<!DOCTYPE html>
<html lang="zh-TW">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>AI æ‰¹é‡åœ–ç‰‡ç”Ÿæˆå™¨ - å¢å¼·ç‰ˆ</title>
    <link rel="stylesheet" href="css/design-system.css">
    <link rel="icon" href="data:image/svg+xml,<svg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 100 100'><text y='.9em' font-size='90'>ğŸ¨</text></svg>">
    <style>
        /* å¢å¼·çš„é é¢ç‰¹å®šæ¨£å¼ */
        .hero-section {
            background: linear-gradient(135deg, var(--primary-500), var(--secondary-500));
            color: white;
            padding: var(--space-20) 0;
            text-align: center;
            position: relative;
            overflow: hidden;
        }

        .hero-section::before {
            content: '';
            position: absolute;
            top: -50%;
            left: -50%;
            width: 200%;
            height: 200%;
            background: url('data:image/svg+xml,<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 100 100"><defs><pattern id="grid" width="10" height="10" patternUnits="userSpaceOnUse"><path d="M 10 0 L 0 0 0 10" fill="none" stroke="rgba(255,255,255,0.1)" stroke-width="1"/></pattern></defs><rect width="100" height="100" fill="url(%23grid)"/></svg>');
            animation: float 20s ease-in-out infinite;
            z-index: 0;
        }

        @keyframes float {
            0%, 100% { transform: translateY(0) rotate(0deg); }
            50% { transform: translateY(-20px) rotate(2deg); }
        }

        .hero-content {
            position: relative;
            z-index: 1;
        }

        .generation-form {
            background: white;
            border-radius: var(--radius-2xl);
            padding: var(--space-8);
            box-shadow: var(--shadow-2xl);
            margin-top: calc(-1 * var(--space-16));
            position: relative;
            z-index: 2;
        }

        .prompt-input {
            width: 100%;
            min-height: 120px;
            padding: var(--space-4);
            border: 2px solid var(--gray-200);
            border-radius: var(--radius-lg);
            resize: vertical;
            font-family: var(--font-body);
            font-size: var(--text-base);
            transition: var(--transition-base);
        }

        .prompt-input:focus {
            border-color: var(--primary-500);
            box-shadow: 0 0 0 3px rgba(59, 130, 246, 0.1);
            outline: none;
        }

        .settings-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: var(--space-4);
            margin: var(--space-6) 0;
        }

        .progress-section {
            margin: var(--space-8) 0;
            padding: var(--space-6);
            background: var(--gray-50);
            border-radius: var(--radius-xl);
            display: none;
        }

        .progress-section.active {
            display: block;
        }

        .image-gallery {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(300px, 1fr));
            gap: var(--space-6);
            margin-top: var(--space-8);
        }

        .image-card {
            background: white;
            border-radius: var(--radius-xl);
            overflow: hidden;
            box-shadow: var(--shadow-lg);
            transition: var(--transition-base);
        }

        .image-card:hover {
            transform: translateY(-4px);
            box-shadow: var(--shadow-2xl);
        }

        .image-placeholder {
            width: 100%;
            height: 300px;
            background: linear-gradient(45deg, var(--gray-100), var(--gray-200));
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: var(--text-4xl);
            color: var(--gray-400);
        }

        .quick-prompts {
            display: flex;
            flex-wrap: wrap;
            gap: var(--space-2);
            margin: var(--space-4) 0;
        }

        .quick-prompt-btn {
            padding: var(--space-2) var(--space-3);
            background: var(--gray-100);
            border: 1px solid var(--gray-300);
            border-radius: var(--radius-full);
            font-size: var(--text-sm);
            cursor: pointer;
            transition: var(--transition-base);
        }

        .quick-prompt-btn:hover {
            background: var(--primary-50);
            border-color: var(--primary-300);
            color: var(--primary-700);
        }

        .status-indicator {
            display: inline-flex;
            align-items: center;
            gap: var(--space-2);
            padding: var(--space-2) var(--space-3);
            border-radius: var(--radius-full);
            font-size: var(--text-sm);
            font-weight: 500;
        }

        .status-indicator.idle {
            background: var(--gray-100);
            color: var(--gray-700);
        }

        .status-indicator.processing {
            background: var(--primary-100);
            color: var(--primary-700);
        }

        .status-indicator.success {
            background: var(--success-50);
            color: var(--success-600);
        }

        .status-indicator.error {
            background: var(--error-50);
            color: var(--error-600);
        }

        .pulse {
            animation: pulse 2s infinite;
        }

        @keyframes pulse {
            0%, 100% { opacity: 1; }
            50% { opacity: 0.5; }
        }

        .feature-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
            gap: var(--space-6);
            margin: var(--space-16) 0;
        }

        .feature-card {
            text-align: center;
            padding: var(--space-6);
        }

        .feature-icon {
            font-size: var(--text-4xl);
            margin-bottom: var(--space-4);
        }
    </style>
</head>
<body>
    <!-- è‹±é›„å€æ®µ -->
    <section class="hero-section">
        <div class="hero-content">
            <div class="container">
                <h1 class="text-5xl font-bold mb-4">AI æ‰¹é‡åœ–ç‰‡ç”Ÿæˆå™¨</h1>
                <p class="text-xl mb-8">ä½¿ç”¨æœ€å…ˆé€²çš„ AI æŠ€è¡“ï¼Œå°‡æ‚¨çš„å‰µæ„è½‰åŒ–ç‚ºé©šäººçš„è¦–è¦ºä½œå“</p>
                <div class="status-indicator idle" id="systemStatus">
                    <span>ğŸŸ¢</span>
                    <span>ç³»çµ±å°±ç·’</span>
                </div>
            </div>
        </div>
    </section>

    <div class="container">
        <!-- ä¸»è¦ç”Ÿæˆè¡¨å–® -->
        <div class="generation-form">
            <form id="imageGenerationForm">
                <div class="form-group">
                    <label class="form-label" for="prompt">
                        ğŸ¨ åœ–ç‰‡æè¿°æç¤ºè©
                        <span class="text-sm text-gray-500 font-normal">
                            (è©³ç´°æè¿°æ‚¨æƒ³è¦ç”Ÿæˆçš„åœ–ç‰‡)
                        </span>
                    </label>
                    <textarea 
                        class="prompt-input" 
                        id="prompt" 
                        name="prompt" 
                        placeholder="ä¾‹å¦‚ï¼šä¸€å€‹ç¾éº—çš„æ—¥è½é¢¨æ™¯ï¼Œå±±è„ˆèƒŒæ™¯ï¼Œæº«æš–çš„æ©™è‰²å¤©ç©ºï¼Œå¯§éœçš„æ¹–é¢å€’æ˜ ..."
                        required
                    ></textarea>
                    
                    <!-- å¿«é€Ÿæç¤ºè©æŒ‰éˆ• -->
                    <div class="quick-prompts">
                        <button type="button" class="quick-prompt-btn" data-prompt="ç¾éº—çš„æ—¥è½é¢¨æ™¯ï¼Œå±±è„ˆèƒŒæ™¯">ğŸŒ… æ—¥è½é¢¨æ™¯</button>
                        <button type="button" class="quick-prompt-btn" data-prompt="ç¾ä»£åŸå¸‚å¤œæ™¯ï¼Œéœ“è™¹ç‡ˆé–ƒçˆ">ğŸ™ï¸ åŸå¸‚å¤œæ™¯</button>
                        <button type="button" class="quick-prompt-btn" data-prompt="å¯æ„›çš„è²“å’ªï¼Œæ¯›èŒ¸èŒ¸ï¼Œå¤§çœ¼ç›">ğŸ± å¯æ„›è²“å’ª</button>
                        <button type="button" class="quick-prompt-btn" data-prompt="æŠ½è±¡è—è¡“ï¼Œè‰²å½©è±å¯Œï¼Œå¹¾ä½•åœ–æ¡ˆ">ğŸ¨ æŠ½è±¡è—è¡“</button>
                        <button type="button" class="quick-prompt-btn" data-prompt="ç§‘å¹»å¤ªç©ºç«™ï¼Œæœªä¾†ç§‘æŠ€æ„Ÿ">ğŸš€ ç§‘å¹»å ´æ™¯</button>
                    </div>
                </div>

                <div class="settings-grid">
                    <div class="form-group">
                        <label class="form-label" for="negative_prompt">ğŸš« è² é¢æç¤ºè©</label>
                        <input 
                            type="text" 
                            class="form-input" 
                            id="negative_prompt" 
                            name="negative_prompt" 
                            placeholder="ä¾‹å¦‚ï¼šæ¨¡ç³Šã€ä½å“è³ªã€è®Šå½¢"
                        >
                    </div>

                    <div class="form-group">
                        <label class="form-label" for="image_size">ğŸ“ åœ–ç‰‡å°ºå¯¸</label>
                        <select class="form-input" id="image_size" name="image_size">
                            <option value="512x512">512Ã—512 (å°)</option>
                            <option value="768x768">768Ã—768 (ä¸­)</option>
                            <option value="1024x1024" selected>1024Ã—1024 (å¤§)</option>
                            <option value="1152x896">1152Ã—896 (å¯¬)</option>
                            <option value="896x1152">896Ã—1152 (é«˜)</option>
                        </select>
                    </div>

                    <div class="form-group">
                        <label class="form-label" for="image_count">ğŸ”¢ ç”Ÿæˆæ•¸é‡</label>
                        <select class="form-input" id="image_count" name="image_count">
                            <option value="1" selected>1 å¼µ</option>
                            <option value="2">2 å¼µ</option>
                            <option value="3">3 å¼µ</option>
                            <option value="4">4 å¼µ</option>
                            <option value="5">5 å¼µ</option>
                        </select>
                    </div>

                    <div class="form-group">
                        <label class="form-label" for="api_provider">ğŸ¤– AI æä¾›å•†</label>
                        <select class="form-input" id="api_provider" name="api_provider">
                            <option value="gemini" selected>Google Gemini</option>
                            <option value="openai">OpenAI DALL-E</option>
                            <option value="stability">Stability AI</option>
                            <option value="huggingface">HuggingFace</option>
                            <option value="replicate">Replicate</option>
                        </select>
                    </div>

                    <div class="form-group">
                        <label class="form-label" for="api_key">ğŸ”‘ API é‡‘é‘°</label>
                        <input 
                            type="password" 
                            class="form-input" 
                            id="api_key" 
                            name="api_key" 
                            placeholder="è¼¸å…¥æ‚¨çš„ API é‡‘é‘°"
                            required
                        >
                    </div>
                </div>

                <div class="flex justify-center gap-4">
                    <button type="submit" class="btn btn-primary btn-lg" id="generateBtn">
                        <span>ğŸ¨ é–‹å§‹ç”Ÿæˆ</span>
                    </button>
                    <button type="button" class="btn btn-secondary btn-lg" id="analyzeBtn">
                        <span>ğŸ” åˆ†ææç¤ºè©</span>
                    </button>
                </div>
            </form>
        </div>

        <!-- é€²åº¦å€æ®µ -->
        <div class="progress-section" id="progressSection">
            <h3 class="text-xl font-semibold mb-4">ğŸš€ ç”Ÿæˆé€²åº¦</h3>
            <div class="progress-container">
                <div class="progress-bar" id="progressBar"></div>
            </div>
            <div id="progressText" class="text-center mt-4 text-gray-600">
                æº–å‚™é–‹å§‹ç”Ÿæˆ...
            </div>
        </div>

        <!-- éŒ¯èª¤è¨Šæ¯å€åŸŸ -->
        <div id="errorContainer"></div>

        <!-- åœ–ç‰‡ç•«å»Š -->
        <div class="image-gallery" id="imageGallery">
            <!-- ç”Ÿæˆçš„åœ–ç‰‡å°‡é¡¯ç¤ºåœ¨é€™è£¡ -->
        </div>

        <!-- åŠŸèƒ½ç‰¹é» -->
        <div class="feature-grid">
            <div class="feature-card">
                <div class="feature-icon">âš¡</div>
                <h3 class="text-lg font-semibold mb-2">æ¥µé€Ÿç”Ÿæˆ</h3>
                <p class="text-gray-600">å…ˆé€²çš„ AI æŠ€è¡“ï¼Œå¿«é€Ÿç”Ÿæˆé«˜å“è³ªåœ–ç‰‡</p>
            </div>
            <div class="feature-card">
                <div class="feature-icon">ğŸ¯</div>
                <h3 class="text-lg font-semibold mb-2">ç²¾æº–æ§åˆ¶</h3>
                <p class="text-gray-600">æ”¯æ´è² é¢æç¤ºè©ï¼Œç²¾ç¢ºæ§åˆ¶ç”Ÿæˆçµæœ</p>
            </div>
            <div class="feature-card">
                <div class="feature-icon">ğŸ”„</div>
                <h3 class="text-lg font-semibold mb-2">æ‰¹é‡è™•ç†</h3>
                <p class="text-gray-600">ä¸€æ¬¡ç”Ÿæˆå¤šå¼µåœ–ç‰‡ï¼Œæé«˜å·¥ä½œæ•ˆç‡</p>
            </div>
            <div class="feature-card">
                <div class="feature-icon">ğŸŒ</div>
                <h3 class="text-lg font-semibold mb-2">å¤šå¹³å°æ”¯æ´</h3>
                <p class="text-gray-600">æ•´åˆå¤šå€‹ AI å¹³å°ï¼Œé¸æ“‡æœ€é©åˆçš„æœå‹™</p>
            </div>
        </div>
    </div>

    <script>
        // ä¸»è¦æ‡‰ç”¨é¡
        class ImageGeneratorApp {
            constructor() {
                this.form = document.getElementById('imageGenerationForm');
                this.progressSection = document.getElementById('progressSection');
                this.progressBar = document.getElementById('progressBar');
                this.progressText = document.getElementById('progressText');
                this.imageGallery = document.getElementById('imageGallery');
                this.errorContainer = document.getElementById('errorContainer');
                this.systemStatus = document.getElementById('systemStatus');
                
                this.initializeEventListeners();
                this.checkSystemHealth();
            }

            initializeEventListeners() {
                // è¡¨å–®æäº¤
                this.form.addEventListener('submit', (e) => {
                    e.preventDefault();
                    this.generateImages();
                });

                // å¿«é€Ÿæç¤ºè©æŒ‰éˆ•
                document.querySelectorAll('.quick-prompt-btn').forEach(btn => {
                    btn.addEventListener('click', () => {
                        const prompt = btn.dataset.prompt;
                        document.getElementById('prompt').value = prompt;
                    });
                });

                // åˆ†ææç¤ºè©æŒ‰éˆ•
                document.getElementById('analyzeBtn').addEventListener('click', () => {
                    this.analyzePrompt();
                });

                // API æä¾›å•†è®Šæ›´æ™‚çš„è™•ç†
                document.getElementById('api_provider').addEventListener('change', (e) => {
                    this.updateAPIProviderInfo(e.target.value);
                });
            }

            async checkSystemHealth() {
                try {
                    const response = await fetch('/health');
                    const data = await response.json();
                    
                    if (data.status === 'healthy') {
                        this.updateSystemStatus('success', 'ç³»çµ±é‹è¡Œæ­£å¸¸');
                    } else {
                        this.updateSystemStatus('warning', 'ç³»çµ±ç‹€æ…‹ç•°å¸¸');
                    }
                } catch (error) {
                    this.updateSystemStatus('error', 'ç„¡æ³•é€£æ¥åˆ°æœå‹™å™¨');
                }
            }

            updateSystemStatus(type, message) {
                const statusMap = {
                    success: { icon: 'ğŸŸ¢', class: 'success' },
                    warning: { icon: 'ğŸŸ¡', class: 'warning' },
                    error: { icon: 'ğŸ”´', class: 'error' }
                };
                
                const status = statusMap[type];
                this.systemStatus.className = `status-indicator ${status.class}`;
                this.systemStatus.innerHTML = `<span>${status.icon}</span><span>${message}</span>`;
            }

            async generateImages() {
                const formData = new FormData(this.form);
                const data = Object.fromEntries(formData.entries());

                // æ¸…é™¤ä¹‹å‰çš„éŒ¯èª¤
                this.clearErrors();

                // é¡¯ç¤ºé€²åº¦
                this.showProgress();
                this.updateProgress(0, 'æº–å‚™ç”Ÿæˆ...');

                try {
                    // é©—è­‰è¼¸å…¥
                    this.validateInputs(data);

                    // æ›´æ–°ç‹€æ…‹
                    this.updateSystemStatus('processing', 'æ­£åœ¨ç”Ÿæˆåœ–ç‰‡...');
                    this.updateProgress(20, 'é€£æ¥ AI æœå‹™...');

                    const response = await fetch('/api/generate-image', {
                        method: 'POST',
                        headers: {
                            'Content-Type': 'application/json',
                        },
                        body: JSON.stringify(data)
                    });

                    this.updateProgress(60, 'AI æ­£åœ¨å‰µä½œ...');

                    const result = await response.json();

                    if (result.success) {
                        this.updateProgress(100, 'ç”Ÿæˆå®Œæˆï¼');
                        this.displayImages(result.images);
                        this.updateSystemStatus('success', 'ç”ŸæˆæˆåŠŸ');
                        
                        setTimeout(() => {
                            this.hideProgress();
                        }, 2000);
                    } else {
                        throw new Error(result.error?.message || 'ç”Ÿæˆå¤±æ•—');
                    }

                } catch (error) {
                    this.handleError(error);
                    this.updateSystemStatus('error', 'ç”Ÿæˆå¤±æ•—');
                    this.hideProgress();
                }
            }

            async analyzePrompt() {
                const prompt = document.getElementById('prompt').value;
                
                if (!prompt.trim()) {
                    this.showError('è«‹å…ˆè¼¸å…¥æç¤ºè©');
                    return;
                }

                try {
                    const response = await fetch('/api/analyze-prompt', {
                        method: 'POST',
                        headers: {
                            'Content-Type': 'application/json',
                        },
                        body: JSON.stringify({ prompt })
                    });

                    const result = await response.json();
                    this.displayAnalysisResult(result);

                } catch (error) {
                    this.showError('åˆ†æå¤±æ•—ï¼š' + error.message);
                }
            }

            validateInputs(data) {
                if (!data.prompt?.trim()) {
                    throw new Error('è«‹è¼¸å…¥åœ–ç‰‡æè¿°');
                }

                if (!data.api_key?.trim()) {
                    throw new Error('è«‹è¼¸å…¥ API é‡‘é‘°');
                }

                const imageCount = parseInt(data.image_count);
                if (imageCount < 1 || imageCount > 10) {
                    throw new Error('åœ–ç‰‡æ•¸é‡å¿…é ˆåœ¨ 1-10 ä¹‹é–“');
                }
            }

            showProgress() {
                this.progressSection.classList.add('active');
            }

            hideProgress() {
                this.progressSection.classList.remove('active');
            }

            updateProgress(percentage, text) {
                this.progressBar.style.width = `${percentage}%`;
                this.progressText.textContent = text;
            }

            displayImages(images) {
                this.imageGallery.innerHTML = '';

                images.forEach((image, index) => {
                    const imageCard = document.createElement('div');
                    imageCard.className = 'image-card';
                    
                    imageCard.innerHTML = `
                        <div class="image-placeholder">
                            ğŸ¨ åœ–ç‰‡ ${index + 1}
                        </div>
                        <div class="card-body">
                            <p class="text-sm text-gray-600">æª”å: ${image.filename}</p>
                            <div class="flex gap-2 mt-3">
                                <button class="btn btn-sm btn-primary" onclick="downloadImage('${image.url}', '${image.filename}')">
                                    ğŸ’¾ ä¸‹è¼‰
                                </button>
                                <button class="btn btn-sm btn-secondary" onclick="shareImage('${image.url}')">
                                    ğŸ“¤ åˆ†äº«
                                </button>
                            </div>
                        </div>
                    `;

                    this.imageGallery.appendChild(imageCard);
                });
            }

            displayAnalysisResult(result) {
                const notification = this.createNotification(
                    'info',
                    'æç¤ºè©åˆ†æçµæœ',
                    `
                    <div>
                        <p><strong>å“è³ªè©•åˆ†:</strong> ${result.analysis?.quality_score || 'N/A'}/10</p>
                        <p><strong>è¤‡é›œåº¦:</strong> ${result.analysis?.complexity || 'N/A'}</p>
                        <p><strong>é ä¼°ç”Ÿæˆæ™‚é–“:</strong> ${result.analysis?.estimated_generation_time || 'N/A'}</p>
                        ${result.analysis?.suggestions ? `
                            <div class="mt-2">
                                <strong>æ”¹é€²å»ºè­°:</strong>
                                <ul class="mt-1">
                                    ${result.analysis.suggestions.map(s => `<li>â€¢ ${s}</li>`).join('')}
                                </ul>
                            </div>
                        ` : ''}
                    </div>
                    `
                );
                
                this.showNotification(notification);
            }

            handleError(error) {
                console.error('Generation error:', error);
                
                const errorMessage = typeof error === 'object' && error.error ? 
                    error.error.message : error.message || 'æœªçŸ¥éŒ¯èª¤';
                
                this.showError(errorMessage);
            }

            showError(message) {
                const notification = this.createNotification('error', 'éŒ¯èª¤', message);
                this.showNotification(notification);
            }

            clearErrors() {
                this.errorContainer.innerHTML = '';
            }

            createNotification(type, title, message) {
                const notification = document.createElement('div');
                notification.className = `notification notification-${type}`;
                
                notification.innerHTML = `
                    <div class="notification-content">
                        <div class="notification-message">
                            <strong>${title}</strong><br>
                            ${message}
                        </div>
                        <button class="notification-close">&times;</button>
                    </div>
                `;

                return notification;
            }

            showNotification(notification) {
                this.errorContainer.appendChild(notification);
                
                // é¡¯ç¤ºå‹•ç•«
                setTimeout(() => notification.classList.add('show'), 100);
                
                // è‡ªå‹•é—œé–‰
                setTimeout(() => {
                    notification.classList.remove('show');
                    setTimeout(() => notification.remove(), 300);
                }, 5000);

                // æ‰‹å‹•é—œé–‰
                notification.querySelector('.notification-close').addEventListener('click', () => {
                    notification.classList.remove('show');
                    setTimeout(() => notification.remove(), 300);
                });
            }

            updateAPIProviderInfo(provider) {
                const infoMap = {
                    'gemini': 'Google çš„å…ˆé€²åœ–åƒç”Ÿæˆæ¨¡å‹',
                    'openai': 'OpenAI çš„ DALL-E æ¨¡å‹',
                    'stability': 'Stability AI çš„ Stable Diffusion',
                    'huggingface': 'HuggingFace å¹³å°æ¨¡å‹',
                    'replicate': 'Replicate å¹³å°æ¨¡å‹'
                };

                // å¯ä»¥åœ¨é€™è£¡é¡¯ç¤ºæä¾›å•†ä¿¡æ¯
                console.log(`é¸æ“‡çš„æä¾›å•†: ${provider} - ${infoMap[provider]}`);
            }
        }

        // å…¨å±€å‡½æ•¸
        function downloadImage(url, filename) {
            const a = document.createElement('a');
            a.href = url;
            a.download = filename;
            document.body.appendChild(a);
            a.click();
            document.body.removeChild(a);
        }

        function shareImage(url) {
            if (navigator.share) {
                navigator.share({
                    title: 'AI ç”Ÿæˆçš„åœ–ç‰‡',
                    url: url
                });
            } else {
                // è¤‡è£½åˆ°å‰ªè²¼æ¿
                navigator.clipboard.writeText(url).then(() => {
                    alert('åœ–ç‰‡é€£çµå·²è¤‡è£½åˆ°å‰ªè²¼æ¿');
                });
            }
        }

        // åˆå§‹åŒ–æ‡‰ç”¨
        document.addEventListener('DOMContentLoaded', () => {
            new ImageGeneratorApp();
        });
    </script>
</body>
</html> 