<!DOCTYPE html>
<html lang="zh-TW">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>æ‰¹é‡åœ–ç‰‡ç”Ÿæˆå™¨ - Multi-AI Image Generator</title>
    <!-- æ‰€æœ‰èˆŠçš„ CSS å’Œ Style æ¨™ç±¤å·²è¢«ç§»é™¤ï¼Œå°‡ç”± Vite çµ±ä¸€ç®¡ç† -->
</head>
<body>
    <!-- æ‡‰ç”¨ç¨‹å¼çš„ä¸»é«” HTML çµæ§‹è¢«ä¿ç•™ -->
    <div class="container">
        <header>
            <h1><i class="fas fa-magic"></i> æ‰¹é‡åœ–ç‰‡ç”Ÿæˆå™¨</h1>
            <div class="header-controls">
                <button id="theme-toggle" class="icon-button" title="åˆ‡æ›ä¸»é¡Œ"><i class="fas fa-sun"></i></button>
                <button id="api-key-manager-btn" class="icon-button" title="API é‡‘é‘°ç®¡ç†"><i class="fas fa-key"></i></button>
            </div>
        </header>

        <main>
            <!-- ä¸»é¡Œå’Œèªè¨€åˆ‡æ›æŒ‰éˆ• -->
            <div class="top-controls">
                <!-- èªè¨€åˆ‡æ›å™¨ -->
                <div class="language-toggle" id="languageToggle">
                    <span class="language-icon">ğŸŒ</span>
                    <span id="languageText" data-i18n="language.current">ç¹é«”ä¸­æ–‡</span>
                    <div class="language-dropdown" id="languageDropdown">
                        <div class="language-option" data-language="zh-TW" onclick="i18n.changeLanguage('zh-TW')">
                            <span class="language-flag">ğŸ‡¹ğŸ‡¼</span>
                            <span class="language-name" data-i18n="language.zhTW">ç¹é«”ä¸­æ–‡</span>
                        </div>
                        <div class="language-option" data-language="zh-CN" onclick="i18n.changeLanguage('zh-CN')">
                            <span class="language-flag">ğŸ‡¨ğŸ‡³</span>
                            <span class="language-name" data-i18n="language.zhCN">ç®€ä½“ä¸­æ–‡</span>
                        </div>
                        <div class="language-option" data-language="en" onclick="i18n.changeLanguage('en')">
                            <span class="language-flag">ğŸ‡ºğŸ‡¸</span>
                            <span class="language-name" data-i18n="language.en">English</span>
                        </div>
                    </div>
                </div>

                <!-- ä¸»é¡Œåˆ‡æ›æŒ‰éˆ• -->
                <button class="theme-toggle" onclick="toggleTheme()">
                    <span class="theme-icon" id="themeIcon">ğŸŒ™</span>
                    <span id="themeText" data-i18n="theme.dark">æ·±è‰²æ¨¡å¼</span>
                </button>
            </div>

            <!-- å°èˆªæ¨™ç±¤ -->
            <nav class="tab-navigation">
                <button class="tab-btn active" onclick="switchTab('generator')" data-i18n="nav.generator">åœ–ç‰‡ç”Ÿæˆ</button>
                <button class="tab-btn" onclick="switchTab('gallery')" data-i18n="nav.gallery">åœ–ç‰‡ç•«å»Š</button>
                <button class="tab-btn" onclick="switchTab('history')" data-i18n="nav.history">ç”Ÿæˆæ­·å²</button>
                <button class="tab-btn" onclick="switchTab('statistics')" data-i18n="nav.statistics">çµ±è¨ˆåˆ†æ</button>
            </nav>

            <!-- åœ–ç‰‡ç”Ÿæˆæ¨™ç±¤é  -->
            <div id="generatorTab" class="tab-content active">
                <div class="main-content">
                    <!-- æç¤ºè©è¼¸å…¥å€åŸŸ -->
                    <div class="input-section">
                        <h2 data-i18n="generator.prompts.label">ğŸ“ è¼¸å…¥æç¤ºè©</h2>
                        <div class="prompts-container">
                            <textarea id="prompts" data-i18n="generator.prompts.placeholder" rows="10"></textarea>
                            <div class="prompt-count"><span data-i18n="generator.prompt.count">æç¤ºè©æ•¸é‡</span>: <span id="promptCount">0</span></div>
                        </div>
                    </div>

                    <!-- AI æ™ºèƒ½åŠ©æ‰‹é¢æ¿ v2.7 -->
                    <div class="ai-assistant-v27" id="aiAssistantV27">
                        <!-- AI Assistant å…§å®¹å°‡ç”± JavaScript å‹•æ…‹ç”Ÿæˆ -->
                    </div>

                    <!-- æç¤ºè©å¢å¼·é¢æ¿ -->
                    <div class="prompt-enhancer-panel" id="promptEnhancerPanel">
                        <div class="enhancer-header" onclick="toggleEnhancerPanel()">
                            <h3 data-i18n="prompt.enhancer.title">ğŸ”§ æç¤ºè©å¢å¼·å·¥å…·</h3>
                            <button class="toggle-enhancer" id="toggleEnhancer" data-i18n="prompt.enhancer.toggle">æ”¶èµ·</button>
                        </div>
                        
                        <div class="enhancer-content" id="enhancerContent">
                            <!-- æç¤ºè©åˆ†æå€åŸŸ -->
                            <div class="analysis-section">
                                <h4 data-i18n="prompt.analysis.title">ğŸ“Š æç¤ºè©åˆ†æ</h4>
                                <div class="analysis-results" id="analysisResults">
                                    <div class="analysis-item">
                                        <span data-i18n="prompt.analysis.length">é•·åº¦:</span>
                                        <span id="promptLength">0</span>
                                    </div>
                                    <div class="analysis-item">
                                        <span data-i18n="prompt.analysis.complexity">è¤‡é›œåº¦:</span>
                                        <span id="promptComplexity">-</span>
                                    </div>
                                    <div class="analysis-item">
                                        <span data-i18n="prompt.analysis.quality">å“è³ªåˆ†æ•¸:</span>
                                        <span id="qualityScore">0/100</span>
                                    </div>
                                </div>
                            </div>

                            <!-- èªæ³•æª¢æŸ¥çµæœ -->
                            <div class="syntax-section">
                                <h4 data-i18n="prompt.syntax.title">âœ… èªæ³•æª¢æŸ¥</h4>
                                <div class="syntax-results" id="syntaxResults">
                                    <div class="syntax-status">ç­‰å¾…åˆ†æ...</div>
                                </div>
                            </div>

                            <!-- AI å„ªåŒ–å»ºè­° -->
                            <div class="optimization-section">
                                <h4 data-i18n="prompt.optimization.title">ğŸ¤– AI å„ªåŒ–å»ºè­°</h4>
                                <div class="optimization-controls">
                                    <button class="enhance-btn" onclick="optimizePrompts()" data-i18n="prompt.optimize.btn">å„ªåŒ–æç¤ºè©</button>
                                    <button class="enhance-btn" onclick="translatePrompts()" data-i18n="prompt.translate.btn">ç¿»è­¯æç¤ºè©</button>
                                </div>
                                <div class="optimization-results" id="optimizationResults"></div>
                            </div>

                            <!-- è² é¢æç¤ºè© -->
                            <div class="negative-prompts-section">
                                <h4 data-i18n="prompt.negative.title">ğŸš« è² é¢æç¤ºè©</h4>
                                <textarea 
                                    id="negativePrompts" 
                                    placeholder="è¼¸å…¥æ‚¨æƒ³è¦é¿å…çš„å…ƒç´ ..." 
                                    data-i18n="prompt.negative.placeholder"
                                    rows="3"></textarea>
                                <div class="negative-suggestions">
                                    <strong data-i18n="prompt.negative.suggestions">å¸¸ç”¨å»ºè­°:</strong>
                                    <div class="suggestion-tags" id="negativeSuggestions"></div>
                                </div>
                            </div>

                            <!-- æç¤ºè©æ¨¡æ¿åº« -->
                            <div class="templates-section">
                                <h4 data-i18n="prompt.templates.title">ğŸ“š æç¤ºè©æ¨¡æ¿åº«</h4>
                                <div class="template-controls">
                                    <select id="templateCategory" data-i18n="prompt.templates.select">
                                        <option value="" data-i18n="prompt.templates.select">é¸æ“‡åˆ†é¡...</option>
                                        <option value="portrait" data-i18n="template.portrait">äººåƒæ”å½±</option>
                                        <option value="landscape" data-i18n="template.landscape">é¢¨æ™¯ç•«é¢</option>
                                        <option value="abstract" data-i18n="template.abstract">æŠ½è±¡è—è¡“</option>
                                        <option value="fantasy" data-i18n="template.fantasy">å¥‡å¹»é¢¨æ ¼</option>
                                        <option value="anime" data-i18n="template.anime">å‹•æ¼«é¢¨æ ¼</option>
                                        <option value="realistic" data-i18n="template.realistic">å¯«å¯¦é¢¨æ ¼</option>
                                    </select>
                                    <button class="enhance-btn" onclick="saveAsTemplate()" data-i18n="prompt.templates.save">ä¿å­˜æ¨¡æ¿</button>
                                </div>
                                <div class="template-suggestions" id="templateSuggestions"></div>
                            </div>

                            <!-- é«˜ç´šè¨­ç½® -->
                            <div class="advanced-settings">
                                <h4 data-i18n="prompt.advanced.title">âš™ï¸ é«˜ç´šè¨­ç½®</h4>
                                <div class="setting-row">
                                    <label>
                                        <input type="checkbox" id="autoOptimize">
                                        <span data-i18n="prompt.auto.optimize">è‡ªå‹•å„ªåŒ–</span>
                                    </label>
                                </div>
                                <div class="setting-row">
                                    <label data-i18n="prompt.optimization.level">å„ªåŒ–ç¨‹åº¦:</label>
                                    <select id="optimizationLevel">
                                        <option value="light" data-i18n="optimization.light">è¼•åº¦</option>
                                        <option value="moderate" data-i18n="optimization.moderate" selected>ä¸­åº¦</option>
                                        <option value="aggressive" data-i18n="optimization.aggressive">æ¿€é€²</option>
                                    </select>
                                </div>
                                <div class="setting-row">
                                    <label data-i18n="prompt.target.language">ç›®æ¨™èªè¨€:</label>
                                    <select id="targetLanguage">
                                        <option value="zh-TW">ç¹é«”ä¸­æ–‡</option>
                                        <option value="zh-CN">ç®€ä½“ä¸­æ–‡</option>
                                        <option value="en" selected>English</option>
                                        <option value="ja" data-i18n="language.ja">æ—¥æœ¬èª</option>
                                        <option value="ko" data-i18n="language.ko">í•œêµ­ì–´</option>
                                    </select>
                                </div>
                            </div>
                        </div>
                    </div>

                    <!-- ç”Ÿæˆè¨­ç½® -->
                    <div class="settings-section">
                        <h2 data-i18n="generator.settings">âš™ï¸ ç”Ÿæˆè¨­ç½®</h2>
                        <div class="settings-grid">
                            <div class="setting-item">
                                <label for="apiProvider" data-i18n="generator.apiProvider">API æä¾›å•†:</label>
                                <select id="apiProvider">
                                    <option value="gemini" selected data-i18n="api.gemini">Google Gemini</option>
                                    <option value="openai" data-i18n="api.openai">OpenAI DALL-E</option>
                                    <option value="stability" data-i18n="api.stability">Stability AI</option>
                                    <option value="adobe_firefly" data-i18n="api.adobe_firefly">Adobe Firefly âœ¨</option>
                                    <option value="leonardo_ai" data-i18n="api.leonardo_ai">Leonardo AI âœ¨</option>
                                    <option value="custom" data-i18n="api.custom">è‡ªå®šç¾© API</option>
                                </select>
                            </div>
                            <div class="setting-item">
                                <label for="imageSize" data-i18n="generator.imageSize">åœ–ç‰‡å°ºå¯¸:</label>
                                <select id="imageSize">
                                    <option value="512x512" data-i18n="size.512x512">512 x 512</option>
                                    <option value="1024x1024" selected data-i18n="size.1024x1024">1024 x 1024</option>
                                    <option value="1024x768" data-i18n="size.1024x768">1024 x 768</option>
                                    <option value="768x1024" data-i18n="size.768x1024">768 x 1024</option>
                                </select>
                            </div>
                            <div class="setting-item">
                                <label for="imageCount" data-i18n="generator.imageCount">æ¯å€‹æç¤ºè©ç”Ÿæˆæ•¸é‡:</label>
                                <input type="number" id="imageCount" min="1" max="5" value="1">
                            </div>
                            <div class="setting-item" id="modelSelectionSection">
                                <label for="modelSelect" data-i18n="generator.model">æ¨¡å‹é¸æ“‡:</label>
                                <select id="modelSelect">
                                    <option value="" data-i18n="model.default">é è¨­æ¨¡å‹</option>
                                </select>
                            </div>
                        </div>
                        
                        <!-- API é‡‘é‘°è¨­ç½® -->
                        <div id="apiKeySettings" class="api-key-section">
                            <h3>ğŸ”‘ API é‡‘é‘°è¨­ç½®</h3>
                            <div class="settings-grid">
                                <div class="setting-item" id="geminiKeySection">
                                    <label for="geminiApiKey">Gemini API é‡‘é‘°:</label>
                                    <input type="password" id="geminiApiKey" placeholder="æ‚¨çš„ Gemini API é‡‘é‘°">
                                </div>
                                <div class="setting-item" id="openaiKeySection" style="display: none;">
                                    <label for="openaiApiKey">OpenAI API é‡‘é‘°:</label>
                                    <input type="password" id="openaiApiKey" placeholder="æ‚¨çš„ OpenAI API é‡‘é‘°">
                                </div>
                                <div class="setting-item" id="stabilityKeySection" style="display: none;">
                                    <label for="stabilityApiKey">Stability AI API é‡‘é‘°:</label>
                                    <input type="password" id="stabilityApiKey" placeholder="æ‚¨çš„ Stability AI API é‡‘é‘°">
                                </div>
                                <div class="setting-item" id="adobeFireflyKeySection" style="display: none;">
                                    <label for="adobeFireflyApiKey">Adobe Firefly API é‡‘é‘°:</label>
                                    <input type="password" id="adobeFireflyApiKey" placeholder="æ‚¨çš„ Adobe Firefly API é‡‘é‘°">
                                </div>
                                <div class="setting-item" id="leonardoAiKeySection" style="display: none;">
                                    <label for="leonardoAiApiKey">Leonardo AI API é‡‘é‘°:</label>
                                    <input type="password" id="leonardoAiApiKey" placeholder="æ‚¨çš„ Leonardo AI API é‡‘é‘°">
                                </div>
                            </div>
                        </div>
                        
                        <!-- è‡ªå®šç¾© API è¨­ç½® -->
                        <div id="customApiSettings" class="custom-api-section" style="display: none;">
                            <h3 data-i18n="api.custom.settings">ğŸ”§ è‡ªå®šç¾© API è¨­ç½®</h3>
                            <div class="settings-grid">
                                <div class="setting-item">
                                    <label for="customApiUrl" data-i18n="api.custom.url">API ç«¯é» URL:</label>
                                    <input type="url" id="customApiUrl" data-i18n="api.custom.url.placeholder" placeholder="https://api.example.com/generate">
                                </div>
                                <div class="setting-item">
                                    <label for="customApiKey" data-i18n="api.custom.key">API é‡‘é‘°:</label>
                                    <input type="password" id="customApiKey" data-i18n="api.custom.key.placeholder" placeholder="æ‚¨çš„ API é‡‘é‘°">
                                </div>
                                <div class="setting-item">
                                    <label for="customModel" data-i18n="api.custom.model">æ¨¡å‹åç¨±:</label>
                                    <input type="text" id="customModel" data-i18n="api.custom.model.placeholder" placeholder="æ¨¡å‹åç¨± (å¯é¸)">
                                </div>
                                <div class="setting-item">
                                    <label for="requestFormat" data-i18n="api.custom.format">è«‹æ±‚æ ¼å¼:</label>
                                    <select id="requestFormat">
                                        <option value="json">JSON</option>
                                        <option value="form">Form Data</option>
                                    </select>
                                </div>
                            </div>
                            <div class="setting-item">
                                <label for="customHeaders" data-i18n="api.custom.headers">è‡ªå®šç¾©è«‹æ±‚é ­ (JSON æ ¼å¼):</label>
                                <textarea id="customHeaders" rows="3" data-i18n="api.custom.headers.placeholder" placeholder='{"Content-Type": "application/json", "Authorization": "Bearer YOUR_TOKEN"}'></textarea>
                            </div>
                            <div class="setting-item">
                                <label for="requestTemplate" data-i18n="api.custom.template">è«‹æ±‚æ¨¡æ¿ (JSON æ ¼å¼):</label>
                                <textarea id="requestTemplate" rows="5" data-i18n="api.custom.template.placeholder" placeholder='{"prompt": "{PROMPT}", "size": "{SIZE}", "n": {COUNT}}'></textarea>
                            </div>
                        </div>
                    </div>

                    <!-- æ§åˆ¶æŒ‰éˆ• -->
                    <div class="controls-section">
                        <button id="generateBtn" class="generate-btn">
                            <span class="btn-text" data-i18n="generator.generate">ğŸš€ é–‹å§‹ç”Ÿæˆ</span>
                            <span class="loading-spinner" style="display: none;" data-i18n="generator.generating">â³ ç”Ÿæˆä¸­...</span>
                        </button>
                        <button id="clearBtn" class="clear-btn" data-i18n="generator.clear">ğŸ—‘ï¸ æ¸…é™¤å…¨éƒ¨</button>
                    </div>

                    <!-- é€²åº¦é¡¯ç¤º -->
                    <div class="progress-section" style="display: none;">
                        <h3 data-i18n="progress.title">ğŸ“Š ç”Ÿæˆé€²åº¦</h3>
                        <div class="progress-bar">
                            <div class="progress-fill" id="progressFill"></div>
                        </div>
                        <div class="progress-text">
                            <span id="progressText" data-i18n="progress.preparing">æº–å‚™ä¸­...</span>
                        </div>
                    </div>

                    <!-- çµæœå±•ç¤º -->
                    <div class="results-section">
                        <h2 data-i18n="results.title">ğŸ–¼ï¸ ç”Ÿæˆçµæœ</h2>
                        <div id="resultsContainer" class="results-grid">
                            <!-- åœ–ç‰‡çµæœæœƒå‹•æ…‹æ’å…¥é€™è£¡ -->
                        </div>
                    </div>
                </div>
            </div>

            <!-- åœ–ç‰‡ç•«å»Šæ¨™ç±¤é  -->
            <div id="galleryTab" class="tab-content">
                <div class="gallery-header">
                    <h2 data-i18n="gallery.title">ğŸ–¼ï¸ åœ–ç‰‡ç•«å»Š</h2>
                    <div class="gallery-stats" id="galleryStats" data-i18n="msg.loading">
                        è¼‰å…¥ä¸­...
                    </div>
                </div>

                <!-- æœå°‹å’Œç¯©é¸ -->
                <div class="gallery-filters">
                    <div class="filter-group">
                        <label for="gallerySearch" data-i18n="gallery.search">ğŸ” æœå°‹æç¤ºè©:</label>
                        <input type="text" id="gallerySearch" data-i18n="gallery.search.placeholder" placeholder="è¼¸å…¥é—œéµå­—æœå°‹...">
                    </div>
                    
                    <div class="filter-group">
                        <label for="providerFilter" data-i18n="gallery.filter.provider">API æä¾›å•†:</label>
                        <select id="providerFilter">
                            <option value="" data-i18n="filter.all">å…¨éƒ¨</option>
                            <option value="gemini" data-i18n="api.gemini">Google Gemini</option>
                            <option value="openai" data-i18n="api.openai">OpenAI DALL-E</option>
                            <option value="stability" data-i18n="api.stability">Stability AI</option>
                            <option value="adobe_firefly" data-i18n="api.adobe_firefly">Adobe Firefly âœ¨</option>
                            <option value="leonardo_ai" data-i18n="api.leonardo_ai">Leonardo AI âœ¨</option>
                            <option value="custom" data-i18n="api.custom">è‡ªå®šç¾© API</option>
                        </select>
                    </div>
                    
                    <div class="filter-group">
                        <label for="favoriteFilter" data-i18n="gallery.filter.favorite">æ”¶è—ç‹€æ…‹:</label>
                        <select id="favoriteFilter">
                            <option value="" data-i18n="filter.all">å…¨éƒ¨</option>
                            <option value="true" data-i18n="filter.favorited">å·²æ”¶è—</option>
                            <option value="false" data-i18n="filter.not.favorited">æœªæ”¶è—</option>
                        </select>
                    </div>
                    
                    <div class="filter-group">
                        <label for="sortBy" data-i18n="gallery.filter.sort">æ’åºæ–¹å¼:</label>
                        <select id="sortBy">
                            <option value="created_at" data-i18n="sort.date">å‰µå»ºæ™‚é–“</option>
                            <option value="rating" data-i18n="sort.rating">è©•åˆ†</option>
                            <option value="filename" data-i18n="sort.filename">æ–‡ä»¶å</option>
                            <option value="api_provider" data-i18n="sort.provider">API æä¾›å•†</option>
                        </select>
                    </div>
                </div>

                <!-- æ‰¹é‡æ“ä½œ -->
                <div class="batch-actions" id="batchActions" style="display: none;">
                    <div class="batch-info">
                        <span data-i18n="gallery.batch.select">å·²é¸æ“‡</span> <span id="selectedCount">0</span> <span data-i18n="gallery.images">å¼µåœ–ç‰‡</span>
                    </div>
                    <div class="batch-buttons">
                        <button id="selectAllImages" class="btn-secondary" data-i18n="btn.select.all">å…¨é¸/å–æ¶ˆå…¨é¸</button>
                        <button id="downloadSelected" class="btn-primary" data-i18n="gallery.batch.download">æ‰¹é‡ä¸‹è¼‰</button>
                        <button id="deleteSelected" class="btn-danger" data-i18n="gallery.batch.delete">æ‰¹é‡åˆªé™¤</button>
                    </div>
                </div>

                <!-- åœ–ç‰‡ç¶²æ ¼ -->
                <div class="gallery-container">
                    <div id="imageGalleryContainer" class="image-grid">
                        <!-- åœ–ç‰‡æœƒå‹•æ…‹è¼‰å…¥åˆ°é€™è£¡ -->
                    </div>
                </div>

                <!-- åˆ†é å°èˆª -->
                <div id="galleryPagination" class="pagination-container">
                    <!-- åˆ†é æ§åˆ¶æœƒå‹•æ…‹è¼‰å…¥åˆ°é€™è£¡ -->
                </div>
            </div>

            <!-- ç”Ÿæˆæ­·å²æ¨™ç±¤é  -->
            <div id="historyTab" class="tab-content">
                <div class="history-header">
                    <h2 data-i18n="history.title">ğŸ“œ ç”Ÿæˆæ­·å²</h2>
                    <div class="history-actions">
                        <button id="exportHistory" class="btn-secondary" data-i18n="history.export">åŒ¯å‡ºæ­·å²</button>
                        <button id="refreshHistory" class="btn-primary" data-i18n="history.refresh">é‡æ–°æ•´ç†</button>
                    </div>
                </div>

                <!-- æ­·å²è¨˜éŒ„åˆ—è¡¨ -->
                <div class="history-container">
                    <div id="historyList" class="history-list">
                        <!-- æ­·å²è¨˜éŒ„æœƒå‹•æ…‹è¼‰å…¥åˆ°é€™è£¡ -->
                    </div>
                </div>

                <!-- æ­·å²åˆ†é  -->
                <div id="historyPagination" class="pagination-container">
                    <!-- åˆ†é æ§åˆ¶æœƒå‹•æ…‹è¼‰å…¥åˆ°é€™è£¡ -->
                </div>
            </div>

            <!-- çµ±è¨ˆåˆ†ææ¨™ç±¤é  -->
            <div id="statisticsTab" class="tab-content">
                <div class="statistics-header">
                    <h2 data-i18n="stats.title">ğŸ“Š çµ±è¨ˆåˆ†æ</h2>
                    <div class="stats-refresh">
                        <button id="refreshStats" class="btn-primary" data-i18n="stats.refresh">é‡æ–°æ•´ç†</button>
                    </div>
                </div>

                <div class="statistics-container">
                    <!-- åŸºæœ¬çµ±è¨ˆ -->
                    <div class="stats-section">
                        <h3 data-i18n="stats.overview">ğŸ“ˆ åŸºæœ¬çµ±è¨ˆ</h3>
                        <div id="basicStats" class="stats-grid">
                            <!-- åŸºæœ¬çµ±è¨ˆæœƒå‹•æ…‹è¼‰å…¥åˆ°é€™è£¡ -->
                        </div>
                    </div>

                    <!-- æŒ‰æä¾›å•†çµ±è¨ˆ -->
                    <div class="stats-section">
                        <h3 data-i18n="stats.provider.usage">ğŸ”§ æŒ‰ API æä¾›å•†çµ±è¨ˆ</h3>
                        <div id="providerStats" class="provider-stats">
                            <!-- æä¾›å•†çµ±è¨ˆæœƒå‹•æ…‹è¼‰å…¥åˆ°é€™è£¡ -->
                        </div>
                    </div>

                    <!-- æœ€è¿‘7å¤©çµ±è¨ˆ -->
                    <div class="stats-section">
                        <h3 data-i18n="stats.daily.activity">ğŸ“… æœ€è¿‘7å¤©ç”Ÿæˆçµ±è¨ˆ</h3>
                        <div id="dailyStats" class="daily-stats">
                            <!-- æ¯æ—¥çµ±è¨ˆæœƒå‹•æ…‹è¼‰å…¥åˆ°é€™è£¡ -->
                        </div>
                    </div>

                    <!-- æˆåŠŸç‡çµ±è¨ˆ -->
                    <div class="stats-section">
                        <h3 data-i18n="stats.success.analysis">âœ… æˆåŠŸç‡åˆ†æ</h3>
                        <div id="successStats" class="success-stats">
                            <!-- æˆåŠŸç‡çµ±è¨ˆæœƒå‹•æ…‹è¼‰å…¥åˆ°é€™è£¡ -->
                        </div>
                    </div>
                </div>
            </div>
        </main>
    </div>
    
    <!-- èˆŠçš„è…³æœ¬å·²è¢«ç§»é™¤ -->
    <!-- Vite æœƒåœ¨æ­¤è™•æ³¨å…¥æ‰€æœ‰å¿…è¦çš„ JavaScript -->
    <script type="module" src="/src/main.js"></script>
</body>
</html>

</rewritten_file>

</rewritten_file>

</rewritten_file>

</rewritten_file>

</rewritten_file>

</rewritten_file>

</rewritten_file>

</rewritten_file>

</rewritten_file>

</rewritten_file>

</rewritten_file>

</rewritten_file>

</rewritten_file>

</rewritten_file>

</rewritten_file>

</rewritten_file>

</rewritten_file>

</rewritten_file>

</rewritten_file>

</rewritten_file>

</rewritten_file>

</rewritten_file>

</rewritten_file>

</rewritten_file>

</rewritten_file>

</rewritten_file>

</rewritten_file>

</rewritten_file>

</rewritten_file>

</rewritten_file>

</rewritten_file>

</rewritten_file>

</rewritten_file>

</rewritten_file>

</rewritten_file>

</rewritten_file>

</rewritten_file>

</rewritten_file>

</rewritten_file>

</rewritten_file>

</rewritten_file>

</rewritten_file>

</rewritten_file>

</rewritten_file>

</rewritten_file>

</rewritten_file>

</rewritten_file>

</rewritten_file>

</rewritten_file>

</rewritten_file>

</rewritten_file>

</rewritten_file>

</rewritten_file>

</rewritten_file>

</rewritten_file>

</rewritten_file>

</rewritten_file>

</rewritten_file>

</rewritten_file>

</rewritten_file>

</rewritten_file>

</rewritten_file>

</rewritten_file>

</rewritten_file>

</rewritten_file>

</rewritten_file>

</rewritten_file>

</rewritten_file>

</rewritten_file>

</rewritten_file>

</rewritten_file>

</rewritten_file>

</rewritten_file>

</rewritten_file>

</rewritten_file>

</rewritten_file>

</rewritten_file>

</rewritten_file>

</rewritten_file>

</rewritten_file>

</rewritten_file>

</rewritten_file>

</rewritten_file>

</rewritten_file>

</rewritten_file>

</rewritten_file>

</rewritten_file>

</rewritten_file>

</rewritten_file>

</rewritten_file>

</rewritten_file>

</rewritten_file>

</rewritten_file>

</rewritten_file>

</rewritten_file>

</rewritten_file>

</rewritten_file>

</rewritten_file>

</rewritten_file>

</rewritten_file>

</rewritten_file>

</rewritten_file>

</rewritten_file>

</rewritten_file>

</rewritten_file>

</rewritten_file>

</rewritten_file>

</rewritten_file>

</rewritten_file>

</rewritten_file>

</rewritten_file>

</rewritten_file>

</rewritten_file>

</rewritten_file>

</rewritten_file>

</rewritten_file>

</rewritten_file>

</rewritten_file>

</rewritten_file>

</rewritten_file>

</rewritten_file>

</rewritten_file>

</rewritten_file>

</rewritten_file>

</rewritten_file>

</rewritten_file>

</rewritten_file>

</rewritten_file>

</rewritten_file>

</rewritten_file>

</rewritten_file>

</rewritten_file>

</rewritten_file>

</rewritten_file>

</rewritten_file>

</rewritten_file>

</rewritten_file>

</rewritten_file>

</rewritten_file>

</rewritten_file>

</rewritten_file>

</rewritten_file>

</rewritten_file>

</rewritten_file>

</rewritten_file>

</rewritten_file>

</rewritten_file>

</rewritten_file>

</rewritten_file>

</rewritten_file>

</rewritten_file>

</rewritten_file>

</rewritten_file>

</rewritten_file>

</rewritten_file>

</rewritten_file>

</rewritten_file>

</rewritten_file>

</rewritten_file>

</rewritten_file>

</rewritten_file>

</rewritten_file>

</rewritten_file>

</rewritten_file>

</rewritten_file>

</rewritten_file>

</rewritten_file>

</rewritten_file>

</rewritten_file>

</rewritten_file>

</rewritten_file>

</rewritten_file>

</rewritten_file>

</rewritten_file>

</rewritten_file>

</rewritten_file>

</rewritten_file>

</rewritten_file>

</rewritten_file>

</rewritten_file>

</rewritten_file>

</rewritten_file>

</rewritten_file>

</rewritten_file>

</rewritten_file>

</rewritten_file>

</rewritten_file>

</rewritten_file>

</rewritten_file>

</rewritten_file>

</rewritten_file>

</rewritten_file>

</rewritten_file>

</rewritten_file>

</rewritten_file>

</rewritten_file>

</rewritten_file>

</rewritten_file>

</rewritten_file>

</rewritten_file>

</rewritten_file>

</rewritten_file>

</rewritten_file>

</rewritten_file>

</rewritten_file>

</rewritten_file>

</rewritten_file>

</rewritten_file>

</rewritten_file>

</rewritten_file>

</rewritten_file>

</rewritten_file>

</rewritten_file>

</rewritten_file>

</rewritten_file>

</rewritten_file>

</rewritten_file>

</rewritten_file>

</rewritten_file>

</rewritten_file>

</rewritten_file>

</rewritten_file>

</rewritten_file>

</rewritten_file>

</rewritten_file>

</rewritten_file>

</rewritten_file>

</rewritten_file>

</rewritten_file>

</rewritten_file>

</rewritten_file>

</rewritten_file>

</rewritten_file>

</rewritten_file>

</rewritten_file>

</rewritten_file>

</rewritten_file>

</rewritten_file>

</rewritten_file>

</rewritten_file>

</rewritten_file>

</rewritten_file>

</rewritten_file>

</rewritten_file>

</rewritten_file>

</rewritten_file>

</rewritten_file>

</rewritten_file>

</rewritten_file>

</rewritten_file>

</rewritten_file>

</rewritten_file>

</rewritten_file>

</rewritten_file>

</rewritten_file>

</rewritten_file>

</rewritten_file>

</rewritten_file>

</rewritten_file>

</rewritten_file>

</rewritten_file>

</rewritten_file>

</rewritten_file>

</rewritten_file>

</rewritten_file>

</rewritten_file>

</rewritten_file>

</rewritten_file>

</rewritten_file>

</rewritten_file>

</rewritten_file>

</rewritten_file>

</rewritten_file>

</rewritten_file>

</rewritten_file>

</rewritten_file>

</rewritten_file>

</rewritten_file>

</rewritten_file>

</rewritten_file>

</rewritten_file>

</rewritten_file>

</rewritten_file>

</rewritten_file>

</rewritten_file>

</rewritten_file>

</rewritten_file>

</rewritten_file>

</rewritten_file>

</rewritten_file>

</rewritten_file>

</rewritten_file>

</rewritten_file>

</rewritten_file>

</rewritten_file>

</rewritten_file>

</rewritten_file>

</rewritten_file>

</rewritten_file>

</rewritten_file>

</rewritten_file>

</rewritten_file>

</rewritten_file>

</rewritten_file>

</rewritten_file>

</rewritten_file>

</rewritten_file>

</rewritten_file>

</rewritten_file>

</rewritten_file>

</rewritten_file>

</rewritten_file>

</rewritten_file>

</rewritten_file>

</rewritten_file>

</rewritten_file>

</rewritten_file>

</rewritten_file>

</rewritten_file>

</rewritten_file>

</rewritten_file>

</rewritten_file>

</rewritten_file>

</rewritten_file>

</rewritten_file>

</rewritten_file>

</rewritten_file>

</rewritten_file>

</rewritten_file>

</rewritten_file>

</rewritten_file>

</rewritten_file>

</rewritten_file>

</rewritten_file>

</rewritten_file>

</rewritten_file>

</rewritten_file>

</rewritten_file>

</rewritten_file>

</rewritten_file>

</rewritten_file>

</rewritten_file>

</rewritten_file>

</rewritten_file>

</rewritten_file>

</rewritten_file>

</rewritten_file>

</rewritten_file>

</rewritten_file>

</rewritten_file>

</rewritten_file>

</rewritten_file>

</rewritten_file>

</rewritten_file>

</rewritten_file>

</rewritten_file>

</rewritten_file>

</rewritten_file>

</rewritten_file>

</rewritten_file>

</rewritten_file>

</rewritten_file>

</rewritten_file>

</rewritten_file>

</rewritten_file>

</rewritten_file>

</rewritten_file>

</rewritten_file>

</rewritten_file>

</rewritten_file>

</rewritten_file>

</rewritten_file>

</rewritten_file>

</rewritten_file>

</rewritten_file>

</rewritten_file>

</rewritten_file>

</rewritten_file>

</rewritten_file>

</rewritten_file>

</rewritten_file>

</rewritten_file>

</rewritten_file>

</rewritten_file>

</rewritten_file>

</rewritten_file>

</rewritten_file>

</rewritten_file>

</rewritten_file>

</rewritten_file>

</rewritten_file>

</rewritten_file>

</rewritten_file>

</rewritten_file>

</rewritten_file>

</rewritten_file>

</rewritten_file>

</rewritten_file>

</rewritten_file>

</rewritten_file>

</rewritten_file>

</rewritten_file>

</rewritten_file>

</rewritten_file>

</rewritten_file>

</rewritten_file>

</rewritten_file>

</rewritten_file>

</rewritten_file>

</rewritten_file>

</rewritten_file>

</rewritten_file>

</rewritten_file>

</rewritten_file>

</rewritten_file>

</rewritten_file>

</rewritten_file>

</rewritten_file>

</rewritten_file>

</rewritten_file>

</rewritten_file>

</rewritten_file>

</rewritten_file>

</rewritten_file>

</rewritten_file>

</rewritten_file>

</rewritten_file>

</rewritten_file>

</rewritten_file>

</rewritten_file>

</rewritten_file>

</rewritten_file>

</rewritten_file>

</rewritten_file>

</rewritten_file>

</rewritten_file>

</rewritten_file>

</rewritten_file>

</rewritten_file>

</rewritten_file>

</rewritten_file>

</rewritten_file>

</rewritten_file>

</rewritten_file>

</rewritten_file>

</rewritten_file>

</rewritten_file>

</rewritten_file>

</rewritten_file>

</rewritten_file>

</rewritten_file>

</rewritten_file>

</rewritten_file>

</rewritten_file>

</rewritten_file>

</rewritten_file>

</rewritten_file>

</rewritten_file>

</rewritten_file>

</rewritten_file>

</rewritten_file>

</rewritten_file>

</rewritten_file>

</rewritten_file>

</rewritten_file>

</rewritten_file>

</rewritten_file>

</rewritten_file>

</rewritten_file>

</rewritten_file>

</rewritten_file>

</rewritten_file>

</rewritten_file>

</rewritten_file>

</rewritten_file>

</rewritten_file>

</rewritten_file>

</rewritten_file>

</rewritten_file>

</rewritten_file>

</rewritten_file>

</rewritten_file>

</rewritten_file>

</rewritten_file>

</rewritten_file>

</rewritten_file>

</rewritten_file>

</rewritten_file>

</rewritten_file>

</rewritten_file>

</rewritten_file>

</rewritten_file>

</rewritten_file>

</rewritten_file>

</rewritten_file>

</rewritten_file>

</rewritten_file>

</rewritten_file>

</rewritten_file>

</rewritten_file>

</rewritten_file>

</rewritten_file>

</rewritten_file>

</rewritten_file>

</rewritten_file>

</rewritten_file>

</rewritten_file>

</rewritten_file>

</rewritten_file>

</rewritten_file>

</rewritten_file>

</rewritten_file>

</rewritten_file>

</rewritten_file>

</rewritten_file>

</rewritten_file>

</rewritten_file>

</rewritten_file>

</rewritten_file>

</rewritten_file>

</rewritten_file>

</rewritten_file>

</rewritten_file>

</rewritten_file>

</rewritten_file>

</rewritten_file>

</rewritten_file>

</rewritten_file>

</rewritten_file>

</rewritten_file>

</rewritten_file>

</rewritten_file>

</rewritten_file>

</rewritten_file>

</rewritten_file>

</rewritten_file>

</rewritten_file>

</rewritten_file>

</rewritten_file>

</rewritten_file>

</rewritten_file>

</rewritten_file>

</rewritten_file>

</rewritten_file>

</rewritten_file>

</rewritten_file>

</rewritten_file>

</rewritten_file>

</rewritten_file>

</rewritten_file>

</rewritten_file>

</rewritten_file>

</rewritten_file>

</rewritten_file>

</rewritten_file>

</rewritten_file>

</rewritten_file>

</rewritten_file>

</rewritten_file>

</rewritten_file>

</rewritten_file>

</rewritten_file>

</rewritten_file>

</rewritten_file>

</rewritten_file>

</rewritten_file>

</rewritten_file>

</rewritten_file>

</rewritten_file>

</rewritten_file>

</rewritten_file>

</rewritten_file>

</rewritten_file>

</rewritten_file>

</rewritten_file>

</rewritten_file>

</rewritten_file>

</rewritten_file>

</rewritten_file>

</rewritten_file>

</rewritten_file>

</rewritten_file>

</rewritten_file>

</rewritten_file>

</rewritten_file>

</rewritten_file>

</rewritten_file>

</rewritten_file>

</rewritten_file>

</rewritten_file>

</rewritten_file>

</rewritten_file>

</rewritten_file>

</rewritten_file>

</rewritten_file>

</rewritten_file>

</rewritten_file>

</rewritten_file>

</rewritten_file>

</rewritten_file>

</rewritten_file>

</rewritten_file>

</rewritten_file>

</rewritten_file>

</rewritten_file>

</rewritten_file>

</rewritten_file>

</rewritten_file>

</rewritten_file>

</rewritten_file>

</rewritten_file>

</rewritten_file>

</rewritten_file>

</rewritten_file>

</rewritten_file>

</rewritten_file>

</rewritten_file>

</rewritten_file>

</rewritten_file>

</rewritten_file>

</rewritten_file>

</rewritten_file>

</rewritten_file>

</rewritten_file>

</rewritten_file>

</rewritten_file>

</rewritten_file>

</rewritten_file>

</rewritten_file>

</rewritten_file>

</rewritten_file>

</rewritten_file>

</rewritten_file>

</rewritten_file>

</rewritten_file>

</rewritten_file>

</rewritten_file>

</rewritten_file>

</rewritten_file>

</rewritten_file>

</rewritten_file>

</rewritten_file>

<!DOCTYPE html>
<html lang="zh-TW">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>æ‰¹é‡åœ–ç‰‡ç”Ÿæˆå™¨ - Multi-AI Image Generator</title>
    <link rel="stylesheet" href="css/style.css">
    <link rel="stylesheet" href="css/api-key-manager.css">
    <link rel="stylesheet" href="css/ai-assistant-v27.css">
    <link rel="stylesheet" href="css/advanced-image-processor.css">
    <link rel="stylesheet" href="css/local-ai-manager.css">
    <link rel="stylesheet" href="css/light-mode-text-fix.css">
    
    <!-- å…§è¯æ·ºè‰²æ¨¡å¼å®Œæ•´ä¿®æ­£ -->
    <style>
    /* æ·ºè‰²æ¨¡å¼å…§å®¹å€åŸŸå®Œæ•´ä¿®æ­£ */
    [data-theme="light"] .tab-content,
    [data-theme="light"] .batch-settings,
    [data-theme="light"] .batch-section,
    [data-theme="light"] .enhance-section,
    [data-theme="light"] .translate-section,
    [data-theme="light"] .style-section,
    [data-theme="light"] .analytics-section,
    [data-theme="light"] .history-section,
    body:not([data-theme="dark"]) .tab-content,
    body:not([data-theme="dark"]) .batch-settings,
    body:not([data-theme="dark"]) .batch-section,
    body:not([data-theme="dark"]) .enhance-section,
    body:not([data-theme="dark"]) .translate-section,
    body:not([data-theme="dark"]) .style-section,
    body:not([data-theme="dark"]) .analytics-section,
    body:not([data-theme="dark"]) .history-section {
        background-color: white !important;
        color: black !important;
    }

    /* è¨­ç½®å’Œé¸é …å€åŸŸ */
    [data-theme="light"] .settings-grid,
    [data-theme="light"] .setting-group,
    [data-theme="light"] .option-group,
    [data-theme="light"] .options-grid,
    [data-theme="light"] .input-group,
    [data-theme="light"] .batch-header,
    [data-theme="light"] .batch-controls,
    [data-theme="light"] .batch-prompts-container,
    [data-theme="light"] .prompts-list,
    [data-theme="light"] .empty-state,
    body:not([data-theme="dark"]) .settings-grid,
    body:not([data-theme="dark"]) .setting-group,
    body:not([data-theme="dark"]) .option-group,
    body:not([data-theme="dark"]) .options-grid,
    body:not([data-theme="dark"]) .input-group,
    body:not([data-theme="dark"]) .batch-header,
    body:not([data-theme="dark"]) .batch-controls,
    body:not([data-theme="dark"]) .batch-prompts-container,
    body:not([data-theme="dark"]) .prompts-list,
    body:not([data-theme="dark"]) .empty-state {
        background-color: white !important;
        color: black !important;
    }

    /* é€²åº¦å’Œçµæœå€åŸŸ */
    [data-theme="light"] .batch-progress,
    [data-theme="light"] .batch-results,
    [data-theme="light"] .batch-stats,
    [data-theme="light"] .progress-header,
    [data-theme="light"] .results-header,
    [data-theme="light"] .batch-actions,
    body:not([data-theme="dark"]) .batch-progress,
    body:not([data-theme="dark"]) .batch-results,
    body:not([data-theme="dark"]) .batch-stats,
    body:not([data-theme="dark"]) .progress-header,
    body:not([data-theme="dark"]) .results-header,
    body:not([data-theme="dark"]) .batch-actions {
        background-color: white !important;
        color: black !important;
    }

    /* è¡¨å–®å…ƒç´ ä¿®æ­£ */
    [data-theme="light"] .ai-assistant-v27 input,
    [data-theme="light"] .ai-assistant-v27 select,
    [data-theme="light"] .ai-assistant-v27 textarea,
    body:not([data-theme="dark"]) .ai-assistant-v27 input,
    body:not([data-theme="dark"]) .ai-assistant-v27 select,
    body:not([data-theme="dark"]) .ai-assistant-v27 textarea {
        background-color: white !important;
        color: black !important;
        border: 1px solid #d1d5db !important;
    }

    /* æ‰€æœ‰æ–‡å­—å…ƒç´  */
    [data-theme="light"] .ai-assistant-v27 label,
    [data-theme="light"] .ai-assistant-v27 h4,
    [data-theme="light"] .ai-assistant-v27 h5,
    [data-theme="light"] .ai-assistant-v27 p,
    [data-theme="light"] .ai-assistant-v27 span,
    [data-theme="light"] .ai-assistant-v27 div,
    body:not([data-theme="dark"]) .ai-assistant-v27 label,
    body:not([data-theme="dark"]) .ai-assistant-v27 h4,
    body:not([data-theme="dark"]) .ai-assistant-v27 h5,
    body:not([data-theme="dark"]) .ai-assistant-v27 p,
    body:not([data-theme="dark"]) .ai-assistant-v27 span,
    body:not([data-theme="dark"]) .ai-assistant-v27 div {
        color: black !important;
    }

    /* æŒ‰éˆ•ä¿®æ­£ï¼ˆé™¤äº†ç‰¹æ®ŠæŒ‰éˆ•ï¼‰ */
    [data-theme="light"] .ai-assistant-v27 .secondary-button,
    [data-theme="light"] .ai-assistant-v27 .action-button,
    body:not([data-theme="dark"]) .ai-assistant-v27 .secondary-button,
    body:not([data-theme="dark"]) .ai-assistant-v27 .action-button {
        background-color: #f3f4f6 !important;
        color: black !important;
        border: 1px solid #d1d5db !important;
    }

    /* å¼·åˆ¶è¦†è“‹æ·±è‰²èƒŒæ™¯ */
    [data-theme="light"] .ai-assistant-v27 *:not(.tab-button.active):not(.primary-button):not(.danger-button),
    body:not([data-theme="dark"]) .ai-assistant-v27 *:not(.tab-button.active):not(.primary-button):not(.danger-button) {
        background-color: inherit !important;
    }

    /* ç¢ºä¿ä¸»å®¹å™¨èƒŒæ™¯ */
    [data-theme="light"] .ai-assistant-v27,
    body:not([data-theme="dark"]) .ai-assistant-v27 {
        background-color: white !important;
        color: black !important;
    }

    /* === æ·±è‰²æ¨¡å¼ä¿è­·æ€§ä¿®æ­£ === */
    
    /* ç¢ºä¿æ·±è‰²æ¨¡å¼ä¸‹çš„æ­£ç¢ºé…è‰² */
    [data-theme="dark"] .ai-assistant-v27,
    body[data-theme="dark"] .ai-assistant-v27 {
        background-color: #1a1a1a !important;
        color: white !important;
    }

    /* æ·±è‰²æ¨¡å¼æ¨™ç±¤æŒ‰éˆ• */
    [data-theme="dark"] .tab-button.active,
    body[data-theme="dark"] .tab-button.active {
        background-color: #2563eb !important;
        color: white !important;
        border: 1px solid #2563eb !important;
    }

    [data-theme="dark"] .tab-button:not(.active),
    body[data-theme="dark"] .tab-button:not(.active) {
        background-color: #374151 !important;
        color: white !important;
        border: 1px solid #4b5563 !important;
    }

    [data-theme="dark"] .tab-button:not(.active):hover,
    body[data-theme="dark"] .tab-button:not(.active):hover {
        background-color: #4b5563 !important;
        color: white !important;
        border: 1px solid #6b7280 !important;
    }

    /* æ·±è‰²æ¨¡å¼å…§å®¹å€åŸŸ */
    [data-theme="dark"] .tab-content,
    [data-theme="dark"] .batch-settings,
    [data-theme="dark"] .batch-section,
    [data-theme="dark"] .enhance-section,
    [data-theme="dark"] .translate-section,
    [data-theme="dark"] .style-section,
    [data-theme="dark"] .analytics-section,
    [data-theme="dark"] .history-section,
    body[data-theme="dark"] .tab-content,
    body[data-theme="dark"] .batch-settings,
    body[data-theme="dark"] .batch-section,
    body[data-theme="dark"] .enhance-section,
    body[data-theme="dark"] .translate-section,
    body[data-theme="dark"] .style-section,
    body[data-theme="dark"] .analytics-section,
    body[data-theme="dark"] .history-section {
        background-color: #1a1a1a !important;
        color: white !important;
    }

    /* æ·±è‰²æ¨¡å¼è¨­ç½®å€åŸŸ */
    [data-theme="dark"] .settings-grid,
    [data-theme="dark"] .setting-group,
    [data-theme="dark"] .option-group,
    [data-theme="dark"] .options-grid,
    [data-theme="dark"] .input-group,
    [data-theme="dark"] .batch-header,
    [data-theme="dark"] .batch-controls,
    [data-theme="dark"] .batch-prompts-container,
    [data-theme="dark"] .prompts-list,
    [data-theme="dark"] .empty-state,
    body[data-theme="dark"] .settings-grid,
    body[data-theme="dark"] .setting-group,
    body[data-theme="dark"] .option-group,
    body[data-theme="dark"] .options-grid,
    body[data-theme="dark"] .input-group,
    body[data-theme="dark"] .batch-header,
    body[data-theme="dark"] .batch-controls,
    body[data-theme="dark"] .batch-prompts-container,
    body[data-theme="dark"] .prompts-list,
    body[data-theme="dark"] .empty-state {
        background-color: #2d2d2d !important;
        color: white !important;
    }

    /* æ·±è‰²æ¨¡å¼é€²åº¦å’Œçµæœå€åŸŸ */
    [data-theme="dark"] .batch-progress,
    [data-theme="dark"] .batch-results,
    [data-theme="dark"] .batch-stats,
    [data-theme="dark"] .progress-header,
    [data-theme="dark"] .results-header,
    [data-theme="dark"] .batch-actions,
    body[data-theme="dark"] .batch-progress,
    body[data-theme="dark"] .batch-results,
    body[data-theme="dark"] .batch-stats,
    body[data-theme="dark"] .progress-header,
    body[data-theme="dark"] .results-header,
    body[data-theme="dark"] .batch-actions {
        background-color: #2d2d2d !important;
        color: white !important;
    }

    /* æ·±è‰²æ¨¡å¼è¡¨å–®å…ƒç´  */
    [data-theme="dark"] .ai-assistant-v27 input,
    [data-theme="dark"] .ai-assistant-v27 select,
    [data-theme="dark"] .ai-assistant-v27 textarea,
    body[data-theme="dark"] .ai-assistant-v27 input,
    body[data-theme="dark"] .ai-assistant-v27 select,
    body[data-theme="dark"] .ai-assistant-v27 textarea {
        background-color: #374151 !important;
        color: white !important;
        border: 1px solid #4b5563 !important;
    }

    /* æ·±è‰²æ¨¡å¼æ–‡å­—å…ƒç´  */
    [data-theme="dark"] .ai-assistant-v27 label,
    [data-theme="dark"] .ai-assistant-v27 h4,
    [data-theme="dark"] .ai-assistant-v27 h5,
    [data-theme="dark"] .ai-assistant-v27 p,
    [data-theme="dark"] .ai-assistant-v27 span,
    [data-theme="dark"] .ai-assistant-v27 div,
    body[data-theme="dark"] .ai-assistant-v27 label,
    body[data-theme="dark"] .ai-assistant-v27 h4,
    body[data-theme="dark"] .ai-assistant-v27 h5,
    body[data-theme="dark"] .ai-assistant-v27 p,
    body[data-theme="dark"] .ai-assistant-v27 span,
    body[data-theme="dark"] .ai-assistant-v27 div {
        color: white !important;
    }

    /* æ·±è‰²æ¨¡å¼æŒ‰éˆ• */
    [data-theme="dark"] .ai-assistant-v27 .secondary-button,
    [data-theme="dark"] .ai-assistant-v27 .action-button,
    body[data-theme="dark"] .ai-assistant-v27 .secondary-button,
    body[data-theme="dark"] .ai-assistant-v27 .action-button {
        background-color: #374151 !important;
        color: white !important;
        border: 1px solid #4b5563 !important;
    }

    /* æ·±è‰²æ¨¡å¼æ¨™é¡Œå’Œç‹€æ…‹ */
    [data-theme="dark"] .ai-assistant-header h3,
    [data-theme="dark"] .status-indicator,
    body[data-theme="dark"] .ai-assistant-header h3,
    body[data-theme="dark"] .status-indicator {
        color: white !important;
    }
    
    /* å¢å¼· Local AI ç®¡ç†ä¸­å¿ƒ CSS - æ¸›å°‘ç·Šæ¹Šæ„Ÿ */
    .local-ai-manager {
        margin: 2.5rem 0 !important;
        padding: 0 !important;
        border-radius: 16px !important;
        box-shadow: 0 8px 32px rgba(0, 0, 0, 0.12) !important;
        background: var(--bg-color, #ffffff) !important;
        overflow: hidden !important;
        transition: all 0.4s ease !important;
    }
    
    .local-ai-manager:hover {
        box-shadow: 0 12px 40px rgba(0, 0, 0, 0.15) !important;
        transform: translateY(-2px) !important;
    }
    
    .local-ai-header {
        padding: 2rem 2.5rem !important;
        background: linear-gradient(135deg, #667eea 0%, #764ba2 100%) !important;
        border-bottom: none !important;
        position: relative !important;
        overflow: hidden !important;
    }
    
    .local-ai-header::before {
        content: '';
        position: absolute;
        top: 0;
        left: 0;
        right: 0;
        bottom: 0;
        background: linear-gradient(45deg, rgba(255,255,255,0.1) 0%, rgba(255,255,255,0.05) 100%);
        pointer-events: none;
    }
    
    .local-ai-header h3 {
        margin: 0 !important;
        font-size: 1.75rem !important;
        font-weight: 700 !important;
        color: white !important;
        display: flex !important;
        align-items: center !important;
        gap: 0.75rem !important;
        text-shadow: 0 2px 4px rgba(0, 0, 0, 0.2) !important;
        position: relative !important;
        z-index: 1 !important;
    }
    
    .local-ai-header h3::before {
        content: '';
        position: absolute;
        left: -0.5rem;
        top: 50%;
        transform: translateY(-50%);
        width: 4px;
        height: 100%;
        background: linear-gradient(to bottom, #fbbf24, #f59e0b);
        border-radius: 2px;
    }
    
    .status-indicators {
        display: flex !important;
        gap: 1.25rem !important;
        align-items: center !important;
        position: relative !important;
        z-index: 1 !important;
    }
    
    .status-indicator {
        display: flex !important;
        align-items: center !important;
        gap: 0.75rem !important;
        font-size: 0.9rem !important;
        font-weight: 600 !important;
        padding: 0.75rem 1.25rem !important;
        background: rgba(255, 255, 255, 0.15) !important;
        border-radius: 25px !important;
        border: 1px solid rgba(255, 255, 255, 0.25) !important;
        backdrop-filter: blur(10px) !important;
        transition: all 0.3s ease !important;
    }
    
    .status-indicator:hover {
        background: rgba(255, 255, 255, 0.2) !important;
        transform: translateY(-1px) !important;
    }
    
    .local-ai-tabs {
        background: linear-gradient(to right, #f8fafc, #f1f5f9) !important;
        border-bottom: 1px solid var(--border-color, #e2e8f0) !important;
        padding: 0.5rem 1rem !important;
        overflow-x: auto !important;
        display: flex !important;
        gap: 0.5rem !important;
    }
    
    .local-ai-tabs .tab-button {
        flex: none !important;
        min-width: 140px !important;
        padding: 1rem 1.75rem !important;
        border: none !important;
        background: transparent !important;
        color: #64748b !important;
        font-size: 0.95rem !important;
        font-weight: 600 !important;
        cursor: pointer !important;
        transition: all 0.3s ease !important;
        border-radius: 12px !important;
        white-space: nowrap !important;
        position: relative !important;
        overflow: hidden !important;
    }
    
    .local-ai-tabs .tab-button::before {
        content: '';
        position: absolute;
        top: 0;
        left: -100%;
        width: 100%;
        height: 100%;
        background: linear-gradient(90deg, transparent, rgba(37, 99, 235, 0.1), transparent);
        transition: left 0.6s ease;
    }
    
    .local-ai-tabs .tab-button:hover::before {
        left: 100%;
    }
    
    .local-ai-tabs .tab-button:hover {
        background: rgba(37, 99, 235, 0.08) !important;
        color: #2563eb !important;
        transform: translateY(-2px) !important;
        box-shadow: 0 4px 12px rgba(37, 99, 235, 0.15) !important;
    }
    
    .local-ai-tabs .tab-button.active {
        background: white !important;
        color: #2563eb !important;
        box-shadow: 0 4px 16px rgba(37, 99, 235, 0.2) !important;
        transform: translateY(-1px) !important;
        border: 1px solid rgba(37, 99, 235, 0.2) !important;
    }
    
    .local-ai-content {
        min-height: 500px !important;
        background: var(--bg-color, #ffffff) !important;
    }
    
    .tab-content {
        display: none !important;
        padding: 2.5rem !important;
        animation: fadeIn 0.4s ease-in-out !important;
    }
    
    .tab-content.active {
        display: block !important;
    }
    
    @keyframes fadeIn {
        from {
            opacity: 0;
            transform: translateY(10px);
        }
        to {
            opacity: 1;
            transform: translateY(0);
        }
    }
    
    /* æ·±è‰²æ¨¡å¼å¢å¼· */
    [data-theme="dark"] .local-ai-manager {
        background: #0f172a !important;
        border: 1px solid #334155 !important;
        box-shadow: 0 8px 32px rgba(0, 0, 0, 0.4) !important;
    }
    
    [data-theme="dark"] .local-ai-header {
        background: linear-gradient(135deg, #1e293b 0%, #0f172a 100%) !important;
    }
    
    [data-theme="dark"] .local-ai-header h3 {
        color: #f8fafc !important;
    }
    
    [data-theme="dark"] .local-ai-tabs {
        background: linear-gradient(to right, #1e293b, #334155) !important;
        border-bottom-color: #475569 !important;
    }
    
    [data-theme="dark"] .local-ai-tabs .tab-button {
        color: #cbd5e1 !important;
    }
    
    [data-theme="dark"] .local-ai-tabs .tab-button.active {
        background: #334155 !important;
        color: #60a5fa !important;
        border-color: #3b82f6 !important;
    }
    
    [data-theme="dark"] .local-ai-content {
        background: #0f172a !important;
    }
    
    /* éŸ¿æ‡‰å¼è¨­è¨ˆå¢å¼· */
    @media (max-width: 768px) {
        .local-ai-header {
            padding: 1.5rem 1.25rem !important;
            flex-direction: column !important;
            gap: 1rem !important;
            text-align: center !important;
        }
        
        .local-ai-header h3 {
            font-size: 1.5rem !important;
            justify-content: center !important;
        }
        
        .status-indicators {
            flex-wrap: wrap !important;
            justify-content: center !important;
            gap: 0.75rem !important;
        }
        
        .local-ai-tabs {
            padding: 0.25rem 0.5rem !important;
            gap: 0.25rem !important;
        }
        
        .local-ai-tabs .tab-button {
            min-width: 100px !important;
            padding: 0.75rem 1rem !important;
            font-size: 0.85rem !important;
        }
        
        .tab-content {
            padding: 1.5rem !important;
        }
    }
    
    @media (max-width: 480px) {
        .local-ai-manager {
            margin: 1.5rem 0 !important;
        }
        
        .local-ai-header {
            padding: 1.25rem 1rem !important;
        }
        
        .local-ai-header h3 {
            font-size: 1.3rem !important;
        }
        
        .tab-content {
            padding: 1rem !important;
        }
    }
    
    </style>

    <!-- Local AI ç®¡ç†ä¸­å¿ƒ CSS å¢å¼· - æ¸›å°‘ç·Šæ¹Šæ„Ÿ -->
    <style>
    /* === ğŸ¤– Local AI ç®¡ç†ä¸­å¿ƒ å¢å¼·æ¨£å¼ === */
    
    .local-ai-manager {
        margin: 3rem 0 !important;
        padding: 0 !important;
        border-radius: 20px !important;
        box-shadow: 0 10px 40px rgba(0, 0, 0, 0.12) !important;
        background: var(--bg-color, #ffffff) !important;
        overflow: hidden !important;
        transition: all 0.4s cubic-bezier(0.4, 0, 0.2, 1) !important;
        border: 1px solid rgba(99, 102, 241, 0.1) !important;
    }
    
    .local-ai-manager:hover {
        box-shadow: 0 20px 60px rgba(0, 0, 0, 0.15) !important;
        transform: translateY(-4px) !important;
        border-color: rgba(99, 102, 241, 0.2) !important;
    }
    
    /* æ¨™é¡Œå€åŸŸå¤§å¹…å¢å¼· */
    .local-ai-header {
        padding: 3rem 3rem !important;
        background: linear-gradient(135deg, #667eea 0%, #764ba2 50%, #f093fb 100%) !important;
        border-bottom: none !important;
        position: relative !important;
        overflow: hidden !important;
        min-height: 120px !important;
    }
    
    /* æ·»åŠ å‹•æ…‹èƒŒæ™¯æ•ˆæœ */
    .local-ai-header::before {
        content: '';
        position: absolute;
        top: 0;
        left: 0;
        right: 0;
        bottom: 0;
        background: 
            radial-gradient(circle at 20% 80%, rgba(120, 119, 198, 0.3) 0%, transparent 50%),
            radial-gradient(circle at 80% 20%, rgba(255, 119, 198, 0.3) 0%, transparent 50%);
        pointer-events: none;
        animation: shimmer 8s ease-in-out infinite alternate;
    }
    
    @keyframes shimmer {
        0% { opacity: 0.5; }
        100% { opacity: 1; }
    }
    
    /* æ¨™é¡Œæ¨£å¼å¤§å¹…å¢å¼· */
    .local-ai-header h3 {
        margin: 0 !important;
        font-size: 2.2rem !important;
        font-weight: 800 !important;
        color: white !important;
        display: flex !important;
        align-items: center !important;
        gap: 1rem !important;
        text-shadow: 0 4px 8px rgba(0, 0, 0, 0.3) !important;
        position: relative !important;
        z-index: 2 !important;
        letter-spacing: -0.5px !important;
    }
    
    /* ç‹€æ…‹æŒ‡ç¤ºå™¨å¢å¼· */
    .status-indicators {
        display: flex !important;
        gap: 1.5rem !important;
        align-items: center !important;
        position: relative !important;
        z-index: 2 !important;
        flex-wrap: wrap !important;
    }
    
    .status-indicator {
        display: flex !important;
        align-items: center !important;
        gap: 0.75rem !important;
        font-size: 1rem !important;
        font-weight: 600 !important;
        padding: 1rem 1.5rem !important;
        background: rgba(255, 255, 255, 0.2) !important;
        border-radius: 30px !important;
        border: 1px solid rgba(255, 255, 255, 0.3) !important;
        backdrop-filter: blur(20px) !important;
        transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1) !important;
        min-height: 50px !important;
        box-shadow: 0 4px 15px rgba(0, 0, 0, 0.1) !important;
    }
    
    .status-indicator:hover {
        background: rgba(255, 255, 255, 0.25) !important;
        transform: translateY(-2px) scale(1.02) !important;
        box-shadow: 0 8px 25px rgba(0, 0, 0, 0.15) !important;
    }
    
    /* æ¨™ç±¤é å€åŸŸå¢å¼· */
    .local-ai-tabs {
        background: linear-gradient(to right, #f8fafc, #f1f5f9, #e2e8f0) !important;
        border-bottom: 2px solid rgba(99, 102, 241, 0.1) !important;
        padding: 1rem 2rem !important;
        overflow-x: auto !important;
        display: flex !important;
        gap: 0.75rem !important;
        min-height: 80px !important;
        align-items: center !important;
    }
    
    .local-ai-tabs .tab-button {
        flex: none !important;
        min-width: 160px !important;
        padding: 1.25rem 2rem !important;
        border: none !important;
        background: rgba(255, 255, 255, 0.7) !important;
        color: #64748b !important;
        font-size: 1rem !important;
        font-weight: 600 !important;
        cursor: pointer !important;
        transition: all 0.4s cubic-bezier(0.4, 0, 0.2, 1) !important;
        border-radius: 16px !important;
        white-space: nowrap !important;
        position: relative !important;
        overflow: hidden !important;
        box-shadow: 0 2px 8px rgba(0, 0, 0, 0.05) !important;
        border: 1px solid rgba(0, 0, 0, 0.05) !important;
    }
    
    .local-ai-tabs .tab-button:hover {
        background: rgba(99, 102, 241, 0.08) !important;
        color: #6366f1 !important;
        transform: translateY(-3px) scale(1.02) !important;
        box-shadow: 0 8px 25px rgba(99, 102, 241, 0.2) !important;
        border-color: rgba(99, 102, 241, 0.2) !important;
    }
    
    .local-ai-tabs .tab-button.active {
        background: linear-gradient(135deg, #6366f1, #8b5cf6) !important;
        color: white !important;
        box-shadow: 0 8px 30px rgba(99, 102, 241, 0.3) !important;
        transform: translateY(-2px) !important;
        border: 1px solid rgba(99, 102, 241, 0.3) !important;
        font-weight: 700 !important;
    }
    
    /* å…§å®¹å€åŸŸå¢å¼· */
    .local-ai-content {
        min-height: 600px !important;
        background: var(--bg-color, #ffffff) !important;
        position: relative !important;
    }
    
    .tab-content {
        display: none !important;
        padding: 3rem !important;
        animation: fadeInUp 0.5s ease-out !important;
        min-height: 500px !important;
    }
    
    .tab-content.active {
        display: block !important;
    }
    
    @keyframes fadeInUp {
        from {
            opacity: 0;
            transform: translateY(20px);
        }
        to {
            opacity: 1;
            transform: translateY(0);
        }
    }
    
    /* æ·±è‰²æ¨¡å¼å¢å¼· */
    [data-theme="dark"] .local-ai-manager {
        background: #0f172a !important;
        border: 1px solid rgba(99, 102, 241, 0.3) !important;
        box-shadow: 0 10px 40px rgba(0, 0, 0, 0.5) !important;
    }
    
    [data-theme="dark"] .local-ai-header {
        background: linear-gradient(135deg, #1e293b 0%, #0f172a 50%, #1e1b4b 100%) !important;
    }
    
    [data-theme="dark"] .local-ai-header h3 {
        color: #f8fafc !important;
        text-shadow: 0 4px 8px rgba(0, 0, 0, 0.5) !important;
    }
    
    [data-theme="dark"] .local-ai-tabs {
        background: linear-gradient(to right, #1e293b, #334155, #475569) !important;
        border-bottom-color: rgba(99, 102, 241, 0.3) !important;
    }
    
    [data-theme="dark"] .local-ai-tabs .tab-button {
        background: rgba(51, 65, 85, 0.8) !important;
        color: #cbd5e1 !important;
        border-color: rgba(71, 85, 105, 0.5) !important;
    }
    
    [data-theme="dark"] .local-ai-tabs .tab-button:hover {
        background: rgba(99, 102, 241, 0.2) !important;
        color: #a5b4fc !important;
    }
    
    [data-theme="dark"] .local-ai-tabs .tab-button.active {
        background: linear-gradient(135deg, #4f46e5, #7c3aed) !important;
        color: #f8fafc !important;
    }
    
    /* éŸ¿æ‡‰å¼è¨­è¨ˆå¢å¼· */
    @media (max-width: 768px) {
        .local-ai-header {
            padding: 2rem 1.5rem !important;
            flex-direction: column !important;
            gap: 1.5rem !important;
            text-align: center !important;
        }
        
        .local-ai-header h3 {
            font-size: 1.8rem !important;
            justify-content: center !important;
        }
        
        .local-ai-tabs .tab-button {
            min-width: 120px !important;
            padding: 1rem 1.25rem !important;
        }
        
        .tab-content {
            padding: 2rem 1.25rem !important;
        }
    }
    </style>

    <!-- æç¤ºè©å¢å¼·åŠŸèƒ½ CSS å¢å¼· -->
    <style>
    /* === ğŸ¨ æç¤ºè©å¢å¼·åŠŸèƒ½å¢å¼·æ¨£å¼ === */
    
    #enhance-tab {
        background: linear-gradient(135deg, #f8fafc 0%, #f1f5f9 100%) !important;
        min-height: 700px !important;
    }
    
    /* åŸå§‹æç¤ºè©è¼¸å…¥å€åŸŸå¢å¼· */
    .enhance-input {
        background: white !important;
        border-radius: 16px !important;
        padding: 2rem !important;
        margin-bottom: 2rem !important;
        box-shadow: 0 4px 20px rgba(0, 0, 0, 0.08) !important;
        border: 1px solid rgba(99, 102, 241, 0.1) !important;
        transition: all 0.3s ease !important;
    }
    
    .enhance-input:hover {
        box-shadow: 0 8px 30px rgba(0, 0, 0, 0.12) !important;
        border-color: rgba(99, 102, 241, 0.2) !important;
        transform: translateY(-2px) !important;
    }
    
    .enhance-input label {
        font-size: 1.1rem !important;
        font-weight: 700 !important;
        color: #1e293b !important;
        margin-bottom: 1rem !important;
        display: flex !important;
        align-items: center !important;
        gap: 0.5rem !important;
    }
    
    .enhance-input label i {
        color: #6366f1 !important;
        font-size: 1.2rem !important;
    }
    
    #originalPrompt {
        width: 100% !important;
        min-height: 150px !important;
        padding: 1.5rem !important;
        border: 2px solid #e2e8f0 !important;
        border-radius: 12px !important;
        font-size: 1rem !important;
        line-height: 1.6 !important;
        resize: vertical !important;
        font-family: 'Arial', 'Microsoft YaHei', sans-serif !important;
        transition: all 0.3s ease !important;
        background: #fafbfc !important;
    }
    
    #originalPrompt:focus {
        outline: none !important;
        border-color: #6366f1 !important;
        box-shadow: 0 0 0 3px rgba(99, 102, 241, 0.1) !important;
        background: white !important;
    }
    
    #originalPrompt::placeholder {
        color: #94a3b8 !important;
        font-style: italic !important;
    }
    
    /* å¢å¼·é¸é …å€åŸŸ */
    .enhance-options {
        background: white !important;
        border-radius: 16px !important;
        padding: 2rem !important;
        margin-bottom: 2rem !important;
        box-shadow: 0 4px 20px rgba(0, 0, 0, 0.08) !important;
        border: 1px solid rgba(99, 102, 241, 0.1) !important;
    }
    
    .option-group {
        margin-bottom: 1.5rem !important;
    }
    
    .option-group label {
        font-size: 1rem !important;
        font-weight: 600 !important;
        color: #334155 !important;
        margin-bottom: 0.75rem !important;
        display: flex !important;
        align-items: center !important;
        gap: 0.5rem !important;
    }
    
    .option-group label i {
        color: #8b5cf6 !important;
    }
    
    #enhanceStyle {
        width: 100% !important;
        padding: 1rem 1.25rem !important;
        border: 2px solid #e2e8f0 !important;
        border-radius: 10px !important;
        font-size: 1rem !important;
        background: #fafbfc !important;
        transition: all 0.3s ease !important;
        cursor: pointer !important;
    }
    
    #enhanceStyle:focus {
        outline: none !important;
        border-color: #8b5cf6 !important;
        box-shadow: 0 0 0 3px rgba(139, 92, 246, 0.1) !important;
        background: white !important;
    }
    
    #enhanceStyle option {
        padding: 0.75rem !important;
        font-size: 1rem !important;
    }
    
    /* æ§åˆ¶æŒ‰éˆ•å€åŸŸå¤§å¹…å¢å¼· */
    .enhance-controls {
        display: flex !important;
        gap: 1.5rem !important;
        justify-content: center !important;
        margin: 3rem 0 !important;
        flex-wrap: wrap !important;
    }
    
    #enhancePromptLocal {
        background: linear-gradient(135deg, #6366f1, #8b5cf6) !important;
        color: white !important;
        border: none !important;
        padding: 1.25rem 2.5rem !important;
        border-radius: 16px !important;
        font-size: 1.1rem !important;
        font-weight: 700 !important;
        cursor: pointer !important;
        transition: all 0.4s cubic-bezier(0.4, 0, 0.2, 1) !important;
        box-shadow: 0 6px 20px rgba(99, 102, 241, 0.3) !important;
        min-width: 180px !important;
        position: relative !important;
        overflow: hidden !important;
    }
    
    #enhancePromptLocal::before {
        content: '';
        position: absolute;
        top: 0;
        left: -100%;
        width: 100%;
        height: 100%;
        background: linear-gradient(90deg, transparent, rgba(255,255,255,0.2), transparent);
        transition: left 0.6s ease;
    }
    
    #enhancePromptLocal:hover::before {
        left: 100%;
    }
    
    #enhancePromptLocal:hover {
        transform: translateY(-3px) scale(1.05) !important;
        box-shadow: 0 10px 40px rgba(99, 102, 241, 0.4) !important;
    }
    
    #enhancePromptLocal:active {
        transform: translateY(-1px) scale(1.02) !important;
    }
    
    #enhancePromptLocal i {
        margin-right: 0.75rem !important;
        font-size: 1.2rem !important;
        animation: sparkle 2s ease-in-out infinite;
    }
    
    @keyframes sparkle {
        0%, 100% { transform: scale(1) rotate(0deg); }
        50% { transform: scale(1.1) rotate(5deg); }
    }
    
    /* çµæœå±•ç¤ºå€åŸŸå¢å¼· */
    .enhance-results {
        background: white !important;
        border-radius: 20px !important;
        padding: 2.5rem !important;
        margin-top: 2rem !important;
        box-shadow: 0 8px 40px rgba(0, 0, 0, 0.1) !important;
        border: 1px solid rgba(34, 197, 94, 0.2) !important;
        animation: slideInUp 0.5s ease-out !important;
    }
    
    @keyframes slideInUp {
        from {
            opacity: 0;
            transform: translateY(30px);
        }
        to {
            opacity: 1;
            transform: translateY(0);
        }
    }
    
    .result-header {
        display: flex !important;
        justify-content: space-between !important;
        align-items: center !important;
        margin-bottom: 2rem !important;
        padding-bottom: 1rem !important;
        border-bottom: 2px solid #f1f5f9 !important;
    }
    
    .result-header h4 {
        margin: 0 !important;
        font-size: 1.5rem !important;
        font-weight: 700 !important;
        color: #1e293b !important;
        display: flex !important;
        align-items: center !important;
        gap: 0.75rem !important;
    }
    
    .result-header h4 i {
        color: #22c55e !important;
        font-size: 1.6rem !important;
        animation: twinkle 3s ease-in-out infinite;
    }
    
    @keyframes twinkle {
        0%, 100% { opacity: 1; }
        50% { opacity: 0.6; }
    }
    
    /* å¢å¼·å¾Œæç¤ºè©å±•ç¤º */
    #enhancedPrompt {
        background: linear-gradient(135deg, #f0fdf4, #dcfce7) !important;
        border: 2px solid #22c55e !important;
        border-radius: 12px !important;
        padding: 2rem !important;
        font-size: 1.1rem !important;
        line-height: 1.7 !important;
        color: #15803d !important;
        font-weight: 500 !important;
        word-wrap: break-word !important;
        white-space: pre-wrap !important;
        margin-bottom: 1.5rem !important;
        position: relative !important;
    }
    
    #enhancedPrompt::before {
        content: 'âœ¨';
        position: absolute;
        top: -10px;
        right: 15px;
        background: white;
        padding: 5px 10px;
        border-radius: 20px;
        box-shadow: 0 2px 8px rgba(0,0,0,0.1);
        font-size: 1.2rem;
    }
    
    /* æ”¹é€²å»ºè­°å€åŸŸ */
    #enhancementSuggestions {
        background: #fef7ff !important;
        border: 1px solid #e879f9 !important;
        border-radius: 12px !important;
        padding: 1.5rem !important;
        margin-top: 1.5rem !important;
    }
    
    #enhancementSuggestions h5 {
        color: #a855f7 !important;
        font-size: 1.1rem !important;
        font-weight: 600 !important;
        margin-bottom: 1rem !important;
        display: flex !important;
        align-items: center !important;
        gap: 0.5rem !important;
    }
    
    #enhancementSuggestions ul {
        list-style: none !important;
        padding: 0 !important;
        margin: 0 !important;
    }
    
    #enhancementSuggestions li {
        background: white !important;
        border-radius: 8px !important;
        padding: 1rem !important;
        margin-bottom: 0.75rem !important;
        border-left: 4px solid #a855f7 !important;
        box-shadow: 0 2px 8px rgba(168, 85, 247, 0.1) !important;
        transition: all 0.2s ease !important;
    }
    
    #enhancementSuggestions li:hover {
        transform: translateX(5px) !important;
        box-shadow: 0 4px 12px rgba(168, 85, 247, 0.2) !important;
    }
    
    #enhancementSuggestions li::before {
        content: 'ğŸ’¡';
        margin-right: 0.5rem;
        font-size: 1.1rem;
    }
    
    /* æ·±è‰²æ¨¡å¼æ”¯æ´ */
    [data-theme="dark"] #enhance-tab {
        background: linear-gradient(135deg, #0f172a 0%, #1e293b 100%) !important;
    }
    
    [data-theme="dark"] .enhance-input,
    [data-theme="dark"] .enhance-options,
    [data-theme="dark"] .enhance-results {
        background: #1e293b !important;
        border-color: rgba(99, 102, 241, 0.3) !important;
    }
    
    [data-theme="dark"] .enhance-input label,
    [data-theme="dark"] .option-group label,
    [data-theme="dark"] .result-header h4 {
        color: #f8fafc !important;
    }
    
    [data-theme="dark"] #originalPrompt,
    [data-theme="dark"] #enhanceStyle {
        background: #334155 !important;
        border-color: #475569 !important;
        color: #f8fafc !important;
    }
    
    [data-theme="dark"] #enhancedPrompt {
        background: linear-gradient(135deg, #064e3b, #065f46) !important;
        border-color: #10b981 !important;
        color: #6ee7b7 !important;
    }
    
    [data-theme="dark"] #enhancementSuggestions {
        background: #2d1b69 !important;
        border-color: #8b5cf6 !important;
    }
    
    [data-theme="dark"] #enhancementSuggestions li {
        background: #334155 !important;
        color: #e2e8f0 !important;
    }
    
    /* éŸ¿æ‡‰å¼è¨­è¨ˆ */
    @media (max-width: 768px) {
        .enhance-input,
        .enhance-options,
        .enhance-results {
            padding: 1.5rem !important;
            margin-bottom: 1.5rem !important;
        }
        
        #originalPrompt {
            min-height: 120px !important;
            padding: 1rem !important;
        }
        
        .enhance-controls {
            flex-direction: column !important;
            align-items: center !important;
            gap: 1rem !important;
        }
        
        #enhancePromptLocal {
            width: 100% !important;
            max-width: 300px !important;
            padding: 1rem 2rem !important;
        }
        
        .result-header {
            flex-direction: column !important;
            gap: 1rem !important;
            text-align: center !important;
        }
    }
    
    /* è¼‰å…¥ç‹€æ…‹å‹•ç•« */
    #enhancePromptLocal:disabled {
        opacity: 0.7 !important;
        cursor: not-allowed !important;
        transform: none !important;
    }
    
    #enhancePromptLocal:disabled i {
        animation: spin 1s linear infinite !important;
    }
    
    @keyframes spin {
        from { transform: rotate(0deg); }
        to { transform: rotate(360deg); }
    }
    
    /* æˆåŠŸç‹€æ…‹å‹•ç•« */
    .enhance-results.success-animation {
        animation: successPulse 0.6s ease-out !important;
    }
    
    @keyframes successPulse {
        0% {
            transform: scale(0.95);
            box-shadow: 0 0 0 0 rgba(34, 197, 94, 0.4);
        }
        50% {
            transform: scale(1.02);
            box-shadow: 0 0 0 10px rgba(34, 197, 94, 0);
        }
        100% {
            transform: scale(1);
            box-shadow: 0 0 0 0 rgba(34, 197, 94, 0);
        }
    }
    </style>

    <!-- æç¤ºè©å¢å¼·åŠŸèƒ½ é–“è·å„ªåŒ– CSS -->
    <style>
    /* === ğŸ¨ æç¤ºè©å¢å¼·åŠŸèƒ½ - å¤§å¹…å¢åŠ é–“è·ï¼Œæ¸›å°‘ç·Šæ¹Šæ„Ÿ === */
    
    /* æ•´é«”æ¨™ç±¤é å¢åŠ é–“è· */
    #enhance-tab {
        padding: 3rem 2rem !important;
        min-height: 800px !important;
    }
    
    /* å„å€‹å€å¡Šä¹‹é–“çš„é–“è·å¤§å¹…å¢åŠ  */
    .prompt-templates {
        margin-bottom: 4rem !important;
        padding: 2.5rem !important;
        background: rgba(255, 255, 255, 0.8) !important;
        border-radius: 20px !important;
        box-shadow: 0 4px 20px rgba(0, 0, 0, 0.05) !important;
    }
    
    .prompt-templates h4 {
        font-size: 1.4rem !important;
        margin-bottom: 2rem !important;
        padding-bottom: 1rem !important;
        border-bottom: 2px solid #f1f5f9 !important;
    }
    
    .template-grid {
        display: grid !important;
        grid-template-columns: repeat(auto-fit, minmax(120px, 1fr)) !important;
        gap: 2rem !important;
        margin-top: 2rem !important;
    }
    
    .template-btn {
        min-height: 100px !important;
        padding: 1.5rem 1rem !important;
        margin: 0 !important;
    }
    
    .template-btn i {
        font-size: 2rem !important;
        margin-bottom: 0.75rem !important;
    }
    
    .template-btn span {
        font-size: 1rem !important;
        margin-top: 0.5rem !important;
    }
    
    /* è¼¸å…¥å€åŸŸå¤§å¹…å¢åŠ é–“è· */
    .enhance-input {
        margin-bottom: 4rem !important;
        padding: 3rem !important;
    }
    
    .input-header {
        display: flex !important;
        justify-content: space-between !important;
        align-items: center !important;
        margin-bottom: 2rem !important;
        padding-bottom: 1rem !important;
        border-bottom: 1px solid #e2e8f0 !important;
    }
    
    .input-tools {
        display: flex !important;
        gap: 1rem !important;
        align-items: center !important;
    }
    
    .tool-btn {
        padding: 0.75rem 1rem !important;
        background: #f8fafc !important;
        border: 1px solid #e2e8f0 !important;
        border-radius: 8px !important;
        cursor: pointer !important;
        transition: all 0.2s ease !important;
        font-size: 0.9rem !important;
    }
    
    .tool-btn:hover {
        background: #e2e8f0 !important;
        transform: translateY(-1px) !important;
    }
    
    .char-count {
        background: #f1f5f9 !important;
        padding: 0.5rem 1rem !important;
        border-radius: 6px !important;
        font-size: 0.85rem !important;
        font-weight: 600 !important;
    }
    
    #originalPrompt {
        min-height: 200px !important;
        padding: 2rem !important;
        font-size: 1.1rem !important;
        line-height: 1.8 !important;
        margin-top: 1.5rem !important;
    }
    
    /* é¸é …å€åŸŸå¢åŠ é–“è· */
    .enhance-options {
        margin-bottom: 4rem !important;
        padding: 3rem !important;
    }
    
    .options-grid {
        display: grid !important;
        grid-template-columns: repeat(auto-fit, minmax(300px, 1fr)) !important;
        gap: 2.5rem !important;
        margin-top: 2rem !important;
    }
    
    .option-group {
        margin-bottom: 2rem !important;
    }
    
    .option-group label {
        font-size: 1.2rem !important;
        margin-bottom: 1.5rem !important;
        padding-left: 0.5rem !important;
    }
    
    #enhanceStyle {
        min-height: 60px !important;
        padding: 1.25rem 1.5rem !important;
        font-size: 1.1rem !important;
        margin-top: 1rem !important;
    }
    
    .intensity-slider {
        margin-top: 1.5rem !important;
        padding: 1rem !important;
        background: #f8fafc !important;
        border-radius: 12px !important;
    }
    
    #enhanceIntensity {
        width: 100% !important;
        height: 8px !important;
        margin: 1rem 0 !important;
    }
    
    .intensity-labels {
        display: flex !important;
        justify-content: space-between !important;
        font-size: 0.9rem !important;
        color: #6b7280 !important;
        margin-top: 1rem !important;
    }
    
    /* æŒ‰éˆ•æ§åˆ¶å€åŸŸå¤§å¹…å¢åŠ é–“è· */
    .enhance-controls {
        margin: 5rem 0 !important;
        padding: 2rem !important;
        background: rgba(255, 255, 255, 0.5) !important;
        border-radius: 20px !important;
        border: 1px solid #e2e8f0 !important;
    }
    
    .enhance-controls button {
        min-height: 70px !important;
        min-width: 200px !important;
        padding: 1.5rem 3rem !important;
        font-size: 1.2rem !important;
        margin: 0.75rem !important;
        border-radius: 20px !important;
    }
    
    .enhance-controls button i {
        font-size: 1.4rem !important;
        margin-right: 1rem !important;
    }
    
    /* çµæœå±•ç¤ºå€åŸŸå¢åŠ é–“è· */
    .enhance-results {
        margin-top: 4rem !important;
        padding: 3.5rem !important;
        border-radius: 24px !important;
    }
    
    .result-header {
        margin-bottom: 3rem !important;
        padding-bottom: 1.5rem !important;
    }
    
    .result-header h4 {
        font-size: 1.8rem !important;
    }
    
    .result-actions {
        display: flex !important;
        gap: 1.5rem !important;
    }
    
    .result-actions .action-btn {
        padding: 1rem 1.5rem !important;
        font-size: 1rem !important;
        border-radius: 12px !important;
    }
    
    .results-container {
        display: flex !important;
        flex-direction: column !important;
        gap: 3rem !important;
    }
    
    .enhanced-prompt-container {
        margin-bottom: 2rem !important;
    }
    
    .enhanced-prompt-container label {
        font-size: 1.3rem !important;
        font-weight: 700 !important;
        color: #1e293b !important;
        margin-bottom: 1.5rem !important;
        display: block !important;
    }
    
    #enhancedPrompt {
        padding: 3rem !important;
        font-size: 1.2rem !important;
        line-height: 1.8 !important;
        margin-top: 1.5rem !important;
        border-radius: 16px !important;
    }
    
    #enhancementSuggestions {
        padding: 2.5rem !important;
        margin-top: 3rem !important;
        border-radius: 16px !important;
    }
    
    #enhancementSuggestions h5 {
        font-size: 1.3rem !important;
        margin-bottom: 2rem !important;
    }
    
    #enhancementSuggestions li {
        padding: 1.5rem !important;
        margin-bottom: 1.5rem !important;
        font-size: 1.1rem !important;
        border-radius: 12px !important;
    }
    
    .comparison-section {
        margin-top: 3rem !important;
        padding: 2.5rem !important;
        background: #f8fafc !important;
        border-radius: 16px !important;
        border: 1px solid #e2e8f0 !important;
    }
    
    .comparison-section h5 {
        font-size: 1.4rem !important;
        margin-bottom: 2rem !important;
        text-align: center !important;
    }
    
    .comparison-grid {
        display: grid !important;
        grid-template-columns: 1fr 1fr !important;
        gap: 3rem !important;
        margin-top: 2rem !important;
    }
    
    .before-section,
    .after-section {
        padding: 2rem !important;
        background: white !important;
        border-radius: 12px !important;
        border: 1px solid #e2e8f0 !important;
    }
    
    .before-section label,
    .after-section label {
        font-size: 1.1rem !important;
        font-weight: 600 !important;
        margin-bottom: 1.5rem !important;
        display: block !important;
    }
    
    .original-text,
    .enhanced-text {
        padding: 1.5rem !important;
        background: #f8fafc !important;
        border-radius: 8px !important;
        font-size: 1rem !important;
        line-height: 1.6 !important;
        min-height: 80px !important;
    }
    
    /* æ·±è‰²æ¨¡å¼çš„é–“è·ä¿æŒä¸€è‡´ */
    [data-theme="dark"] .prompt-templates,
    [data-theme="dark"] .enhance-controls {
        background: rgba(30, 41, 59, 0.8) !important;
    }
    
    [data-theme="dark"] .comparison-section,
    [data-theme="dark"] .before-section,
    [data-theme="dark"] .after-section {
        background: #334155 !important;
        border-color: #475569 !important;
    }
    
    [data-theme="dark"] .original-text,
    [data-theme="dark"] .enhanced-text {
        background: #1e293b !important;
        color: #e2e8f0 !important;
    }
    
    /* éŸ¿æ‡‰å¼è¨­è¨ˆ - ä¿æŒå¤§é–“è· */
    @media (max-width: 768px) {
        #enhance-tab {
            padding: 2rem 1.5rem !important;
        }
        
        .prompt-templates,
        .enhance-input,
        .enhance-options,
        .enhance-results {
            padding: 2rem !important;
            margin-bottom: 3rem !important;
        }
        
        .template-grid {
            grid-template-columns: repeat(auto-fit, minmax(100px, 1fr)) !important;
            gap: 1.5rem !important;
        }
        
        .options-grid {
            grid-template-columns: 1fr !important;
            gap: 2rem !important;
        }
        
        .enhance-controls {
            margin: 3rem 0 !important;
            padding: 1.5rem !important;
        }
        
        .enhance-controls button {
            min-height: 60px !important;
            min-width: 180px !important;
            padding: 1.25rem 2rem !important;
            font-size: 1.1rem !important;
        }
        
        .comparison-grid {
            grid-template-columns: 1fr !important;
            gap: 2rem !important;
        }
    }
    
    @media (max-width: 480px) {
        #enhance-tab {
            padding: 1.5rem 1rem !important;
        }
        
        .enhance-controls button {
            width: 100% !important;
            max-width: none !important;
            margin: 0.5rem 0 !important;
        }
        
        #originalPrompt {
            min-height: 160px !important;
            padding: 1.5rem !important;
        }
    }
    </style>

    <!-- å–æ¶ˆ group å…ƒç´ çš„"æ¡†"æ¨£å¼ -->
    <style>
    /* === ğŸš« å–æ¶ˆå®¹å™¨"æ¡†"æ¨£å¼ === */
    
    .input-group,
    .options-grid,
    .option-group,
    .setting-group {
        background: transparent !important;
        background-color: transparent !important;
        border: none !important;
        box-shadow: none !important;
        padding: 0 !important;
        margin-bottom: 2rem !important; /* ä¿ç•™ä¸€äº›å‚ç›´é–“è·ï¼Œé¿å…å…ƒç´ æ“ åœ¨ä¸€èµ· */
    }

    /* ç‚ºæ·±è‰²æ¨¡å¼ä¹Ÿæ‡‰ç”¨ç›¸åŒçš„è¦å‰‡ */
    [data-theme="dark"] .input-group,
    [data-theme="dark"] .options-grid,
    [data-theme="dark"] .option-group,
    [data-theme="dark"] .setting-group,
    body[data-theme="dark"] .input-group,
    body[data-theme="dark"] .options-grid,
    body[data-theme="dark"] .option-group,
    body[data-theme="dark"] .setting-group {
        background: transparent !important;
        background-color: transparent !important;
        border: none !important;
        box-shadow: none !important;
        padding: 0 !important;
    }
    
    /* å°æ–¼å…§éƒ¨çš„ label å’Œ input/selectï¼Œå¯èƒ½éœ€è¦å¾®èª¿ä»¥ä¿æŒå°é½Š */
    .option-group label,
    .setting-group label {
        margin-bottom: 1rem !important;
    }

    </style>

    <!-- åƒ…å–æ¶ˆ group å…ƒç´ çš„"é‚Šæ¡†"æ¨£å¼ -->
    <style>
    /* === ğŸš« å–æ¶ˆå®¹å™¨"é‚Šæ¡†"æ¨£å¼ === */
    
    .input-group,
    .options-grid,
    .option-group,
    .setting-group {
        border: none !important;
        /* ä¿ç•™åŸæœ‰çš„ background, padding, å’Œ box-shadow */
    }

    /* ç‚ºæ·±è‰²æ¨¡å¼ä¹Ÿæ‡‰ç”¨ç›¸åŒçš„è¦å‰‡ */
    [data-theme="dark"] .input-group,
    [data-theme="dark"] .options-grid,
    [data-theme="dark"] .option-group,
    [data-theme="dark"] .setting-group,
    body[data-theme="dark"] .input-group,
    body[data-theme="dark"] .options-grid,
    body[data-theme="dark"] .option-group,
    body[data-theme="dark"] .setting-group {
        border: none !important;
        /* ä¿ç•™åŸæœ‰çš„ background, padding, å’Œ box-shadow */
    }
    </style>

    <!-- æ·±è‰²æ¨¡å¼ä¸‹ï¼Œå–æ¶ˆæŒ‡å®šå®¹å™¨çš„èƒŒæ™¯å’Œé‚Šæ¡† -->
    <style>
    /* === ğŸš« æ·±è‰²æ¨¡å¼å®¹å™¨æ‰å¹³åŒ– === */
    
    [data-theme="dark"] .settings-grid,
    [data-theme="dark"] .setting-group,
    [data-theme="dark"] .option-group,
    [data-theme="dark"] .options-grid,
    [data-theme="dark"] .input-group,
    [data-theme="dark"] .batch-header,
    [data-theme="dark"] .batch-controls,
    [data-theme="dark"] .batch-prompts-container,
    [data-theme="dark"] .prompts-list,
    [data-theme="dark"] .empty-state,
    body[data-theme="dark"] .settings-grid,
    body[data-theme="dark"] .setting-group,
    body[data-theme="dark"] .option-group,
    body[data-theme="dark"] .options-grid,
    body[data-theme="dark"] .input-group,
    body[data-theme="dark"] .batch-header,
    body[data-theme="dark"] .batch-controls,
    body[data-theme="dark"] .batch-prompts-container,
    body[data-theme="dark"] .prompts-list,
    body[data-theme="dark"] .empty-state {
        background-color: transparent !important;
        border: none !important;
        box-shadow: none !important;
        padding: 0 !important; /* åŒæ™‚ç§»é™¤å…§é‚Šè·ä»¥é”åˆ°å®Œå…¨æ‰å¹³åŒ– */
        margin-bottom: 2rem !important; /* ä¿ç•™å‚ç›´é–“è· */
    }
    </style>
</head>
<body>
    <!-- ä¸»é¡Œå’Œèªè¨€åˆ‡æ›æŒ‰éˆ• -->
    <div class="top-controls">
        <!-- èªè¨€åˆ‡æ›å™¨ -->
        <div class="language-toggle" id="languageToggle">
            <span class="language-icon">ğŸŒ</span>
            <span id="languageText" data-i18n="language.current">ç¹é«”ä¸­æ–‡</span>
            <div class="language-dropdown" id="languageDropdown">
                <div class="language-option" data-language="zh-TW" onclick="i18n.changeLanguage('zh-TW')">
                    <span class="language-flag">ğŸ‡¹ğŸ‡¼</span>
                    <span class="language-name" data-i18n="language.zhTW">ç¹é«”ä¸­æ–‡</span>
                </div>
                <div class="language-option" data-language="zh-CN" onclick="i18n.changeLanguage('zh-CN')">
                    <span class="language-flag">ğŸ‡¨ğŸ‡³</span>
                    <span class="language-name" data-i18n="language.zhCN">ç®€ä½“ä¸­æ–‡</span>
                </div>
                <div class="language-option" data-language="en" onclick="i18n.changeLanguage('en')">
                    <span class="language-flag">ğŸ‡ºğŸ‡¸</span>
                    <span class="language-name" data-i18n="language.en">English</span>
                </div>
            </div>
        </div>

        <!-- ä¸»é¡Œåˆ‡æ›æŒ‰éˆ• -->
        <button class="theme-toggle" onclick="toggleTheme()">
            <span class="theme-icon" id="themeIcon">ğŸŒ™</span>
            <span id="themeText" data-i18n="theme.dark">æ·±è‰²æ¨¡å¼</span>
        </button>
    </div>

    <!-- å°èˆªæ¨™ç±¤ -->
    <nav class="tab-navigation">
        <button class="tab-btn active" onclick="switchTab('generator')" data-i18n="nav.generator">åœ–ç‰‡ç”Ÿæˆ</button>
        <button class="tab-btn" onclick="switchTab('gallery')" data-i18n="nav.gallery">åœ–ç‰‡ç•«å»Š</button>
        <button class="tab-btn" onclick="switchTab('history')" data-i18n="nav.history">ç”Ÿæˆæ­·å²</button>
        <button class="tab-btn" onclick="switchTab('statistics')" data-i18n="nav.statistics">çµ±è¨ˆåˆ†æ</button>
    </nav>
    <div class="container">
        <header>
            <h1 data-i18n="app.title">ğŸ¨ æ‰¹é‡åœ–ç‰‡ç”Ÿæˆå™¨</h1>
            <p data-i18n="app.subtitle">æ”¯æŒå¤šç¨® AI åœ–ç‰‡ç”Ÿæˆæœå‹™ï¼šGeminiã€OpenAIã€Stability AI æˆ–è‡ªå®šç¾© API</p>
            <div class="api-info" data-i18n="app.api.info">
                ğŸ’¡ æ‰€æœ‰ API é…ç½®éƒ½å¯ä»¥åœ¨ä¸‹æ–¹è¨­ç½®ä¸­å®Œæˆï¼Œç„¡éœ€ç’°å¢ƒè®Šé‡
            </div>
        </header>

        <!-- åœ–ç‰‡ç”Ÿæˆæ¨™ç±¤é  -->
        <div id="generatorTab" class="tab-content active">
            <div class="main-content">
            <!-- æç¤ºè©è¼¸å…¥å€åŸŸ -->
            <div class="input-section">
                <h2 data-i18n="generator.prompts.label">ğŸ“ è¼¸å…¥æç¤ºè©</h2>
                <div class="prompts-container">
                    <textarea id="prompts" data-i18n="generator.prompts.placeholder" rows="10"></textarea>
                    <div class="prompt-count"><span data-i18n="generator.prompt.count">æç¤ºè©æ•¸é‡</span>: <span id="promptCount">0</span></div>
                </div>
            </div>

            <!-- AI æ™ºèƒ½åŠ©æ‰‹é¢æ¿ v2.7 -->
            <div class="ai-assistant-v27" id="aiAssistantV27">
                <!-- AI Assistant å…§å®¹å°‡ç”± JavaScript å‹•æ…‹ç”Ÿæˆ -->
            </div>

            <!-- æç¤ºè©å¢å¼·é¢æ¿ -->
            <div class="prompt-enhancer-panel" id="promptEnhancerPanel">
                <div class="enhancer-header" onclick="toggleEnhancerPanel()">
                    <h3 data-i18n="prompt.enhancer.title">ğŸ”§ æç¤ºè©å¢å¼·å·¥å…·</h3>
                    <button class="toggle-enhancer" id="toggleEnhancer" data-i18n="prompt.enhancer.toggle">æ”¶èµ·</button>
                </div>
                
                <div class="enhancer-content" id="enhancerContent">
                    <!-- æç¤ºè©åˆ†æå€åŸŸ -->
                    <div class="analysis-section">
                        <h4 data-i18n="prompt.analysis.title">ğŸ“Š æç¤ºè©åˆ†æ</h4>
                        <div class="analysis-results" id="analysisResults">
                            <div class="analysis-item">
                                <span data-i18n="prompt.analysis.length">é•·åº¦:</span>
                                <span id="promptLength">0</span>
                            </div>
                            <div class="analysis-item">
                                <span data-i18n="prompt.analysis.complexity">è¤‡é›œåº¦:</span>
                                <span id="promptComplexity">-</span>
                            </div>
                            <div class="analysis-item">
                                <span data-i18n="prompt.analysis.quality">å“è³ªåˆ†æ•¸:</span>
                                <span id="qualityScore">0/100</span>
                            </div>
                        </div>
                    </div>

                    <!-- èªæ³•æª¢æŸ¥çµæœ -->
                    <div class="syntax-section">
                        <h4 data-i18n="prompt.syntax.title">âœ… èªæ³•æª¢æŸ¥</h4>
                        <div class="syntax-results" id="syntaxResults">
                            <div class="syntax-status">ç­‰å¾…åˆ†æ...</div>
                        </div>
                    </div>

                    <!-- AI å„ªåŒ–å»ºè­° -->
                    <div class="optimization-section">
                        <h4 data-i18n="prompt.optimization.title">ğŸ¤– AI å„ªåŒ–å»ºè­°</h4>
                        <div class="optimization-controls">
                            <button class="enhance-btn" onclick="optimizePrompts()" data-i18n="prompt.optimize.btn">å„ªåŒ–æç¤ºè©</button>
                            <button class="enhance-btn" onclick="translatePrompts()" data-i18n="prompt.translate.btn">ç¿»è­¯æç¤ºè©</button>
                        </div>
                        <div class="optimization-results" id="optimizationResults"></div>
                    </div>

                    <!-- è² é¢æç¤ºè© -->
                    <div class="negative-prompts-section">
                        <h4 data-i18n="prompt.negative.title">ğŸš« è² é¢æç¤ºè©</h4>
                        <textarea 
                            id="negativePrompts" 
                            placeholder="è¼¸å…¥æ‚¨æƒ³è¦é¿å…çš„å…ƒç´ ..." 
                            data-i18n="prompt.negative.placeholder"
                            rows="3"></textarea>
                        <div class="negative-suggestions">
                            <strong data-i18n="prompt.negative.suggestions">å¸¸ç”¨å»ºè­°:</strong>
                            <div class="suggestion-tags" id="negativeSuggestions"></div>
                        </div>
                    </div>

                    <!-- æç¤ºè©æ¨¡æ¿åº« -->
                    <div class="templates-section">
                        <h4 data-i18n="prompt.templates.title">ğŸ“š æç¤ºè©æ¨¡æ¿åº«</h4>
                        <div class="template-controls">
                            <select id="templateCategory" data-i18n="prompt.templates.select">
                                <option value="" data-i18n="prompt.templates.select">é¸æ“‡åˆ†é¡...</option>
                                <option value="portrait" data-i18n="template.portrait">äººåƒæ”å½±</option>
                                <option value="landscape" data-i18n="template.landscape">é¢¨æ™¯ç•«é¢</option>
                                <option value="abstract" data-i18n="template.abstract">æŠ½è±¡è—è¡“</option>
                                <option value="fantasy" data-i18n="template.fantasy">å¥‡å¹»é¢¨æ ¼</option>
                                <option value="anime" data-i18n="template.anime">å‹•æ¼«é¢¨æ ¼</option>
                                <option value="realistic" data-i18n="template.realistic">å¯«å¯¦é¢¨æ ¼</option>
                            </select>
                            <button class="enhance-btn" onclick="saveAsTemplate()" data-i18n="prompt.templates.save">ä¿å­˜æ¨¡æ¿</button>
                        </div>
                        <div class="template-suggestions" id="templateSuggestions"></div>
                    </div>

                    <!-- é«˜ç´šè¨­ç½® -->
                    <div class="advanced-settings">
                        <h4 data-i18n="prompt.advanced.title">âš™ï¸ é«˜ç´šè¨­ç½®</h4>
                        <div class="setting-row">
                            <label>
                                <input type="checkbox" id="autoOptimize">
                                <span data-i18n="prompt.auto.optimize">è‡ªå‹•å„ªåŒ–</span>
                            </label>
                        </div>
                        <div class="setting-row">
                            <label data-i18n="prompt.optimization.level">å„ªåŒ–ç¨‹åº¦:</label>
                            <select id="optimizationLevel">
                                <option value="light" data-i18n="optimization.light">è¼•åº¦</option>
                                <option value="moderate" data-i18n="optimization.moderate" selected>ä¸­åº¦</option>
                                <option value="aggressive" data-i18n="optimization.aggressive">æ¿€é€²</option>
                            </select>
                        </div>
                        <div class="setting-row">
                            <label data-i18n="prompt.target.language">ç›®æ¨™èªè¨€:</label>
                            <select id="targetLanguage">
                                <option value="zh-TW">ç¹é«”ä¸­æ–‡</option>
                                <option value="zh-CN">ç®€ä½“ä¸­æ–‡</option>
                                <option value="en" selected>English</option>
                                <option value="ja" data-i18n="language.ja">æ—¥æœ¬èª</option>
                                <option value="ko" data-i18n="language.ko">í•œêµ­ì–´</option>
                            </select>
                        </div>
                    </div>
                </div>
            </div>

            <!-- ç”Ÿæˆè¨­ç½® -->
            <div class="settings-section">
                <h2 data-i18n="generator.settings">âš™ï¸ ç”Ÿæˆè¨­ç½®</h2>
                <div class="settings-grid">
                    <div class="setting-item">
                        <label for="apiProvider" data-i18n="generator.apiProvider">API æä¾›å•†:</label>
                        <select id="apiProvider">
                            <option value="gemini" selected data-i18n="api.gemini">Google Gemini</option>
                            <option value="openai" data-i18n="api.openai">OpenAI DALL-E</option>
                            <option value="stability" data-i18n="api.stability">Stability AI</option>
                            <option value="adobe_firefly" data-i18n="api.adobe_firefly">Adobe Firefly âœ¨</option>
                            <option value="leonardo_ai" data-i18n="api.leonardo_ai">Leonardo AI âœ¨</option>
                            <option value="custom" data-i18n="api.custom">è‡ªå®šç¾© API</option>
                        </select>
                    </div>
                    <div class="setting-item">
                        <label for="imageSize" data-i18n="generator.imageSize">åœ–ç‰‡å°ºå¯¸:</label>
                        <select id="imageSize">
                            <option value="512x512" data-i18n="size.512x512">512 x 512</option>
                            <option value="1024x1024" selected data-i18n="size.1024x1024">1024 x 1024</option>
                            <option value="1024x768" data-i18n="size.1024x768">1024 x 768</option>
                            <option value="768x1024" data-i18n="size.768x1024">768 x 1024</option>
                        </select>
                    </div>
                    <div class="setting-item">
                        <label for="imageCount" data-i18n="generator.imageCount">æ¯å€‹æç¤ºè©ç”Ÿæˆæ•¸é‡:</label>
                        <input type="number" id="imageCount" min="1" max="5" value="1">
                    </div>
                    <div class="setting-item" id="modelSelectionSection">
                        <label for="modelSelect" data-i18n="generator.model">æ¨¡å‹é¸æ“‡:</label>
                        <select id="modelSelect">
                            <option value="" data-i18n="model.default">é è¨­æ¨¡å‹</option>
                        </select>
                    </div>
                </div>
                
                <!-- API é‡‘é‘°è¨­ç½® -->
                <div id="apiKeySettings" class="api-key-section">
                    <h3>ğŸ”‘ API é‡‘é‘°è¨­ç½®</h3>
                    <div class="settings-grid">
                        <div class="setting-item" id="geminiKeySection">
                            <label for="geminiApiKey">Gemini API é‡‘é‘°:</label>
                            <input type="password" id="geminiApiKey" placeholder="æ‚¨çš„ Gemini API é‡‘é‘°">
                        </div>
                        <div class="setting-item" id="openaiKeySection" style="display: none;">
                            <label for="openaiApiKey">OpenAI API é‡‘é‘°:</label>
                            <input type="password" id="openaiApiKey" placeholder="æ‚¨çš„ OpenAI API é‡‘é‘°">
                        </div>
                        <div class="setting-item" id="stabilityKeySection" style="display: none;">
                            <label for="stabilityApiKey">Stability AI API é‡‘é‘°:</label>
                            <input type="password" id="stabilityApiKey" placeholder="æ‚¨çš„ Stability AI API é‡‘é‘°">
                        </div>
                        <div class="setting-item" id="adobeFireflyKeySection" style="display: none;">
                            <label for="adobeFireflyApiKey">Adobe Firefly API é‡‘é‘°:</label>
                            <input type="password" id="adobeFireflyApiKey" placeholder="æ‚¨çš„ Adobe Firefly API é‡‘é‘°">
                        </div>
                        <div class="setting-item" id="leonardoAiKeySection" style="display: none;">
                            <label for="leonardoAiApiKey">Leonardo AI API é‡‘é‘°:</label>
                            <input type="password" id="leonardoAiApiKey" placeholder="æ‚¨çš„ Leonardo AI API é‡‘é‘°">
                        </div>
                    </div>
                </div>
                
                <!-- è‡ªå®šç¾© API è¨­ç½® -->
                <div id="customApiSettings" class="custom-api-section" style="display: none;">
                    <h3 data-i18n="api.custom.settings">ğŸ”§ è‡ªå®šç¾© API è¨­ç½®</h3>
                    <div class="settings-grid">
                        <div class="setting-item">
                            <label for="customApiUrl" data-i18n="api.custom.url">API ç«¯é» URL:</label>
                            <input type="url" id="customApiUrl" data-i18n="api.custom.url.placeholder" placeholder="https://api.example.com/generate">
                        </div>
                        <div class="setting-item">
                            <label for="customApiKey" data-i18n="api.custom.key">API é‡‘é‘°:</label>
                            <input type="password" id="customApiKey" data-i18n="api.custom.key.placeholder" placeholder="æ‚¨çš„ API é‡‘é‘°">
                        </div>
                        <div class="setting-item">
                            <label for="customModel" data-i18n="api.custom.model">æ¨¡å‹åç¨±:</label>
                            <input type="text" id="customModel" data-i18n="api.custom.model.placeholder" placeholder="æ¨¡å‹åç¨± (å¯é¸)">
                        </div>
                        <div class="setting-item">
                            <label for="requestFormat" data-i18n="api.custom.format">è«‹æ±‚æ ¼å¼:</label>
                            <select id="requestFormat">
                                <option value="json">JSON</option>
                                <option value="form">Form Data</option>
                            </select>
                        </div>
                    </div>
                    <div class="setting-item">
                        <label for="customHeaders" data-i18n="api.custom.headers">è‡ªå®šç¾©è«‹æ±‚é ­ (JSON æ ¼å¼):</label>
                        <textarea id="customHeaders" rows="3" data-i18n="api.custom.headers.placeholder" placeholder='{"Content-Type": "application/json", "Authorization": "Bearer YOUR_TOKEN"}'></textarea>
                    </div>
                    <div class="setting-item">
                        <label for="requestTemplate" data-i18n="api.custom.template">è«‹æ±‚æ¨¡æ¿ (JSON æ ¼å¼):</label>
                        <textarea id="requestTemplate" rows="5" data-i18n="api.custom.template.placeholder" placeholder='{"prompt": "{PROMPT}", "size": "{SIZE}", "n": {COUNT}}'></textarea>
                    </div>
                </div>
            </div>

            <!-- æ§åˆ¶æŒ‰éˆ• -->
            <div class="controls-section">
                <button id="generateBtn" class="generate-btn">
                    <span class="btn-text" data-i18n="generator.generate">ğŸš€ é–‹å§‹ç”Ÿæˆ</span>
                    <span class="loading-spinner" style="display: none;" data-i18n="generator.generating">â³ ç”Ÿæˆä¸­...</span>
                </button>
                <button id="clearBtn" class="clear-btn" data-i18n="generator.clear">ğŸ—‘ï¸ æ¸…é™¤å…¨éƒ¨</button>
            </div>

            <!-- é€²åº¦é¡¯ç¤º -->
            <div class="progress-section" style="display: none;">
                <h3 data-i18n="progress.title">ğŸ“Š ç”Ÿæˆé€²åº¦</h3>
                <div class="progress-bar">
                    <div class="progress-fill" id="progressFill"></div>
                </div>
                <div class="progress-text">
                    <span id="progressText" data-i18n="progress.preparing">æº–å‚™ä¸­...</span>
                </div>
            </div>

            <!-- çµæœå±•ç¤º -->
            <div class="results-section">
                <h2 data-i18n="results.title">ğŸ–¼ï¸ ç”Ÿæˆçµæœ</h2>
                <div id="resultsContainer" class="results-grid">
                    <!-- åœ–ç‰‡çµæœæœƒå‹•æ…‹æ’å…¥é€™è£¡ -->
                </div>
            </div>
        </div>
    </div>

        <!-- åœ–ç‰‡ç•«å»Šæ¨™ç±¤é  -->
        <div id="galleryTab" class="tab-content">
            <div class="gallery-header">
                <h2 data-i18n="gallery.title">ğŸ–¼ï¸ åœ–ç‰‡ç•«å»Š</h2>
                <div class="gallery-stats" id="galleryStats" data-i18n="msg.loading">
                    è¼‰å…¥ä¸­...
                </div>
            </div>

            <!-- æœå°‹å’Œç¯©é¸ -->
            <div class="gallery-filters">
                <div class="filter-group">
                    <label for="gallerySearch" data-i18n="gallery.search">ğŸ” æœå°‹æç¤ºè©:</label>
                    <input type="text" id="gallerySearch" data-i18n="gallery.search.placeholder" placeholder="è¼¸å…¥é—œéµå­—æœå°‹...">
                </div>
                
                <div class="filter-group">
                    <label for="providerFilter" data-i18n="gallery.filter.provider">API æä¾›å•†:</label>
                    <select id="providerFilter">
                        <option value="" data-i18n="filter.all">å…¨éƒ¨</option>
                        <option value="gemini" data-i18n="api.gemini">Google Gemini</option>
                        <option value="openai" data-i18n="api.openai">OpenAI DALL-E</option>
                        <option value="stability" data-i18n="api.stability">Stability AI</option>
                        <option value="adobe_firefly" data-i18n="api.adobe_firefly">Adobe Firefly âœ¨</option>
                        <option value="leonardo_ai" data-i18n="api.leonardo_ai">Leonardo AI âœ¨</option>
                        <option value="custom" data-i18n="api.custom">è‡ªå®šç¾© API</option>
                    </select>
                </div>
                
                <div class="filter-group">
                    <label for="favoriteFilter" data-i18n="gallery.filter.favorite">æ”¶è—ç‹€æ…‹:</label>
                    <select id="favoriteFilter">
                        <option value="" data-i18n="filter.all">å…¨éƒ¨</option>
                        <option value="true" data-i18n="filter.favorited">å·²æ”¶è—</option>
                        <option value="false" data-i18n="filter.not.favorited">æœªæ”¶è—</option>
                    </select>
                </div>
                
                <div class="filter-group">
                    <label for="sortBy" data-i18n="gallery.filter.sort">æ’åºæ–¹å¼:</label>
                    <select id="sortBy">
                        <option value="created_at" data-i18n="sort.date">å‰µå»ºæ™‚é–“</option>
                        <option value="rating" data-i18n="sort.rating">è©•åˆ†</option>
                        <option value="filename" data-i18n="sort.filename">æ–‡ä»¶å</option>
                        <option value="api_provider" data-i18n="sort.provider">API æä¾›å•†</option>
                    </select>
                </div>
            </div>

            <!-- æ‰¹é‡æ“ä½œ -->
            <div class="batch-actions" id="batchActions" style="display: none;">
                <div class="batch-info">
                    <span data-i18n="gallery.batch.select">å·²é¸æ“‡</span> <span id="selectedCount">0</span> <span data-i18n="gallery.images">å¼µåœ–ç‰‡</span>
                </div>
                <div class="batch-buttons">
                    <button id="selectAllImages" class="btn-secondary" data-i18n="btn.select.all">å…¨é¸/å–æ¶ˆå…¨é¸</button>
                    <button id="downloadSelected" class="btn-primary" data-i18n="gallery.batch.download">æ‰¹é‡ä¸‹è¼‰</button>
                    <button id="deleteSelected" class="btn-danger" data-i18n="gallery.batch.delete">æ‰¹é‡åˆªé™¤</button>
                </div>
            </div>

            <!-- åœ–ç‰‡ç¶²æ ¼ -->
            <div class="gallery-container">
                <div id="imageGalleryContainer" class="image-grid">
                    <!-- åœ–ç‰‡æœƒå‹•æ…‹è¼‰å…¥åˆ°é€™è£¡ -->
                </div>
            </div>

            <!-- åˆ†é å°èˆª -->
            <div id="galleryPagination" class="pagination-container">
                <!-- åˆ†é æ§åˆ¶æœƒå‹•æ…‹è¼‰å…¥åˆ°é€™è£¡ -->
            </div>
        </div>

        <!-- ç”Ÿæˆæ­·å²æ¨™ç±¤é  -->
        <div id="historyTab" class="tab-content">
            <div class="history-header">
                <h2 data-i18n="history.title">ğŸ“œ ç”Ÿæˆæ­·å²</h2>
                <div class="history-actions">
                    <button id="exportHistory" class="btn-secondary" data-i18n="history.export">åŒ¯å‡ºæ­·å²</button>
                    <button id="refreshHistory" class="btn-primary" data-i18n="history.refresh">é‡æ–°æ•´ç†</button>
                </div>
            </div>

            <!-- æ­·å²è¨˜éŒ„åˆ—è¡¨ -->
            <div class="history-container">
                <div id="historyList" class="history-list">
                    <!-- æ­·å²è¨˜éŒ„æœƒå‹•æ…‹è¼‰å…¥åˆ°é€™è£¡ -->
                </div>
            </div>

            <!-- æ­·å²åˆ†é  -->
            <div id="historyPagination" class="pagination-container">
                <!-- åˆ†é æ§åˆ¶æœƒå‹•æ…‹è¼‰å…¥åˆ°é€™è£¡ -->
            </div>
        </div>

        <!-- çµ±è¨ˆåˆ†ææ¨™ç±¤é  -->
        <div id="statisticsTab" class="tab-content">
            <div class="statistics-header">
                <h2 data-i18n="stats.title">ğŸ“Š çµ±è¨ˆåˆ†æ</h2>
                <div class="stats-refresh">
                    <button id="refreshStats" class="btn-primary" data-i18n="stats.refresh">é‡æ–°æ•´ç†</button>
                </div>
            </div>

            <div class="statistics-container">
                <!-- åŸºæœ¬çµ±è¨ˆ -->
                <div class="stats-section">
                    <h3 data-i18n="stats.overview">ğŸ“ˆ åŸºæœ¬çµ±è¨ˆ</h3>
                    <div id="basicStats" class="stats-grid">
                        <!-- åŸºæœ¬çµ±è¨ˆæœƒå‹•æ…‹è¼‰å…¥åˆ°é€™è£¡ -->
                    </div>
                </div>

                <!-- æŒ‰æä¾›å•†çµ±è¨ˆ -->
                <div class="stats-section">
                    <h3 data-i18n="stats.provider.usage">ğŸ”§ æŒ‰ API æä¾›å•†çµ±è¨ˆ</h3>
                    <div id="providerStats" class="provider-stats">
                        <!-- æä¾›å•†çµ±è¨ˆæœƒå‹•æ…‹è¼‰å…¥åˆ°é€™è£¡ -->
                    </div>
                </div>

                <!-- æœ€è¿‘7å¤©çµ±è¨ˆ -->
                <div class="stats-section">
                    <h3 data-i18n="stats.daily.activity">ğŸ“… æœ€è¿‘7å¤©ç”Ÿæˆçµ±è¨ˆ</h3>
                    <div id="dailyStats" class="daily-stats">
                        <!-- æ¯æ—¥çµ±è¨ˆæœƒå‹•æ…‹è¼‰å…¥åˆ°é€™è£¡ -->
                    </div>
                </div>

                <!-- æˆåŠŸç‡çµ±è¨ˆ -->
                <div class="stats-section">
                    <h3 data-i18n="stats.success.analysis">âœ… æˆåŠŸç‡åˆ†æ</h3>
                    <div id="successStats" class="success-stats">
                        <!-- æˆåŠŸç‡çµ±è¨ˆæœƒå‹•æ…‹è¼‰å…¥åˆ°é€™è£¡ -->
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- è³‡æºç®¡ç†å™¨å„ªå…ˆè¼‰å…¥ -->
    <script src="js/resource-manager.js"></script>
    
    <!-- å‰ç«¯éŒ¯èª¤ä¿®å¾©è…³æœ¬ -->
    <script>
        /**
         * å…§è¯å‰ç«¯éŒ¯èª¤ä¿®å¾©è…³æœ¬
         * ç«‹å³ä¿®å¾©DOMæ“ä½œå®‰å…¨å•é¡Œ
         */
        (function() {
            class FrontendErrorFixes {
                constructor() {
                    this.fixedFunctions = new Set();
                    this.errorCount = 0;
                    this.warnings = [];
                    this.init();
                }
                
                init() {
                    console.log('ğŸ”§ å‰ç«¯éŒ¯èª¤ä¿®å¾©å™¨å•Ÿå‹•...');
                    this.enhanceErrorHandling();
                    this.createSafeHelpers();
                    console.log('âœ… å‰ç«¯éŒ¯èª¤ä¿®å¾©å®Œæˆ');
                }
                
                enhanceErrorHandling() {
                    if (!window._frontendErrorHandlerInstalled) {
                        window.addEventListener('error', (event) => {
                            this.errorCount++;
                            if (event.message && (
                                event.message.includes('Cannot read properties of null') ||
                                event.message.includes('getElementById') ||
                                event.message.includes('querySelector'))) {
                                console.error('ğŸš¨ DOMæ“ä½œéŒ¯èª¤:', {
                                    message: event.message,
                                    filename: event.filename,
                                    line: event.lineno
                                });
                            }
                        });
                        
                        window.addEventListener('unhandledrejection', (event) => {
                            console.error('ğŸš¨ æœªè™•ç†PromiseéŒ¯èª¤:', event.reason);
                        });
                        
                        window._frontendErrorHandlerInstalled = true;
                    }
                }
                
                createSafeHelpers() {
                    // å®‰å…¨ç²å–å…ƒç´ 
                    window.safeGetElement = (id) => {
                        try {
                            const element = document.getElementById(id);
                            if (!element) console.warn(`âš ï¸ å…ƒç´ ä¸å­˜åœ¨: ${id}`);
                            return element;
                        } catch (error) {
                            console.error(`âŒ ç²å–å…ƒç´ å¤±æ•—: ${id}`, error);
                            return null;
                        }
                    };
                    
                    // å®‰å…¨é¸æ“‡å™¨
                    window.safeQuerySelector = (selector) => {
                        try {
                            const element = document.querySelector(selector);
                            if (!element) console.warn(`âš ï¸ é¸æ“‡å™¨æœªæ‰¾åˆ°å…ƒç´ : ${selector}`);
                            return element;
                        } catch (error) {
                            console.error(`âŒ é¸æ“‡å™¨æŸ¥è©¢å¤±æ•—: ${selector}`, error);
                            return null;
                        }
                    };
                    
                    // å®‰å…¨äº‹ä»¶ç›£è½å™¨
                    window.safeAddEventListener = (elementOrId, event, handler, options = {}) => {
                        try {
                            const element = typeof elementOrId === 'string' ? 
                                window.safeGetElement(elementOrId) : elementOrId;
                            if (element && element.addEventListener) {
                                element.addEventListener(event, handler, options);
                                return true;
                            }
                            return false;
                        } catch (error) {
                            console.error('âŒ æ·»åŠ äº‹ä»¶ç›£è½å™¨å¤±æ•—:', error);
                            return false;
                        }
                    };
                    
                    // å®‰å…¨è¨­ç½®å…§å®¹
                    window.safeSetContent = (elementOrId, content, method = 'textContent') => {
                        try {
                            const element = typeof elementOrId === 'string' ? 
                                window.safeGetElement(elementOrId) : elementOrId;
                            if (element) {
                                element[method] = content;
                                return true;
                            }
                            return false;
                        } catch (error) {
                            console.error('âŒ è¨­ç½®å…§å®¹å¤±æ•—:', error);
                            return false;
                        }
                    };
                    
                    this.fixedFunctions.add('safeHelpers');
                }
                
                getDiagnostics() {
                    return {
                        fixedFunctions: Array.from(this.fixedFunctions),
                        errorCount: this.errorCount,
                        warnings: this.warnings
                    };
                }
            }
            
            // å‰µå»ºå…¨å±€å¯¦ä¾‹
            window.frontendErrorFixes = new FrontendErrorFixes();
            
            // DOMè¼‰å…¥å®Œæˆå¾Œæª¢æŸ¥é—œéµå…ƒç´ 
            document.addEventListener('DOMContentLoaded', () => {
                setTimeout(() => {
                    const criticalElements = ['prompts', 'promptCount', 'generateBtn', 'apiProvider'];
                    const missing = [];
                    
                    criticalElements.forEach(id => {
                        const element = window.safeGetElement(id);
                        if (!element) missing.push(id);
                    });
                    
                    if (missing.length > 0) {
                        console.warn('ğŸš¨ é—œéµå…ƒç´ ç¼ºå¤±:', missing);
                    } else {
                        console.log('âœ… æ‰€æœ‰é—œéµå…ƒç´ éƒ½å­˜åœ¨');
                    }
                    
                    const coverage = ((criticalElements.length - missing.length) / criticalElements.length * 100).toFixed(1);
                    console.log('ğŸ¯ é—œéµå…ƒç´ è¦†è“‹ç‡:', coverage + '%');
                }, 1000);
            });
        })();
    </script>
    
    <!-- éŒ¯èª¤ä¿®å¾©è£œä¸ - å„ªå…ˆè¼‰å…¥ -->
    <script>
        /**
         * éŒ¯èª¤ä¿®å¾©è£œä¸
         * è§£æ±ºæ§åˆ¶å°ä¸­ç™¼ç¾çš„å…·é«”å•é¡Œ
         */
        (function() {
            console.log('ğŸ©¹ è¼‰å…¥éŒ¯èª¤ä¿®å¾©è£œä¸...');
            
            // 1. ä¿®å¾©è³‡æºç®¡ç†å™¨å®šæ™‚å™¨å•é¡Œ
            if (!window._originalSetInterval) {
                window._originalSetInterval = setInterval;
                window._originalSetTimeout = setTimeout;
                window._originalClearInterval = clearInterval;
                window._originalClearTimeout = clearTimeout;
            }
            
            // 2. å…¨å±€PromiseéŒ¯èª¤è™•ç†å¢å¼·
            window.addEventListener('unhandledrejection', (event) => {
                const error = event.reason;
                if (error && error.message) {
                    if (error.message.includes('UserModel') ||
                        error.message.includes('log_activity') ||
                        error.message.includes('404 Not Found')) {
                        console.warn('âš ï¸ å¾Œç«¯é–‹ç™¼å•é¡Œï¼Œå·²å‹å¥½è™•ç†:', error.message);
                        event.preventDefault();
                        return;
                    }
                }
            });
            
            // 3. DOMè¼‰å…¥å¾Œçš„ä¿®å¾©
            document.addEventListener('DOMContentLoaded', () => {
                setTimeout(() => {
                    // ä¿®å¾©AIåŠ©æ‰‹ç›¸é—œéŒ¯èª¤
                    if (window.aiAssistantV27) {
                        const originalUpdate = window.aiAssistantV27.updateStatusIndicators;
                        if (originalUpdate) {
                            window.aiAssistantV27.updateStatusIndicators = function() {
                                try {
                                    const statusElement = document.getElementById('aiAssistantStatus');
                                    if (statusElement) {
                                        return originalUpdate.call(this);
                                    } else {
                                        console.warn('âš ï¸ AIåŠ©æ‰‹ç‹€æ…‹å…ƒç´ ä¸å­˜åœ¨ï¼Œè·³éæ›´æ–°');
                                    }
                                } catch (error) {
                                    console.warn('âš ï¸ AIåŠ©æ‰‹ç‹€æ…‹æ›´æ–°å¤±æ•—:', error.message);
                                }
                            };
                        }
                    }
                    
                    // ä¿®å¾©åˆ†æå„€è¡¨æ¿
                    if (window.analyticsDashboard && !window.analyticsDashboard.updateRealtimeMetrics) {
                        window.analyticsDashboard.updateRealtimeMetrics = function() {
                            console.log('ğŸ“Š åˆ†æå„€è¡¨æ¿ï¼šä½¿ç”¨æ¨¡æ“¬å¯¦æ™‚æ•¸æ“š');
                        };
                    }
                    
                    console.log('âœ… DOMéŒ¯èª¤ä¿®å¾©å®Œæˆ');
                }, 1500);
            });
            
            console.log('âœ… éŒ¯èª¤ä¿®å¾©è£œä¸è¼‰å…¥å®Œæˆ');
        })();
    </script>
    
    <!-- çµ±ä¸€APIç®¡ç†å™¨å„ªå…ˆè¼‰å…¥ -->
    <script src="js/unified-api-manager.js"></script>
    
    <!-- æ•´åˆä¿®å¾©è…³æœ¬ -->
    <script src="js/integration-fix.js"></script>
    
    <!-- èªè­‰ä¿®å¾©ç³»çµ±å„ªå…ˆè¼‰å…¥ -->
    <script src="js/auth-fix.js"></script>
    
    <!-- i18n ç³»çµ±éœ€è¦æœ€å…ˆè¼‰å…¥ -->
    <script src="js/i18n.js"></script>
    <script src="js/prompt-enhancer.js"></script>
    <script src="js/script.js"></script>
    <script src="js/image-gallery.js"></script>
    <script src="js/history-manager.js"></script>
    <script src="js/statistics-manager.js"></script>
            <script src="js/image-processor.js"></script>
        <script src="js/image-editor.js"></script>
        <script src="js/ai-assistant.js"></script>
    <script src="js/user-management.js"></script>
    <script src="js/api-key-manager.js"></script>
    <script src="js/ai-assistant-v27.js"></script>
    <script src="js/advanced-image-processor.js"></script>
    <script src="js/performance-optimizer.js"></script>
    <script src="js/system-integration-tester.js"></script>
    <script src="js/ux-enhancement.js"></script>
    <script src="js/analytics-dashboard.js"></script>
    <script src="js/local-ai-manager.js"></script>
    
    <!-- æ¨™ç±¤è¼‰å…¥ä¿®æ­£è…³æœ¬ -->
    <script>
    /**
     * æ¨™ç±¤è¼‰å…¥å’Œæ¨¡å‹ä¸‹è¼‰ä¿®æ­£
     * è§£æ±ºé‡è¤‡"æ­£åœ¨è™•ç†è«‹æ±‚..."å’Œ"é€²åº¦å®¹å™¨ä¸å­˜åœ¨"å•é¡Œ
     */
    class TabLoadingFix {
        constructor() {
            this.loadingStates = new Map();
            this.init();
        }

        init() {
            console.log('ğŸ”§ æ¨™ç±¤è¼‰å…¥ä¿®æ­£å·²å•Ÿå‹•');
            setTimeout(() => {
                this.fixTabLoading();
                this.fixModelDownload();
                this.preventDuplicateLoading();
            }, 1000);
        }

        // ä¿®æ­£æ¨™ç±¤è¼‰å…¥é‡è¤‡è«‹æ±‚å•é¡Œ
        fixTabLoading() {
            // æ””æˆª AI Assistant v2.7 çš„æ¨™ç±¤åˆ‡æ›
            if (window.aiAssistantV27?.switchTab) {
                const originalSwitchTab = window.aiAssistantV27.switchTab;
                window.aiAssistantV27.switchTab = (tabName) => {
                    if (this.loadingStates.get(`ai-${tabName}`) === 'loading') {
                        console.log(`æ¨™ç±¤ ${tabName} æ­£åœ¨è¼‰å…¥ä¸­ï¼Œè·³éé‡è¤‡è«‹æ±‚`);
                        return;
                    }
                    this.loadingStates.set(`ai-${tabName}`, 'loading');
                    try {
                        originalSwitchTab.call(window.aiAssistantV27, tabName);
                    } finally {
                        setTimeout(() => {
                            this.loadingStates.set(`ai-${tabName}`, 'loaded');
                        }, 1000);
                    }
                };
            }

            // æ””æˆª Local AI Manager çš„æ¨™ç±¤åˆ‡æ›
            if (window.localAIManager?.switchTab) {
                const originalLocalSwitchTab = window.localAIManager.switchTab;
                window.localAIManager.switchTab = (tabName) => {
                    if (this.loadingStates.get(`local-${tabName}`) === 'loading') {
                        console.log(`Local AI æ¨™ç±¤ ${tabName} æ­£åœ¨è¼‰å…¥ä¸­ï¼Œè·³éé‡è¤‡è«‹æ±‚`);
                        return;
                    }
                    this.loadingStates.set(`local-${tabName}`, 'loading');
                    try {
                        originalLocalSwitchTab.call(window.localAIManager, tabName);
                    } finally {
                        setTimeout(() => {
                            this.loadingStates.set(`local-${tabName}`, 'loaded');
                        }, 1000);
                    }
                };
            }
        }

        // ä¿®æ­£æ¨¡å‹ä¸‹è¼‰é€²åº¦å®¹å™¨å•é¡Œ
        fixModelDownload() {
            document.addEventListener('click', (e) => {
                if (e.target.classList.contains('download-model-btn') || 
                    e.target.closest('.download-model-btn')) {
                    
                    const button = e.target.classList.contains('download-model-btn') ? 
                                   e.target : e.target.closest('.download-model-btn');
                    
                    const modelName = button.dataset.model;
                    if (modelName) {
                        this.ensureProgressContainer(modelName);
                    }
                }
            });
        }

        // ç¢ºä¿é€²åº¦å®¹å™¨å­˜åœ¨
        ensureProgressContainer(modelName) {
            let progressContainer = document.getElementById(`progress-${modelName}`);
            
            if (!progressContainer) {
                console.log(`å‰µå»ºç¼ºå¤±çš„é€²åº¦å®¹å™¨: progress-${modelName}`);
                
                const modelCard = document.querySelector(`[data-model="${modelName}"]`);
                if (modelCard) {
                    progressContainer = document.createElement('div');
                    progressContainer.className = 'download-progress';
                    progressContainer.id = `progress-${modelName}`;
                    progressContainer.style.display = 'none';
                    progressContainer.innerHTML = `
                        <div class="progress-bar">
                            <div class="progress-fill"></div>
                        </div>
                        <span class="progress-text">0%</span>
                    `;
                    
                    modelCard.appendChild(progressContainer);
                    console.log(`âœ… å·²å‰µå»ºé€²åº¦å®¹å™¨: progress-${modelName}`);
                } else {
                    console.error(`æ‰¾ä¸åˆ°æ¨¡å‹å¡ç‰‡: ${modelName}`);
                }
            }
            
            return progressContainer;
        }

        // é˜²æ­¢é‡è¤‡è¼‰å…¥æŒ‡ç¤ºå™¨
        preventDuplicateLoading() {
            let activeLoadingIndicators = new Set();

            document.addEventListener('apiRequestStart', (event) => {
                const { url } = event.detail || {};
                if (url && activeLoadingIndicators.has(url)) {
                    event.stopPropagation();
                    return;
                }
                if (url) activeLoadingIndicators.add(url);
            });

            document.addEventListener('apiRequestEnd', (event) => {
                const { url } = event.detail || {};
                if (url) activeLoadingIndicators.delete(url);
            });

            document.addEventListener('apiRequestError', (event) => {
                const { url } = event.detail || {};
                if (url) activeLoadingIndicators.delete(url);
            });
        }
    }

    // ç­‰å¾…é é¢è¼‰å…¥å®Œæˆå¾Œåˆå§‹åŒ–
    document.addEventListener('DOMContentLoaded', () => {
        setTimeout(() => {
            window.tabLoadingFix = new TabLoadingFix();
        }, 2000);
    });

    // æä¾›å…¨å±€ä¿®æ­£å‡½æ•¸
    window.fixTabLoading = () => {
        if (window.tabLoadingFix) {
            window.tabLoadingFix.loadingStates.clear();
            window.tabLoadingFix.fixTabLoading();
            window.tabLoadingFix.fixModelDownload();
            console.log('ğŸ”§ æ‰‹å‹•é‡æ–°æ‡‰ç”¨æ¨™ç±¤è¼‰å…¥ä¿®æ­£');
        }
    };

    console.log('ğŸš€ æ¨™ç±¤è¼‰å…¥ä¿®æ­£è…³æœ¬å·²è¼‰å…¥');
    </script>
    
    <!-- è¼‰å…¥æŒ‡ç¤ºå™¨ä¿®æ­£è…³æœ¬ -->
    <script>
    /**
     * è¼‰å…¥æŒ‡ç¤ºå™¨ä¿®æ­£è…³æœ¬
     * å°ˆé–€è§£æ±ºé‡è¤‡é¡¯ç¤º"æ­£åœ¨è™•ç†è«‹æ±‚..."çš„å•é¡Œ
     */
    class LoadingIndicatorFix {
        constructor() {
            this.activeIndicators = new Set();
            this.maxIndicators = 1; // æœ€å¤šåªå…è¨±1å€‹è¼‰å…¥æŒ‡ç¤ºå™¨
            this.isBlockingRequests = false;
            this.init();
        }

        init() {
            console.log('ğŸ”§ è¼‰å…¥æŒ‡ç¤ºå™¨ä¿®æ­£å·²å•Ÿå‹•');
            setTimeout(() => {
                this.interceptUXEnhancement();
                this.setupTabClickFix();
                this.startPeriodicCleanup();
            }, 1500);
        }

        // æ””æˆªä¸¦ä¿®æ­£ UX Enhancement çš„è¼‰å…¥æŒ‡ç¤ºå™¨
        interceptUXEnhancement() {
            const uxInstance = window.uxEnhancement;
            if (!uxInstance) {
                console.log('âš ï¸ UX Enhancement æœªæ‰¾åˆ°ï¼Œç¨å¾Œé‡è©¦');
                setTimeout(() => this.interceptUXEnhancement(), 1000);
                return;
            }

            console.log('ğŸ”§ ä¿®æ­£ UX Enhancement è¼‰å…¥æŒ‡ç¤ºå™¨');

            // ä¿å­˜åŸå§‹æ–¹æ³•
            const originalShowLoadingIndicator = uxInstance.showLoadingIndicator;
            const originalHideLoadingIndicator = uxInstance.hideLoadingIndicator;

            // é‡å¯« showLoadingIndicator æ–¹æ³•
            uxInstance.showLoadingIndicator = (message = 'è¼‰å…¥ä¸­...') => {
                // æª¢æŸ¥æ˜¯å¦å·²ç¶“æœ‰å¤ªå¤šè¼‰å…¥æŒ‡ç¤ºå™¨
                if (this.activeIndicators.size >= this.maxIndicators) {
                    console.log('ğŸš« å·²é”åˆ°è¼‰å…¥æŒ‡ç¤ºå™¨ä¸Šé™ï¼Œè·³éæ–°çš„æŒ‡ç¤ºå™¨');
                    return Array.from(this.activeIndicators)[0]; // è¿”å›ç¾æœ‰æŒ‡ç¤ºå™¨çš„ ID
                }

                // æª¢æŸ¥æ˜¯å¦æœ‰ç›¸åŒæ¶ˆæ¯çš„æŒ‡ç¤ºå™¨
                const existingIndicators = document.querySelectorAll('.loading-indicator');
                for (const indicator of existingIndicators) {
                    const messageElement = indicator.querySelector('.loading-message');
                    if (messageElement && messageElement.textContent === message) {
                        console.log('ğŸš« è·³éé‡è¤‡çš„è¼‰å…¥æŒ‡ç¤ºå™¨:', message);
                        return indicator.id.replace('loading-', '');
                    }
                }

                // èª¿ç”¨åŸå§‹æ–¹æ³•
                const id = originalShowLoadingIndicator.call(uxInstance, message);
                this.activeIndicators.add(id);
                
                console.log('âœ… é¡¯ç¤ºè¼‰å…¥æŒ‡ç¤ºå™¨:', message, 'ID:', id);
                return id;
            };

            // é‡å¯« hideLoadingIndicator æ–¹æ³•
            uxInstance.hideLoadingIndicator = (id) => {
                if (this.activeIndicators.has(id)) {
                    this.activeIndicators.delete(id);
                    console.log('âœ… éš±è—è¼‰å…¥æŒ‡ç¤ºå™¨ ID:', id);
                }
                
                return originalHideLoadingIndicator.call(uxInstance, id);
            };

            // å®Œå…¨é‡å¯« enhanceProgressFeedback æ–¹æ³•
            uxInstance.enhanceProgressFeedback = () => {
                console.log('ğŸ”§ ä½¿ç”¨ä¿®æ­£çš„é€²åº¦åé¥‹');
                
                // åªç›£è½çœŸæ­£çš„ API è«‹æ±‚ï¼Œä¸¦ä¸”æœ‰ç¯€æµ
                let lastRequestTime = 0;
                const throttleDelay = 1000; // 1ç§’å…§åªè™•ç†ä¸€å€‹è«‹æ±‚
                
                document.addEventListener('apiRequestStart', (event) => {
                    const now = Date.now();
                    if (now - lastRequestTime < throttleDelay) {
                        console.log('ğŸš« è«‹æ±‚å¤ªé »ç¹ï¼Œè·³éè¼‰å…¥æŒ‡ç¤ºå™¨');
                        return;
                    }
                    lastRequestTime = now;
                    
                    if (this.isBlockingRequests) {
                        console.log('ğŸš« è«‹æ±‚è¢«é˜»æ­¢ï¼Œè·³éè¼‰å…¥æŒ‡ç¤ºå™¨');
                        return;
                    }

                    // åªæœ‰åœ¨æ²’æœ‰æ´»å‹•æŒ‡ç¤ºå™¨æ™‚æ‰é¡¯ç¤ºæ–°çš„
                    if (this.activeIndicators.size === 0) {
                        const loadingId = uxInstance.showLoadingIndicator('æ­£åœ¨è™•ç†è«‹æ±‚...');
                        if (loadingId && event.detail) {
                            event.detail.loadingId = loadingId;
                        }
                    } else {
                        console.log('ğŸš« å·²æœ‰æ´»å‹•è¼‰å…¥æŒ‡ç¤ºå™¨ï¼Œè·³éæ–°çš„');
                    }
                });

                document.addEventListener('apiRequestEnd', (event) => {
                    if (event.detail?.loadingId) {
                        uxInstance.hideLoadingIndicator(event.detail.loadingId);
                    }
                    // æ¸…ç†æ‰€æœ‰è¼‰å…¥æŒ‡ç¤ºå™¨ï¼ˆä»¥é˜²è¬ä¸€ï¼‰
                    this.cleanupStaleIndicators();
                });

                document.addEventListener('apiRequestError', (event) => {
                    if (event.detail?.loadingId) {
                        uxInstance.hideLoadingIndicator(event.detail.loadingId);
                    }
                    // æ¸…ç†æ‰€æœ‰è¼‰å…¥æŒ‡ç¤ºå™¨
                    this.cleanupStaleIndicators();
                });
            };
        }

        // ä¿®æ­£æ¨™ç±¤é»æ“Šå¼•èµ·çš„å•é¡Œ
        setupTabClickFix() {
            document.addEventListener('click', (e) => {
                const isTabButton = e.target.classList.contains('tab-button') || 
                                   e.target.closest('.tab-button');
                
                if (isTabButton) {
                    console.log('ğŸ”§ æ¨™ç±¤é»æ“Šä¿®æ­£');
                    
                    // ç«‹å³æ¸…ç†ç¾æœ‰è¼‰å…¥æŒ‡ç¤ºå™¨
                    this.cleanupStaleIndicators();
                    
                    // é˜»æ­¢å¾ŒçºŒè«‹æ±‚ä¸€æ®µæ™‚é–“
                    this.isBlockingRequests = true;
                    
                    // 1.5ç§’å¾Œé‡æ–°å…è¨±è«‹æ±‚
                    setTimeout(() => {
                        this.isBlockingRequests = false;
                    }, 1500);
                }
            });
        }

        // æ¸…ç†éæœŸçš„è¼‰å…¥æŒ‡ç¤ºå™¨
        cleanupStaleIndicators() {
            const indicators = document.querySelectorAll('.loading-indicator');
            indicators.forEach(indicator => {
                indicator.remove();
            });
            this.activeIndicators.clear();
            console.log('ğŸ§¹ å·²æ¸…ç†æ‰€æœ‰è¼‰å…¥æŒ‡ç¤ºå™¨');
        }

        // å®šæœŸæ¸…ç†
        startPeriodicCleanup() {
            setInterval(() => {
                // æª¢æŸ¥æ˜¯å¦æœ‰å­¤ç«‹çš„è¼‰å…¥æŒ‡ç¤ºå™¨
                const indicators = document.querySelectorAll('.loading-indicator');
                if (indicators.length > this.maxIndicators) {
                    console.log('ğŸ§¹ æª¢æ¸¬åˆ°éå¤šè¼‰å…¥æŒ‡ç¤ºå™¨ï¼ŒåŸ·è¡Œæ¸…ç†');
                    this.cleanupStaleIndicators();
                }
            }, 3000); // æ¯3ç§’æª¢æŸ¥ä¸€æ¬¡
        }

        // æ‰‹å‹•æ¸…ç†å‡½æ•¸
        forceCleanup() {
            this.cleanupStaleIndicators();
            this.isBlockingRequests = false;
            console.log('ğŸ”§ å¼·åˆ¶æ¸…ç†å®Œæˆ');
        }
    }

    // ç«‹å³åˆå§‹åŒ–
    window.loadingIndicatorFix = new LoadingIndicatorFix();

    // æä¾›å…¨å±€ä¿®æ­£å‡½æ•¸
    window.fixLoadingIndicators = () => {
        if (window.loadingIndicatorFix) {
            window.loadingIndicatorFix.forceCleanup();
        } else {
            window.loadingIndicatorFix = new LoadingIndicatorFix();
        }
        console.log('ğŸ”§ æ‰‹å‹•ä¿®æ­£è¼‰å…¥æŒ‡ç¤ºå™¨');
    };

    console.log('ğŸš€ è¼‰å…¥æŒ‡ç¤ºå™¨ä¿®æ­£è…³æœ¬å·²è¼‰å…¥');
    </script>
    
    <!-- æ¨™ç±¤åˆ‡æ›ä¿®æ­£è…³æœ¬ -->
    <script>
    /**
     * æ¨™ç±¤åˆ‡æ›ä¿®æ­£è…³æœ¬
     * è§£æ±ºé»æ“Šæ¨™ç±¤å¾Œè·³è½‰åˆ°ç©ºç™½é é¢çš„å•é¡Œ
     */
    class TabSwitchFix {
        constructor() {
            this.init();
        }

        init() {
            console.log('ğŸ”§ æ¨™ç±¤åˆ‡æ›ä¿®æ­£å·²å•Ÿå‹•');
            setTimeout(() => {
                this.fixAIAssistantTabs();
                this.fixLocalAITabs();
                this.preventPageJumps();
            }, 1000);
        }

        // ä¿®æ­£ AI Assistant v2.7 çš„æ¨™ç±¤åˆ‡æ›
        fixAIAssistantTabs() {
            if (!window.aiAssistantV27) {
                setTimeout(() => this.fixAIAssistantTabs(), 1000);
                return;
            }

            const originalSwitchTab = window.aiAssistantV27.switchTab;
            
            window.aiAssistantV27.switchTab = (tabName) => {
                console.log('ğŸ”„ AI Assistant æ¨™ç±¤åˆ‡æ›:', tabName);
                
                try {
                    // ç¢ºä¿æ‰€æœ‰éœ€è¦çš„å…ƒç´ éƒ½å­˜åœ¨
                    const tabButtons = document.querySelectorAll('.ai-assistant-v27 .tab-button');
                    const tabContents = document.querySelectorAll('.ai-assistant-v27 .tab-content');
                    
                    if (tabButtons.length === 0 || tabContents.length === 0) {
                        console.warn('âš ï¸ AI Assistant æ¨™ç±¤å…ƒç´ ä¸å­˜åœ¨');
                        return;
                    }

                    // ç§»é™¤æ‰€æœ‰æ´»å‹•ç‹€æ…‹
                    tabButtons.forEach(btn => btn.classList.remove('active'));
                    tabContents.forEach(content => content.classList.remove('active'));
                    
                    // æ¿€æ´»é¸ä¸­çš„æ¨™ç±¤æŒ‰éˆ•
                    const targetButton = document.querySelector(`.ai-assistant-v27 [data-tab="${tabName}"]`);
                    if (targetButton) {
                        targetButton.classList.add('active');
                    } else {
                        console.warn(`âš ï¸ æ‰¾ä¸åˆ°æ¨™ç±¤æŒ‰éˆ•: ${tabName}`);
                    }
                    
                    // æ¿€æ´»å°æ‡‰çš„å…§å®¹
                    const targetContent = document.getElementById(`${tabName}-tab`);
                    if (targetContent) {
                        targetContent.classList.add('active');
                        console.log(`âœ… å·²æ¿€æ´»æ¨™ç±¤å…§å®¹: ${tabName}-tab`);
                    } else {
                        console.warn(`âš ï¸ æ‰¾ä¸åˆ°æ¨™ç±¤å…§å®¹: ${tabName}-tab`);
                        // å˜—è©¦é‡æ–°å‰µå»ºå…§å®¹
                        this.recreateTabContent(tabName);
                    }
                    
                    // è¼‰å…¥å°æ‡‰æ•¸æ“šï¼ˆä½†ä¸ç­‰å¾…ï¼Œé¿å…é˜»å¡ï¼‰
                    if (window.aiAssistantV27.loadTabData) {
                        setTimeout(() => {
                            window.aiAssistantV27.loadTabData(tabName);
                        }, 100);
                    }
                    
                } catch (error) {
                    console.error('âŒ AI Assistant æ¨™ç±¤åˆ‡æ›å¤±æ•—:', error);
                    // å˜—è©¦ä½¿ç”¨åŸå§‹æ–¹æ³•
                    if (originalSwitchTab) {
                        originalSwitchTab.call(window.aiAssistantV27, tabName);
                    }
                }
            };
        }

        // ä¿®æ­£ Local AI Manager çš„æ¨™ç±¤åˆ‡æ›
        fixLocalAITabs() {
            if (!window.localAIManager) {
                setTimeout(() => this.fixLocalAITabs(), 1000);
                return;
            }

            const originalSwitchTab = window.localAIManager.switchTab;
            
            window.localAIManager.switchTab = (tabName) => {
                console.log('ğŸ”„ Local AI æ¨™ç±¤åˆ‡æ›:', tabName);
                
                try {
                    const tabButtons = document.querySelectorAll('.local-ai-manager .tab-button');
                    const tabContents = document.querySelectorAll('.local-ai-manager .tab-content');
                    
                    if (tabButtons.length === 0 || tabContents.length === 0) {
                        console.warn('âš ï¸ Local AI æ¨™ç±¤å…ƒç´ ä¸å­˜åœ¨');
                        return;
                    }

                    // æ›´æ–°æ¨™ç±¤ç‹€æ…‹
                    tabButtons.forEach(tab => {
                        tab.classList.toggle('active', tab.dataset.tab === tabName);
                    });

                    // æ›´æ–°å…§å®¹é¡¯ç¤º
                    tabContents.forEach(content => {
                        content.classList.toggle('active', content.id === `${tabName}-tab`);
                    });
                    
                    console.log(`âœ… Local AI æ¨™ç±¤åˆ‡æ›å®Œæˆ: ${tabName}`);
                    
                } catch (error) {
                    console.error('âŒ Local AI æ¨™ç±¤åˆ‡æ›å¤±æ•—:', error);
                    if (originalSwitchTab) {
                        originalSwitchTab.call(window.localAIManager, tabName);
                    }
                }
            };
        }

        // é˜²æ­¢é é¢è·³è½‰
        preventPageJumps() {
            document.addEventListener('click', (e) => {
                const tabButton = e.target.closest('.tab-button');
                
                if (tabButton) {
                    e.preventDefault(); // é˜²æ­¢é é¢è·³è½‰
                    e.stopPropagation(); // åœæ­¢äº‹ä»¶å†’æ³¡
                    
                    const tabName = tabButton.dataset.tab;
                    if (tabName) {
                        console.log('ğŸ”§ é˜²æ­¢é é¢è·³è½‰ï¼Œè™•ç†æ¨™ç±¤é»æ“Š:', tabName);
                        
                        // ç¢ºå®šæ˜¯å“ªå€‹çµ„ä»¶çš„æ¨™ç±¤
                        if (tabButton.closest('.ai-assistant-v27')) {
                            if (window.aiAssistantV27?.switchTab) {
                                window.aiAssistantV27.switchTab(tabName);
                            }
                        } else if (tabButton.closest('.local-ai-manager')) {
                            if (window.localAIManager?.switchTab) {
                                window.localAIManager.switchTab(tabName);
                            }
                        }
                    }
                    
                    return false; // ç¢ºä¿ä¸æœƒå°èˆª
                }
            }, true); // ä½¿ç”¨æ•ç²éšæ®µ
        }

        // é‡æ–°å‰µå»ºæ¨™ç±¤å…§å®¹ï¼ˆç•¶å…ƒç´ ä¸å­˜åœ¨æ™‚ï¼‰
        recreateTabContent(tabName) {
            console.log('ğŸ”„ å˜—è©¦é‡æ–°å‰µå»ºæ¨™ç±¤å…§å®¹:', tabName);
            
            if (!window.aiAssistantV27) return;
            
            const contentContainer = document.querySelector('.ai-assistant-v27 .ai-assistant-content');
            if (!contentContainer) return;
            
            let newContent = '';
            
            try {
                switch (tabName) {
                    case 'enhance':
                        newContent = window.aiAssistantV27.createEnhanceTab();
                        break;
                    case 'batch':
                        newContent = window.aiAssistantV27.createBatchTab();
                        break;
                    case 'translate':
                        newContent = window.aiAssistantV27.createTranslateTab();
                        break;
                    case 'style':
                        newContent = window.aiAssistantV27.createStyleTab();
                        break;
                    case 'analytics':
                        newContent = window.aiAssistantV27.createAnalyticsTab();
                        break;
                    case 'history':
                        newContent = window.aiAssistantV27.createHistoryTab();
                        break;
                }
                
                if (newContent) {
                    // ç§»é™¤ç¾æœ‰çš„åŒåå…§å®¹
                    const existingContent = document.getElementById(`${tabName}-tab`);
                    if (existingContent) {
                        existingContent.remove();
                    }
                    
                    // æ·»åŠ æ–°å…§å®¹
                    contentContainer.insertAdjacentHTML('beforeend', newContent);
                    console.log(`âœ… å·²é‡æ–°å‰µå»ºæ¨™ç±¤å…§å®¹: ${tabName}-tab`);
                }
                
            } catch (error) {
                console.error(`âŒ é‡æ–°å‰µå»ºæ¨™ç±¤å…§å®¹å¤±æ•— ${tabName}:`, error);
            }
        }

        // è¨ºæ–·å·¥å…·
        diagnose() {
            const aiAssistant = document.querySelector('.ai-assistant-v27');
            const localAI = document.querySelector('.local-ai-manager');
            
            console.log('ğŸ” æ¨™ç±¤åˆ‡æ›è¨ºæ–·:');
            console.log('AI Assistant å­˜åœ¨:', !!aiAssistant);
            console.log('Local AI å­˜åœ¨:', !!localAI);
            
            if (aiAssistant) {
                const tabButtons = aiAssistant.querySelectorAll('.tab-button');
                const tabContents = aiAssistant.querySelectorAll('.tab-content');
                console.log('AI Assistant æ¨™ç±¤æŒ‰éˆ•æ•¸é‡:', tabButtons.length);
                console.log('AI Assistant æ¨™ç±¤å…§å®¹æ•¸é‡:', tabContents.length);
            }
            
            if (localAI) {
                const tabButtons = localAI.querySelectorAll('.tab-button');
                const tabContents = localAI.querySelectorAll('.tab-content');
                console.log('Local AI æ¨™ç±¤æŒ‰éˆ•æ•¸é‡:', tabButtons.length);
                console.log('Local AI æ¨™ç±¤å…§å®¹æ•¸é‡:', tabContents.length);
            }
        }
    }

    // ç«‹å³åˆå§‹åŒ–
    window.tabSwitchFix = new TabSwitchFix();

    // æä¾›å…¨åŸŸè¨ºæ–·å‡½æ•¸
    window.diagnoseTabSwitching = () => {
        if (window.tabSwitchFix) {
            window.tabSwitchFix.diagnose();
        }
    };

    // ä¿®å¾©å‡½æ•¸
    window.fixTabSwitching = () => {
        window.tabSwitchFix = new TabSwitchFix();
        console.log('ğŸ”§ å·²é‡æ–°åˆå§‹åŒ–æ¨™ç±¤åˆ‡æ›ä¿®æ­£');
    };

    console.log('ğŸš€ æ¨™ç±¤åˆ‡æ›ä¿®æ­£è…³æœ¬å·²è¼‰å…¥');
    </script>
    
    <!-- æ·±è‰²æ¨¡å¼ä¿è­·æ€§ä¿®æ­£ -->
    <style>
    /* æ·±è‰²æ¨¡å¼ä¿è­·æ€§ä¿®æ­£ - ç¢ºä¿æ·±è‰²æ¨¡å¼ä¸å—æ·ºè‰²æ¨¡å¼ä¿®æ­£å½±éŸ¿ */
    [data-theme="dark"] .ai-assistant-v27,
    body[data-theme="dark"] .ai-assistant-v27 {
        background-color: #1a1a1a !important;
        color: white !important;
    }

    [data-theme="dark"] .tab-content,
    [data-theme="dark"] .batch-settings,
    [data-theme="dark"] .batch-section,
    [data-theme="dark"] .enhance-section,
    [data-theme="dark"] .translate-section,
    [data-theme="dark"] .style-section,
    [data-theme="dark"] .analytics-section,
    [data-theme="dark"] .history-section,
    body[data-theme="dark"] .tab-content,
    body[data-theme="dark"] .batch-settings,
    body[data-theme="dark"] .batch-section,
    body[data-theme="dark"] .enhance-section,
    body[data-theme="dark"] .translate-section,
    body[data-theme="dark"] .style-section,
    body[data-theme="dark"] .analytics-section,
    body[data-theme="dark"] .history-section {
        background-color: #2d2d2d !important;
        color: white !important;
    }

    [data-theme="dark"] .settings-grid,
    [data-theme="dark"] .setting-group,
    [data-theme="dark"] .option-group,
    [data-theme="dark"] .options-grid,
    [data-theme="dark"] .input-group,
    [data-theme="dark"] .batch-header,
    [data-theme="dark"] .batch-controls,
    [data-theme="dark"] .batch-prompts-container,
    [data-theme="dark"] .prompts-list,
    [data-theme="dark"] .empty-state,
    body[data-theme="dark"] .settings-grid,
    body[data-theme="dark"] .setting-group,
    body[data-theme="dark"] .option-group,
    body[data-theme="dark"] .options-grid,
    body[data-theme="dark"] .input-group,
    body[data-theme="dark"] .batch-header,
    body[data-theme="dark"] .batch-controls,
    body[data-theme="dark"] .batch-prompts-container,
    body[data-theme="dark"] .prompts-list,
    body[data-theme="dark"] .empty-state {
        background-color: #2d2d2d !important;
        color: white !important;
    }

    [data-theme="dark"] .ai-assistant-v27 input,
    [data-theme="dark"] .ai-assistant-v27 select,
    [data-theme="dark"] .ai-assistant-v27 textarea,
    body[data-theme="dark"] .ai-assistant-v27 input,
    body[data-theme="dark"] .ai-assistant-v27 select,
    body[data-theme="dark"] .ai-assistant-v27 textarea {
        background-color: #374151 !important;
        color: white !important;
        border: 1px solid #4b5563 !important;
    }

    [data-theme="dark"] .ai-assistant-v27 label,
    [data-theme="dark"] .ai-assistant-v27 h4,
    [data-theme="dark"] .ai-assistant-v27 h5,
    [data-theme="dark"] .ai-assistant-v27 p,
    [data-theme="dark"] .ai-assistant-v27 span,
    [data-theme="dark"] .ai-assistant-v27 div,
    body[data-theme="dark"] .ai-assistant-v27 label,
    body[data-theme="dark"] .ai-assistant-v27 h4,
    body[data-theme="dark"] .ai-assistant-v27 h5,
    body[data-theme="dark"] .ai-assistant-v27 p,
    body[data-theme="dark"] .ai-assistant-v27 span,
    body[data-theme="dark"] .ai-assistant-v27 div {
        color: white !important;
    }

    [data-theme="dark"] .ai-assistant-v27 .secondary-button,
    [data-theme="dark"] .ai-assistant-v27 .action-button,
    body[data-theme="dark"] .ai-assistant-v27 .secondary-button,
    body[data-theme="dark"] .ai-assistant-v27 .action-button {
        background-color: #374151 !important;
        color: white !important;
        border: 1px solid #4b5563 !important;
    }

    [data-theme="dark"] .ai-assistant-header h3,
    [data-theme="dark"] .status-indicator,
    body[data-theme="dark"] .ai-assistant-header h3,
    body[data-theme="dark"] .status-indicator {
        color: white !important;
    }
    </style>
    
    <!-- æ¨™ç±¤èƒŒæ™¯è‰²ä¿®æ­£ -->
    <style>
    /* æ·ºè‰²æ¨¡å¼æ¨™ç±¤èƒŒæ™¯ä¿®æ­£ */
    [data-theme="light"] .tab-button.active,
    body:not([data-theme="dark"]) .tab-button.active {
        background-color: #2563eb !important; /* è—è‰²èƒŒæ™¯ */
        color: white !important; /* ç™½è‰²æ–‡å­— */
        border: 1px solid #2563eb !important;
    }

    [data-theme="light"] .tab-button:not(.active),
    body:not([data-theme="dark"]) .tab-button:not(.active) {
        background-color: #f3f4f6 !important; /* æ·ºç°è‰²èƒŒæ™¯ */
        color: black !important; /* é»‘è‰²æ–‡å­— */
        border: 1px solid #d1d5db !important;
    }

    [data-theme="light"] .tab-button:not(.active):hover,
    body:not([data-theme="dark"]) .tab-button:not(.active):hover {
        background-color: #e5e7eb !important;
        color: black !important;
        border: 1px solid #9ca3af !important;
    }

    /* ç‰¹åˆ¥é‡å°å•é¡Œæ¨™ç±¤ */
    [data-theme="light"] .tab-button[data-tab="batch"],
    [data-theme="light"] .tab-button[data-tab="analytics"], 
    [data-theme="light"] .tab-button[data-tab="history"],
    body:not([data-theme="dark"]) .tab-button[data-tab="batch"],
    body:not([data-theme="dark"]) .tab-button[data-tab="analytics"],
    body:not([data-theme="dark"]) .tab-button[data-tab="history"] {
        background-color: #f3f4f6 !important;
        color: black !important;
        border: 1px solid #d1d5db !important;
    }

    [data-theme="light"] .tab-button[data-tab="batch"].active,
    [data-theme="light"] .tab-button[data-tab="analytics"].active, 
    [data-theme="light"] .tab-button[data-tab="history"].active,
    body:not([data-theme="dark"]) .tab-button[data-tab="batch"].active,
    body:not([data-theme="dark"]) .tab-button[data-tab="analytics"].active,
    body:not([data-theme="dark"]) .tab-button[data-tab="history"].active {
        background-color: #2563eb !important;
        color: white !important;
        border: 1px solid #2563eb !important;
    }

    /* æ¨™ç±¤å®¹å™¨èƒŒæ™¯ */
    [data-theme="light"] .ai-assistant-tabs,
    [data-theme="light"] .local-ai-tabs,
    body:not([data-theme="dark"]) .ai-assistant-tabs,
    body:not([data-theme="dark"]) .local-ai-tabs {
        background-color: white !important;
    }

    /* æ¨™ç±¤å…§å®¹å€åŸŸèƒŒæ™¯ */
    [data-theme="light"] .tab-content,
    body:not([data-theme="dark"]) .tab-content {
        background-color: white !important;
        color: black !important;
    }

    /* ä¿®æ­£æ¨™ç±¤å…§å®¹ä¸­çš„å…·é«”å…ƒç´  */
    [data-theme="light"] .batch-settings,
    [data-theme="light"] .batch-section,
    [data-theme="light"] .enhance-section,
    [data-theme="light"] .translate-section,
    [data-theme="light"] .style-section,
    [data-theme="light"] .analytics-section,
    [data-theme="light"] .history-section,
    body:not([data-theme="dark"]) .batch-settings,
    body:not([data-theme="dark"]) .batch-section,
    body:not([data-theme="dark"]) .enhance-section,
    body:not([data-theme="dark"]) .translate-section,
    body:not([data-theme="dark"]) .style-section,
    body:not([data-theme="dark"]) .analytics-section,
    body:not([data-theme="dark"]) .history-section {
        background-color: white !important;
        color: black !important;
    }

    /* ä¿®æ­£è¨­ç½®ç¶²æ ¼å’Œé¸é …çµ„ */
    [data-theme="light"] .settings-grid,
    [data-theme="light"] .setting-group,
    [data-theme="light"] .option-group,
    [data-theme="light"] .options-grid,
    body:not([data-theme="dark"]) .settings-grid,
    body:not([data-theme="dark"]) .setting-group,
    body:not([data-theme="dark"]) .option-group,
    body:not([data-theme="dark"]) .options-grid {
        background-color: white !important;
        color: black !important;
    }

    /* ä¿®æ­£é€²åº¦å’Œçµ±è¨ˆå€åŸŸ */
    [data-theme="light"] .batch-progress,
    [data-theme="light"] .batch-results,
    [data-theme="light"] .batch-stats,
    [data-theme="light"] .progress-header,
    [data-theme="light"] .results-header,
    body:not([data-theme="dark"]) .batch-progress,
    body:not([data-theme="dark"]) .batch-results,
    body:not([data-theme="dark"]) .batch-stats,
    body:not([data-theme="dark"]) .progress-header,
    body:not([data-theme="dark"]) .results-header {
        background-color: white !important;
        color: black !important;
    }

    /* ä¿®æ­£è¡¨å–®å…ƒç´  */
    [data-theme="light"] .tab-content input,
    [data-theme="light"] .tab-content select,
    [data-theme="light"] .tab-content textarea,
    body:not([data-theme="dark"]) .tab-content input,
    body:not([data-theme="dark"]) .tab-content select,
    body:not([data-theme="dark"]) .tab-content textarea {
        background-color: white !important;
        color: black !important;
        border: 1px solid #d1d5db !important;
    }

    /* ä¿®æ­£æ¨™ç±¤æ–‡å­— */
    [data-theme="light"] .tab-content label,
    [data-theme="light"] .tab-content h4,
    [data-theme="light"] .tab-content h5,
    [data-theme="light"] .tab-content p,
    [data-theme="light"] .tab-content span,
    body:not([data-theme="dark"]) .tab-content label,
    body:not([data-theme="dark"]) .tab-content h4,
    body:not([data-theme="dark"]) .tab-content h5,
    body:not([data-theme="dark"]) .tab-content p,
    body:not([data-theme="dark"]) .tab-content span {
        color: black !important;
    }

    /* ä¿®æ­£æŒ‰éˆ• */
    [data-theme="light"] .tab-content .primary-button,
    [data-theme="light"] .tab-content .secondary-button,
    [data-theme="light"] .tab-content .danger-button,
    [data-theme="light"] .tab-content .action-button,
    body:not([data-theme="dark"]) .tab-content .primary-button,
    body:not([data-theme="dark"]) .tab-content .secondary-button,
    body:not([data-theme="dark"]) .tab-content .danger-button,
    body:not([data-theme="dark"]) .tab-content .action-button {
        background-color: #f3f4f6 !important;
        color: black !important;
        border: 1px solid #d1d5db !important;
    }

    /* ä¸»è¦æŒ‰éˆ•ä¿æŒè—è‰² */
    [data-theme="light"] .tab-content .primary-button,
    body:not([data-theme="dark"]) .tab-content .primary-button {
        background-color: #2563eb !important;
        color: white !important;
        border: 1px solid #2563eb !important;
    }

    /* å±éšªæŒ‰éˆ•ä¿æŒç´…è‰² */
    [data-theme="light"] .tab-content .danger-button,
    body:not([data-theme="dark"]) .tab-content .danger-button {
        background-color: #dc2626 !important;
        color: white !important;
        border: 1px solid #dc2626 !important;
    }

    /* ä¿®æ­£æ‰€æœ‰ AI Assistant å…§å®¹å€åŸŸ */
    [data-theme="light"] .ai-assistant-v27 *,
    body:not([data-theme="dark"]) .ai-assistant-v27 * {
        background-color: inherit !important;
        color: inherit !important;
    }

    /* ç¢ºä¿ä¸»å®¹å™¨æ˜¯ç™½è‰²èƒŒæ™¯é»‘è‰²æ–‡å­— */
    [data-theme="light"] .ai-assistant-v27,
    body:not([data-theme="dark"]) .ai-assistant-v27 {
        background-color: white !important;
        color: black !important;
    }
    </style>

    <!-- æ·±è‰²æ¨¡å¼é¡è‰²å„ªåŒ–ä¿®æ­£ -->
    <style>
    /* === æ·±è‰²æ¨¡å¼é¡è‰²ç³»çµ±å„ªåŒ– === */
    
    /* å®šç¾©æ›´å¥½çš„æ·±è‰²æ¨¡å¼é¡è‰²è®Šæ•¸ */
    [data-theme="dark"],
    body[data-theme="dark"] {
        --dark-bg-primary: #0f172a;      /* æ·±è—é»‘ä¸»èƒŒæ™¯ - æ›´å¥½çš„å°æ¯”åº¦ */
        --dark-bg-secondary: #1e293b;    /* æ¬¡è¦èƒŒæ™¯ - æ·±è—ç° */
        --dark-bg-tertiary: #334155;     /* ç¬¬ä¸‰ç´šèƒŒæ™¯ - ä¸­è—ç° */
        --dark-bg-elevated: #475569;     /* æµ®èµ·å…ƒç´  - æ·ºè—ç° */
        --dark-text-primary: #f8fafc;    /* ä¸»è¦æ–‡å­— - è¿‘ç™½è‰² */
        --dark-text-secondary: #e2e8f0;  /* æ¬¡è¦æ–‡å­— - æ·ºç° */
        --dark-text-muted: #cbd5e1;      /* è¼”åŠ©æ–‡å­— - ä¸­ç° */
        --dark-border: #475569;          /* é‚Šæ¡†è‰² */
        --dark-border-light: transparent; /* æ·ºé‚Šæ¡† - è¨­ç‚ºé€æ˜ */
        --dark-accent-blue: #3b82f6;     /* ä¸»è¦è—è‰² */
        --dark-accent-blue-hover: #2563eb; /* è—è‰²æ‡¸åœ */
    }

    /* é‡æ–°å®šç¾© AI æ™ºèƒ½åŠ©æ‰‹ä¸»å®¹å™¨ */
    [data-theme="dark"] .ai-assistant-v27,
    body[data-theme="dark"] .ai-assistant-v27 {
        background-color: var(--dark-bg-primary) !important;
        color: var(--dark-text-primary) !important;
        border: 1px solid var(--dark-border) !important;
        box-shadow: 0 4px 12px rgba(0, 0, 0, 0.3) !important;
    }

    /* æ¨™é¡Œå€åŸŸå„ªåŒ– */
    [data-theme="dark"] .ai-assistant-header,
    body[data-theme="dark"] .ai-assistant-header {
        background: linear-gradient(135deg, var(--dark-bg-secondary) 0%, var(--dark-bg-tertiary) 100%) !important;
        color: var(--dark-text-primary) !important;
        border-bottom: 1px solid var(--dark-border) !important;
    }

    [data-theme="dark"] .ai-assistant-header h3,
    body[data-theme="dark"] .ai-assistant-header h3 {
        color: var(--dark-text-primary) !important;
    }

    /* ç‹€æ…‹æŒ‡ç¤ºå™¨å„ªåŒ– */
    [data-theme="dark"] .status-indicator,
    body[data-theme="dark"] .status-indicator {
        background-color: var(--dark-bg-tertiary) !important;
        color: var(--dark-text-secondary) !important;
        border: 1px solid var(--dark-border-light) !important;
    }

    /* æ¨™ç±¤æŒ‰éˆ•ç³»çµ±å„ªåŒ– */
    [data-theme="dark"] .tab-button:not(.active),
    body[data-theme="dark"] .tab-button:not(.active) {
        background-color: var(--dark-bg-tertiary) !important;
        color: var(--dark-text-secondary) !important;
        border: 1px solid var(--dark-border-light) !important;
    }

    [data-theme="dark"] .tab-button.active,
    body[data-theme="dark"] .tab-button.active {
        background-color: var(--dark-accent-blue) !important;
        color: white !important;
        border: 1px solid var(--dark-accent-blue) !important;
        box-shadow: 0 2px 4px rgba(59, 130, 246, 0.2) !important;
    }

    [data-theme="dark"] .tab-button:not(.active):hover,
    body[data-theme="dark"] .tab-button:not(.active):hover {
        background-color: var(--dark-bg-elevated) !important;
        color: var(--dark-text-primary) !important;
        border: 1px solid var(--dark-border) !important;
    }

    /* é‡æ–°å®šç¾©å…§å®¹å€åŸŸ */
    [data-theme="dark"] .tab-content,
    [data-theme="dark"] .batch-settings,
    [data-theme="dark"] .batch-section,
    [data-theme="dark"] .enhance-section,
    [data-theme="dark"] .translate-section,
    [data-theme="dark"] .style-section,
    [data-theme="dark"] .analytics-section,
    [data-theme="dark"] .history-section,
    body[data-theme="dark"] .tab-content,
    body[data-theme="dark"] .batch-settings,
    body[data-theme="dark"] .batch-section,
    body[data-theme="dark"] .enhance-section,
    body[data-theme="dark"] .translate-section,
    body[data-theme="dark"] .style-section,
    body[data-theme="dark"] .analytics-section,
    body[data-theme="dark"] .history-section {
        background-color: var(--dark-bg-secondary) !important;
        color: var(--dark-text-primary) !important;
    }

    /* è¨­ç½®å€åŸŸå„ªåŒ– */
    [data-theme="dark"] .settings-grid,
    [data-theme="dark"] .setting-group,
    [data-theme="dark"] .option-group,
    [data-theme="dark"] .options-grid,
    [data-theme="dark"] .input-group,
    [data-theme="dark"] .batch-header,
    [data-theme="dark"] .batch-controls,
    [data-theme="dark"] .batch-prompts-container,
    [data-theme="dark"] .prompts-list,
    [data-theme="dark"] .empty-state,
    body[data-theme="dark"] .settings-grid,
    body[data-theme="dark"] .setting-group,
    body[data-theme="dark"] .option-group,
    body[data-theme="dark"] .options-grid,
    body[data-theme="dark"] .input-group,
    body[data-theme="dark"] .batch-header,
    body[data-theme="dark"] .batch-controls,
    body[data-theme="dark"] .batch-prompts-container,
    body[data-theme="dark"] .prompts-list,
    body[data-theme="dark"] .empty-state {
        background-color: var(--dark-bg-tertiary) !important;
        color: var(--dark-text-primary) !important;
        border: 1px solid var(--dark-border-light) !important;
    }

    /* è¡¨å–®å…ƒç´ å„ªåŒ– */
    [data-theme="dark"] .ai-assistant-v27 input,
    [data-theme="dark"] .ai-assistant-v27 select,
    [data-theme="dark"] .ai-assistant-v27 textarea,
    body[data-theme="dark"] .ai-assistant-v27 input,
    body[data-theme="dark"] .ai-assistant-v27 select,
    body[data-theme="dark"] .ai-assistant-v27 textarea {
        background-color: var(--dark-bg-elevated) !important;
        color: var(--dark-text-primary) !important;
        border: 1px solid var(--dark-border) !important;
    }

    /* è¡¨å–®å…ƒç´ èšç„¦æ•ˆæœ */
    [data-theme="dark"] .ai-assistant-v27 input:focus,
    [data-theme="dark"] .ai-assistant-v27 select:focus,
    [data-theme="dark"] .ai-assistant-v27 textarea:focus,
    body[data-theme="dark"] .ai-assistant-v27 input:focus,
    body[data-theme="dark"] .ai-assistant-v27 select:focus,
    body[data-theme="dark"] .ai-assistant-v27 textarea:focus {
        border-color: var(--dark-accent-blue) !important;
        box-shadow: 0 0 0 3px rgba(59, 130, 246, 0.1) !important;
        background-color: var(--dark-bg-primary) !important;
    }

    /* æ–‡å­—å…ƒç´ å„ªåŒ– */
    [data-theme="dark"] .ai-assistant-v27 label,
    [data-theme="dark"] .ai-assistant-v27 h4,
    [data-theme="dark"] .ai-assistant-v27 h5,
    [data-theme="dark"] .ai-assistant-v27 p,
    [data-theme="dark"] .ai-assistant-v27 span,
    [data-theme="dark"] .ai-assistant-v27 div,
    body[data-theme="dark"] .ai-assistant-v27 label,
    body[data-theme="dark"] .ai-assistant-v27 h4,
    body[data-theme="dark"] .ai-assistant-v27 h5,
    body[data-theme="dark"] .ai-assistant-v27 p,
    body[data-theme="dark"] .ai-assistant-v27 span,
    body[data-theme="dark"] .ai-assistant-v27 div {
        color: var(--dark-text-primary) !important;
    }

    /* æ¬¡è¦æ–‡å­— */
    [data-theme="dark"] .ai-assistant-v27 .text-secondary,
    [data-theme="dark"] .ai-assistant-v27 .help-text,
    [data-theme="dark"] .ai-assistant-v27 .meta-info,
    body[data-theme="dark"] .ai-assistant-v27 .text-secondary,
    body[data-theme="dark"] .ai-assistant-v27 .help-text,
    body[data-theme="dark"] .ai-assistant-v27 .meta-info {
        color: var(--dark-text-secondary) !important;
    }

    /* æŒ‰éˆ•ç³»çµ±é‡æ–°å®šç¾© */
    [data-theme="dark"] .ai-assistant-v27 .primary-button,
    body[data-theme="dark"] .ai-assistant-v27 .primary-button {
        background-color: var(--dark-accent-blue) !important;
        color: white !important;
        border: 1px solid var(--dark-accent-blue) !important;
    }

    [data-theme="dark"] .ai-assistant-v27 .primary-button:hover,
    body[data-theme="dark"] .ai-assistant-v27 .primary-button:hover {
        background-color: var(--dark-accent-blue-hover) !important;
        border-color: var(--dark-accent-blue-hover) !important;
    }

    [data-theme="dark"] .ai-assistant-v27 .secondary-button,
    [data-theme="dark"] .ai-assistant-v27 .action-button,
    body[data-theme="dark"] .ai-assistant-v27 .secondary-button,
    body[data-theme="dark"] .ai-assistant-v27 .action-button {
        background-color: var(--dark-bg-elevated) !important;
        color: var(--dark-text-primary) !important;
        border: 1px solid var(--dark-border) !important;
    }

    [data-theme="dark"] .ai-assistant-v27 .secondary-button:hover,
    [data-theme="dark"] .ai-assistant-v27 .action-button:hover,
    body[data-theme="dark"] .ai-assistant-v27 .secondary-button:hover,
    body[data-theme="dark"] .ai-assistant-v27 .action-button:hover {
        background-color: var(--dark-bg-tertiary) !important;
    }

    /* é€²åº¦æ¢å„ªåŒ– */
    [data-theme="dark"] .progress-bar,
    body[data-theme="dark"] .progress-bar {
        background-color: var(--dark-bg-elevated) !important;
        border: 1px solid var(--dark-border-light) !important;
    }

    [data-theme="dark"] .progress-fill,
    body[data-theme="dark"] .progress-fill {
        background: linear-gradient(90deg, var(--dark-accent-blue), var(--dark-accent-blue-hover)) !important;
    }

    /* æ»¾å‹•æ¢ç¾åŒ– */
    [data-theme="dark"] .ai-assistant-v27 ::-webkit-scrollbar,
    body[data-theme="dark"] .ai-assistant-v27 ::-webkit-scrollbar {
        width: 8px;
        height: 8px;
    }

    [data-theme="dark"] .ai-assistant-v27 ::-webkit-scrollbar-track,
    body[data-theme="dark"] .ai-assistant-v27 ::-webkit-scrollbar-track {
        background: var(--dark-bg-secondary);
        border-radius: 4px;
    }

    [data-theme="dark"] .ai-assistant-v27 ::-webkit-scrollbar-thumb,
    body[data-theme="dark"] .ai-assistant-v27 ::-webkit-scrollbar-thumb {
        background: var(--dark-border);
        border-radius: 4px;
    }

    [data-theme="dark"] .ai-assistant-v27 ::-webkit-scrollbar-thumb:hover,
    body[data-theme="dark"] .ai-assistant-v27 ::-webkit-scrollbar-thumb:hover {
        background: var(--dark-bg-elevated);
    }

    /* ä¿®æ­£ä»»ä½•æ®˜é¤˜çš„é¡è‰²å•é¡Œ */
    [data-theme="dark"] .ai-assistant-v27 .tab-content *:not(.primary-button):not(.danger-button):not(.success-button),
    body[data-theme="dark"] .ai-assistant-v27 .tab-content *:not(.primary-button):not(.danger-button):not(.success-button) {
        color: inherit !important;
    }

    /* ç¢ºä¿åœ–æ¨™å’Œç¬¦è™Ÿæ­£ç¢ºé¡¯ç¤º */
    [data-theme="dark"] .ai-assistant-v27 .icon,
    [data-theme="dark"] .ai-assistant-v27 i,
    body[data-theme="dark"] .ai-assistant-v27 .icon,
    body[data-theme="dark"] .ai-assistant-v27 i {
        color: var(--dark-text-secondary) !important;
    }

    [data-theme="dark"] .ai-assistant-v27 .icon.active,
    [data-theme="dark"] .ai-assistant-v27 i.active,
    body[data-theme="dark"] .ai-assistant-v27 .icon.active,
    body[data-theme="dark"] .ai-assistant-v27 i.active {
        color: var(--dark-accent-blue) !important;
    }
    </style>

    <!-- æ·±è‰²æ¨¡å¼é¡è‰²ç³»çµ±å„ªåŒ– -->
    <style>
    /* æ·±è‰²æ¨¡å¼æ”¹é€²çš„é¡è‰²è®Šæ•¸ */
    [data-theme="dark"] {
        --improved-bg-primary: #0f172a;
        --improved-bg-secondary: #1e293b;
        --improved-bg-tertiary: #334155;
        --improved-text-primary: #f8fafc;
        --improved-text-secondary: #e2e8f0;
        --improved-border: #475569;
        --improved-accent: #3b82f6;
    }

    /* æ”¹é€²çš„ AI æ™ºèƒ½åŠ©æ‰‹èƒŒæ™¯ */
    [data-theme="dark"] .ai-assistant-v27,
    body[data-theme="dark"] .ai-assistant-v27 {
        background-color: var(--improved-bg-primary) !important;
        color: var(--improved-text-primary) !important;
        border: 1px solid var(--improved-border) !important;
    }

    /* æ”¹é€²çš„æ¨™ç±¤å…§å®¹èƒŒæ™¯ */
    [data-theme="dark"] .tab-content,
    body[data-theme="dark"] .tab-content {
        background-color: var(--improved-bg-secondary) !important;
        color: var(--improved-text-primary) !important;
    }

    /* æ”¹é€²çš„è¨­ç½®å€åŸŸèƒŒæ™¯ */
    [data-theme="dark"] .settings-grid,
    [data-theme="dark"] .option-group,
    body[data-theme="dark"] .settings-grid,
    body[data-theme="dark"] .option-group {
        background-color: var(--improved-bg-tertiary) !important;
        color: var(--improved-text-primary) !important;
        border: 1px solid var(--improved-border) !important;
    }

    /* æ”¹é€²çš„è¡¨å–®å…ƒç´  */
    [data-theme="dark"] .ai-assistant-v27 input,
    [data-theme="dark"] .ai-assistant-v27 select,
    body[data-theme="dark"] .ai-assistant-v27 input,
    body[data-theme="dark"] .ai-assistant-v27 select {
        background-color: var(--improved-bg-tertiary) !important;
        color: var(--improved-text-primary) !important;
        border: 1px solid var(--improved-border) !important;
    }

    /* æ”¹é€²çš„æŒ‰éˆ• */
    [data-theme="dark"] .ai-assistant-v27 .secondary-button,
    body[data-theme="dark"] .ai-assistant-v27 .secondary-button {
        background-color: var(--improved-bg-tertiary) !important;
        color: var(--improved-text-primary) !important;
        border: 1px solid var(--improved-border) !important;
    }
    </style>

    <!-- é‡å°å…·é«”å…ƒç´ çš„æ·±è‰²æ¨¡å¼ä¿®æ­£ -->
    <style>
    /* === æ‚¨è¦æ±‚çš„å…·é«”ä¿®æ­£ === */
    
    /* generatorTab å€åŸŸ - é»‘è‰²èƒŒæ™¯ç™½è‰²æ–‡å­— */
    [data-theme="dark"] #generatorTab.tab-content,
    body[data-theme="dark"] #generatorTab.tab-content {
        background-color: #000000 !important;
        color: #ffffff !important;
    }

    /* AI æ™ºèƒ½åŠ©æ‰‹ v2.7 æ¨™é¡Œ - ç™½è‰²æ–‡å­— */
    [data-theme="dark"] #generatorTab h3,
    body[data-theme="dark"] #generatorTab h3 {
        color: #ffffff !important;
        background-color: transparent !important;
    }

    /* status-indicators å€åŸŸ - é»‘è‰²èƒŒæ™¯ç™½è‰²æ–‡å­— */
    [data-theme="dark"] .status-indicators,
    body[data-theme="dark"] .status-indicators {
        background-color: #000000 !important;
        color: #ffffff !important;
    }

    /* generatorTab å…§çš„æ‰€æœ‰ç›´æ¥å­å…ƒç´  */
    [data-theme="dark"] #generatorTab > *,
    body[data-theme="dark"] #generatorTab > * {
        background-color: #000000 !important;
        color: #ffffff !important;
    }

    /* generatorTab å…§çš„ main-content å€åŸŸ */
    [data-theme="dark"] #generatorTab .main-content,
    body[data-theme="dark"] #generatorTab .main-content {
        background-color: #000000 !important;
        color: #ffffff !important;
    }

    /* generatorTab å…§çš„ input-section */
    [data-theme="dark"] #generatorTab .input-section,
    body[data-theme="dark"] #generatorTab .input-section {
        background-color: #000000 !important;
        color: #ffffff !important;
    }

    /* generatorTab å…§çš„æ‰€æœ‰æ¨™é¡Œ */
    [data-theme="dark"] #generatorTab h1,
    [data-theme="dark"] #generatorTab h2,
    [data-theme="dark"] #generatorTab h3,
    [data-theme="dark"] #generatorTab h4,
    [data-theme="dark"] #generatorTab h5,
    body[data-theme="dark"] #generatorTab h1,
    body[data-theme="dark"] #generatorTab h2,
    body[data-theme="dark"] #generatorTab h3,
    body[data-theme="dark"] #generatorTab h4,
    body[data-theme="dark"] #generatorTab h5 {
        color: #ffffff !important;
        background-color: transparent !important;
    }

    /* generatorTab å…§çš„æ‰€æœ‰æ®µè½å’Œæ–‡å­— */
    [data-theme="dark"] #generatorTab p,
    [data-theme="dark"] #generatorTab span,
    [data-theme="dark"] #generatorTab div,
    [data-theme="dark"] #generatorTab label,
    body[data-theme="dark"] #generatorTab p,
    body[data-theme="dark"] #generatorTab span,
    body[data-theme="dark"] #generatorTab div,
    body[data-theme="dark"] #generatorTab label {
        color: #ffffff !important;
    }

    /* ç¢ºä¿ generatorTab å…§çš„å®¹å™¨éƒ½æ˜¯é»‘è‰²èƒŒæ™¯ */
    [data-theme="dark"] #generatorTab .container,
    [data-theme="dark"] #generatorTab .prompts-container,
    body[data-theme="dark"] #generatorTab .container,
    body[data-theme="dark"] #generatorTab .prompts-container {
        background-color: #000000 !important;
        color: #ffffff !important;
    }

    /* generatorTab å…§çš„ header å€åŸŸ */
    [data-theme="dark"] #generatorTab header,
    body[data-theme="dark"] #generatorTab header {
        background-color: #000000 !important;
        color: #ffffff !important;
    }

    /* æ‡‰ç”¨åˆ°æ•´å€‹ generatorTab åŠå…¶æ‰€æœ‰å­å…ƒç´  */
    [data-theme="dark"] #generatorTab,
    [data-theme="dark"] #generatorTab *,
    body[data-theme="dark"] #generatorTab,
    body[data-theme="dark"] #generatorTab * {
        background-color: #000000 !important;
        color: #ffffff !important;
    }

    /* ç¢ºä¿æŒ‰éˆ•ä¿æŒæ­£ç¢ºçš„é¡è‰² */
    [data-theme="dark"] #generatorTab .primary-button,
    body[data-theme="dark"] #generatorTab .primary-button {
        background-color: #2563eb !important;
        color: #ffffff !important;
    }

    [data-theme="dark"] #generatorTab .secondary-button,
    body[data-theme="dark"] #generatorTab .secondary-button {
        background-color: #333333 !important;
        color: #ffffff !important;
        border: 1px solid #555555 !important;
    }

    /* === æ‚¨è¦æ±‚çš„å…·é«”ä¿®æ­£ï¼šgeneratorTab é»‘è‰²èƒŒæ™¯ç™½è‰²æ–‡å­— === */
    [data-theme="dark"] #generatorTab {
        background-color: #000000 !important;
        color: #ffffff !important;
    }

    [data-theme="dark"] #generatorTab h3 {
        color: #ffffff !important;
    }

    [data-theme="dark"] .status-indicators {
        background-color: #000000 !important;
        color: #ffffff !important;
    }

    [data-theme="dark"] #generatorTab * {
        background-color: #000000 !important;
        color: #ffffff !important;
    }
    </style>

    <!-- æŒ‰éˆ•é–“è·ä¿®æ­£ -->
    <style>
    /* === æŒ‰éˆ•é–“è·å„ªåŒ– === */
    
    /* é€šç”¨æŒ‰éˆ•é–“è· - æ‰€æœ‰æŒ‰éˆ•ä¹‹é–“åŠ ä¸Šé–“è· */
    .ai-assistant-v27 button {
        margin: 8px 4px !important;  /* ä¸Šä¸‹8pxï¼Œå·¦å³4px */
    }
    
    /* å‹•ä½œæŒ‰éˆ•çµ„é–“è· */
    .action-buttons {
        display: flex !important;
        gap: 12px !important;  /* æŒ‰éˆ•ä¹‹é–“12pxé–“è· */
        flex-wrap: wrap !important;  /* å…è¨±æ›è¡Œ */
        margin: 16px 0 !important;  /* ä¸Šä¸‹16pxå¤–é‚Šè· */
    }
    
    /* é¢¨æ ¼æ¨è–¦æŒ‰éˆ•ç‰¹åˆ¥é–“è· */
    .ai-assistant-v27 .primary-button,
    .ai-assistant-v27 .secondary-button {
        margin: 8px 8px !important;  /* å¢åŠ å·¦å³é–“è· */
        min-width: 120px !important;  /* è¨­å®šæœ€å°å¯¬åº¦ */
    }
    
    /* æ¸…é™¤ç·©å­˜å’Œå°å‡ºæ•¸æ“šæŒ‰éˆ•é–“è· */
    .history-controls button,
    .batch-actions button,
    .analytics-actions button {
        margin: 6px 8px !important;
        padding: 8px 16px !important;  /* å…§éƒ¨å¡«å…… */
    }
    
    /* æŒ‰éˆ•çµ„å®¹å™¨é–“è· */
    .button-group {
        display: flex !important;
        gap: 10px !important;
        margin: 12px 0 !important;
        flex-wrap: wrap !important;
    }
    
    /* è¡¨å–®æŒ‰éˆ•é–“è· */
    .form-actions {
        display: flex !important;
        gap: 15px !important;
        margin-top: 20px !important;
        justify-content: flex-start !important;
    }
    
    /* å·¥å…·åˆ—æŒ‰éˆ•é–“è· */
    .toolbar-buttons {
        display: flex !important;
        gap: 8px !important;
        flex-wrap: wrap !important;
    }
    
    /* ç¢ºä¿æŒ‰éˆ•ä¸æœƒæ“ åœ¨ä¸€èµ· */
    .ai-assistant-v27 .tab-content button {
        margin: 6px 6px !important;
        min-height: 36px !important;  /* æœ€å°é«˜åº¦ */
    }
    
    /* ç‰¹å®šæŒ‰éˆ•çµ„çš„é–“è·ä¿®æ­£ */
    .enhancement-controls,
    .translation-controls,
    .style-controls {
        display: flex !important;
        gap: 12px !important;
        margin: 16px 0 !important;
        flex-wrap: wrap !important;
    }
    
    /* éŸ¿æ‡‰å¼è¨­è¨ˆ - æ‰‹æ©Ÿç‰ˆæ›´å¤§é–“è· */
    @media (max-width: 768px) {
        .ai-assistant-v27 button {
            margin: 10px 6px !important;
            min-width: 100px !important;
        }
        
        .action-buttons {
            gap: 15px !important;
            justify-content: center !important;
        }
        
        .button-group {
            gap: 12px !important;
            justify-content: center !important;
        }
    }

    /* === æŒ‰éˆ•é–“è·ä¿®æ­£ === */
    .ai-assistant-v27 button {
        margin: 8px 6px !important;
        min-width: 100px !important;
    }
    
    .action-buttons {
        display: flex !important;
        gap: 12px !important;
        flex-wrap: wrap !important;
        margin: 16px 0 !important;
    }
    
    .button-group {
        display: flex !important;
        gap: 10px !important;
        margin: 12px 0 !important;
    }
    </style>

    <!-- Local AI ç®¡ç†ä¸­å¿ƒ CSS å¢å¼· - æ¸›å°‘ç·Šæ¹Šæ„Ÿ -->
    <style>
    /* === ğŸ¤– Local AI ç®¡ç†ä¸­å¿ƒ å¢å¼·æ¨£å¼ === */
    
    .local-ai-manager {
        margin: 3rem 0 !important;
        padding: 0 !important;
        border-radius: 20px !important;
        box-shadow: 0 10px 40px rgba(0, 0, 0, 0.12) !important;
        background: var(--bg-color, #ffffff) !important;
        overflow: hidden !important;
        transition: all 0.4s cubic-bezier(0.4, 0, 0.2, 1) !important;
        border: 1px solid rgba(99, 102, 241, 0.1) !important;
    }
    
    .local-ai-manager:hover {
        box-shadow: 0 20px 60px rgba(0, 0, 0, 0.15) !important;
        transform: translateY(-4px) !important;
        border-color: rgba(99, 102, 241, 0.2) !important;
    }
    
    /* æ¨™é¡Œå€åŸŸå¤§å¹…å¢å¼· */
    .local-ai-header {
        padding: 3rem 3rem !important;
        background: linear-gradient(135deg, #667eea 0%, #764ba2 50%, #f093fb 100%) !important;
        border-bottom: none !important;
        position: relative !important;
        overflow: hidden !important;
        min-height: 120px !important;
    }
    
    /* æ·»åŠ å‹•æ…‹èƒŒæ™¯æ•ˆæœ */
    .local-ai-header::before {
        content: '';
        position: absolute;
        top: 0;
        left: 0;
        right: 0;
        bottom: 0;
        background: 
            radial-gradient(circle at 20% 80%, rgba(120, 119, 198, 0.3) 0%, transparent 50%),
            radial-gradient(circle at 80% 20%, rgba(255, 119, 198, 0.3) 0%, transparent 50%);
        pointer-events: none;
        animation: shimmer 8s ease-in-out infinite alternate;
    }
    
    @keyframes shimmer {
        0% { opacity: 0.5; }
        100% { opacity: 1; }
    }
    
    /* æ¨™é¡Œæ¨£å¼å¤§å¹…å¢å¼· */
    .local-ai-header h3 {
        margin: 0 !important;
        font-size: 2.2rem !important;
        font-weight: 800 !important;
        color: white !important;
        display: flex !important;
        align-items: center !important;
        gap: 1rem !important;
        text-shadow: 0 4px 8px rgba(0, 0, 0, 0.3) !important;
        position: relative !important;
        z-index: 2 !important;
        letter-spacing: -0.5px !important;
    }
    
    /* æ·»åŠ é–ƒçˆå‹•ç•«çµ¦æ©Ÿå™¨äººemoji */
    .local-ai-header h3::first-letter {
        display: inline-block;
        animation: robotPulse 2s ease-in-out infinite;
    }
    
    @keyframes robotPulse {
        0%, 100% { transform: scale(1); }
        50% { transform: scale(1.1); }
    }
    
    /* å·¦å´è£é£¾æ¢ */
    .local-ai-header h3::before {
        content: '';
        position: absolute;
        left: -1rem;
        top: 50%;
        transform: translateY(-50%);
        width: 6px;
        height: 120%;
        background: linear-gradient(to bottom, #fbbf24, #f59e0b, #d97706);
        border-radius: 3px;
        box-shadow: 0 0 20px rgba(251, 191, 36, 0.5);
    }
    
    /* ç‹€æ…‹æŒ‡ç¤ºå™¨å¢å¼· */
    .status-indicators {
        display: flex !important;
        gap: 1.5rem !important;
        align-items: center !important;
        position: relative !important;
        z-index: 2 !important;
        flex-wrap: wrap !important;
    }
    
    .status-indicator {
        display: flex !important;
        align-items: center !important;
        gap: 0.75rem !important;
        font-size: 1rem !important;
        font-weight: 600 !important;
        padding: 1rem 1.5rem !important;
        background: rgba(255, 255, 255, 0.2) !important;
        border-radius: 30px !important;
        border: 1px solid rgba(255, 255, 255, 0.3) !important;
        backdrop-filter: blur(20px) !important;
        transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1) !important;
        min-height: 50px !important;
        box-shadow: 0 4px 15px rgba(0, 0, 0, 0.1) !important;
    }
    
    .status-indicator:hover {
        background: rgba(255, 255, 255, 0.25) !important;
        transform: translateY(-2px) scale(1.02) !important;
        box-shadow: 0 8px 25px rgba(0, 0, 0, 0.15) !important;
    }
    
    #initializeLocalAI {
        background: rgba(34, 197, 94, 0.9) !important;
        color: white !important;
        border: 1px solid rgba(34, 197, 94, 0.3) !important;
        padding: 1rem 2rem !important;
        font-weight: 700 !important;
        font-size: 1rem !important;
        transition: all 0.3s ease !important;
    }
    
    #initializeLocalAI:hover {
        background: rgba(34, 197, 94, 1) !important;
        transform: translateY(-2px) scale(1.05) !important;
        box-shadow: 0 10px 30px rgba(34, 197, 94, 0.4) !important;
    }
    
    /* æ¨™ç±¤é å€åŸŸå¢å¼· */
    .local-ai-tabs {
        background: linear-gradient(to right, #f8fafc, #f1f5f9, #e2e8f0) !important;
        border-bottom: 2px solid rgba(99, 102, 241, 0.1) !important;
        padding: 1rem 2rem !important;
        overflow-x: auto !important;
        display: flex !important;
        gap: 0.75rem !important;
        min-height: 80px !important;
        align-items: center !important;
    }
    
    .local-ai-tabs .tab-button {
        flex: none !important;
        min-width: 160px !important;
        padding: 1.25rem 2rem !important;
        border: none !important;
        background: rgba(255, 255, 255, 0.7) !important;
        color: #64748b !important;
        font-size: 1rem !important;
        font-weight: 600 !important;
        cursor: pointer !important;
        transition: all 0.4s cubic-bezier(0.4, 0, 0.2, 1) !important;
        border-radius: 16px !important;
        white-space: nowrap !important;
        position: relative !important;
        overflow: hidden !important;
        box-shadow: 0 2px 8px rgba(0, 0, 0, 0.05) !important;
        border: 1px solid rgba(0, 0, 0, 0.05) !important;
    }
    
    /* æ¨™ç±¤æŒ‰éˆ•æ‡¸åœå‹•ç•« */
    .local-ai-tabs .tab-button::before {
        content: '';
        position: absolute;
        top: 0;
        left: -100%;
        width: 100%;
        height: 100%;
        background: linear-gradient(90deg, transparent, rgba(99, 102, 241, 0.1), transparent);
        transition: left 0.6s ease;
    }
    
    .local-ai-tabs .tab-button:hover::before {
        left: 100%;
    }
    
    .local-ai-tabs .tab-button:hover {
        background: rgba(99, 102, 241, 0.08) !important;
        color: #6366f1 !important;
        transform: translateY(-3px) scale(1.02) !important;
        box-shadow: 0 8px 25px rgba(99, 102, 241, 0.2) !important;
        border-color: rgba(99, 102, 241, 0.2) !important;
    }
    
    .local-ai-tabs .tab-button.active {
        background: linear-gradient(135deg, #6366f1, #8b5cf6) !important;
        color: white !important;
        box-shadow: 0 8px 30px rgba(99, 102, 241, 0.3) !important;
        transform: translateY(-2px) !important;
        border: 1px solid rgba(99, 102, 241, 0.3) !important;
        font-weight: 700 !important;
    }
    
    .local-ai-tabs .tab-button.active::after {
        content: '';
        position: absolute;
        bottom: -2px;
        left: 50%;
        transform: translateX(-50%);
        width: 60%;
        height: 4px;
        background: linear-gradient(to right, #fbbf24, #f59e0b);
        border-radius: 2px;
        box-shadow: 0 2px 8px rgba(251, 191, 36, 0.4);
    }
    
    /* å…§å®¹å€åŸŸå¢å¼· */
    .local-ai-content {
        min-height: 600px !important;
        background: var(--bg-color, #ffffff) !important;
        position: relative !important;
    }
    
    .tab-content {
        display: none !important;
        padding: 3rem !important;
        animation: fadeInUp 0.5s ease-out !important;
        min-height: 500px !important;
    }
    
    .tab-content.active {
        display: block !important;
    }
    
    @keyframes fadeInUp {
        from {
            opacity: 0;
            transform: translateY(20px);
        }
        to {
            opacity: 1;
            transform: translateY(0);
        }
    }
    
    /* æ·±è‰²æ¨¡å¼å¢å¼· */
    [data-theme="dark"] .local-ai-manager {
        background: #0f172a !important;
        border: 1px solid rgba(99, 102, 241, 0.3) !important;
        box-shadow: 0 10px 40px rgba(0, 0, 0, 0.5) !important;
    }
    
    [data-theme="dark"] .local-ai-manager:hover {
        border-color: rgba(99, 102, 241, 0.5) !important;
        box-shadow: 0 20px 60px rgba(0, 0, 0, 0.7) !important;
    }
    
    [data-theme="dark"] .local-ai-header {
        background: linear-gradient(135deg, #1e293b 0%, #0f172a 50%, #1e1b4b 100%) !important;
    }
    
    [data-theme="dark"] .local-ai-header h3 {
        color: #f8fafc !important;
        text-shadow: 0 4px 8px rgba(0, 0, 0, 0.5) !important;
    }
    
    [data-theme="dark"] .local-ai-tabs {
        background: linear-gradient(to right, #1e293b, #334155, #475569) !important;
        border-bottom-color: rgba(99, 102, 241, 0.3) !important;
    }
    
    [data-theme="dark"] .local-ai-tabs .tab-button {
        background: rgba(51, 65, 85, 0.8) !important;
        color: #cbd5e1 !important;
        border-color: rgba(71, 85, 105, 0.5) !important;
    }
    
    [data-theme="dark"] .local-ai-tabs .tab-button:hover {
        background: rgba(99, 102, 241, 0.2) !important;
        color: #a5b4fc !important;
        border-color: rgba(99, 102, 241, 0.4) !important;
    }
    
    [data-theme="dark"] .local-ai-tabs .tab-button.active {
        background: linear-gradient(135deg, #4f46e5, #7c3aed) !important;
        color: #f8fafc !important;
        border-color: rgba(99, 102, 241, 0.5) !important;
    }
    
    [data-theme="dark"] .local-ai-content {
        background: #0f172a !important;
    }
    
    /* éŸ¿æ‡‰å¼è¨­è¨ˆå¤§å¹…å¢å¼· */
    @media (max-width: 768px) {
        .local-ai-manager {
            margin: 2rem 0 !important;
        }
        
        .local-ai-header {
            padding: 2rem 1.5rem !important;
            flex-direction: column !important;
            gap: 1.5rem !important;
            text-align: center !important;
            min-height: 140px !important;
        }
        
        .local-ai-header h3 {
            font-size: 1.8rem !important;
            justify-content: center !important;
        }
        
        .status-indicators {
            flex-wrap: wrap !important;
            justify-content: center !important;
            gap: 1rem !important;
        }
        
        .status-indicator {
            min-width: 140px !important;
            justify-content: center !important;
        }
        
        .local-ai-tabs {
            padding: 0.75rem 1rem !important;
            gap: 0.5rem !important;
            min-height: 70px !important;
        }
        
        .local-ai-tabs .tab-button {
            min-width: 120px !important;
            padding: 1rem 1.25rem !important;
            font-size: 0.9rem !important;
        }
        
        .tab-content {
            padding: 2rem 1.25rem !important;
        }
    }
    
    @media (max-width: 480px) {
        .local-ai-manager {
            margin: 1.5rem 0 !important;
            border-radius: 16px !important;
        }
        
        .local-ai-header {
            padding: 1.5rem 1rem !important;
            min-height: 120px !important;
        }
        
        .local-ai-header h3 {
            font-size: 1.5rem !important;
            gap: 0.75rem !important;
        }
        
        .status-indicator {
            padding: 0.75rem 1rem !important;
            font-size: 0.9rem !important;
            min-width: 120px !important;
        }
        
        .local-ai-tabs .tab-button {
            min-width: 100px !important;
            padding: 0.75rem 1rem !important;
            font-size: 0.85rem !important;
        }
        
        .tab-content {
            padding: 1.5rem 1rem !important;
        }
    }
    
    /* æ·»åŠ ä¸€äº›ç²¾ç¾çš„ç´°ç¯€å‹•ç•« */
    .local-ai-manager * {
        transition: all 0.3s ease !important;
    }
    
    /* è¼‰å…¥æ™‚çš„é€²å…¥å‹•ç•« */
    .local-ai-manager {
        animation: slideInFromBottom 0.6s ease-out;
    }
    
    @keyframes slideInFromBottom {
        from {
            opacity: 0;
            transform: translateY(30px);
        }
        to {
            opacity: 1;
            transform: translateY(0);
        }
    }
    </style>
    <!-- æç¤ºè©å¢å¼·åŠŸèƒ½ CSS å¢å¼· -->
    <style>
    /* === ğŸ¨ æç¤ºè©å¢å¼·åŠŸèƒ½å¢å¼·æ¨£å¼ === */
    
    #enhance-tab {
        background: linear-gradient(135deg, #f8fafc 0%, #f1f5f9 100%) !important;
        min-height: 700px !important;
        padding: 2rem !important;
    }
    
    /* åŸå§‹æç¤ºè©è¼¸å…¥å€åŸŸå¢å¼· */
    .enhance-input {
        background: white !important;
        border-radius: 16px !important;
        padding: 2rem !important;
        margin-bottom: 2rem !important;
        box-shadow: 0 4px 20px rgba(0, 0, 0, 0.08) !important;
        border: 1px solid rgba(99, 102, 241, 0.1) !important;
        transition: all 0.3s ease !important;
    }
    
    .enhance-input:hover {
        box-shadow: 0 8px 30px rgba(0, 0, 0, 0.12) !important;
        border-color: rgba(99, 102, 241, 0.2) !important;
        transform: translateY(-2px) !important;
    }
    
    .enhance-input label {
        font-size: 1.1rem !important;
        font-weight: 700 !important;
        color: #1e293b !important;
        margin-bottom: 1rem !important;
        display: flex !important;
        align-items: center !important;
        gap: 0.5rem !important;
    }
    
    #originalPrompt {
        width: 100% !important;
        min-height: 150px !important;
        padding: 1.5rem !important;
        border: 2px solid #e2e8f0 !important;
        border-radius: 12px !important;
        font-size: 1rem !important;
        line-height: 1.6 !important;
        resize: vertical !important;
        font-family: 'Arial', 'Microsoft YaHei', sans-serif !important;
        transition: all 0.3s ease !important;
        background: #fafbfc !important;
    }
    
    #originalPrompt:focus {
        outline: none !important;
        border-color: #6366f1 !important;
        box-shadow: 0 0 0 3px rgba(99, 102, 241, 0.1) !important;
        background: white !important;
    }
    
    #originalPrompt::placeholder {
        color: #94a3b8 !important;
        font-style: italic !important;
    }
    
    /* å¢å¼·é¸é …å€åŸŸ */
    .enhance-options {
        background: white !important;
        border-radius: 16px !important;
        padding: 2rem !important;
        margin-bottom: 2rem !important;
        box-shadow: 0 4px 20px rgba(0, 0, 0, 0.08) !important;
        border: 1px solid rgba(99, 102, 241, 0.1) !important;
    }
    
    .option-group label {
        font-size: 1rem !important;
        font-weight: 600 !important;
        color: #334155 !important;
        margin-bottom: 0.75rem !important;
        display: flex !important;
        align-items: center !important;
        gap: 0.5rem !important;
    }
    
    #enhanceStyle {
        width: 100% !important;
        padding: 1rem 1.25rem !important;
        border: 2px solid #e2e8f0 !important;
        border-radius: 10px !important;
        font-size: 1rem !important;
        background: #fafbfc !important;
        transition: all 0.3s ease !important;
        cursor: pointer !important;
    }
    
    #enhanceStyle:focus {
        outline: none !important;
        border-color: #8b5cf6 !important;
        box-shadow: 0 0 0 3px rgba(139, 92, 246, 0.1) !important;
        background: white !important;
    }
    
    /* æ§åˆ¶æŒ‰éˆ•å€åŸŸå¤§å¹…å¢å¼· */
    .enhance-controls {
        display: flex !important;
        gap: 1.5rem !important;
        justify-content: center !important;
        margin: 3rem 0 !important;
        flex-wrap: wrap !important;
    }
    
    #enhancePromptLocal {
        background: linear-gradient(135deg, #6366f1, #8b5cf6) !important;
        color: white !important;
        border: none !important;
        padding: 1.25rem 2.5rem !important;
        border-radius: 16px !important;
        font-size: 1.1rem !important;
        font-weight: 700 !important;
        cursor: pointer !important;
        transition: all 0.4s cubic-bezier(0.4, 0, 0.2, 1) !important;
        box-shadow: 0 6px 20px rgba(99, 102, 241, 0.3) !important;
        min-width: 180px !important;
        position: relative !important;
        overflow: hidden !important;
    }
    
    #enhancePromptLocal:hover {
        transform: translateY(-3px) scale(1.05) !important;
        box-shadow: 0 10px 40px rgba(99, 102, 241, 0.4) !important;
    }
    
    #enhancePromptLocal:active {
        transform: translateY(-1px) scale(1.02) !important;
    }
    
    #enhancePromptLocal i {
        margin-right: 0.75rem !important;
        font-size: 1.2rem !important;
        animation: sparkle 2s ease-in-out infinite;
    }
    
    @keyframes sparkle {
        0%, 100% { transform: scale(1) rotate(0deg); }
        50% { transform: scale(1.1) rotate(5deg); }
    }
    
    /* çµæœå±•ç¤ºå€åŸŸå¢å¼· */
    .enhance-results {
        background: white !important;
        border-radius: 20px !important;
        padding: 2.5rem !important;
        margin-top: 2rem !important;
        box-shadow: 0 8px 40px rgba(0, 0, 0, 0.1) !important;
        border: 1px solid rgba(34, 197, 94, 0.2) !important;
        animation: slideInUp 0.5s ease-out !important;
    }
    
    @keyframes slideInUp {
        from {
            opacity: 0;
            transform: translateY(30px);
        }
        to {
            opacity: 1;
            transform: translateY(0);
        }
    }
    
    .result-header {
        display: flex !important;
        justify-content: space-between !important;
        align-items: center !important;
        margin-bottom: 2rem !important;
        padding-bottom: 1rem !important;
        border-bottom: 2px solid #f1f5f9 !important;
    }
    
    .result-header h4 {
        margin: 0 !important;
        font-size: 1.5rem !important;
        font-weight: 700 !important;
        color: #1e293b !important;
        display: flex !important;
        align-items: center !important;
        gap: 0.75rem !important;
    }
    
    /* å¢å¼·å¾Œæç¤ºè©å±•ç¤º */
    #enhancedPrompt {
        background: linear-gradient(135deg, #f0fdf4, #dcfce7) !important;
        border: 2px solid #22c55e !important;
        border-radius: 12px !important;
        padding: 2rem !important;
        font-size: 1.1rem !important;
        line-height: 1.7 !important;
        color: #15803d !important;
        font-weight: 500 !important;
        word-wrap: break-word !important;
        white-space: pre-wrap !important;
        margin-bottom: 1.5rem !important;
        position: relative !important;
    }
    
    #enhancedPrompt::before {
        content: 'âœ¨';
        position: absolute;
        top: -10px;
        right: 15px;
        background: white;
        padding: 5px 10px;
        border-radius: 20px;
        box-shadow: 0 2px 8px rgba(0,0,0,0.1);
        font-size: 1.2rem;
    }
    
    /* æ”¹é€²å»ºè­°å€åŸŸ */
    #enhancementSuggestions {
        background: #fef7ff !important;
        border: 1px solid #e879f9 !important;
        border-radius: 12px !important;
        padding: 1.5rem !important;
        margin-top: 1.5rem !important;
    }
    
    #enhancementSuggestions h5 {
        color: #a855f7 !important;
        font-size: 1.1rem !important;
        font-weight: 600 !important;
        margin-bottom: 1rem !important;
    }
    
    #enhancementSuggestions ul {
        list-style: none !important;
        padding: 0 !important;
        margin: 0 !important;
    }
    
    #enhancementSuggestions li {
        background: white !important;
        border-radius: 8px !important;
        padding: 1rem !important;
        margin-bottom: 0.75rem !important;
        border-left: 4px solid #a855f7 !important;
        box-shadow: 0 2px 8px rgba(168, 85, 247, 0.1) !important;
        transition: all 0.2s ease !important;
    }
    
    #enhancementSuggestions li:hover {
        transform: translateX(5px) !important;
        box-shadow: 0 4px 12px rgba(168, 85, 247, 0.2) !important;
    }
    
    #enhancementSuggestions li::before {
        content: 'ğŸ’¡';
        margin-right: 0.5rem;
        font-size: 1.1rem;
    }
    
    /* æ·±è‰²æ¨¡å¼æ”¯æ´ */
    [data-theme="dark"] #enhance-tab {
        background: linear-gradient(135deg, #0f172a 0%, #1e293b 100%) !important;
    }
    
    [data-theme="dark"] .enhance-input,
    [data-theme="dark"] .enhance-options,
    [data-theme="dark"] .enhance-results {
        background: #1e293b !important;
        border-color: rgba(99, 102, 241, 0.3) !important;
    }
    
    [data-theme="dark"] .enhance-input label,
    [data-theme="dark"] .option-group label,
    [data-theme="dark"] .result-header h4 {
        color: #f8fafc !important;
    }
    
    [data-theme="dark"] #originalPrompt,
    [data-theme="dark"] #enhanceStyle {
        background: #334155 !important;
        border-color: #475569 !important;
        color: #f8fafc !important;
    }
    
    [data-theme="dark"] #enhancedPrompt {
        background: linear-gradient(135deg, #064e3b, #065f46) !important;
        border-color: #10b981 !important;
        color: #6ee7b7 !important;
    }
    
    /* éŸ¿æ‡‰å¼è¨­è¨ˆ */
    @media (max-width: 768px) {
        #enhance-tab {
            padding: 1rem !important;
        }
        
        .enhance-input,
        .enhance-options,
        .enhance-results {
            padding: 1.5rem !important;
            margin-bottom: 1.5rem !important;
        }
        
        #originalPrompt {
            min-height: 120px !important;
            padding: 1rem !important;
        }
        
        .enhance-controls {
            flex-direction: column !important;
            align-items: center !important;
            gap: 1rem !important;
        }
        
        #enhancePromptLocal {
            width: 100% !important;
            max-width: 300px !important;
            padding: 1rem 2rem !important;
        }
    }
    
    /* è¼‰å…¥ç‹€æ…‹å‹•ç•« */
    #enhancePromptLocal:disabled i {
        animation: spin 1s linear infinite !important;
    }
    
    @keyframes spin {
        from { transform: rotate(0deg); }
        to { transform: rotate(360deg); }
    }
    
    /* === é¡å¤–çš„æç¤ºè©å¢å¼·åŠŸèƒ½æ”¹é€² === */
    
    /* å¢åŠ æ–‡å­—è¼¸å…¥æ¡†çš„è¦–è¦ºæ”¹é€² */
    #enhance-tab .enhance-input {
        position: relative !important;
    }
    
    #enhance-tab .enhance-input::before {
        content: '';
        position: absolute;
        top: 0;
        left: 0;
        right: 0;
        height: 4px;
        background: linear-gradient(90deg, #6366f1, #8b5cf6, #ec4899);
        border-radius: 16px 16px 0 0;
    }
    
    /* å¢å¼·é¸é …çš„åœ–æ¨™ç¾åŒ– */
    #enhanceStyle option {
        padding: 8px 12px !important;
        font-weight: 500 !important;
    }
    
    /* æŒ‰éˆ•ç¾¤çµ„çš„é€²ä¸€æ­¥ç¾åŒ– */
    .enhance-controls button:nth-child(1) {
        background: linear-gradient(135deg, #6366f1, #8b5cf6) !important;
    }
    
    .enhance-controls button:nth-child(2) {
        background: linear-gradient(135deg, #059669, #10b981) !important;
        color: white !important;
    }
    
    .enhance-controls button:nth-child(3) {
        background: linear-gradient(135deg, #dc2626, #f59e0b) !important;
        color: white !important;
    }
    
    /* çµæœå€åŸŸçš„æˆåŠŸæç¤º */
    .enhance-results.show {
        animation: successShow 0.8s cubic-bezier(0.34, 1.56, 0.64, 1) !important;
    }
    
    @keyframes successShow {
        0% {
            opacity: 0;
            transform: scale(0.8) translateY(40px);
        }
        60% {
            transform: scale(1.05) translateY(-5px);
        }
        100% {
            opacity: 1;
            transform: scale(1) translateY(0);
        }
    }
    
    /* æ–‡å­—è¨ˆæ•¸å™¨æ¨£å¼ */
    .char-count {
        font-size: 0.85rem !important;
        color: #6b7280 !important;
        font-weight: 500 !important;
    }
    
    /* æç¤ºè©æ¨¡æ¿æŒ‰éˆ• */
    .template-btn {
        background: white !important;
        border: 2px solid #e2e8f0 !important;
        border-radius: 12px !important;
        padding: 1rem !important;
        cursor: pointer !important;
        transition: all 0.3s ease !important;
        display: flex !important;
        flex-direction: column !important;
        align-items: center !important;
        gap: 0.5rem !important;
        min-width: 80px !important;
    }
    
    .template-btn:hover {
        border-color: #6366f1 !important;
        background: #f8fafc !important;
        transform: translateY(-2px) !important;
        box-shadow: 0 4px 12px rgba(99, 102, 241, 0.15) !important;
    }
    
    .template-btn i {
        font-size: 1.5rem !important;
        color: #6366f1 !important;
    }
    
    .template-btn span {
        font-size: 0.85rem !important;
        font-weight: 600 !important;
        color: #374151 !important;
    }
    
    /* è¤‡è£½æŒ‰éˆ•åŠŸèƒ½ */
    .copy-button {
        position: absolute !important;
        top: 10px !important;
        right: 50px !important;
        background: rgba(99, 102, 241, 0.1) !important;
        border: 1px solid rgba(99, 102, 241, 0.3) !important;
        border-radius: 6px !important;
        padding: 6px 12px !important;
        font-size: 0.8rem !important;
        cursor: pointer !important;
        transition: all 0.2s ease !important;
    }
    
    .copy-button:hover {
        background: rgba(99, 102, 241, 0.2) !important;
        transform: scale(1.05) !important;
    }
    
    /* æ–°å¢ï¼šå¿«é€Ÿå‹•ä½œå·¥å…·åˆ— */
    .quick-actions {
        display: flex !important;
        gap: 0.5rem !important;
        margin-bottom: 1rem !important;
        justify-content: flex-end !important;
    }
    
    .action-btn {
        background: #f3f4f6 !important;
        border: 1px solid #d1d5db !important;
        border-radius: 6px !important;
        padding: 6px 10px !important;
        cursor: pointer !important;
        transition: all 0.2s ease !important;
        font-size: 0.8rem !important;
    }
    
    .action-btn:hover {
        background: #e5e7eb !important;
        transform: translateY(-1px) !important;
    }
    
    /* å¢å¼·æ¨£å¼é¸æ“‡çš„è¦–è¦ºæ”¹é€² */
    #enhanceStyle {
        background-image: url("data:image/svg+xml;charset=UTF-8,<svg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 24 24' fill='none' stroke='%236366f1' stroke-width='2'><polyline points='6,9 12,15 18,9'></polyline></svg>") !important;
        background-repeat: no-repeat !important;
        background-position: right 12px center !important;
        background-size: 16px !important;
        appearance: none !important;
        -webkit-appearance: none !important;
        -moz-appearance: none !important;
    }
    
    /* æ·±è‰²æ¨¡å¼çš„æ¨¡æ¿æŒ‰éˆ• */
    [data-theme="dark"] .template-btn {
        background: #334155 !important;
        border-color: #475569 !important;
        color: #e2e8f0 !important;
    }
    
    [data-theme="dark"] .template-btn:hover {
        background: #475569 !important;
        border-color: #6366f1 !important;
    }
    
    [data-theme="dark"] .template-btn span {
        color: #e2e8f0 !important;
    }
    </style>

    <!-- æç¤ºè©å¢å¼·åŠŸèƒ½ JavaScript å¢å¼· -->
    <script>
    // === ğŸ¨ æç¤ºè©å¢å¼·åŠŸèƒ½ JavaScript å¢å¼· ===
    
    document.addEventListener('DOMContentLoaded', function() {
        // å­—ç¬¦è¨ˆæ•¸åŠŸèƒ½
        const originalPrompt = document.getElementById('originalPrompt');
        const charCount = document.getElementById('charCount');
        
        if (originalPrompt && charCount) {
            originalPrompt.addEventListener('input', function() {
                const count = this.value.length;
                charCount.textContent = `${count}/2000`;
                
                // å­—ç¬¦æ•¸é¡è‰²è®ŠåŒ–
                if (count > 1800) {
                    charCount.style.color = '#dc2626';
                } else if (count > 1500) {
                    charCount.style.color = '#f59e0b';
                } else {
                    charCount.style.color = '#6b7280';
                }
            });
        }
        
        // å¿«é€Ÿæ¨¡æ¿åŠŸèƒ½
        const templateButtons = document.querySelectorAll('.template-btn');
        templateButtons.forEach(btn => {
            btn.addEventListener('click', function() {
                const template = this.dataset.template;
                const templates = {
                    photo: "å°ˆæ¥­æ”å½±ä½œå“ï¼Œé«˜è§£æåº¦ï¼Œç´°ç¯€è±å¯Œï¼Œå®Œç¾å…‰å½±ï¼Œæ”å½±å¸«ç´šåˆ¥æ§‹åœ–",
                    art: "ç²¾ç¾è—è¡“ä½œå“ï¼Œç´°è†©ç­†è§¸ï¼Œè±å¯Œè‰²å½©ï¼Œè—è¡“å¤§å¸«é¢¨æ ¼ï¼Œç¾è¡“é¤¨ç´šåˆ¥",
                    anime: "ç²¾ç¾å‹•æ¼«é¢¨æ ¼ï¼Œç´°è†©ç·šæ¢ï¼Œé®®è±”è‰²å½©ï¼Œæ—¥ç³»å‹•ç•«é¢¨æ ¼ï¼Œé«˜å“è³ªæ¸²æŸ“",
                    realistic: "è¶…é€¼çœŸå¯«å¯¦é¢¨æ ¼ï¼ŒçœŸå¯¦è³ªæ„Ÿï¼Œè‡ªç„¶å…‰ç·šï¼ŒçœŸäººæ”å½±å“è³ªï¼Œç´°ç¯€å®Œç¾",
                    fantasy: "å¥‡å¹»é¢¨æ ¼ï¼Œé­”æ³•æ°›åœï¼Œç¥ç§˜è‰²å½©ï¼Œå¹»æƒ³ä¸–ç•Œï¼Œå²è©©ç´šå ´æ™¯",
                    portrait: "å°ˆæ¥­äººåƒæ”å½±ï¼Œå®Œç¾å…‰å½±ï¼Œè‡ªç„¶è¡¨æƒ…ï¼Œé«˜å“è³ªè‚–åƒï¼Œæ”å½±æ£šç´šåˆ¥"
                };
                
                if (originalPrompt && templates[template]) {
                    const currentText = originalPrompt.value.trim();
                    const templateText = templates[template];
                    
                    if (currentText) {
                        originalPrompt.value = `${currentText}, ${templateText}`;
                    } else {
                        originalPrompt.value = templateText;
                    }
                    
                    // è§¸ç™¼å­—ç¬¦è¨ˆæ•¸æ›´æ–°
                    originalPrompt.dispatchEvent(new Event('input'));
                    
                    // è¦–è¦ºåé¥‹
                    this.style.transform = 'scale(0.95)';
                    setTimeout(() => {
                        this.style.transform = 'scale(1)';
                    }, 150);
                }
            });
        });
        
        // æ¸…ç©ºæŒ‰éˆ•åŠŸèƒ½
        const clearPrompt = document.getElementById('clearPrompt');
        if (clearPrompt && originalPrompt) {
            clearPrompt.addEventListener('click', function() {
                if (confirm('ç¢ºå®šè¦æ¸…ç©ºæç¤ºè©å…§å®¹å—ï¼Ÿ')) {
                    originalPrompt.value = '';
                    originalPrompt.dispatchEvent(new Event('input'));
                    originalPrompt.focus();
                }
            });
        }
        
        // è²¼ä¸ŠæŒ‰éˆ•åŠŸèƒ½
        const pastePrompt = document.getElementById('pastePrompt');
        if (pastePrompt && originalPrompt) {
            pastePrompt.addEventListener('click', async function() {
                try {
                    const text = await navigator.clipboard.readText();
                    if (text) {
                        originalPrompt.value = text;
                        originalPrompt.dispatchEvent(new Event('input'));
                        
                        // æˆåŠŸæç¤º
                        this.innerHTML = '<i class="fas fa-check"></i>';
                        setTimeout(() => {
                            this.innerHTML = '<i class="fas fa-paste"></i>';
                        }, 1000);
                    }
                } catch (err) {
                    console.log('ç„¡æ³•è®€å–å‰ªè²¼ç°¿å…§å®¹:', err);
                    alert('ç„¡æ³•è®€å–å‰ªè²¼ç°¿å…§å®¹ï¼Œè«‹æ‰‹å‹•è²¼ä¸Šã€‚');
                }
            });
        }
        
        // è¤‡è£½çµæœåŠŸèƒ½
        const copyResult = document.getElementById('copyResult');
        const enhancedPrompt = document.getElementById('enhancedPrompt');
        
        if (copyResult && enhancedPrompt) {
            copyResult.addEventListener('click', async function() {
                try {
                    const text = enhancedPrompt.textContent;
                    await navigator.clipboard.writeText(text);
                    
                    // æˆåŠŸæç¤º
                    const originalIcon = this.innerHTML;
                    this.innerHTML = '<i class="fas fa-check"></i>';
                    this.style.color = '#22c55e';
                    
                    setTimeout(() => {
                        this.innerHTML = originalIcon;
                        this.style.color = '';
                    }, 2000);
                    
                    // é¡¯ç¤ºé€šçŸ¥
                    showNotification('å¢å¼·çµæœå·²è¤‡è£½åˆ°å‰ªè²¼ç°¿ï¼', 'success');
                    
                } catch (err) {
                    console.error('è¤‡è£½å¤±æ•—:', err);
                    showNotification('è¤‡è£½å¤±æ•—ï¼Œè«‹æ‰‹å‹•é¸æ“‡è¤‡è£½ã€‚', 'error');
                }
            });
        }
        
        // å¢å¼·çµæœé¡¯ç¤ºå‹•ç•«
        const enhanceResults = document.getElementById('enhanceResults');
        if (enhanceResults) {
            // ç›£è½çµæœé¡¯ç¤º
            const observer = new MutationObserver(function(mutations) {
                mutations.forEach(function(mutation) {
                    if (mutation.type === 'attributes' && mutation.attributeName === 'style') {
                        const target = mutation.target;
                        if (target.style.display !== 'none') {
                            target.classList.add('success-animation');
                            setTimeout(() => {
                                target.classList.remove('success-animation');
                            }, 600);
                        }
                    }
                });
            });
            
            observer.observe(enhanceResults, {
                attributes: true,
                attributeFilter: ['style']
            });
        }
        
        // å¿«é€Ÿå¢å¼·æŒ‰éˆ•åŠŸèƒ½
        const quickEnhance = document.getElementById('quickEnhance');
        if (quickEnhance && originalPrompt) {
            quickEnhance.addEventListener('click', function() {
                const currentText = originalPrompt.value.trim();
                if (!currentText) {
                    alert('è«‹å…ˆè¼¸å…¥æç¤ºè©ï¼');
                    originalPrompt.focus();
                    return;
                }
                
                // å¿«é€Ÿå¢å¼·é‚è¼¯ï¼šæ·»åŠ å“è³ªä¿®é£¾è©
                const qualityTerms = [
                    "é«˜å“è³ª", "è¶…æ¸…æ™°", "ç´°ç¯€è±å¯Œ", "å°ˆæ¥­ç´šåˆ¥", 
                    "å®Œç¾æ§‹åœ–", "çµ•ä½³å…‰å½±", "é ‚ç´šå“è³ª", "ç²¾ç¾ç´°ç¯€"
                ];
                
                const randomQuality = qualityTerms[Math.floor(Math.random() * qualityTerms.length)];
                originalPrompt.value = `${currentText}, ${randomQuality}`;
                originalPrompt.dispatchEvent(new Event('input'));
                
                // è¦–è¦ºåé¥‹
                this.style.background = 'linear-gradient(135deg, #22c55e, #16a34a)';
                setTimeout(() => {
                    this.style.background = '';
                }, 1000);
            });
        }
        
        // éš¨æ©Ÿéˆæ„ŸæŒ‰éˆ•åŠŸèƒ½
        const randomEnhance = document.getElementById('randomEnhance');
        if (randomEnhance && originalPrompt) {
            randomEnhance.addEventListener('click', function() {
                const inspirations = [
                    "å¤¢å¹»è‰²å½©ï¼ŒæŸ”å’Œå…‰ç·š",
                    "å²è©©ç´šå ´æ™¯ï¼Œå®å‰æ°£å‹¢",
                    "æ¥µç°¡é¢¨æ ¼ï¼Œç´”æ·¨ç¾æ„Ÿ",
                    "å¾©å¤æ‡·èˆŠï¼Œæº«æš–è‰²èª¿",
                    "æœªä¾†ç§‘å¹»ï¼Œéœ“è™¹å…‰æ•ˆ",
                    "è‡ªç„¶é‡è¶£ï¼Œç”Ÿæ©Ÿç›ç„¶",
                    "æµªæ¼«å”¯ç¾ï¼Œæº«é¦¨æ°›åœ",
                    "ç¥ç§˜é­”å¹»ï¼Œå¥‡å¹»è‰²å½©"
                ];
                
                const randomInspiration = inspirations[Math.floor(Math.random() * inspirations.length)];
                const currentText = originalPrompt.value.trim();
                
                if (currentText) {
                    originalPrompt.value = `${currentText}, ${randomInspiration}`;
                } else {
                    originalPrompt.value = randomInspiration;
                }
                
                originalPrompt.dispatchEvent(new Event('input'));
                
                // è¦–è¦ºåé¥‹
                this.style.transform = 'rotate(180deg)';
                setTimeout(() => {
                    this.style.transform = 'rotate(0deg)';
                }, 500);
            });
        }
        
        // ä¿å­˜çµæœåŠŸèƒ½
        const saveResult = document.getElementById('saveResult');
        if (saveResult && enhancedPrompt) {
            saveResult.addEventListener('click', function() {
                const text = enhancedPrompt.textContent;
                const blob = new Blob([text], { type: 'text/plain' });
                const url = URL.createObjectURL(blob);
                const a = document.createElement('a');
                a.href = url;
                a.download = `enhanced-prompt-${new Date().getTime()}.txt`;
                document.body.appendChild(a);
                a.click();
                document.body.removeChild(a);
                URL.revokeObjectURL(url);
                
                showNotification('å¢å¼·çµæœå·²ä¿å­˜ç‚ºæ–‡ä»¶ï¼', 'success');
            });
        }
        
        // é€šçŸ¥å‡½æ•¸
        function showNotification(message, type = 'info') {
            const notification = document.createElement('div');
            notification.className = `notification notification-${type}`;
            notification.textContent = message;
            notification.style.cssText = `
                position: fixed;
                top: 20px;
                right: 20px;
                background: ${type === 'success' ? '#22c55e' : type === 'error' ? '#dc2626' : '#3b82f6'};
                color: white;
                padding: 12px 20px;
                border-radius: 8px;
                z-index: 10000;
                font-weight: 500;
                box-shadow: 0 4px 12px rgba(0,0,0,0.15);
                animation: slideInRight 0.3s ease-out;
            `;
            
            document.body.appendChild(notification);
            
            setTimeout(() => {
                notification.style.animation = 'slideOutRight 0.3s ease-in';
                setTimeout(() => {
                    document.body.removeChild(notification);
                }, 300);
            }, 3000);
        }
    });
    
    // æ·»åŠ å‹•ç•«æ¨£å¼
    const style = document.createElement('style');
    style.textContent = `
        @keyframes slideInRight {
            from { transform: translateX(100%); opacity: 0; }
            to { transform: translateX(0); opacity: 1; }
        }
        @keyframes slideOutRight {
            from { transform: translateX(0); opacity: 1; }
            to { transform: translateX(100%); opacity: 0; }
        }
    `;
    document.head.appendChild(style);
    </script>
    <!-- é‡ç½®é‚Šæ¡†æ¨£å¼è®Šæ•¸ -->
    <style>
    /* å°‡ --dark-border-light è®Šæ•¸é‡ç½®ç‚ºé€æ˜ */
    [data-theme="dark"],
    body[data-theme="dark"] {
        --dark-border-light: transparent !important;
    }
    </style>
</body>
</html> < s t y l e > / *   ï¿½ï¿½Ë„@b	gO(u  - - d a r k - b o r d e r - l i g h t   ï¿½vï¿½ï¿½Fh  * / [ d a t a - t h e m e = " d a r k " ]   * ,   b o d y [ d a t a - t h e m e = " d a r k " ]   *   {   b o r d e r - c o l o r :   t r a n s p a r e n t   ! i m p o r t a n t ;   } < / s t y l e > 
 
 