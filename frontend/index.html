<!DOCTYPE html>
<html lang="zh-TW">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>批量圖片生成器 - Multi-AI Image Generator</title>
    <!-- 所有舊的 CSS 和 Style 標籤已被移除，將由 Vite 統一管理 -->
</head>
<body>
    <!-- 應用程式的主體 HTML 結構被保留 -->
    <div class="container">
        <header>
            <h1><i class="fas fa-magic"></i> 批量圖片生成器</h1>
            <div class="header-controls">
                <button id="theme-toggle" class="icon-button" title="切換主題"><i class="fas fa-sun"></i></button>
                <button id="api-key-manager-btn" class="icon-button" title="API 金鑰管理"><i class="fas fa-key"></i></button>
            </div>
        </header>

        <main>
            <!-- 主題和語言切換按鈕 -->
            <div class="top-controls">
                <!-- 語言切換器 -->
                <div class="language-toggle" id="languageToggle">
                    <span class="language-icon">🌍</span>
                    <span id="languageText" data-i18n="language.current">繁體中文</span>
                    <div class="language-dropdown" id="languageDropdown">
                        <div class="language-option" data-language="zh-TW" onclick="i18n.changeLanguage('zh-TW')">
                            <span class="language-flag">🇹🇼</span>
                            <span class="language-name" data-i18n="language.zhTW">繁體中文</span>
                        </div>
                        <div class="language-option" data-language="zh-CN" onclick="i18n.changeLanguage('zh-CN')">
                            <span class="language-flag">🇨🇳</span>
                            <span class="language-name" data-i18n="language.zhCN">简体中文</span>
                        </div>
                        <div class="language-option" data-language="en" onclick="i18n.changeLanguage('en')">
                            <span class="language-flag">🇺🇸</span>
                            <span class="language-name" data-i18n="language.en">English</span>
                        </div>
                    </div>
                </div>

                <!-- 主題切換按鈕 -->
                <button class="theme-toggle" onclick="toggleTheme()">
                    <span class="theme-icon" id="themeIcon">🌙</span>
                    <span id="themeText" data-i18n="theme.dark">深色模式</span>
                </button>
            </div>

            <!-- 導航標籤 -->
            <nav class="tab-navigation">
                <button class="tab-btn active" onclick="switchTab('generator')" data-i18n="nav.generator">圖片生成</button>
                <button class="tab-btn" onclick="switchTab('gallery')" data-i18n="nav.gallery">圖片畫廊</button>
                <button class="tab-btn" onclick="switchTab('history')" data-i18n="nav.history">生成歷史</button>
                <button class="tab-btn" onclick="switchTab('statistics')" data-i18n="nav.statistics">統計分析</button>
            </nav>

            <!-- 圖片生成標籤頁 -->
            <div id="generatorTab" class="tab-content active">
                <div class="main-content">
                    <!-- 提示詞輸入區域 -->
                    <div class="input-section">
                        <h2 data-i18n="generator.prompts.label">📝 輸入提示詞</h2>
                        <div class="prompts-container">
                            <textarea id="prompts" data-i18n="generator.prompts.placeholder" rows="10"></textarea>
                            <div class="prompt-count"><span data-i18n="generator.prompt.count">提示詞數量</span>: <span id="promptCount">0</span></div>
                        </div>
                    </div>

                    <!-- AI 智能助手面板 v2.7 -->
                    <div class="ai-assistant-v27" id="aiAssistantV27">
                        <!-- AI Assistant 內容將由 JavaScript 動態生成 -->
                    </div>

                    <!-- 提示詞增強面板 -->
                    <div class="prompt-enhancer-panel" id="promptEnhancerPanel">
                        <div class="enhancer-header" onclick="toggleEnhancerPanel()">
                            <h3 data-i18n="prompt.enhancer.title">🔧 提示詞增強工具</h3>
                            <button class="toggle-enhancer" id="toggleEnhancer" data-i18n="prompt.enhancer.toggle">收起</button>
                        </div>
                        
                        <div class="enhancer-content" id="enhancerContent">
                            <!-- 提示詞分析區域 -->
                            <div class="analysis-section">
                                <h4 data-i18n="prompt.analysis.title">📊 提示詞分析</h4>
                                <div class="analysis-results" id="analysisResults">
                                    <div class="analysis-item">
                                        <span data-i18n="prompt.analysis.length">長度:</span>
                                        <span id="promptLength">0</span>
                                    </div>
                                    <div class="analysis-item">
                                        <span data-i18n="prompt.analysis.complexity">複雜度:</span>
                                        <span id="promptComplexity">-</span>
                                    </div>
                                    <div class="analysis-item">
                                        <span data-i18n="prompt.analysis.quality">品質分數:</span>
                                        <span id="qualityScore">0/100</span>
                                    </div>
                                </div>
                            </div>

                            <!-- 語法檢查結果 -->
                            <div class="syntax-section">
                                <h4 data-i18n="prompt.syntax.title">✅ 語法檢查</h4>
                                <div class="syntax-results" id="syntaxResults">
                                    <div class="syntax-status">等待分析...</div>
                                </div>
                            </div>

                            <!-- AI 優化建議 -->
                            <div class="optimization-section">
                                <h4 data-i18n="prompt.optimization.title">🤖 AI 優化建議</h4>
                                <div class="optimization-controls">
                                    <button class="enhance-btn" onclick="optimizePrompts()" data-i18n="prompt.optimize.btn">優化提示詞</button>
                                    <button class="enhance-btn" onclick="translatePrompts()" data-i18n="prompt.translate.btn">翻譯提示詞</button>
                                </div>
                                <div class="optimization-results" id="optimizationResults"></div>
                            </div>

                            <!-- 負面提示詞 -->
                            <div class="negative-prompts-section">
                                <h4 data-i18n="prompt.negative.title">🚫 負面提示詞</h4>
                                <textarea 
                                    id="negativePrompts" 
                                    placeholder="輸入您想要避免的元素..." 
                                    data-i18n="prompt.negative.placeholder"
                                    rows="3"></textarea>
                                <div class="negative-suggestions">
                                    <strong data-i18n="prompt.negative.suggestions">常用建議:</strong>
                                    <div class="suggestion-tags" id="negativeSuggestions"></div>
                                </div>
                            </div>

                            <!-- 提示詞模板庫 -->
                            <div class="templates-section">
                                <h4 data-i18n="prompt.templates.title">📚 提示詞模板庫</h4>
                                <div class="template-controls">
                                    <select id="templateCategory" data-i18n="prompt.templates.select">
                                        <option value="" data-i18n="prompt.templates.select">選擇分類...</option>
                                        <option value="portrait" data-i18n="template.portrait">人像攝影</option>
                                        <option value="landscape" data-i18n="template.landscape">風景畫面</option>
                                        <option value="abstract" data-i18n="template.abstract">抽象藝術</option>
                                        <option value="fantasy" data-i18n="template.fantasy">奇幻風格</option>
                                        <option value="anime" data-i18n="template.anime">動漫風格</option>
                                        <option value="realistic" data-i18n="template.realistic">寫實風格</option>
                                    </select>
                                    <button class="enhance-btn" onclick="saveAsTemplate()" data-i18n="prompt.templates.save">保存模板</button>
                                </div>
                                <div class="template-suggestions" id="templateSuggestions"></div>
                            </div>

                            <!-- 高級設置 -->
                            <div class="advanced-settings">
                                <h4 data-i18n="prompt.advanced.title">⚙️ 高級設置</h4>
                                <div class="setting-row">
                                    <label>
                                        <input type="checkbox" id="autoOptimize">
                                        <span data-i18n="prompt.auto.optimize">自動優化</span>
                                    </label>
                                </div>
                                <div class="setting-row">
                                    <label data-i18n="prompt.optimization.level">優化程度:</label>
                                    <select id="optimizationLevel">
                                        <option value="light" data-i18n="optimization.light">輕度</option>
                                        <option value="moderate" data-i18n="optimization.moderate" selected>中度</option>
                                        <option value="aggressive" data-i18n="optimization.aggressive">激進</option>
                                    </select>
                                </div>
                                <div class="setting-row">
                                    <label data-i18n="prompt.target.language">目標語言:</label>
                                    <select id="targetLanguage">
                                        <option value="zh-TW">繁體中文</option>
                                        <option value="zh-CN">简体中文</option>
                                        <option value="en" selected>English</option>
                                        <option value="ja" data-i18n="language.ja">日本語</option>
                                        <option value="ko" data-i18n="language.ko">한국어</option>
                                    </select>
                                </div>
                            </div>
                        </div>
                    </div>

                    <!-- 生成設置 -->
                    <div class="settings-section">
                        <h2 data-i18n="generator.settings">⚙️ 生成設置</h2>
                        <div class="settings-grid">
                            <div class="setting-item">
                                <label for="apiProvider" data-i18n="generator.apiProvider">API 提供商:</label>
                                <select id="apiProvider">
                                    <option value="gemini" selected data-i18n="api.gemini">Google Gemini</option>
                                    <option value="openai" data-i18n="api.openai">OpenAI DALL-E</option>
                                    <option value="stability" data-i18n="api.stability">Stability AI</option>
                                    <option value="adobe_firefly" data-i18n="api.adobe_firefly">Adobe Firefly ✨</option>
                                    <option value="leonardo_ai" data-i18n="api.leonardo_ai">Leonardo AI ✨</option>
                                    <option value="custom" data-i18n="api.custom">自定義 API</option>
                                </select>
                            </div>
                            <div class="setting-item">
                                <label for="imageSize" data-i18n="generator.imageSize">圖片尺寸:</label>
                                <select id="imageSize">
                                    <option value="512x512" data-i18n="size.512x512">512 x 512</option>
                                    <option value="1024x1024" selected data-i18n="size.1024x1024">1024 x 1024</option>
                                    <option value="1024x768" data-i18n="size.1024x768">1024 x 768</option>
                                    <option value="768x1024" data-i18n="size.768x1024">768 x 1024</option>
                                </select>
                            </div>
                            <div class="setting-item">
                                <label for="imageCount" data-i18n="generator.imageCount">每個提示詞生成數量:</label>
                                <input type="number" id="imageCount" min="1" max="5" value="1">
                            </div>
                            <div class="setting-item" id="modelSelectionSection">
                                <label for="modelSelect" data-i18n="generator.model">模型選擇:</label>
                                <select id="modelSelect">
                                    <option value="" data-i18n="model.default">預設模型</option>
                                </select>
                            </div>
                        </div>
                        
                        <!-- API 金鑰設置 -->
                        <div id="apiKeySettings" class="api-key-section">
                            <h3>🔑 API 金鑰設置</h3>
                            <div class="settings-grid">
                                <div class="setting-item" id="geminiKeySection">
                                    <label for="geminiApiKey">Gemini API 金鑰:</label>
                                    <input type="password" id="geminiApiKey" placeholder="您的 Gemini API 金鑰">
                                </div>
                                <div class="setting-item" id="openaiKeySection" style="display: none;">
                                    <label for="openaiApiKey">OpenAI API 金鑰:</label>
                                    <input type="password" id="openaiApiKey" placeholder="您的 OpenAI API 金鑰">
                                </div>
                                <div class="setting-item" id="stabilityKeySection" style="display: none;">
                                    <label for="stabilityApiKey">Stability AI API 金鑰:</label>
                                    <input type="password" id="stabilityApiKey" placeholder="您的 Stability AI API 金鑰">
                                </div>
                                <div class="setting-item" id="adobeFireflyKeySection" style="display: none;">
                                    <label for="adobeFireflyApiKey">Adobe Firefly API 金鑰:</label>
                                    <input type="password" id="adobeFireflyApiKey" placeholder="您的 Adobe Firefly API 金鑰">
                                </div>
                                <div class="setting-item" id="leonardoAiKeySection" style="display: none;">
                                    <label for="leonardoAiApiKey">Leonardo AI API 金鑰:</label>
                                    <input type="password" id="leonardoAiApiKey" placeholder="您的 Leonardo AI API 金鑰">
                                </div>
                            </div>
                        </div>
                        
                        <!-- 自定義 API 設置 -->
                        <div id="customApiSettings" class="custom-api-section" style="display: none;">
                            <h3 data-i18n="api.custom.settings">🔧 自定義 API 設置</h3>
                            <div class="settings-grid">
                                <div class="setting-item">
                                    <label for="customApiUrl" data-i18n="api.custom.url">API 端點 URL:</label>
                                    <input type="url" id="customApiUrl" data-i18n="api.custom.url.placeholder" placeholder="https://api.example.com/generate">
                                </div>
                                <div class="setting-item">
                                    <label for="customApiKey" data-i18n="api.custom.key">API 金鑰:</label>
                                    <input type="password" id="customApiKey" data-i18n="api.custom.key.placeholder" placeholder="您的 API 金鑰">
                                </div>
                                <div class="setting-item">
                                    <label for="customModel" data-i18n="api.custom.model">模型名稱:</label>
                                    <input type="text" id="customModel" data-i18n="api.custom.model.placeholder" placeholder="模型名稱 (可選)">
                                </div>
                                <div class="setting-item">
                                    <label for="requestFormat" data-i18n="api.custom.format">請求格式:</label>
                                    <select id="requestFormat">
                                        <option value="json">JSON</option>
                                        <option value="form">Form Data</option>
                                    </select>
                                </div>
                            </div>
                            <div class="setting-item">
                                <label for="customHeaders" data-i18n="api.custom.headers">自定義請求頭 (JSON 格式):</label>
                                <textarea id="customHeaders" rows="3" data-i18n="api.custom.headers.placeholder" placeholder='{"Content-Type": "application/json", "Authorization": "Bearer YOUR_TOKEN"}'></textarea>
                            </div>
                            <div class="setting-item">
                                <label for="requestTemplate" data-i18n="api.custom.template">請求模板 (JSON 格式):</label>
                                <textarea id="requestTemplate" rows="5" data-i18n="api.custom.template.placeholder" placeholder='{"prompt": "{PROMPT}", "size": "{SIZE}", "n": {COUNT}}'></textarea>
                            </div>
                        </div>
                    </div>

                    <!-- 控制按鈕 -->
                    <div class="controls-section">
                        <button id="generateBtn" class="generate-btn">
                            <span class="btn-text" data-i18n="generator.generate">🚀 開始生成</span>
                            <span class="loading-spinner" style="display: none;" data-i18n="generator.generating">⏳ 生成中...</span>
                        </button>
                        <button id="clearBtn" class="clear-btn" data-i18n="generator.clear">🗑️ 清除全部</button>
                    </div>

                    <!-- 進度顯示 -->
                    <div class="progress-section" style="display: none;">
                        <h3 data-i18n="progress.title">📊 生成進度</h3>
                        <div class="progress-bar">
                            <div class="progress-fill" id="progressFill"></div>
                        </div>
                        <div class="progress-text">
                            <span id="progressText" data-i18n="progress.preparing">準備中...</span>
                        </div>
                    </div>

                    <!-- 結果展示 -->
                    <div class="results-section">
                        <h2 data-i18n="results.title">🖼️ 生成結果</h2>
                        <div id="resultsContainer" class="results-grid">
                            <!-- 圖片結果會動態插入這裡 -->
                        </div>
                    </div>
                </div>
            </div>

            <!-- 圖片畫廊標籤頁 -->
            <div id="galleryTab" class="tab-content">
                <div class="gallery-header">
                    <h2 data-i18n="gallery.title">🖼️ 圖片畫廊</h2>
                    <div class="gallery-stats" id="galleryStats" data-i18n="msg.loading">
                        載入中...
                    </div>
                </div>

                <!-- 搜尋和篩選 -->
                <div class="gallery-filters">
                    <div class="filter-group">
                        <label for="gallerySearch" data-i18n="gallery.search">🔍 搜尋提示詞:</label>
                        <input type="text" id="gallerySearch" data-i18n="gallery.search.placeholder" placeholder="輸入關鍵字搜尋...">
                    </div>
                    
                    <div class="filter-group">
                        <label for="providerFilter" data-i18n="gallery.filter.provider">API 提供商:</label>
                        <select id="providerFilter">
                            <option value="" data-i18n="filter.all">全部</option>
                            <option value="gemini" data-i18n="api.gemini">Google Gemini</option>
                            <option value="openai" data-i18n="api.openai">OpenAI DALL-E</option>
                            <option value="stability" data-i18n="api.stability">Stability AI</option>
                            <option value="adobe_firefly" data-i18n="api.adobe_firefly">Adobe Firefly ✨</option>
                            <option value="leonardo_ai" data-i18n="api.leonardo_ai">Leonardo AI ✨</option>
                            <option value="custom" data-i18n="api.custom">自定義 API</option>
                        </select>
                    </div>
                    
                    <div class="filter-group">
                        <label for="favoriteFilter" data-i18n="gallery.filter.favorite">收藏狀態:</label>
                        <select id="favoriteFilter">
                            <option value="" data-i18n="filter.all">全部</option>
                            <option value="true" data-i18n="filter.favorited">已收藏</option>
                            <option value="false" data-i18n="filter.not.favorited">未收藏</option>
                        </select>
                    </div>
                    
                    <div class="filter-group">
                        <label for="sortBy" data-i18n="gallery.filter.sort">排序方式:</label>
                        <select id="sortBy">
                            <option value="created_at" data-i18n="sort.date">創建時間</option>
                            <option value="rating" data-i18n="sort.rating">評分</option>
                            <option value="filename" data-i18n="sort.filename">文件名</option>
                            <option value="api_provider" data-i18n="sort.provider">API 提供商</option>
                        </select>
                    </div>
                </div>

                <!-- 批量操作 -->
                <div class="batch-actions" id="batchActions" style="display: none;">
                    <div class="batch-info">
                        <span data-i18n="gallery.batch.select">已選擇</span> <span id="selectedCount">0</span> <span data-i18n="gallery.images">張圖片</span>
                    </div>
                    <div class="batch-buttons">
                        <button id="selectAllImages" class="btn-secondary" data-i18n="btn.select.all">全選/取消全選</button>
                        <button id="downloadSelected" class="btn-primary" data-i18n="gallery.batch.download">批量下載</button>
                        <button id="deleteSelected" class="btn-danger" data-i18n="gallery.batch.delete">批量刪除</button>
                    </div>
                </div>

                <!-- 圖片網格 -->
                <div class="gallery-container">
                    <div id="imageGalleryContainer" class="image-grid">
                        <!-- 圖片會動態載入到這裡 -->
                    </div>
                </div>

                <!-- 分頁導航 -->
                <div id="galleryPagination" class="pagination-container">
                    <!-- 分頁控制會動態載入到這裡 -->
                </div>
            </div>

            <!-- 生成歷史標籤頁 -->
            <div id="historyTab" class="tab-content">
                <div class="history-header">
                    <h2 data-i18n="history.title">📜 生成歷史</h2>
                    <div class="history-actions">
                        <button id="exportHistory" class="btn-secondary" data-i18n="history.export">匯出歷史</button>
                        <button id="refreshHistory" class="btn-primary" data-i18n="history.refresh">重新整理</button>
                    </div>
                </div>

                <!-- 歷史記錄列表 -->
                <div class="history-container">
                    <div id="historyList" class="history-list">
                        <!-- 歷史記錄會動態載入到這裡 -->
                    </div>
                </div>

                <!-- 歷史分頁 -->
                <div id="historyPagination" class="pagination-container">
                    <!-- 分頁控制會動態載入到這裡 -->
                </div>
            </div>

            <!-- 統計分析標籤頁 -->
            <div id="statisticsTab" class="tab-content">
                <div class="statistics-header">
                    <h2 data-i18n="stats.title">📊 統計分析</h2>
                    <div class="stats-refresh">
                        <button id="refreshStats" class="btn-primary" data-i18n="stats.refresh">重新整理</button>
                    </div>
                </div>

                <div class="statistics-container">
                    <!-- 基本統計 -->
                    <div class="stats-section">
                        <h3 data-i18n="stats.overview">📈 基本統計</h3>
                        <div id="basicStats" class="stats-grid">
                            <!-- 基本統計會動態載入到這裡 -->
                        </div>
                    </div>

                    <!-- 按提供商統計 -->
                    <div class="stats-section">
                        <h3 data-i18n="stats.provider.usage">🔧 按 API 提供商統計</h3>
                        <div id="providerStats" class="provider-stats">
                            <!-- 提供商統計會動態載入到這裡 -->
                        </div>
                    </div>

                    <!-- 最近7天統計 -->
                    <div class="stats-section">
                        <h3 data-i18n="stats.daily.activity">📅 最近7天生成統計</h3>
                        <div id="dailyStats" class="daily-stats">
                            <!-- 每日統計會動態載入到這裡 -->
                        </div>
                    </div>

                    <!-- 成功率統計 -->
                    <div class="stats-section">
                        <h3 data-i18n="stats.success.analysis">✅ 成功率分析</h3>
                        <div id="successStats" class="success-stats">
                            <!-- 成功率統計會動態載入到這裡 -->
                        </div>
                    </div>
                </div>
            </div>
        </main>
    </div>
    
    <!-- 舊的腳本已被移除 -->
    <!-- Vite 會在此處注入所有必要的 JavaScript -->
    <script type="module" src="/src/main.js"></script>
</body>
</html>

</rewritten_file>

</rewritten_file>

</rewritten_file>

</rewritten_file>

</rewritten_file>

</rewritten_file>

</rewritten_file>

</rewritten_file>

</rewritten_file>

</rewritten_file>

</rewritten_file>

</rewritten_file>

</rewritten_file>

</rewritten_file>

</rewritten_file>

</rewritten_file>

</rewritten_file>

</rewritten_file>

</rewritten_file>

</rewritten_file>

</rewritten_file>

</rewritten_file>

</rewritten_file>

</rewritten_file>

</rewritten_file>

</rewritten_file>

</rewritten_file>

</rewritten_file>

</rewritten_file>

</rewritten_file>

</rewritten_file>

</rewritten_file>

</rewritten_file>

</rewritten_file>

</rewritten_file>

</rewritten_file>

</rewritten_file>

</rewritten_file>

</rewritten_file>

</rewritten_file>

</rewritten_file>

</rewritten_file>

</rewritten_file>

</rewritten_file>

</rewritten_file>

</rewritten_file>

</rewritten_file>

</rewritten_file>

</rewritten_file>

</rewritten_file>

</rewritten_file>

</rewritten_file>

</rewritten_file>

</rewritten_file>

</rewritten_file>

</rewritten_file>

</rewritten_file>

</rewritten_file>

</rewritten_file>

</rewritten_file>

</rewritten_file>

</rewritten_file>

</rewritten_file>

</rewritten_file>

</rewritten_file>

</rewritten_file>

</rewritten_file>

</rewritten_file>

</rewritten_file>

</rewritten_file>

</rewritten_file>

</rewritten_file>

</rewritten_file>

</rewritten_file>

</rewritten_file>

</rewritten_file>

</rewritten_file>

</rewritten_file>

</rewritten_file>

</rewritten_file>

</rewritten_file>

</rewritten_file>

</rewritten_file>

</rewritten_file>

</rewritten_file>

</rewritten_file>

</rewritten_file>

</rewritten_file>

</rewritten_file>

</rewritten_file>

</rewritten_file>

</rewritten_file>

</rewritten_file>

</rewritten_file>

</rewritten_file>

</rewritten_file>

</rewritten_file>

</rewritten_file>

</rewritten_file>

</rewritten_file>

</rewritten_file>

</rewritten_file>

</rewritten_file>

</rewritten_file>

</rewritten_file>

</rewritten_file>

</rewritten_file>

</rewritten_file>

</rewritten_file>

</rewritten_file>

</rewritten_file>

</rewritten_file>

</rewritten_file>

</rewritten_file>

</rewritten_file>

</rewritten_file>

</rewritten_file>

</rewritten_file>

</rewritten_file>

</rewritten_file>

</rewritten_file>

</rewritten_file>

</rewritten_file>

</rewritten_file>

</rewritten_file>

</rewritten_file>

</rewritten_file>

</rewritten_file>

</rewritten_file>

</rewritten_file>

</rewritten_file>

</rewritten_file>

</rewritten_file>

</rewritten_file>

</rewritten_file>

</rewritten_file>

</rewritten_file>

</rewritten_file>

</rewritten_file>

</rewritten_file>

</rewritten_file>

</rewritten_file>

</rewritten_file>

</rewritten_file>

</rewritten_file>

</rewritten_file>

</rewritten_file>

</rewritten_file>

</rewritten_file>

</rewritten_file>

</rewritten_file>

</rewritten_file>

</rewritten_file>

</rewritten_file>

</rewritten_file>

</rewritten_file>

</rewritten_file>

</rewritten_file>

</rewritten_file>

</rewritten_file>

</rewritten_file>

</rewritten_file>

</rewritten_file>

</rewritten_file>

</rewritten_file>

</rewritten_file>

</rewritten_file>

</rewritten_file>

</rewritten_file>

</rewritten_file>

</rewritten_file>

</rewritten_file>

</rewritten_file>

</rewritten_file>

</rewritten_file>

</rewritten_file>

</rewritten_file>

</rewritten_file>

</rewritten_file>

</rewritten_file>

</rewritten_file>

</rewritten_file>

</rewritten_file>

</rewritten_file>

</rewritten_file>

</rewritten_file>

</rewritten_file>

</rewritten_file>

</rewritten_file>

</rewritten_file>

</rewritten_file>

</rewritten_file>

</rewritten_file>

</rewritten_file>

</rewritten_file>

</rewritten_file>

</rewritten_file>

</rewritten_file>

</rewritten_file>

</rewritten_file>

</rewritten_file>

</rewritten_file>

</rewritten_file>

</rewritten_file>

</rewritten_file>

</rewritten_file>

</rewritten_file>

</rewritten_file>

</rewritten_file>

</rewritten_file>

</rewritten_file>

</rewritten_file>

</rewritten_file>

</rewritten_file>

</rewritten_file>

</rewritten_file>

</rewritten_file>

</rewritten_file>

</rewritten_file>

</rewritten_file>

</rewritten_file>

</rewritten_file>

</rewritten_file>

</rewritten_file>

</rewritten_file>

</rewritten_file>

</rewritten_file>

</rewritten_file>

</rewritten_file>

</rewritten_file>

</rewritten_file>

</rewritten_file>

</rewritten_file>

</rewritten_file>

</rewritten_file>

</rewritten_file>

</rewritten_file>

</rewritten_file>

</rewritten_file>

</rewritten_file>

</rewritten_file>

</rewritten_file>

</rewritten_file>

</rewritten_file>

</rewritten_file>

</rewritten_file>

</rewritten_file>

</rewritten_file>

</rewritten_file>

</rewritten_file>

</rewritten_file>

</rewritten_file>

</rewritten_file>

</rewritten_file>

</rewritten_file>

</rewritten_file>

</rewritten_file>

</rewritten_file>

</rewritten_file>

</rewritten_file>

</rewritten_file>

</rewritten_file>

</rewritten_file>

</rewritten_file>

</rewritten_file>

</rewritten_file>

</rewritten_file>

</rewritten_file>

</rewritten_file>

</rewritten_file>

</rewritten_file>

</rewritten_file>

</rewritten_file>

</rewritten_file>

</rewritten_file>

</rewritten_file>

</rewritten_file>

</rewritten_file>

</rewritten_file>

</rewritten_file>

</rewritten_file>

</rewritten_file>

</rewritten_file>

</rewritten_file>

</rewritten_file>

</rewritten_file>

</rewritten_file>

</rewritten_file>

</rewritten_file>

</rewritten_file>

</rewritten_file>

</rewritten_file>

</rewritten_file>

</rewritten_file>

</rewritten_file>

</rewritten_file>

</rewritten_file>

</rewritten_file>

</rewritten_file>

</rewritten_file>

</rewritten_file>

</rewritten_file>

</rewritten_file>

</rewritten_file>

</rewritten_file>

</rewritten_file>

</rewritten_file>

</rewritten_file>

</rewritten_file>

</rewritten_file>

</rewritten_file>

</rewritten_file>

</rewritten_file>

</rewritten_file>

</rewritten_file>

</rewritten_file>

</rewritten_file>

</rewritten_file>

</rewritten_file>

</rewritten_file>

</rewritten_file>

</rewritten_file>

</rewritten_file>

</rewritten_file>

</rewritten_file>

</rewritten_file>

</rewritten_file>

</rewritten_file>

</rewritten_file>

</rewritten_file>

</rewritten_file>

</rewritten_file>

</rewritten_file>

</rewritten_file>

</rewritten_file>

</rewritten_file>

</rewritten_file>

</rewritten_file>

</rewritten_file>

</rewritten_file>

</rewritten_file>

</rewritten_file>

</rewritten_file>

</rewritten_file>

</rewritten_file>

</rewritten_file>

</rewritten_file>

</rewritten_file>

</rewritten_file>

</rewritten_file>

</rewritten_file>

</rewritten_file>

</rewritten_file>

</rewritten_file>

</rewritten_file>

</rewritten_file>

</rewritten_file>

</rewritten_file>

</rewritten_file>

</rewritten_file>

</rewritten_file>

</rewritten_file>

</rewritten_file>

</rewritten_file>

</rewritten_file>

</rewritten_file>

</rewritten_file>

</rewritten_file>

</rewritten_file>

</rewritten_file>

</rewritten_file>

</rewritten_file>

</rewritten_file>

</rewritten_file>

</rewritten_file>

</rewritten_file>

</rewritten_file>

</rewritten_file>

</rewritten_file>

</rewritten_file>

</rewritten_file>

</rewritten_file>

</rewritten_file>

</rewritten_file>

</rewritten_file>

</rewritten_file>

</rewritten_file>

</rewritten_file>

</rewritten_file>

</rewritten_file>

</rewritten_file>

</rewritten_file>

</rewritten_file>

</rewritten_file>

</rewritten_file>

</rewritten_file>

</rewritten_file>

</rewritten_file>

</rewritten_file>

</rewritten_file>

</rewritten_file>

</rewritten_file>

</rewritten_file>

</rewritten_file>

</rewritten_file>

</rewritten_file>

</rewritten_file>

</rewritten_file>

</rewritten_file>

</rewritten_file>

</rewritten_file>

</rewritten_file>

</rewritten_file>

</rewritten_file>

</rewritten_file>

</rewritten_file>

</rewritten_file>

</rewritten_file>

</rewritten_file>

</rewritten_file>

</rewritten_file>

</rewritten_file>

</rewritten_file>

</rewritten_file>

</rewritten_file>

</rewritten_file>

</rewritten_file>

</rewritten_file>

</rewritten_file>

</rewritten_file>

</rewritten_file>

</rewritten_file>

</rewritten_file>

</rewritten_file>

</rewritten_file>

</rewritten_file>

</rewritten_file>

</rewritten_file>

</rewritten_file>

</rewritten_file>

</rewritten_file>

</rewritten_file>

</rewritten_file>

</rewritten_file>

</rewritten_file>

</rewritten_file>

</rewritten_file>

</rewritten_file>

</rewritten_file>

</rewritten_file>

</rewritten_file>

</rewritten_file>

</rewritten_file>

</rewritten_file>

</rewritten_file>

</rewritten_file>

</rewritten_file>

</rewritten_file>

</rewritten_file>

</rewritten_file>

</rewritten_file>

</rewritten_file>

</rewritten_file>

</rewritten_file>

</rewritten_file>

</rewritten_file>

</rewritten_file>

</rewritten_file>

</rewritten_file>

</rewritten_file>

</rewritten_file>

</rewritten_file>

</rewritten_file>

</rewritten_file>

</rewritten_file>

</rewritten_file>

</rewritten_file>

</rewritten_file>

</rewritten_file>

</rewritten_file>

</rewritten_file>

</rewritten_file>

</rewritten_file>

</rewritten_file>

</rewritten_file>

</rewritten_file>

</rewritten_file>

</rewritten_file>

</rewritten_file>

</rewritten_file>

</rewritten_file>

</rewritten_file>

</rewritten_file>

</rewritten_file>

</rewritten_file>

</rewritten_file>

</rewritten_file>

</rewritten_file>

</rewritten_file>

</rewritten_file>

</rewritten_file>

</rewritten_file>

</rewritten_file>

</rewritten_file>

</rewritten_file>

</rewritten_file>

</rewritten_file>

</rewritten_file>

</rewritten_file>

</rewritten_file>

</rewritten_file>

</rewritten_file>

</rewritten_file>

</rewritten_file>

</rewritten_file>

</rewritten_file>

</rewritten_file>

</rewritten_file>

</rewritten_file>

</rewritten_file>

</rewritten_file>

</rewritten_file>

</rewritten_file>

</rewritten_file>

</rewritten_file>

</rewritten_file>

</rewritten_file>

</rewritten_file>

</rewritten_file>

</rewritten_file>

</rewritten_file>

</rewritten_file>

</rewritten_file>

</rewritten_file>

</rewritten_file>

</rewritten_file>

</rewritten_file>

</rewritten_file>

</rewritten_file>

</rewritten_file>

</rewritten_file>

</rewritten_file>

</rewritten_file>

</rewritten_file>

</rewritten_file>

</rewritten_file>

</rewritten_file>

</rewritten_file>

</rewritten_file>

</rewritten_file>

</rewritten_file>

</rewritten_file>

</rewritten_file>

</rewritten_file>

</rewritten_file>

</rewritten_file>

</rewritten_file>

</rewritten_file>

</rewritten_file>

</rewritten_file>

</rewritten_file>

</rewritten_file>

</rewritten_file>

</rewritten_file>

</rewritten_file>

</rewritten_file>

</rewritten_file>

</rewritten_file>

</rewritten_file>

</rewritten_file>

</rewritten_file>

</rewritten_file>

</rewritten_file>

</rewritten_file>

</rewritten_file>

</rewritten_file>

</rewritten_file>

</rewritten_file>

</rewritten_file>

</rewritten_file>

</rewritten_file>

</rewritten_file>

</rewritten_file>

</rewritten_file>

</rewritten_file>

</rewritten_file>

</rewritten_file>

</rewritten_file>

</rewritten_file>

</rewritten_file>

</rewritten_file>

</rewritten_file>

</rewritten_file>

</rewritten_file>

</rewritten_file>

</rewritten_file>

</rewritten_file>

</rewritten_file>

</rewritten_file>

</rewritten_file>

</rewritten_file>

</rewritten_file>

</rewritten_file>

</rewritten_file>

</rewritten_file>

</rewritten_file>

</rewritten_file>

</rewritten_file>

</rewritten_file>

</rewritten_file>

</rewritten_file>

</rewritten_file>

</rewritten_file>

</rewritten_file>

</rewritten_file>

</rewritten_file>

</rewritten_file>

</rewritten_file>

</rewritten_file>

</rewritten_file>

</rewritten_file>

</rewritten_file>

</rewritten_file>

</rewritten_file>

</rewritten_file>

</rewritten_file>

</rewritten_file>

</rewritten_file>

</rewritten_file>

</rewritten_file>

</rewritten_file>

</rewritten_file>

</rewritten_file>

</rewritten_file>

</rewritten_file>

</rewritten_file>

</rewritten_file>

</rewritten_file>

</rewritten_file>

</rewritten_file>

</rewritten_file>

</rewritten_file>

<!DOCTYPE html>
<html lang="zh-TW">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>批量圖片生成器 - Multi-AI Image Generator</title>
    <link rel="stylesheet" href="css/style.css">
    <link rel="stylesheet" href="css/api-key-manager.css">
    <link rel="stylesheet" href="css/ai-assistant-v27.css">
    <link rel="stylesheet" href="css/advanced-image-processor.css">
    <link rel="stylesheet" href="css/local-ai-manager.css">
    <link rel="stylesheet" href="css/light-mode-text-fix.css">
    
    <!-- 內聯淺色模式完整修正 -->
    <style>
    /* 淺色模式內容區域完整修正 */
    [data-theme="light"] .tab-content,
    [data-theme="light"] .batch-settings,
    [data-theme="light"] .batch-section,
    [data-theme="light"] .enhance-section,
    [data-theme="light"] .translate-section,
    [data-theme="light"] .style-section,
    [data-theme="light"] .analytics-section,
    [data-theme="light"] .history-section,
    body:not([data-theme="dark"]) .tab-content,
    body:not([data-theme="dark"]) .batch-settings,
    body:not([data-theme="dark"]) .batch-section,
    body:not([data-theme="dark"]) .enhance-section,
    body:not([data-theme="dark"]) .translate-section,
    body:not([data-theme="dark"]) .style-section,
    body:not([data-theme="dark"]) .analytics-section,
    body:not([data-theme="dark"]) .history-section {
        background-color: white !important;
        color: black !important;
    }

    /* 設置和選項區域 */
    [data-theme="light"] .settings-grid,
    [data-theme="light"] .setting-group,
    [data-theme="light"] .option-group,
    [data-theme="light"] .options-grid,
    [data-theme="light"] .input-group,
    [data-theme="light"] .batch-header,
    [data-theme="light"] .batch-controls,
    [data-theme="light"] .batch-prompts-container,
    [data-theme="light"] .prompts-list,
    [data-theme="light"] .empty-state,
    body:not([data-theme="dark"]) .settings-grid,
    body:not([data-theme="dark"]) .setting-group,
    body:not([data-theme="dark"]) .option-group,
    body:not([data-theme="dark"]) .options-grid,
    body:not([data-theme="dark"]) .input-group,
    body:not([data-theme="dark"]) .batch-header,
    body:not([data-theme="dark"]) .batch-controls,
    body:not([data-theme="dark"]) .batch-prompts-container,
    body:not([data-theme="dark"]) .prompts-list,
    body:not([data-theme="dark"]) .empty-state {
        background-color: white !important;
        color: black !important;
    }

    /* 進度和結果區域 */
    [data-theme="light"] .batch-progress,
    [data-theme="light"] .batch-results,
    [data-theme="light"] .batch-stats,
    [data-theme="light"] .progress-header,
    [data-theme="light"] .results-header,
    [data-theme="light"] .batch-actions,
    body:not([data-theme="dark"]) .batch-progress,
    body:not([data-theme="dark"]) .batch-results,
    body:not([data-theme="dark"]) .batch-stats,
    body:not([data-theme="dark"]) .progress-header,
    body:not([data-theme="dark"]) .results-header,
    body:not([data-theme="dark"]) .batch-actions {
        background-color: white !important;
        color: black !important;
    }

    /* 表單元素修正 */
    [data-theme="light"] .ai-assistant-v27 input,
    [data-theme="light"] .ai-assistant-v27 select,
    [data-theme="light"] .ai-assistant-v27 textarea,
    body:not([data-theme="dark"]) .ai-assistant-v27 input,
    body:not([data-theme="dark"]) .ai-assistant-v27 select,
    body:not([data-theme="dark"]) .ai-assistant-v27 textarea {
        background-color: white !important;
        color: black !important;
        border: 1px solid #d1d5db !important;
    }

    /* 所有文字元素 */
    [data-theme="light"] .ai-assistant-v27 label,
    [data-theme="light"] .ai-assistant-v27 h4,
    [data-theme="light"] .ai-assistant-v27 h5,
    [data-theme="light"] .ai-assistant-v27 p,
    [data-theme="light"] .ai-assistant-v27 span,
    [data-theme="light"] .ai-assistant-v27 div,
    body:not([data-theme="dark"]) .ai-assistant-v27 label,
    body:not([data-theme="dark"]) .ai-assistant-v27 h4,
    body:not([data-theme="dark"]) .ai-assistant-v27 h5,
    body:not([data-theme="dark"]) .ai-assistant-v27 p,
    body:not([data-theme="dark"]) .ai-assistant-v27 span,
    body:not([data-theme="dark"]) .ai-assistant-v27 div {
        color: black !important;
    }

    /* 按鈕修正（除了特殊按鈕） */
    [data-theme="light"] .ai-assistant-v27 .secondary-button,
    [data-theme="light"] .ai-assistant-v27 .action-button,
    body:not([data-theme="dark"]) .ai-assistant-v27 .secondary-button,
    body:not([data-theme="dark"]) .ai-assistant-v27 .action-button {
        background-color: #f3f4f6 !important;
        color: black !important;
        border: 1px solid #d1d5db !important;
    }

    /* 強制覆蓋深色背景 */
    [data-theme="light"] .ai-assistant-v27 *:not(.tab-button.active):not(.primary-button):not(.danger-button),
    body:not([data-theme="dark"]) .ai-assistant-v27 *:not(.tab-button.active):not(.primary-button):not(.danger-button) {
        background-color: inherit !important;
    }

    /* 確保主容器背景 */
    [data-theme="light"] .ai-assistant-v27,
    body:not([data-theme="dark"]) .ai-assistant-v27 {
        background-color: white !important;
        color: black !important;
    }

    /* === 深色模式保護性修正 === */
    
    /* 確保深色模式下的正確配色 */
    [data-theme="dark"] .ai-assistant-v27,
    body[data-theme="dark"] .ai-assistant-v27 {
        background-color: #1a1a1a !important;
        color: white !important;
    }

    /* 深色模式標籤按鈕 */
    [data-theme="dark"] .tab-button.active,
    body[data-theme="dark"] .tab-button.active {
        background-color: #2563eb !important;
        color: white !important;
        border: 1px solid #2563eb !important;
    }

    [data-theme="dark"] .tab-button:not(.active),
    body[data-theme="dark"] .tab-button:not(.active) {
        background-color: #374151 !important;
        color: white !important;
        border: 1px solid #4b5563 !important;
    }

    [data-theme="dark"] .tab-button:not(.active):hover,
    body[data-theme="dark"] .tab-button:not(.active):hover {
        background-color: #4b5563 !important;
        color: white !important;
        border: 1px solid #6b7280 !important;
    }

    /* 深色模式內容區域 */
    [data-theme="dark"] .tab-content,
    [data-theme="dark"] .batch-settings,
    [data-theme="dark"] .batch-section,
    [data-theme="dark"] .enhance-section,
    [data-theme="dark"] .translate-section,
    [data-theme="dark"] .style-section,
    [data-theme="dark"] .analytics-section,
    [data-theme="dark"] .history-section,
    body[data-theme="dark"] .tab-content,
    body[data-theme="dark"] .batch-settings,
    body[data-theme="dark"] .batch-section,
    body[data-theme="dark"] .enhance-section,
    body[data-theme="dark"] .translate-section,
    body[data-theme="dark"] .style-section,
    body[data-theme="dark"] .analytics-section,
    body[data-theme="dark"] .history-section {
        background-color: #1a1a1a !important;
        color: white !important;
    }

    /* 深色模式設置區域 */
    [data-theme="dark"] .settings-grid,
    [data-theme="dark"] .setting-group,
    [data-theme="dark"] .option-group,
    [data-theme="dark"] .options-grid,
    [data-theme="dark"] .input-group,
    [data-theme="dark"] .batch-header,
    [data-theme="dark"] .batch-controls,
    [data-theme="dark"] .batch-prompts-container,
    [data-theme="dark"] .prompts-list,
    [data-theme="dark"] .empty-state,
    body[data-theme="dark"] .settings-grid,
    body[data-theme="dark"] .setting-group,
    body[data-theme="dark"] .option-group,
    body[data-theme="dark"] .options-grid,
    body[data-theme="dark"] .input-group,
    body[data-theme="dark"] .batch-header,
    body[data-theme="dark"] .batch-controls,
    body[data-theme="dark"] .batch-prompts-container,
    body[data-theme="dark"] .prompts-list,
    body[data-theme="dark"] .empty-state {
        background-color: #2d2d2d !important;
        color: white !important;
    }

    /* 深色模式進度和結果區域 */
    [data-theme="dark"] .batch-progress,
    [data-theme="dark"] .batch-results,
    [data-theme="dark"] .batch-stats,
    [data-theme="dark"] .progress-header,
    [data-theme="dark"] .results-header,
    [data-theme="dark"] .batch-actions,
    body[data-theme="dark"] .batch-progress,
    body[data-theme="dark"] .batch-results,
    body[data-theme="dark"] .batch-stats,
    body[data-theme="dark"] .progress-header,
    body[data-theme="dark"] .results-header,
    body[data-theme="dark"] .batch-actions {
        background-color: #2d2d2d !important;
        color: white !important;
    }

    /* 深色模式表單元素 */
    [data-theme="dark"] .ai-assistant-v27 input,
    [data-theme="dark"] .ai-assistant-v27 select,
    [data-theme="dark"] .ai-assistant-v27 textarea,
    body[data-theme="dark"] .ai-assistant-v27 input,
    body[data-theme="dark"] .ai-assistant-v27 select,
    body[data-theme="dark"] .ai-assistant-v27 textarea {
        background-color: #374151 !important;
        color: white !important;
        border: 1px solid #4b5563 !important;
    }

    /* 深色模式文字元素 */
    [data-theme="dark"] .ai-assistant-v27 label,
    [data-theme="dark"] .ai-assistant-v27 h4,
    [data-theme="dark"] .ai-assistant-v27 h5,
    [data-theme="dark"] .ai-assistant-v27 p,
    [data-theme="dark"] .ai-assistant-v27 span,
    [data-theme="dark"] .ai-assistant-v27 div,
    body[data-theme="dark"] .ai-assistant-v27 label,
    body[data-theme="dark"] .ai-assistant-v27 h4,
    body[data-theme="dark"] .ai-assistant-v27 h5,
    body[data-theme="dark"] .ai-assistant-v27 p,
    body[data-theme="dark"] .ai-assistant-v27 span,
    body[data-theme="dark"] .ai-assistant-v27 div {
        color: white !important;
    }

    /* 深色模式按鈕 */
    [data-theme="dark"] .ai-assistant-v27 .secondary-button,
    [data-theme="dark"] .ai-assistant-v27 .action-button,
    body[data-theme="dark"] .ai-assistant-v27 .secondary-button,
    body[data-theme="dark"] .ai-assistant-v27 .action-button {
        background-color: #374151 !important;
        color: white !important;
        border: 1px solid #4b5563 !important;
    }

    /* 深色模式標題和狀態 */
    [data-theme="dark"] .ai-assistant-header h3,
    [data-theme="dark"] .status-indicator,
    body[data-theme="dark"] .ai-assistant-header h3,
    body[data-theme="dark"] .status-indicator {
        color: white !important;
    }
    
    /* 增強 Local AI 管理中心 CSS - 減少緊湊感 */
    .local-ai-manager {
        margin: 2.5rem 0 !important;
        padding: 0 !important;
        border-radius: 16px !important;
        box-shadow: 0 8px 32px rgba(0, 0, 0, 0.12) !important;
        background: var(--bg-color, #ffffff) !important;
        overflow: hidden !important;
        transition: all 0.4s ease !important;
    }
    
    .local-ai-manager:hover {
        box-shadow: 0 12px 40px rgba(0, 0, 0, 0.15) !important;
        transform: translateY(-2px) !important;
    }
    
    .local-ai-header {
        padding: 2rem 2.5rem !important;
        background: linear-gradient(135deg, #667eea 0%, #764ba2 100%) !important;
        border-bottom: none !important;
        position: relative !important;
        overflow: hidden !important;
    }
    
    .local-ai-header::before {
        content: '';
        position: absolute;
        top: 0;
        left: 0;
        right: 0;
        bottom: 0;
        background: linear-gradient(45deg, rgba(255,255,255,0.1) 0%, rgba(255,255,255,0.05) 100%);
        pointer-events: none;
    }
    
    .local-ai-header h3 {
        margin: 0 !important;
        font-size: 1.75rem !important;
        font-weight: 700 !important;
        color: white !important;
        display: flex !important;
        align-items: center !important;
        gap: 0.75rem !important;
        text-shadow: 0 2px 4px rgba(0, 0, 0, 0.2) !important;
        position: relative !important;
        z-index: 1 !important;
    }
    
    .local-ai-header h3::before {
        content: '';
        position: absolute;
        left: -0.5rem;
        top: 50%;
        transform: translateY(-50%);
        width: 4px;
        height: 100%;
        background: linear-gradient(to bottom, #fbbf24, #f59e0b);
        border-radius: 2px;
    }
    
    .status-indicators {
        display: flex !important;
        gap: 1.25rem !important;
        align-items: center !important;
        position: relative !important;
        z-index: 1 !important;
    }
    
    .status-indicator {
        display: flex !important;
        align-items: center !important;
        gap: 0.75rem !important;
        font-size: 0.9rem !important;
        font-weight: 600 !important;
        padding: 0.75rem 1.25rem !important;
        background: rgba(255, 255, 255, 0.15) !important;
        border-radius: 25px !important;
        border: 1px solid rgba(255, 255, 255, 0.25) !important;
        backdrop-filter: blur(10px) !important;
        transition: all 0.3s ease !important;
    }
    
    .status-indicator:hover {
        background: rgba(255, 255, 255, 0.2) !important;
        transform: translateY(-1px) !important;
    }
    
    .local-ai-tabs {
        background: linear-gradient(to right, #f8fafc, #f1f5f9) !important;
        border-bottom: 1px solid var(--border-color, #e2e8f0) !important;
        padding: 0.5rem 1rem !important;
        overflow-x: auto !important;
        display: flex !important;
        gap: 0.5rem !important;
    }
    
    .local-ai-tabs .tab-button {
        flex: none !important;
        min-width: 140px !important;
        padding: 1rem 1.75rem !important;
        border: none !important;
        background: transparent !important;
        color: #64748b !important;
        font-size: 0.95rem !important;
        font-weight: 600 !important;
        cursor: pointer !important;
        transition: all 0.3s ease !important;
        border-radius: 12px !important;
        white-space: nowrap !important;
        position: relative !important;
        overflow: hidden !important;
    }
    
    .local-ai-tabs .tab-button::before {
        content: '';
        position: absolute;
        top: 0;
        left: -100%;
        width: 100%;
        height: 100%;
        background: linear-gradient(90deg, transparent, rgba(37, 99, 235, 0.1), transparent);
        transition: left 0.6s ease;
    }
    
    .local-ai-tabs .tab-button:hover::before {
        left: 100%;
    }
    
    .local-ai-tabs .tab-button:hover {
        background: rgba(37, 99, 235, 0.08) !important;
        color: #2563eb !important;
        transform: translateY(-2px) !important;
        box-shadow: 0 4px 12px rgba(37, 99, 235, 0.15) !important;
    }
    
    .local-ai-tabs .tab-button.active {
        background: white !important;
        color: #2563eb !important;
        box-shadow: 0 4px 16px rgba(37, 99, 235, 0.2) !important;
        transform: translateY(-1px) !important;
        border: 1px solid rgba(37, 99, 235, 0.2) !important;
    }
    
    .local-ai-content {
        min-height: 500px !important;
        background: var(--bg-color, #ffffff) !important;
    }
    
    .tab-content {
        display: none !important;
        padding: 2.5rem !important;
        animation: fadeIn 0.4s ease-in-out !important;
    }
    
    .tab-content.active {
        display: block !important;
    }
    
    @keyframes fadeIn {
        from {
            opacity: 0;
            transform: translateY(10px);
        }
        to {
            opacity: 1;
            transform: translateY(0);
        }
    }
    
    /* 深色模式增強 */
    [data-theme="dark"] .local-ai-manager {
        background: #0f172a !important;
        border: 1px solid #334155 !important;
        box-shadow: 0 8px 32px rgba(0, 0, 0, 0.4) !important;
    }
    
    [data-theme="dark"] .local-ai-header {
        background: linear-gradient(135deg, #1e293b 0%, #0f172a 100%) !important;
    }
    
    [data-theme="dark"] .local-ai-header h3 {
        color: #f8fafc !important;
    }
    
    [data-theme="dark"] .local-ai-tabs {
        background: linear-gradient(to right, #1e293b, #334155) !important;
        border-bottom-color: #475569 !important;
    }
    
    [data-theme="dark"] .local-ai-tabs .tab-button {
        color: #cbd5e1 !important;
    }
    
    [data-theme="dark"] .local-ai-tabs .tab-button.active {
        background: #334155 !important;
        color: #60a5fa !important;
        border-color: #3b82f6 !important;
    }
    
    [data-theme="dark"] .local-ai-content {
        background: #0f172a !important;
    }
    
    /* 響應式設計增強 */
    @media (max-width: 768px) {
        .local-ai-header {
            padding: 1.5rem 1.25rem !important;
            flex-direction: column !important;
            gap: 1rem !important;
            text-align: center !important;
        }
        
        .local-ai-header h3 {
            font-size: 1.5rem !important;
            justify-content: center !important;
        }
        
        .status-indicators {
            flex-wrap: wrap !important;
            justify-content: center !important;
            gap: 0.75rem !important;
        }
        
        .local-ai-tabs {
            padding: 0.25rem 0.5rem !important;
            gap: 0.25rem !important;
        }
        
        .local-ai-tabs .tab-button {
            min-width: 100px !important;
            padding: 0.75rem 1rem !important;
            font-size: 0.85rem !important;
        }
        
        .tab-content {
            padding: 1.5rem !important;
        }
    }
    
    @media (max-width: 480px) {
        .local-ai-manager {
            margin: 1.5rem 0 !important;
        }
        
        .local-ai-header {
            padding: 1.25rem 1rem !important;
        }
        
        .local-ai-header h3 {
            font-size: 1.3rem !important;
        }
        
        .tab-content {
            padding: 1rem !important;
        }
    }
    
    </style>

    <!-- Local AI 管理中心 CSS 增強 - 減少緊湊感 -->
    <style>
    /* === 🤖 Local AI 管理中心 增強樣式 === */
    
    .local-ai-manager {
        margin: 3rem 0 !important;
        padding: 0 !important;
        border-radius: 20px !important;
        box-shadow: 0 10px 40px rgba(0, 0, 0, 0.12) !important;
        background: var(--bg-color, #ffffff) !important;
        overflow: hidden !important;
        transition: all 0.4s cubic-bezier(0.4, 0, 0.2, 1) !important;
        border: 1px solid rgba(99, 102, 241, 0.1) !important;
    }
    
    .local-ai-manager:hover {
        box-shadow: 0 20px 60px rgba(0, 0, 0, 0.15) !important;
        transform: translateY(-4px) !important;
        border-color: rgba(99, 102, 241, 0.2) !important;
    }
    
    /* 標題區域大幅增強 */
    .local-ai-header {
        padding: 3rem 3rem !important;
        background: linear-gradient(135deg, #667eea 0%, #764ba2 50%, #f093fb 100%) !important;
        border-bottom: none !important;
        position: relative !important;
        overflow: hidden !important;
        min-height: 120px !important;
    }
    
    /* 添加動態背景效果 */
    .local-ai-header::before {
        content: '';
        position: absolute;
        top: 0;
        left: 0;
        right: 0;
        bottom: 0;
        background: 
            radial-gradient(circle at 20% 80%, rgba(120, 119, 198, 0.3) 0%, transparent 50%),
            radial-gradient(circle at 80% 20%, rgba(255, 119, 198, 0.3) 0%, transparent 50%);
        pointer-events: none;
        animation: shimmer 8s ease-in-out infinite alternate;
    }
    
    @keyframes shimmer {
        0% { opacity: 0.5; }
        100% { opacity: 1; }
    }
    
    /* 標題樣式大幅增強 */
    .local-ai-header h3 {
        margin: 0 !important;
        font-size: 2.2rem !important;
        font-weight: 800 !important;
        color: white !important;
        display: flex !important;
        align-items: center !important;
        gap: 1rem !important;
        text-shadow: 0 4px 8px rgba(0, 0, 0, 0.3) !important;
        position: relative !important;
        z-index: 2 !important;
        letter-spacing: -0.5px !important;
    }
    
    /* 狀態指示器增強 */
    .status-indicators {
        display: flex !important;
        gap: 1.5rem !important;
        align-items: center !important;
        position: relative !important;
        z-index: 2 !important;
        flex-wrap: wrap !important;
    }
    
    .status-indicator {
        display: flex !important;
        align-items: center !important;
        gap: 0.75rem !important;
        font-size: 1rem !important;
        font-weight: 600 !important;
        padding: 1rem 1.5rem !important;
        background: rgba(255, 255, 255, 0.2) !important;
        border-radius: 30px !important;
        border: 1px solid rgba(255, 255, 255, 0.3) !important;
        backdrop-filter: blur(20px) !important;
        transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1) !important;
        min-height: 50px !important;
        box-shadow: 0 4px 15px rgba(0, 0, 0, 0.1) !important;
    }
    
    .status-indicator:hover {
        background: rgba(255, 255, 255, 0.25) !important;
        transform: translateY(-2px) scale(1.02) !important;
        box-shadow: 0 8px 25px rgba(0, 0, 0, 0.15) !important;
    }
    
    /* 標籤頁區域增強 */
    .local-ai-tabs {
        background: linear-gradient(to right, #f8fafc, #f1f5f9, #e2e8f0) !important;
        border-bottom: 2px solid rgba(99, 102, 241, 0.1) !important;
        padding: 1rem 2rem !important;
        overflow-x: auto !important;
        display: flex !important;
        gap: 0.75rem !important;
        min-height: 80px !important;
        align-items: center !important;
    }
    
    .local-ai-tabs .tab-button {
        flex: none !important;
        min-width: 160px !important;
        padding: 1.25rem 2rem !important;
        border: none !important;
        background: rgba(255, 255, 255, 0.7) !important;
        color: #64748b !important;
        font-size: 1rem !important;
        font-weight: 600 !important;
        cursor: pointer !important;
        transition: all 0.4s cubic-bezier(0.4, 0, 0.2, 1) !important;
        border-radius: 16px !important;
        white-space: nowrap !important;
        position: relative !important;
        overflow: hidden !important;
        box-shadow: 0 2px 8px rgba(0, 0, 0, 0.05) !important;
        border: 1px solid rgba(0, 0, 0, 0.05) !important;
    }
    
    .local-ai-tabs .tab-button:hover {
        background: rgba(99, 102, 241, 0.08) !important;
        color: #6366f1 !important;
        transform: translateY(-3px) scale(1.02) !important;
        box-shadow: 0 8px 25px rgba(99, 102, 241, 0.2) !important;
        border-color: rgba(99, 102, 241, 0.2) !important;
    }
    
    .local-ai-tabs .tab-button.active {
        background: linear-gradient(135deg, #6366f1, #8b5cf6) !important;
        color: white !important;
        box-shadow: 0 8px 30px rgba(99, 102, 241, 0.3) !important;
        transform: translateY(-2px) !important;
        border: 1px solid rgba(99, 102, 241, 0.3) !important;
        font-weight: 700 !important;
    }
    
    /* 內容區域增強 */
    .local-ai-content {
        min-height: 600px !important;
        background: var(--bg-color, #ffffff) !important;
        position: relative !important;
    }
    
    .tab-content {
        display: none !important;
        padding: 3rem !important;
        animation: fadeInUp 0.5s ease-out !important;
        min-height: 500px !important;
    }
    
    .tab-content.active {
        display: block !important;
    }
    
    @keyframes fadeInUp {
        from {
            opacity: 0;
            transform: translateY(20px);
        }
        to {
            opacity: 1;
            transform: translateY(0);
        }
    }
    
    /* 深色模式增強 */
    [data-theme="dark"] .local-ai-manager {
        background: #0f172a !important;
        border: 1px solid rgba(99, 102, 241, 0.3) !important;
        box-shadow: 0 10px 40px rgba(0, 0, 0, 0.5) !important;
    }
    
    [data-theme="dark"] .local-ai-header {
        background: linear-gradient(135deg, #1e293b 0%, #0f172a 50%, #1e1b4b 100%) !important;
    }
    
    [data-theme="dark"] .local-ai-header h3 {
        color: #f8fafc !important;
        text-shadow: 0 4px 8px rgba(0, 0, 0, 0.5) !important;
    }
    
    [data-theme="dark"] .local-ai-tabs {
        background: linear-gradient(to right, #1e293b, #334155, #475569) !important;
        border-bottom-color: rgba(99, 102, 241, 0.3) !important;
    }
    
    [data-theme="dark"] .local-ai-tabs .tab-button {
        background: rgba(51, 65, 85, 0.8) !important;
        color: #cbd5e1 !important;
        border-color: rgba(71, 85, 105, 0.5) !important;
    }
    
    [data-theme="dark"] .local-ai-tabs .tab-button:hover {
        background: rgba(99, 102, 241, 0.2) !important;
        color: #a5b4fc !important;
    }
    
    [data-theme="dark"] .local-ai-tabs .tab-button.active {
        background: linear-gradient(135deg, #4f46e5, #7c3aed) !important;
        color: #f8fafc !important;
    }
    
    /* 響應式設計增強 */
    @media (max-width: 768px) {
        .local-ai-header {
            padding: 2rem 1.5rem !important;
            flex-direction: column !important;
            gap: 1.5rem !important;
            text-align: center !important;
        }
        
        .local-ai-header h3 {
            font-size: 1.8rem !important;
            justify-content: center !important;
        }
        
        .local-ai-tabs .tab-button {
            min-width: 120px !important;
            padding: 1rem 1.25rem !important;
        }
        
        .tab-content {
            padding: 2rem 1.25rem !important;
        }
    }
    </style>

    <!-- 提示詞增強功能 CSS 增強 -->
    <style>
    /* === 🎨 提示詞增強功能增強樣式 === */
    
    #enhance-tab {
        background: linear-gradient(135deg, #f8fafc 0%, #f1f5f9 100%) !important;
        min-height: 700px !important;
    }
    
    /* 原始提示詞輸入區域增強 */
    .enhance-input {
        background: white !important;
        border-radius: 16px !important;
        padding: 2rem !important;
        margin-bottom: 2rem !important;
        box-shadow: 0 4px 20px rgba(0, 0, 0, 0.08) !important;
        border: 1px solid rgba(99, 102, 241, 0.1) !important;
        transition: all 0.3s ease !important;
    }
    
    .enhance-input:hover {
        box-shadow: 0 8px 30px rgba(0, 0, 0, 0.12) !important;
        border-color: rgba(99, 102, 241, 0.2) !important;
        transform: translateY(-2px) !important;
    }
    
    .enhance-input label {
        font-size: 1.1rem !important;
        font-weight: 700 !important;
        color: #1e293b !important;
        margin-bottom: 1rem !important;
        display: flex !important;
        align-items: center !important;
        gap: 0.5rem !important;
    }
    
    .enhance-input label i {
        color: #6366f1 !important;
        font-size: 1.2rem !important;
    }
    
    #originalPrompt {
        width: 100% !important;
        min-height: 150px !important;
        padding: 1.5rem !important;
        border: 2px solid #e2e8f0 !important;
        border-radius: 12px !important;
        font-size: 1rem !important;
        line-height: 1.6 !important;
        resize: vertical !important;
        font-family: 'Arial', 'Microsoft YaHei', sans-serif !important;
        transition: all 0.3s ease !important;
        background: #fafbfc !important;
    }
    
    #originalPrompt:focus {
        outline: none !important;
        border-color: #6366f1 !important;
        box-shadow: 0 0 0 3px rgba(99, 102, 241, 0.1) !important;
        background: white !important;
    }
    
    #originalPrompt::placeholder {
        color: #94a3b8 !important;
        font-style: italic !important;
    }
    
    /* 增強選項區域 */
    .enhance-options {
        background: white !important;
        border-radius: 16px !important;
        padding: 2rem !important;
        margin-bottom: 2rem !important;
        box-shadow: 0 4px 20px rgba(0, 0, 0, 0.08) !important;
        border: 1px solid rgba(99, 102, 241, 0.1) !important;
    }
    
    .option-group {
        margin-bottom: 1.5rem !important;
    }
    
    .option-group label {
        font-size: 1rem !important;
        font-weight: 600 !important;
        color: #334155 !important;
        margin-bottom: 0.75rem !important;
        display: flex !important;
        align-items: center !important;
        gap: 0.5rem !important;
    }
    
    .option-group label i {
        color: #8b5cf6 !important;
    }
    
    #enhanceStyle {
        width: 100% !important;
        padding: 1rem 1.25rem !important;
        border: 2px solid #e2e8f0 !important;
        border-radius: 10px !important;
        font-size: 1rem !important;
        background: #fafbfc !important;
        transition: all 0.3s ease !important;
        cursor: pointer !important;
    }
    
    #enhanceStyle:focus {
        outline: none !important;
        border-color: #8b5cf6 !important;
        box-shadow: 0 0 0 3px rgba(139, 92, 246, 0.1) !important;
        background: white !important;
    }
    
    #enhanceStyle option {
        padding: 0.75rem !important;
        font-size: 1rem !important;
    }
    
    /* 控制按鈕區域大幅增強 */
    .enhance-controls {
        display: flex !important;
        gap: 1.5rem !important;
        justify-content: center !important;
        margin: 3rem 0 !important;
        flex-wrap: wrap !important;
    }
    
    #enhancePromptLocal {
        background: linear-gradient(135deg, #6366f1, #8b5cf6) !important;
        color: white !important;
        border: none !important;
        padding: 1.25rem 2.5rem !important;
        border-radius: 16px !important;
        font-size: 1.1rem !important;
        font-weight: 700 !important;
        cursor: pointer !important;
        transition: all 0.4s cubic-bezier(0.4, 0, 0.2, 1) !important;
        box-shadow: 0 6px 20px rgba(99, 102, 241, 0.3) !important;
        min-width: 180px !important;
        position: relative !important;
        overflow: hidden !important;
    }
    
    #enhancePromptLocal::before {
        content: '';
        position: absolute;
        top: 0;
        left: -100%;
        width: 100%;
        height: 100%;
        background: linear-gradient(90deg, transparent, rgba(255,255,255,0.2), transparent);
        transition: left 0.6s ease;
    }
    
    #enhancePromptLocal:hover::before {
        left: 100%;
    }
    
    #enhancePromptLocal:hover {
        transform: translateY(-3px) scale(1.05) !important;
        box-shadow: 0 10px 40px rgba(99, 102, 241, 0.4) !important;
    }
    
    #enhancePromptLocal:active {
        transform: translateY(-1px) scale(1.02) !important;
    }
    
    #enhancePromptLocal i {
        margin-right: 0.75rem !important;
        font-size: 1.2rem !important;
        animation: sparkle 2s ease-in-out infinite;
    }
    
    @keyframes sparkle {
        0%, 100% { transform: scale(1) rotate(0deg); }
        50% { transform: scale(1.1) rotate(5deg); }
    }
    
    /* 結果展示區域增強 */
    .enhance-results {
        background: white !important;
        border-radius: 20px !important;
        padding: 2.5rem !important;
        margin-top: 2rem !important;
        box-shadow: 0 8px 40px rgba(0, 0, 0, 0.1) !important;
        border: 1px solid rgba(34, 197, 94, 0.2) !important;
        animation: slideInUp 0.5s ease-out !important;
    }
    
    @keyframes slideInUp {
        from {
            opacity: 0;
            transform: translateY(30px);
        }
        to {
            opacity: 1;
            transform: translateY(0);
        }
    }
    
    .result-header {
        display: flex !important;
        justify-content: space-between !important;
        align-items: center !important;
        margin-bottom: 2rem !important;
        padding-bottom: 1rem !important;
        border-bottom: 2px solid #f1f5f9 !important;
    }
    
    .result-header h4 {
        margin: 0 !important;
        font-size: 1.5rem !important;
        font-weight: 700 !important;
        color: #1e293b !important;
        display: flex !important;
        align-items: center !important;
        gap: 0.75rem !important;
    }
    
    .result-header h4 i {
        color: #22c55e !important;
        font-size: 1.6rem !important;
        animation: twinkle 3s ease-in-out infinite;
    }
    
    @keyframes twinkle {
        0%, 100% { opacity: 1; }
        50% { opacity: 0.6; }
    }
    
    /* 增強後提示詞展示 */
    #enhancedPrompt {
        background: linear-gradient(135deg, #f0fdf4, #dcfce7) !important;
        border: 2px solid #22c55e !important;
        border-radius: 12px !important;
        padding: 2rem !important;
        font-size: 1.1rem !important;
        line-height: 1.7 !important;
        color: #15803d !important;
        font-weight: 500 !important;
        word-wrap: break-word !important;
        white-space: pre-wrap !important;
        margin-bottom: 1.5rem !important;
        position: relative !important;
    }
    
    #enhancedPrompt::before {
        content: '✨';
        position: absolute;
        top: -10px;
        right: 15px;
        background: white;
        padding: 5px 10px;
        border-radius: 20px;
        box-shadow: 0 2px 8px rgba(0,0,0,0.1);
        font-size: 1.2rem;
    }
    
    /* 改進建議區域 */
    #enhancementSuggestions {
        background: #fef7ff !important;
        border: 1px solid #e879f9 !important;
        border-radius: 12px !important;
        padding: 1.5rem !important;
        margin-top: 1.5rem !important;
    }
    
    #enhancementSuggestions h5 {
        color: #a855f7 !important;
        font-size: 1.1rem !important;
        font-weight: 600 !important;
        margin-bottom: 1rem !important;
        display: flex !important;
        align-items: center !important;
        gap: 0.5rem !important;
    }
    
    #enhancementSuggestions ul {
        list-style: none !important;
        padding: 0 !important;
        margin: 0 !important;
    }
    
    #enhancementSuggestions li {
        background: white !important;
        border-radius: 8px !important;
        padding: 1rem !important;
        margin-bottom: 0.75rem !important;
        border-left: 4px solid #a855f7 !important;
        box-shadow: 0 2px 8px rgba(168, 85, 247, 0.1) !important;
        transition: all 0.2s ease !important;
    }
    
    #enhancementSuggestions li:hover {
        transform: translateX(5px) !important;
        box-shadow: 0 4px 12px rgba(168, 85, 247, 0.2) !important;
    }
    
    #enhancementSuggestions li::before {
        content: '💡';
        margin-right: 0.5rem;
        font-size: 1.1rem;
    }
    
    /* 深色模式支援 */
    [data-theme="dark"] #enhance-tab {
        background: linear-gradient(135deg, #0f172a 0%, #1e293b 100%) !important;
    }
    
    [data-theme="dark"] .enhance-input,
    [data-theme="dark"] .enhance-options,
    [data-theme="dark"] .enhance-results {
        background: #1e293b !important;
        border-color: rgba(99, 102, 241, 0.3) !important;
    }
    
    [data-theme="dark"] .enhance-input label,
    [data-theme="dark"] .option-group label,
    [data-theme="dark"] .result-header h4 {
        color: #f8fafc !important;
    }
    
    [data-theme="dark"] #originalPrompt,
    [data-theme="dark"] #enhanceStyle {
        background: #334155 !important;
        border-color: #475569 !important;
        color: #f8fafc !important;
    }
    
    [data-theme="dark"] #enhancedPrompt {
        background: linear-gradient(135deg, #064e3b, #065f46) !important;
        border-color: #10b981 !important;
        color: #6ee7b7 !important;
    }
    
    [data-theme="dark"] #enhancementSuggestions {
        background: #2d1b69 !important;
        border-color: #8b5cf6 !important;
    }
    
    [data-theme="dark"] #enhancementSuggestions li {
        background: #334155 !important;
        color: #e2e8f0 !important;
    }
    
    /* 響應式設計 */
    @media (max-width: 768px) {
        .enhance-input,
        .enhance-options,
        .enhance-results {
            padding: 1.5rem !important;
            margin-bottom: 1.5rem !important;
        }
        
        #originalPrompt {
            min-height: 120px !important;
            padding: 1rem !important;
        }
        
        .enhance-controls {
            flex-direction: column !important;
            align-items: center !important;
            gap: 1rem !important;
        }
        
        #enhancePromptLocal {
            width: 100% !important;
            max-width: 300px !important;
            padding: 1rem 2rem !important;
        }
        
        .result-header {
            flex-direction: column !important;
            gap: 1rem !important;
            text-align: center !important;
        }
    }
    
    /* 載入狀態動畫 */
    #enhancePromptLocal:disabled {
        opacity: 0.7 !important;
        cursor: not-allowed !important;
        transform: none !important;
    }
    
    #enhancePromptLocal:disabled i {
        animation: spin 1s linear infinite !important;
    }
    
    @keyframes spin {
        from { transform: rotate(0deg); }
        to { transform: rotate(360deg); }
    }
    
    /* 成功狀態動畫 */
    .enhance-results.success-animation {
        animation: successPulse 0.6s ease-out !important;
    }
    
    @keyframes successPulse {
        0% {
            transform: scale(0.95);
            box-shadow: 0 0 0 0 rgba(34, 197, 94, 0.4);
        }
        50% {
            transform: scale(1.02);
            box-shadow: 0 0 0 10px rgba(34, 197, 94, 0);
        }
        100% {
            transform: scale(1);
            box-shadow: 0 0 0 0 rgba(34, 197, 94, 0);
        }
    }
    </style>

    <!-- 提示詞增強功能 間距優化 CSS -->
    <style>
    /* === 🎨 提示詞增強功能 - 大幅增加間距，減少緊湊感 === */
    
    /* 整體標籤頁增加間距 */
    #enhance-tab {
        padding: 3rem 2rem !important;
        min-height: 800px !important;
    }
    
    /* 各個區塊之間的間距大幅增加 */
    .prompt-templates {
        margin-bottom: 4rem !important;
        padding: 2.5rem !important;
        background: rgba(255, 255, 255, 0.8) !important;
        border-radius: 20px !important;
        box-shadow: 0 4px 20px rgba(0, 0, 0, 0.05) !important;
    }
    
    .prompt-templates h4 {
        font-size: 1.4rem !important;
        margin-bottom: 2rem !important;
        padding-bottom: 1rem !important;
        border-bottom: 2px solid #f1f5f9 !important;
    }
    
    .template-grid {
        display: grid !important;
        grid-template-columns: repeat(auto-fit, minmax(120px, 1fr)) !important;
        gap: 2rem !important;
        margin-top: 2rem !important;
    }
    
    .template-btn {
        min-height: 100px !important;
        padding: 1.5rem 1rem !important;
        margin: 0 !important;
    }
    
    .template-btn i {
        font-size: 2rem !important;
        margin-bottom: 0.75rem !important;
    }
    
    .template-btn span {
        font-size: 1rem !important;
        margin-top: 0.5rem !important;
    }
    
    /* 輸入區域大幅增加間距 */
    .enhance-input {
        margin-bottom: 4rem !important;
        padding: 3rem !important;
    }
    
    .input-header {
        display: flex !important;
        justify-content: space-between !important;
        align-items: center !important;
        margin-bottom: 2rem !important;
        padding-bottom: 1rem !important;
        border-bottom: 1px solid #e2e8f0 !important;
    }
    
    .input-tools {
        display: flex !important;
        gap: 1rem !important;
        align-items: center !important;
    }
    
    .tool-btn {
        padding: 0.75rem 1rem !important;
        background: #f8fafc !important;
        border: 1px solid #e2e8f0 !important;
        border-radius: 8px !important;
        cursor: pointer !important;
        transition: all 0.2s ease !important;
        font-size: 0.9rem !important;
    }
    
    .tool-btn:hover {
        background: #e2e8f0 !important;
        transform: translateY(-1px) !important;
    }
    
    .char-count {
        background: #f1f5f9 !important;
        padding: 0.5rem 1rem !important;
        border-radius: 6px !important;
        font-size: 0.85rem !important;
        font-weight: 600 !important;
    }
    
    #originalPrompt {
        min-height: 200px !important;
        padding: 2rem !important;
        font-size: 1.1rem !important;
        line-height: 1.8 !important;
        margin-top: 1.5rem !important;
    }
    
    /* 選項區域增加間距 */
    .enhance-options {
        margin-bottom: 4rem !important;
        padding: 3rem !important;
    }
    
    .options-grid {
        display: grid !important;
        grid-template-columns: repeat(auto-fit, minmax(300px, 1fr)) !important;
        gap: 2.5rem !important;
        margin-top: 2rem !important;
    }
    
    .option-group {
        margin-bottom: 2rem !important;
    }
    
    .option-group label {
        font-size: 1.2rem !important;
        margin-bottom: 1.5rem !important;
        padding-left: 0.5rem !important;
    }
    
    #enhanceStyle {
        min-height: 60px !important;
        padding: 1.25rem 1.5rem !important;
        font-size: 1.1rem !important;
        margin-top: 1rem !important;
    }
    
    .intensity-slider {
        margin-top: 1.5rem !important;
        padding: 1rem !important;
        background: #f8fafc !important;
        border-radius: 12px !important;
    }
    
    #enhanceIntensity {
        width: 100% !important;
        height: 8px !important;
        margin: 1rem 0 !important;
    }
    
    .intensity-labels {
        display: flex !important;
        justify-content: space-between !important;
        font-size: 0.9rem !important;
        color: #6b7280 !important;
        margin-top: 1rem !important;
    }
    
    /* 按鈕控制區域大幅增加間距 */
    .enhance-controls {
        margin: 5rem 0 !important;
        padding: 2rem !important;
        background: rgba(255, 255, 255, 0.5) !important;
        border-radius: 20px !important;
        border: 1px solid #e2e8f0 !important;
    }
    
    .enhance-controls button {
        min-height: 70px !important;
        min-width: 200px !important;
        padding: 1.5rem 3rem !important;
        font-size: 1.2rem !important;
        margin: 0.75rem !important;
        border-radius: 20px !important;
    }
    
    .enhance-controls button i {
        font-size: 1.4rem !important;
        margin-right: 1rem !important;
    }
    
    /* 結果展示區域增加間距 */
    .enhance-results {
        margin-top: 4rem !important;
        padding: 3.5rem !important;
        border-radius: 24px !important;
    }
    
    .result-header {
        margin-bottom: 3rem !important;
        padding-bottom: 1.5rem !important;
    }
    
    .result-header h4 {
        font-size: 1.8rem !important;
    }
    
    .result-actions {
        display: flex !important;
        gap: 1.5rem !important;
    }
    
    .result-actions .action-btn {
        padding: 1rem 1.5rem !important;
        font-size: 1rem !important;
        border-radius: 12px !important;
    }
    
    .results-container {
        display: flex !important;
        flex-direction: column !important;
        gap: 3rem !important;
    }
    
    .enhanced-prompt-container {
        margin-bottom: 2rem !important;
    }
    
    .enhanced-prompt-container label {
        font-size: 1.3rem !important;
        font-weight: 700 !important;
        color: #1e293b !important;
        margin-bottom: 1.5rem !important;
        display: block !important;
    }
    
    #enhancedPrompt {
        padding: 3rem !important;
        font-size: 1.2rem !important;
        line-height: 1.8 !important;
        margin-top: 1.5rem !important;
        border-radius: 16px !important;
    }
    
    #enhancementSuggestions {
        padding: 2.5rem !important;
        margin-top: 3rem !important;
        border-radius: 16px !important;
    }
    
    #enhancementSuggestions h5 {
        font-size: 1.3rem !important;
        margin-bottom: 2rem !important;
    }
    
    #enhancementSuggestions li {
        padding: 1.5rem !important;
        margin-bottom: 1.5rem !important;
        font-size: 1.1rem !important;
        border-radius: 12px !important;
    }
    
    .comparison-section {
        margin-top: 3rem !important;
        padding: 2.5rem !important;
        background: #f8fafc !important;
        border-radius: 16px !important;
        border: 1px solid #e2e8f0 !important;
    }
    
    .comparison-section h5 {
        font-size: 1.4rem !important;
        margin-bottom: 2rem !important;
        text-align: center !important;
    }
    
    .comparison-grid {
        display: grid !important;
        grid-template-columns: 1fr 1fr !important;
        gap: 3rem !important;
        margin-top: 2rem !important;
    }
    
    .before-section,
    .after-section {
        padding: 2rem !important;
        background: white !important;
        border-radius: 12px !important;
        border: 1px solid #e2e8f0 !important;
    }
    
    .before-section label,
    .after-section label {
        font-size: 1.1rem !important;
        font-weight: 600 !important;
        margin-bottom: 1.5rem !important;
        display: block !important;
    }
    
    .original-text,
    .enhanced-text {
        padding: 1.5rem !important;
        background: #f8fafc !important;
        border-radius: 8px !important;
        font-size: 1rem !important;
        line-height: 1.6 !important;
        min-height: 80px !important;
    }
    
    /* 深色模式的間距保持一致 */
    [data-theme="dark"] .prompt-templates,
    [data-theme="dark"] .enhance-controls {
        background: rgba(30, 41, 59, 0.8) !important;
    }
    
    [data-theme="dark"] .comparison-section,
    [data-theme="dark"] .before-section,
    [data-theme="dark"] .after-section {
        background: #334155 !important;
        border-color: #475569 !important;
    }
    
    [data-theme="dark"] .original-text,
    [data-theme="dark"] .enhanced-text {
        background: #1e293b !important;
        color: #e2e8f0 !important;
    }
    
    /* 響應式設計 - 保持大間距 */
    @media (max-width: 768px) {
        #enhance-tab {
            padding: 2rem 1.5rem !important;
        }
        
        .prompt-templates,
        .enhance-input,
        .enhance-options,
        .enhance-results {
            padding: 2rem !important;
            margin-bottom: 3rem !important;
        }
        
        .template-grid {
            grid-template-columns: repeat(auto-fit, minmax(100px, 1fr)) !important;
            gap: 1.5rem !important;
        }
        
        .options-grid {
            grid-template-columns: 1fr !important;
            gap: 2rem !important;
        }
        
        .enhance-controls {
            margin: 3rem 0 !important;
            padding: 1.5rem !important;
        }
        
        .enhance-controls button {
            min-height: 60px !important;
            min-width: 180px !important;
            padding: 1.25rem 2rem !important;
            font-size: 1.1rem !important;
        }
        
        .comparison-grid {
            grid-template-columns: 1fr !important;
            gap: 2rem !important;
        }
    }
    
    @media (max-width: 480px) {
        #enhance-tab {
            padding: 1.5rem 1rem !important;
        }
        
        .enhance-controls button {
            width: 100% !important;
            max-width: none !important;
            margin: 0.5rem 0 !important;
        }
        
        #originalPrompt {
            min-height: 160px !important;
            padding: 1.5rem !important;
        }
    }
    </style>

    <!-- 取消 group 元素的"框"樣式 -->
    <style>
    /* === 🚫 取消容器"框"樣式 === */
    
    .input-group,
    .options-grid,
    .option-group,
    .setting-group {
        background: transparent !important;
        background-color: transparent !important;
        border: none !important;
        box-shadow: none !important;
        padding: 0 !important;
        margin-bottom: 2rem !important; /* 保留一些垂直間距，避免元素擠在一起 */
    }

    /* 為深色模式也應用相同的規則 */
    [data-theme="dark"] .input-group,
    [data-theme="dark"] .options-grid,
    [data-theme="dark"] .option-group,
    [data-theme="dark"] .setting-group,
    body[data-theme="dark"] .input-group,
    body[data-theme="dark"] .options-grid,
    body[data-theme="dark"] .option-group,
    body[data-theme="dark"] .setting-group {
        background: transparent !important;
        background-color: transparent !important;
        border: none !important;
        box-shadow: none !important;
        padding: 0 !important;
    }
    
    /* 對於內部的 label 和 input/select，可能需要微調以保持對齊 */
    .option-group label,
    .setting-group label {
        margin-bottom: 1rem !important;
    }

    </style>

    <!-- 僅取消 group 元素的"邊框"樣式 -->
    <style>
    /* === 🚫 取消容器"邊框"樣式 === */
    
    .input-group,
    .options-grid,
    .option-group,
    .setting-group {
        border: none !important;
        /* 保留原有的 background, padding, 和 box-shadow */
    }

    /* 為深色模式也應用相同的規則 */
    [data-theme="dark"] .input-group,
    [data-theme="dark"] .options-grid,
    [data-theme="dark"] .option-group,
    [data-theme="dark"] .setting-group,
    body[data-theme="dark"] .input-group,
    body[data-theme="dark"] .options-grid,
    body[data-theme="dark"] .option-group,
    body[data-theme="dark"] .setting-group {
        border: none !important;
        /* 保留原有的 background, padding, 和 box-shadow */
    }
    </style>

    <!-- 深色模式下，取消指定容器的背景和邊框 -->
    <style>
    /* === 🚫 深色模式容器扁平化 === */
    
    [data-theme="dark"] .settings-grid,
    [data-theme="dark"] .setting-group,
    [data-theme="dark"] .option-group,
    [data-theme="dark"] .options-grid,
    [data-theme="dark"] .input-group,
    [data-theme="dark"] .batch-header,
    [data-theme="dark"] .batch-controls,
    [data-theme="dark"] .batch-prompts-container,
    [data-theme="dark"] .prompts-list,
    [data-theme="dark"] .empty-state,
    body[data-theme="dark"] .settings-grid,
    body[data-theme="dark"] .setting-group,
    body[data-theme="dark"] .option-group,
    body[data-theme="dark"] .options-grid,
    body[data-theme="dark"] .input-group,
    body[data-theme="dark"] .batch-header,
    body[data-theme="dark"] .batch-controls,
    body[data-theme="dark"] .batch-prompts-container,
    body[data-theme="dark"] .prompts-list,
    body[data-theme="dark"] .empty-state {
        background-color: transparent !important;
        border: none !important;
        box-shadow: none !important;
        padding: 0 !important; /* 同時移除內邊距以達到完全扁平化 */
        margin-bottom: 2rem !important; /* 保留垂直間距 */
    }
    </style>
</head>
<body>
    <!-- 主題和語言切換按鈕 -->
    <div class="top-controls">
        <!-- 語言切換器 -->
        <div class="language-toggle" id="languageToggle">
            <span class="language-icon">🌍</span>
            <span id="languageText" data-i18n="language.current">繁體中文</span>
            <div class="language-dropdown" id="languageDropdown">
                <div class="language-option" data-language="zh-TW" onclick="i18n.changeLanguage('zh-TW')">
                    <span class="language-flag">🇹🇼</span>
                    <span class="language-name" data-i18n="language.zhTW">繁體中文</span>
                </div>
                <div class="language-option" data-language="zh-CN" onclick="i18n.changeLanguage('zh-CN')">
                    <span class="language-flag">🇨🇳</span>
                    <span class="language-name" data-i18n="language.zhCN">简体中文</span>
                </div>
                <div class="language-option" data-language="en" onclick="i18n.changeLanguage('en')">
                    <span class="language-flag">🇺🇸</span>
                    <span class="language-name" data-i18n="language.en">English</span>
                </div>
            </div>
        </div>

        <!-- 主題切換按鈕 -->
        <button class="theme-toggle" onclick="toggleTheme()">
            <span class="theme-icon" id="themeIcon">🌙</span>
            <span id="themeText" data-i18n="theme.dark">深色模式</span>
        </button>
    </div>

    <!-- 導航標籤 -->
    <nav class="tab-navigation">
        <button class="tab-btn active" onclick="switchTab('generator')" data-i18n="nav.generator">圖片生成</button>
        <button class="tab-btn" onclick="switchTab('gallery')" data-i18n="nav.gallery">圖片畫廊</button>
        <button class="tab-btn" onclick="switchTab('history')" data-i18n="nav.history">生成歷史</button>
        <button class="tab-btn" onclick="switchTab('statistics')" data-i18n="nav.statistics">統計分析</button>
    </nav>
    <div class="container">
        <header>
            <h1 data-i18n="app.title">🎨 批量圖片生成器</h1>
            <p data-i18n="app.subtitle">支持多種 AI 圖片生成服務：Gemini、OpenAI、Stability AI 或自定義 API</p>
            <div class="api-info" data-i18n="app.api.info">
                💡 所有 API 配置都可以在下方設置中完成，無需環境變量
            </div>
        </header>

        <!-- 圖片生成標籤頁 -->
        <div id="generatorTab" class="tab-content active">
            <div class="main-content">
            <!-- 提示詞輸入區域 -->
            <div class="input-section">
                <h2 data-i18n="generator.prompts.label">📝 輸入提示詞</h2>
                <div class="prompts-container">
                    <textarea id="prompts" data-i18n="generator.prompts.placeholder" rows="10"></textarea>
                    <div class="prompt-count"><span data-i18n="generator.prompt.count">提示詞數量</span>: <span id="promptCount">0</span></div>
                </div>
            </div>

            <!-- AI 智能助手面板 v2.7 -->
            <div class="ai-assistant-v27" id="aiAssistantV27">
                <!-- AI Assistant 內容將由 JavaScript 動態生成 -->
            </div>

            <!-- 提示詞增強面板 -->
            <div class="prompt-enhancer-panel" id="promptEnhancerPanel">
                <div class="enhancer-header" onclick="toggleEnhancerPanel()">
                    <h3 data-i18n="prompt.enhancer.title">🔧 提示詞增強工具</h3>
                    <button class="toggle-enhancer" id="toggleEnhancer" data-i18n="prompt.enhancer.toggle">收起</button>
                </div>
                
                <div class="enhancer-content" id="enhancerContent">
                    <!-- 提示詞分析區域 -->
                    <div class="analysis-section">
                        <h4 data-i18n="prompt.analysis.title">📊 提示詞分析</h4>
                        <div class="analysis-results" id="analysisResults">
                            <div class="analysis-item">
                                <span data-i18n="prompt.analysis.length">長度:</span>
                                <span id="promptLength">0</span>
                            </div>
                            <div class="analysis-item">
                                <span data-i18n="prompt.analysis.complexity">複雜度:</span>
                                <span id="promptComplexity">-</span>
                            </div>
                            <div class="analysis-item">
                                <span data-i18n="prompt.analysis.quality">品質分數:</span>
                                <span id="qualityScore">0/100</span>
                            </div>
                        </div>
                    </div>

                    <!-- 語法檢查結果 -->
                    <div class="syntax-section">
                        <h4 data-i18n="prompt.syntax.title">✅ 語法檢查</h4>
                        <div class="syntax-results" id="syntaxResults">
                            <div class="syntax-status">等待分析...</div>
                        </div>
                    </div>

                    <!-- AI 優化建議 -->
                    <div class="optimization-section">
                        <h4 data-i18n="prompt.optimization.title">🤖 AI 優化建議</h4>
                        <div class="optimization-controls">
                            <button class="enhance-btn" onclick="optimizePrompts()" data-i18n="prompt.optimize.btn">優化提示詞</button>
                            <button class="enhance-btn" onclick="translatePrompts()" data-i18n="prompt.translate.btn">翻譯提示詞</button>
                        </div>
                        <div class="optimization-results" id="optimizationResults"></div>
                    </div>

                    <!-- 負面提示詞 -->
                    <div class="negative-prompts-section">
                        <h4 data-i18n="prompt.negative.title">🚫 負面提示詞</h4>
                        <textarea 
                            id="negativePrompts" 
                            placeholder="輸入您想要避免的元素..." 
                            data-i18n="prompt.negative.placeholder"
                            rows="3"></textarea>
                        <div class="negative-suggestions">
                            <strong data-i18n="prompt.negative.suggestions">常用建議:</strong>
                            <div class="suggestion-tags" id="negativeSuggestions"></div>
                        </div>
                    </div>

                    <!-- 提示詞模板庫 -->
                    <div class="templates-section">
                        <h4 data-i18n="prompt.templates.title">📚 提示詞模板庫</h4>
                        <div class="template-controls">
                            <select id="templateCategory" data-i18n="prompt.templates.select">
                                <option value="" data-i18n="prompt.templates.select">選擇分類...</option>
                                <option value="portrait" data-i18n="template.portrait">人像攝影</option>
                                <option value="landscape" data-i18n="template.landscape">風景畫面</option>
                                <option value="abstract" data-i18n="template.abstract">抽象藝術</option>
                                <option value="fantasy" data-i18n="template.fantasy">奇幻風格</option>
                                <option value="anime" data-i18n="template.anime">動漫風格</option>
                                <option value="realistic" data-i18n="template.realistic">寫實風格</option>
                            </select>
                            <button class="enhance-btn" onclick="saveAsTemplate()" data-i18n="prompt.templates.save">保存模板</button>
                        </div>
                        <div class="template-suggestions" id="templateSuggestions"></div>
                    </div>

                    <!-- 高級設置 -->
                    <div class="advanced-settings">
                        <h4 data-i18n="prompt.advanced.title">⚙️ 高級設置</h4>
                        <div class="setting-row">
                            <label>
                                <input type="checkbox" id="autoOptimize">
                                <span data-i18n="prompt.auto.optimize">自動優化</span>
                            </label>
                        </div>
                        <div class="setting-row">
                            <label data-i18n="prompt.optimization.level">優化程度:</label>
                            <select id="optimizationLevel">
                                <option value="light" data-i18n="optimization.light">輕度</option>
                                <option value="moderate" data-i18n="optimization.moderate" selected>中度</option>
                                <option value="aggressive" data-i18n="optimization.aggressive">激進</option>
                            </select>
                        </div>
                        <div class="setting-row">
                            <label data-i18n="prompt.target.language">目標語言:</label>
                            <select id="targetLanguage">
                                <option value="zh-TW">繁體中文</option>
                                <option value="zh-CN">简体中文</option>
                                <option value="en" selected>English</option>
                                <option value="ja" data-i18n="language.ja">日本語</option>
                                <option value="ko" data-i18n="language.ko">한국어</option>
                            </select>
                        </div>
                    </div>
                </div>
            </div>

            <!-- 生成設置 -->
            <div class="settings-section">
                <h2 data-i18n="generator.settings">⚙️ 生成設置</h2>
                <div class="settings-grid">
                    <div class="setting-item">
                        <label for="apiProvider" data-i18n="generator.apiProvider">API 提供商:</label>
                        <select id="apiProvider">
                            <option value="gemini" selected data-i18n="api.gemini">Google Gemini</option>
                            <option value="openai" data-i18n="api.openai">OpenAI DALL-E</option>
                            <option value="stability" data-i18n="api.stability">Stability AI</option>
                            <option value="adobe_firefly" data-i18n="api.adobe_firefly">Adobe Firefly ✨</option>
                            <option value="leonardo_ai" data-i18n="api.leonardo_ai">Leonardo AI ✨</option>
                            <option value="custom" data-i18n="api.custom">自定義 API</option>
                        </select>
                    </div>
                    <div class="setting-item">
                        <label for="imageSize" data-i18n="generator.imageSize">圖片尺寸:</label>
                        <select id="imageSize">
                            <option value="512x512" data-i18n="size.512x512">512 x 512</option>
                            <option value="1024x1024" selected data-i18n="size.1024x1024">1024 x 1024</option>
                            <option value="1024x768" data-i18n="size.1024x768">1024 x 768</option>
                            <option value="768x1024" data-i18n="size.768x1024">768 x 1024</option>
                        </select>
                    </div>
                    <div class="setting-item">
                        <label for="imageCount" data-i18n="generator.imageCount">每個提示詞生成數量:</label>
                        <input type="number" id="imageCount" min="1" max="5" value="1">
                    </div>
                    <div class="setting-item" id="modelSelectionSection">
                        <label for="modelSelect" data-i18n="generator.model">模型選擇:</label>
                        <select id="modelSelect">
                            <option value="" data-i18n="model.default">預設模型</option>
                        </select>
                    </div>
                </div>
                
                <!-- API 金鑰設置 -->
                <div id="apiKeySettings" class="api-key-section">
                    <h3>🔑 API 金鑰設置</h3>
                    <div class="settings-grid">
                        <div class="setting-item" id="geminiKeySection">
                            <label for="geminiApiKey">Gemini API 金鑰:</label>
                            <input type="password" id="geminiApiKey" placeholder="您的 Gemini API 金鑰">
                        </div>
                        <div class="setting-item" id="openaiKeySection" style="display: none;">
                            <label for="openaiApiKey">OpenAI API 金鑰:</label>
                            <input type="password" id="openaiApiKey" placeholder="您的 OpenAI API 金鑰">
                        </div>
                        <div class="setting-item" id="stabilityKeySection" style="display: none;">
                            <label for="stabilityApiKey">Stability AI API 金鑰:</label>
                            <input type="password" id="stabilityApiKey" placeholder="您的 Stability AI API 金鑰">
                        </div>
                        <div class="setting-item" id="adobeFireflyKeySection" style="display: none;">
                            <label for="adobeFireflyApiKey">Adobe Firefly API 金鑰:</label>
                            <input type="password" id="adobeFireflyApiKey" placeholder="您的 Adobe Firefly API 金鑰">
                        </div>
                        <div class="setting-item" id="leonardoAiKeySection" style="display: none;">
                            <label for="leonardoAiApiKey">Leonardo AI API 金鑰:</label>
                            <input type="password" id="leonardoAiApiKey" placeholder="您的 Leonardo AI API 金鑰">
                        </div>
                    </div>
                </div>
                
                <!-- 自定義 API 設置 -->
                <div id="customApiSettings" class="custom-api-section" style="display: none;">
                    <h3 data-i18n="api.custom.settings">🔧 自定義 API 設置</h3>
                    <div class="settings-grid">
                        <div class="setting-item">
                            <label for="customApiUrl" data-i18n="api.custom.url">API 端點 URL:</label>
                            <input type="url" id="customApiUrl" data-i18n="api.custom.url.placeholder" placeholder="https://api.example.com/generate">
                        </div>
                        <div class="setting-item">
                            <label for="customApiKey" data-i18n="api.custom.key">API 金鑰:</label>
                            <input type="password" id="customApiKey" data-i18n="api.custom.key.placeholder" placeholder="您的 API 金鑰">
                        </div>
                        <div class="setting-item">
                            <label for="customModel" data-i18n="api.custom.model">模型名稱:</label>
                            <input type="text" id="customModel" data-i18n="api.custom.model.placeholder" placeholder="模型名稱 (可選)">
                        </div>
                        <div class="setting-item">
                            <label for="requestFormat" data-i18n="api.custom.format">請求格式:</label>
                            <select id="requestFormat">
                                <option value="json">JSON</option>
                                <option value="form">Form Data</option>
                            </select>
                        </div>
                    </div>
                    <div class="setting-item">
                        <label for="customHeaders" data-i18n="api.custom.headers">自定義請求頭 (JSON 格式):</label>
                        <textarea id="customHeaders" rows="3" data-i18n="api.custom.headers.placeholder" placeholder='{"Content-Type": "application/json", "Authorization": "Bearer YOUR_TOKEN"}'></textarea>
                    </div>
                    <div class="setting-item">
                        <label for="requestTemplate" data-i18n="api.custom.template">請求模板 (JSON 格式):</label>
                        <textarea id="requestTemplate" rows="5" data-i18n="api.custom.template.placeholder" placeholder='{"prompt": "{PROMPT}", "size": "{SIZE}", "n": {COUNT}}'></textarea>
                    </div>
                </div>
            </div>

            <!-- 控制按鈕 -->
            <div class="controls-section">
                <button id="generateBtn" class="generate-btn">
                    <span class="btn-text" data-i18n="generator.generate">🚀 開始生成</span>
                    <span class="loading-spinner" style="display: none;" data-i18n="generator.generating">⏳ 生成中...</span>
                </button>
                <button id="clearBtn" class="clear-btn" data-i18n="generator.clear">🗑️ 清除全部</button>
            </div>

            <!-- 進度顯示 -->
            <div class="progress-section" style="display: none;">
                <h3 data-i18n="progress.title">📊 生成進度</h3>
                <div class="progress-bar">
                    <div class="progress-fill" id="progressFill"></div>
                </div>
                <div class="progress-text">
                    <span id="progressText" data-i18n="progress.preparing">準備中...</span>
                </div>
            </div>

            <!-- 結果展示 -->
            <div class="results-section">
                <h2 data-i18n="results.title">🖼️ 生成結果</h2>
                <div id="resultsContainer" class="results-grid">
                    <!-- 圖片結果會動態插入這裡 -->
                </div>
            </div>
        </div>
    </div>

        <!-- 圖片畫廊標籤頁 -->
        <div id="galleryTab" class="tab-content">
            <div class="gallery-header">
                <h2 data-i18n="gallery.title">🖼️ 圖片畫廊</h2>
                <div class="gallery-stats" id="galleryStats" data-i18n="msg.loading">
                    載入中...
                </div>
            </div>

            <!-- 搜尋和篩選 -->
            <div class="gallery-filters">
                <div class="filter-group">
                    <label for="gallerySearch" data-i18n="gallery.search">🔍 搜尋提示詞:</label>
                    <input type="text" id="gallerySearch" data-i18n="gallery.search.placeholder" placeholder="輸入關鍵字搜尋...">
                </div>
                
                <div class="filter-group">
                    <label for="providerFilter" data-i18n="gallery.filter.provider">API 提供商:</label>
                    <select id="providerFilter">
                        <option value="" data-i18n="filter.all">全部</option>
                        <option value="gemini" data-i18n="api.gemini">Google Gemini</option>
                        <option value="openai" data-i18n="api.openai">OpenAI DALL-E</option>
                        <option value="stability" data-i18n="api.stability">Stability AI</option>
                        <option value="adobe_firefly" data-i18n="api.adobe_firefly">Adobe Firefly ✨</option>
                        <option value="leonardo_ai" data-i18n="api.leonardo_ai">Leonardo AI ✨</option>
                        <option value="custom" data-i18n="api.custom">自定義 API</option>
                    </select>
                </div>
                
                <div class="filter-group">
                    <label for="favoriteFilter" data-i18n="gallery.filter.favorite">收藏狀態:</label>
                    <select id="favoriteFilter">
                        <option value="" data-i18n="filter.all">全部</option>
                        <option value="true" data-i18n="filter.favorited">已收藏</option>
                        <option value="false" data-i18n="filter.not.favorited">未收藏</option>
                    </select>
                </div>
                
                <div class="filter-group">
                    <label for="sortBy" data-i18n="gallery.filter.sort">排序方式:</label>
                    <select id="sortBy">
                        <option value="created_at" data-i18n="sort.date">創建時間</option>
                        <option value="rating" data-i18n="sort.rating">評分</option>
                        <option value="filename" data-i18n="sort.filename">文件名</option>
                        <option value="api_provider" data-i18n="sort.provider">API 提供商</option>
                    </select>
                </div>
            </div>

            <!-- 批量操作 -->
            <div class="batch-actions" id="batchActions" style="display: none;">
                <div class="batch-info">
                    <span data-i18n="gallery.batch.select">已選擇</span> <span id="selectedCount">0</span> <span data-i18n="gallery.images">張圖片</span>
                </div>
                <div class="batch-buttons">
                    <button id="selectAllImages" class="btn-secondary" data-i18n="btn.select.all">全選/取消全選</button>
                    <button id="downloadSelected" class="btn-primary" data-i18n="gallery.batch.download">批量下載</button>
                    <button id="deleteSelected" class="btn-danger" data-i18n="gallery.batch.delete">批量刪除</button>
                </div>
            </div>

            <!-- 圖片網格 -->
            <div class="gallery-container">
                <div id="imageGalleryContainer" class="image-grid">
                    <!-- 圖片會動態載入到這裡 -->
                </div>
            </div>

            <!-- 分頁導航 -->
            <div id="galleryPagination" class="pagination-container">
                <!-- 分頁控制會動態載入到這裡 -->
            </div>
        </div>

        <!-- 生成歷史標籤頁 -->
        <div id="historyTab" class="tab-content">
            <div class="history-header">
                <h2 data-i18n="history.title">📜 生成歷史</h2>
                <div class="history-actions">
                    <button id="exportHistory" class="btn-secondary" data-i18n="history.export">匯出歷史</button>
                    <button id="refreshHistory" class="btn-primary" data-i18n="history.refresh">重新整理</button>
                </div>
            </div>

            <!-- 歷史記錄列表 -->
            <div class="history-container">
                <div id="historyList" class="history-list">
                    <!-- 歷史記錄會動態載入到這裡 -->
                </div>
            </div>

            <!-- 歷史分頁 -->
            <div id="historyPagination" class="pagination-container">
                <!-- 分頁控制會動態載入到這裡 -->
            </div>
        </div>

        <!-- 統計分析標籤頁 -->
        <div id="statisticsTab" class="tab-content">
            <div class="statistics-header">
                <h2 data-i18n="stats.title">📊 統計分析</h2>
                <div class="stats-refresh">
                    <button id="refreshStats" class="btn-primary" data-i18n="stats.refresh">重新整理</button>
                </div>
            </div>

            <div class="statistics-container">
                <!-- 基本統計 -->
                <div class="stats-section">
                    <h3 data-i18n="stats.overview">📈 基本統計</h3>
                    <div id="basicStats" class="stats-grid">
                        <!-- 基本統計會動態載入到這裡 -->
                    </div>
                </div>

                <!-- 按提供商統計 -->
                <div class="stats-section">
                    <h3 data-i18n="stats.provider.usage">🔧 按 API 提供商統計</h3>
                    <div id="providerStats" class="provider-stats">
                        <!-- 提供商統計會動態載入到這裡 -->
                    </div>
                </div>

                <!-- 最近7天統計 -->
                <div class="stats-section">
                    <h3 data-i18n="stats.daily.activity">📅 最近7天生成統計</h3>
                    <div id="dailyStats" class="daily-stats">
                        <!-- 每日統計會動態載入到這裡 -->
                    </div>
                </div>

                <!-- 成功率統計 -->
                <div class="stats-section">
                    <h3 data-i18n="stats.success.analysis">✅ 成功率分析</h3>
                    <div id="successStats" class="success-stats">
                        <!-- 成功率統計會動態載入到這裡 -->
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- 資源管理器優先載入 -->
    <script src="js/resource-manager.js"></script>
    
    <!-- 前端錯誤修復腳本 -->
    <script>
        /**
         * 內聯前端錯誤修復腳本
         * 立即修復DOM操作安全問題
         */
        (function() {
            class FrontendErrorFixes {
                constructor() {
                    this.fixedFunctions = new Set();
                    this.errorCount = 0;
                    this.warnings = [];
                    this.init();
                }
                
                init() {
                    console.log('🔧 前端錯誤修復器啟動...');
                    this.enhanceErrorHandling();
                    this.createSafeHelpers();
                    console.log('✅ 前端錯誤修復完成');
                }
                
                enhanceErrorHandling() {
                    if (!window._frontendErrorHandlerInstalled) {
                        window.addEventListener('error', (event) => {
                            this.errorCount++;
                            if (event.message && (
                                event.message.includes('Cannot read properties of null') ||
                                event.message.includes('getElementById') ||
                                event.message.includes('querySelector'))) {
                                console.error('🚨 DOM操作錯誤:', {
                                    message: event.message,
                                    filename: event.filename,
                                    line: event.lineno
                                });
                            }
                        });
                        
                        window.addEventListener('unhandledrejection', (event) => {
                            console.error('🚨 未處理Promise錯誤:', event.reason);
                        });
                        
                        window._frontendErrorHandlerInstalled = true;
                    }
                }
                
                createSafeHelpers() {
                    // 安全獲取元素
                    window.safeGetElement = (id) => {
                        try {
                            const element = document.getElementById(id);
                            if (!element) console.warn(`⚠️ 元素不存在: ${id}`);
                            return element;
                        } catch (error) {
                            console.error(`❌ 獲取元素失敗: ${id}`, error);
                            return null;
                        }
                    };
                    
                    // 安全選擇器
                    window.safeQuerySelector = (selector) => {
                        try {
                            const element = document.querySelector(selector);
                            if (!element) console.warn(`⚠️ 選擇器未找到元素: ${selector}`);
                            return element;
                        } catch (error) {
                            console.error(`❌ 選擇器查詢失敗: ${selector}`, error);
                            return null;
                        }
                    };
                    
                    // 安全事件監聽器
                    window.safeAddEventListener = (elementOrId, event, handler, options = {}) => {
                        try {
                            const element = typeof elementOrId === 'string' ? 
                                window.safeGetElement(elementOrId) : elementOrId;
                            if (element && element.addEventListener) {
                                element.addEventListener(event, handler, options);
                                return true;
                            }
                            return false;
                        } catch (error) {
                            console.error('❌ 添加事件監聽器失敗:', error);
                            return false;
                        }
                    };
                    
                    // 安全設置內容
                    window.safeSetContent = (elementOrId, content, method = 'textContent') => {
                        try {
                            const element = typeof elementOrId === 'string' ? 
                                window.safeGetElement(elementOrId) : elementOrId;
                            if (element) {
                                element[method] = content;
                                return true;
                            }
                            return false;
                        } catch (error) {
                            console.error('❌ 設置內容失敗:', error);
                            return false;
                        }
                    };
                    
                    this.fixedFunctions.add('safeHelpers');
                }
                
                getDiagnostics() {
                    return {
                        fixedFunctions: Array.from(this.fixedFunctions),
                        errorCount: this.errorCount,
                        warnings: this.warnings
                    };
                }
            }
            
            // 創建全局實例
            window.frontendErrorFixes = new FrontendErrorFixes();
            
            // DOM載入完成後檢查關鍵元素
            document.addEventListener('DOMContentLoaded', () => {
                setTimeout(() => {
                    const criticalElements = ['prompts', 'promptCount', 'generateBtn', 'apiProvider'];
                    const missing = [];
                    
                    criticalElements.forEach(id => {
                        const element = window.safeGetElement(id);
                        if (!element) missing.push(id);
                    });
                    
                    if (missing.length > 0) {
                        console.warn('🚨 關鍵元素缺失:', missing);
                    } else {
                        console.log('✅ 所有關鍵元素都存在');
                    }
                    
                    const coverage = ((criticalElements.length - missing.length) / criticalElements.length * 100).toFixed(1);
                    console.log('🎯 關鍵元素覆蓋率:', coverage + '%');
                }, 1000);
            });
        })();
    </script>
    
    <!-- 錯誤修復補丁 - 優先載入 -->
    <script>
        /**
         * 錯誤修復補丁
         * 解決控制台中發現的具體問題
         */
        (function() {
            console.log('🩹 載入錯誤修復補丁...');
            
            // 1. 修復資源管理器定時器問題
            if (!window._originalSetInterval) {
                window._originalSetInterval = setInterval;
                window._originalSetTimeout = setTimeout;
                window._originalClearInterval = clearInterval;
                window._originalClearTimeout = clearTimeout;
            }
            
            // 2. 全局Promise錯誤處理增強
            window.addEventListener('unhandledrejection', (event) => {
                const error = event.reason;
                if (error && error.message) {
                    if (error.message.includes('UserModel') ||
                        error.message.includes('log_activity') ||
                        error.message.includes('404 Not Found')) {
                        console.warn('⚠️ 後端開發問題，已友好處理:', error.message);
                        event.preventDefault();
                        return;
                    }
                }
            });
            
            // 3. DOM載入後的修復
            document.addEventListener('DOMContentLoaded', () => {
                setTimeout(() => {
                    // 修復AI助手相關錯誤
                    if (window.aiAssistantV27) {
                        const originalUpdate = window.aiAssistantV27.updateStatusIndicators;
                        if (originalUpdate) {
                            window.aiAssistantV27.updateStatusIndicators = function() {
                                try {
                                    const statusElement = document.getElementById('aiAssistantStatus');
                                    if (statusElement) {
                                        return originalUpdate.call(this);
                                    } else {
                                        console.warn('⚠️ AI助手狀態元素不存在，跳過更新');
                                    }
                                } catch (error) {
                                    console.warn('⚠️ AI助手狀態更新失敗:', error.message);
                                }
                            };
                        }
                    }
                    
                    // 修復分析儀表板
                    if (window.analyticsDashboard && !window.analyticsDashboard.updateRealtimeMetrics) {
                        window.analyticsDashboard.updateRealtimeMetrics = function() {
                            console.log('📊 分析儀表板：使用模擬實時數據');
                        };
                    }
                    
                    console.log('✅ DOM錯誤修復完成');
                }, 1500);
            });
            
            console.log('✅ 錯誤修復補丁載入完成');
        })();
    </script>
    
    <!-- 統一API管理器優先載入 -->
    <script src="js/unified-api-manager.js"></script>
    
    <!-- 整合修復腳本 -->
    <script src="js/integration-fix.js"></script>
    
    <!-- 認證修復系統優先載入 -->
    <script src="js/auth-fix.js"></script>
    
    <!-- i18n 系統需要最先載入 -->
    <script src="js/i18n.js"></script>
    <script src="js/prompt-enhancer.js"></script>
    <script src="js/script.js"></script>
    <script src="js/image-gallery.js"></script>
    <script src="js/history-manager.js"></script>
    <script src="js/statistics-manager.js"></script>
            <script src="js/image-processor.js"></script>
        <script src="js/image-editor.js"></script>
        <script src="js/ai-assistant.js"></script>
    <script src="js/user-management.js"></script>
    <script src="js/api-key-manager.js"></script>
    <script src="js/ai-assistant-v27.js"></script>
    <script src="js/advanced-image-processor.js"></script>
    <script src="js/performance-optimizer.js"></script>
    <script src="js/system-integration-tester.js"></script>
    <script src="js/ux-enhancement.js"></script>
    <script src="js/analytics-dashboard.js"></script>
    <script src="js/local-ai-manager.js"></script>
    
    <!-- 標籤載入修正腳本 -->
    <script>
    /**
     * 標籤載入和模型下載修正
     * 解決重複"正在處理請求..."和"進度容器不存在"問題
     */
    class TabLoadingFix {
        constructor() {
            this.loadingStates = new Map();
            this.init();
        }

        init() {
            console.log('🔧 標籤載入修正已啟動');
            setTimeout(() => {
                this.fixTabLoading();
                this.fixModelDownload();
                this.preventDuplicateLoading();
            }, 1000);
        }

        // 修正標籤載入重複請求問題
        fixTabLoading() {
            // 攔截 AI Assistant v2.7 的標籤切換
            if (window.aiAssistantV27?.switchTab) {
                const originalSwitchTab = window.aiAssistantV27.switchTab;
                window.aiAssistantV27.switchTab = (tabName) => {
                    if (this.loadingStates.get(`ai-${tabName}`) === 'loading') {
                        console.log(`標籤 ${tabName} 正在載入中，跳過重複請求`);
                        return;
                    }
                    this.loadingStates.set(`ai-${tabName}`, 'loading');
                    try {
                        originalSwitchTab.call(window.aiAssistantV27, tabName);
                    } finally {
                        setTimeout(() => {
                            this.loadingStates.set(`ai-${tabName}`, 'loaded');
                        }, 1000);
                    }
                };
            }

            // 攔截 Local AI Manager 的標籤切換
            if (window.localAIManager?.switchTab) {
                const originalLocalSwitchTab = window.localAIManager.switchTab;
                window.localAIManager.switchTab = (tabName) => {
                    if (this.loadingStates.get(`local-${tabName}`) === 'loading') {
                        console.log(`Local AI 標籤 ${tabName} 正在載入中，跳過重複請求`);
                        return;
                    }
                    this.loadingStates.set(`local-${tabName}`, 'loading');
                    try {
                        originalLocalSwitchTab.call(window.localAIManager, tabName);
                    } finally {
                        setTimeout(() => {
                            this.loadingStates.set(`local-${tabName}`, 'loaded');
                        }, 1000);
                    }
                };
            }
        }

        // 修正模型下載進度容器問題
        fixModelDownload() {
            document.addEventListener('click', (e) => {
                if (e.target.classList.contains('download-model-btn') || 
                    e.target.closest('.download-model-btn')) {
                    
                    const button = e.target.classList.contains('download-model-btn') ? 
                                   e.target : e.target.closest('.download-model-btn');
                    
                    const modelName = button.dataset.model;
                    if (modelName) {
                        this.ensureProgressContainer(modelName);
                    }
                }
            });
        }

        // 確保進度容器存在
        ensureProgressContainer(modelName) {
            let progressContainer = document.getElementById(`progress-${modelName}`);
            
            if (!progressContainer) {
                console.log(`創建缺失的進度容器: progress-${modelName}`);
                
                const modelCard = document.querySelector(`[data-model="${modelName}"]`);
                if (modelCard) {
                    progressContainer = document.createElement('div');
                    progressContainer.className = 'download-progress';
                    progressContainer.id = `progress-${modelName}`;
                    progressContainer.style.display = 'none';
                    progressContainer.innerHTML = `
                        <div class="progress-bar">
                            <div class="progress-fill"></div>
                        </div>
                        <span class="progress-text">0%</span>
                    `;
                    
                    modelCard.appendChild(progressContainer);
                    console.log(`✅ 已創建進度容器: progress-${modelName}`);
                } else {
                    console.error(`找不到模型卡片: ${modelName}`);
                }
            }
            
            return progressContainer;
        }

        // 防止重複載入指示器
        preventDuplicateLoading() {
            let activeLoadingIndicators = new Set();

            document.addEventListener('apiRequestStart', (event) => {
                const { url } = event.detail || {};
                if (url && activeLoadingIndicators.has(url)) {
                    event.stopPropagation();
                    return;
                }
                if (url) activeLoadingIndicators.add(url);
            });

            document.addEventListener('apiRequestEnd', (event) => {
                const { url } = event.detail || {};
                if (url) activeLoadingIndicators.delete(url);
            });

            document.addEventListener('apiRequestError', (event) => {
                const { url } = event.detail || {};
                if (url) activeLoadingIndicators.delete(url);
            });
        }
    }

    // 等待頁面載入完成後初始化
    document.addEventListener('DOMContentLoaded', () => {
        setTimeout(() => {
            window.tabLoadingFix = new TabLoadingFix();
        }, 2000);
    });

    // 提供全局修正函數
    window.fixTabLoading = () => {
        if (window.tabLoadingFix) {
            window.tabLoadingFix.loadingStates.clear();
            window.tabLoadingFix.fixTabLoading();
            window.tabLoadingFix.fixModelDownload();
            console.log('🔧 手動重新應用標籤載入修正');
        }
    };

    console.log('🚀 標籤載入修正腳本已載入');
    </script>
    
    <!-- 載入指示器修正腳本 -->
    <script>
    /**
     * 載入指示器修正腳本
     * 專門解決重複顯示"正在處理請求..."的問題
     */
    class LoadingIndicatorFix {
        constructor() {
            this.activeIndicators = new Set();
            this.maxIndicators = 1; // 最多只允許1個載入指示器
            this.isBlockingRequests = false;
            this.init();
        }

        init() {
            console.log('🔧 載入指示器修正已啟動');
            setTimeout(() => {
                this.interceptUXEnhancement();
                this.setupTabClickFix();
                this.startPeriodicCleanup();
            }, 1500);
        }

        // 攔截並修正 UX Enhancement 的載入指示器
        interceptUXEnhancement() {
            const uxInstance = window.uxEnhancement;
            if (!uxInstance) {
                console.log('⚠️ UX Enhancement 未找到，稍後重試');
                setTimeout(() => this.interceptUXEnhancement(), 1000);
                return;
            }

            console.log('🔧 修正 UX Enhancement 載入指示器');

            // 保存原始方法
            const originalShowLoadingIndicator = uxInstance.showLoadingIndicator;
            const originalHideLoadingIndicator = uxInstance.hideLoadingIndicator;

            // 重寫 showLoadingIndicator 方法
            uxInstance.showLoadingIndicator = (message = '載入中...') => {
                // 檢查是否已經有太多載入指示器
                if (this.activeIndicators.size >= this.maxIndicators) {
                    console.log('🚫 已達到載入指示器上限，跳過新的指示器');
                    return Array.from(this.activeIndicators)[0]; // 返回現有指示器的 ID
                }

                // 檢查是否有相同消息的指示器
                const existingIndicators = document.querySelectorAll('.loading-indicator');
                for (const indicator of existingIndicators) {
                    const messageElement = indicator.querySelector('.loading-message');
                    if (messageElement && messageElement.textContent === message) {
                        console.log('🚫 跳過重複的載入指示器:', message);
                        return indicator.id.replace('loading-', '');
                    }
                }

                // 調用原始方法
                const id = originalShowLoadingIndicator.call(uxInstance, message);
                this.activeIndicators.add(id);
                
                console.log('✅ 顯示載入指示器:', message, 'ID:', id);
                return id;
            };

            // 重寫 hideLoadingIndicator 方法
            uxInstance.hideLoadingIndicator = (id) => {
                if (this.activeIndicators.has(id)) {
                    this.activeIndicators.delete(id);
                    console.log('✅ 隱藏載入指示器 ID:', id);
                }
                
                return originalHideLoadingIndicator.call(uxInstance, id);
            };

            // 完全重寫 enhanceProgressFeedback 方法
            uxInstance.enhanceProgressFeedback = () => {
                console.log('🔧 使用修正的進度反饋');
                
                // 只監聽真正的 API 請求，並且有節流
                let lastRequestTime = 0;
                const throttleDelay = 1000; // 1秒內只處理一個請求
                
                document.addEventListener('apiRequestStart', (event) => {
                    const now = Date.now();
                    if (now - lastRequestTime < throttleDelay) {
                        console.log('🚫 請求太頻繁，跳過載入指示器');
                        return;
                    }
                    lastRequestTime = now;
                    
                    if (this.isBlockingRequests) {
                        console.log('🚫 請求被阻止，跳過載入指示器');
                        return;
                    }

                    // 只有在沒有活動指示器時才顯示新的
                    if (this.activeIndicators.size === 0) {
                        const loadingId = uxInstance.showLoadingIndicator('正在處理請求...');
                        if (loadingId && event.detail) {
                            event.detail.loadingId = loadingId;
                        }
                    } else {
                        console.log('🚫 已有活動載入指示器，跳過新的');
                    }
                });

                document.addEventListener('apiRequestEnd', (event) => {
                    if (event.detail?.loadingId) {
                        uxInstance.hideLoadingIndicator(event.detail.loadingId);
                    }
                    // 清理所有載入指示器（以防萬一）
                    this.cleanupStaleIndicators();
                });

                document.addEventListener('apiRequestError', (event) => {
                    if (event.detail?.loadingId) {
                        uxInstance.hideLoadingIndicator(event.detail.loadingId);
                    }
                    // 清理所有載入指示器
                    this.cleanupStaleIndicators();
                });
            };
        }

        // 修正標籤點擊引起的問題
        setupTabClickFix() {
            document.addEventListener('click', (e) => {
                const isTabButton = e.target.classList.contains('tab-button') || 
                                   e.target.closest('.tab-button');
                
                if (isTabButton) {
                    console.log('🔧 標籤點擊修正');
                    
                    // 立即清理現有載入指示器
                    this.cleanupStaleIndicators();
                    
                    // 阻止後續請求一段時間
                    this.isBlockingRequests = true;
                    
                    // 1.5秒後重新允許請求
                    setTimeout(() => {
                        this.isBlockingRequests = false;
                    }, 1500);
                }
            });
        }

        // 清理過期的載入指示器
        cleanupStaleIndicators() {
            const indicators = document.querySelectorAll('.loading-indicator');
            indicators.forEach(indicator => {
                indicator.remove();
            });
            this.activeIndicators.clear();
            console.log('🧹 已清理所有載入指示器');
        }

        // 定期清理
        startPeriodicCleanup() {
            setInterval(() => {
                // 檢查是否有孤立的載入指示器
                const indicators = document.querySelectorAll('.loading-indicator');
                if (indicators.length > this.maxIndicators) {
                    console.log('🧹 檢測到過多載入指示器，執行清理');
                    this.cleanupStaleIndicators();
                }
            }, 3000); // 每3秒檢查一次
        }

        // 手動清理函數
        forceCleanup() {
            this.cleanupStaleIndicators();
            this.isBlockingRequests = false;
            console.log('🔧 強制清理完成');
        }
    }

    // 立即初始化
    window.loadingIndicatorFix = new LoadingIndicatorFix();

    // 提供全局修正函數
    window.fixLoadingIndicators = () => {
        if (window.loadingIndicatorFix) {
            window.loadingIndicatorFix.forceCleanup();
        } else {
            window.loadingIndicatorFix = new LoadingIndicatorFix();
        }
        console.log('🔧 手動修正載入指示器');
    };

    console.log('🚀 載入指示器修正腳本已載入');
    </script>
    
    <!-- 標籤切換修正腳本 -->
    <script>
    /**
     * 標籤切換修正腳本
     * 解決點擊標籤後跳轉到空白頁面的問題
     */
    class TabSwitchFix {
        constructor() {
            this.init();
        }

        init() {
            console.log('🔧 標籤切換修正已啟動');
            setTimeout(() => {
                this.fixAIAssistantTabs();
                this.fixLocalAITabs();
                this.preventPageJumps();
            }, 1000);
        }

        // 修正 AI Assistant v2.7 的標籤切換
        fixAIAssistantTabs() {
            if (!window.aiAssistantV27) {
                setTimeout(() => this.fixAIAssistantTabs(), 1000);
                return;
            }

            const originalSwitchTab = window.aiAssistantV27.switchTab;
            
            window.aiAssistantV27.switchTab = (tabName) => {
                console.log('🔄 AI Assistant 標籤切換:', tabName);
                
                try {
                    // 確保所有需要的元素都存在
                    const tabButtons = document.querySelectorAll('.ai-assistant-v27 .tab-button');
                    const tabContents = document.querySelectorAll('.ai-assistant-v27 .tab-content');
                    
                    if (tabButtons.length === 0 || tabContents.length === 0) {
                        console.warn('⚠️ AI Assistant 標籤元素不存在');
                        return;
                    }

                    // 移除所有活動狀態
                    tabButtons.forEach(btn => btn.classList.remove('active'));
                    tabContents.forEach(content => content.classList.remove('active'));
                    
                    // 激活選中的標籤按鈕
                    const targetButton = document.querySelector(`.ai-assistant-v27 [data-tab="${tabName}"]`);
                    if (targetButton) {
                        targetButton.classList.add('active');
                    } else {
                        console.warn(`⚠️ 找不到標籤按鈕: ${tabName}`);
                    }
                    
                    // 激活對應的內容
                    const targetContent = document.getElementById(`${tabName}-tab`);
                    if (targetContent) {
                        targetContent.classList.add('active');
                        console.log(`✅ 已激活標籤內容: ${tabName}-tab`);
                    } else {
                        console.warn(`⚠️ 找不到標籤內容: ${tabName}-tab`);
                        // 嘗試重新創建內容
                        this.recreateTabContent(tabName);
                    }
                    
                    // 載入對應數據（但不等待，避免阻塞）
                    if (window.aiAssistantV27.loadTabData) {
                        setTimeout(() => {
                            window.aiAssistantV27.loadTabData(tabName);
                        }, 100);
                    }
                    
                } catch (error) {
                    console.error('❌ AI Assistant 標籤切換失敗:', error);
                    // 嘗試使用原始方法
                    if (originalSwitchTab) {
                        originalSwitchTab.call(window.aiAssistantV27, tabName);
                    }
                }
            };
        }

        // 修正 Local AI Manager 的標籤切換
        fixLocalAITabs() {
            if (!window.localAIManager) {
                setTimeout(() => this.fixLocalAITabs(), 1000);
                return;
            }

            const originalSwitchTab = window.localAIManager.switchTab;
            
            window.localAIManager.switchTab = (tabName) => {
                console.log('🔄 Local AI 標籤切換:', tabName);
                
                try {
                    const tabButtons = document.querySelectorAll('.local-ai-manager .tab-button');
                    const tabContents = document.querySelectorAll('.local-ai-manager .tab-content');
                    
                    if (tabButtons.length === 0 || tabContents.length === 0) {
                        console.warn('⚠️ Local AI 標籤元素不存在');
                        return;
                    }

                    // 更新標籤狀態
                    tabButtons.forEach(tab => {
                        tab.classList.toggle('active', tab.dataset.tab === tabName);
                    });

                    // 更新內容顯示
                    tabContents.forEach(content => {
                        content.classList.toggle('active', content.id === `${tabName}-tab`);
                    });
                    
                    console.log(`✅ Local AI 標籤切換完成: ${tabName}`);
                    
                } catch (error) {
                    console.error('❌ Local AI 標籤切換失敗:', error);
                    if (originalSwitchTab) {
                        originalSwitchTab.call(window.localAIManager, tabName);
                    }
                }
            };
        }

        // 防止頁面跳轉
        preventPageJumps() {
            document.addEventListener('click', (e) => {
                const tabButton = e.target.closest('.tab-button');
                
                if (tabButton) {
                    e.preventDefault(); // 防止頁面跳轉
                    e.stopPropagation(); // 停止事件冒泡
                    
                    const tabName = tabButton.dataset.tab;
                    if (tabName) {
                        console.log('🔧 防止頁面跳轉，處理標籤點擊:', tabName);
                        
                        // 確定是哪個組件的標籤
                        if (tabButton.closest('.ai-assistant-v27')) {
                            if (window.aiAssistantV27?.switchTab) {
                                window.aiAssistantV27.switchTab(tabName);
                            }
                        } else if (tabButton.closest('.local-ai-manager')) {
                            if (window.localAIManager?.switchTab) {
                                window.localAIManager.switchTab(tabName);
                            }
                        }
                    }
                    
                    return false; // 確保不會導航
                }
            }, true); // 使用捕獲階段
        }

        // 重新創建標籤內容（當元素不存在時）
        recreateTabContent(tabName) {
            console.log('🔄 嘗試重新創建標籤內容:', tabName);
            
            if (!window.aiAssistantV27) return;
            
            const contentContainer = document.querySelector('.ai-assistant-v27 .ai-assistant-content');
            if (!contentContainer) return;
            
            let newContent = '';
            
            try {
                switch (tabName) {
                    case 'enhance':
                        newContent = window.aiAssistantV27.createEnhanceTab();
                        break;
                    case 'batch':
                        newContent = window.aiAssistantV27.createBatchTab();
                        break;
                    case 'translate':
                        newContent = window.aiAssistantV27.createTranslateTab();
                        break;
                    case 'style':
                        newContent = window.aiAssistantV27.createStyleTab();
                        break;
                    case 'analytics':
                        newContent = window.aiAssistantV27.createAnalyticsTab();
                        break;
                    case 'history':
                        newContent = window.aiAssistantV27.createHistoryTab();
                        break;
                }
                
                if (newContent) {
                    // 移除現有的同名內容
                    const existingContent = document.getElementById(`${tabName}-tab`);
                    if (existingContent) {
                        existingContent.remove();
                    }
                    
                    // 添加新內容
                    contentContainer.insertAdjacentHTML('beforeend', newContent);
                    console.log(`✅ 已重新創建標籤內容: ${tabName}-tab`);
                }
                
            } catch (error) {
                console.error(`❌ 重新創建標籤內容失敗 ${tabName}:`, error);
            }
        }

        // 診斷工具
        diagnose() {
            const aiAssistant = document.querySelector('.ai-assistant-v27');
            const localAI = document.querySelector('.local-ai-manager');
            
            console.log('🔍 標籤切換診斷:');
            console.log('AI Assistant 存在:', !!aiAssistant);
            console.log('Local AI 存在:', !!localAI);
            
            if (aiAssistant) {
                const tabButtons = aiAssistant.querySelectorAll('.tab-button');
                const tabContents = aiAssistant.querySelectorAll('.tab-content');
                console.log('AI Assistant 標籤按鈕數量:', tabButtons.length);
                console.log('AI Assistant 標籤內容數量:', tabContents.length);
            }
            
            if (localAI) {
                const tabButtons = localAI.querySelectorAll('.tab-button');
                const tabContents = localAI.querySelectorAll('.tab-content');
                console.log('Local AI 標籤按鈕數量:', tabButtons.length);
                console.log('Local AI 標籤內容數量:', tabContents.length);
            }
        }
    }

    // 立即初始化
    window.tabSwitchFix = new TabSwitchFix();

    // 提供全域診斷函數
    window.diagnoseTabSwitching = () => {
        if (window.tabSwitchFix) {
            window.tabSwitchFix.diagnose();
        }
    };

    // 修復函數
    window.fixTabSwitching = () => {
        window.tabSwitchFix = new TabSwitchFix();
        console.log('🔧 已重新初始化標籤切換修正');
    };

    console.log('🚀 標籤切換修正腳本已載入');
    </script>
    
    <!-- 深色模式保護性修正 -->
    <style>
    /* 深色模式保護性修正 - 確保深色模式不受淺色模式修正影響 */
    [data-theme="dark"] .ai-assistant-v27,
    body[data-theme="dark"] .ai-assistant-v27 {
        background-color: #1a1a1a !important;
        color: white !important;
    }

    [data-theme="dark"] .tab-content,
    [data-theme="dark"] .batch-settings,
    [data-theme="dark"] .batch-section,
    [data-theme="dark"] .enhance-section,
    [data-theme="dark"] .translate-section,
    [data-theme="dark"] .style-section,
    [data-theme="dark"] .analytics-section,
    [data-theme="dark"] .history-section,
    body[data-theme="dark"] .tab-content,
    body[data-theme="dark"] .batch-settings,
    body[data-theme="dark"] .batch-section,
    body[data-theme="dark"] .enhance-section,
    body[data-theme="dark"] .translate-section,
    body[data-theme="dark"] .style-section,
    body[data-theme="dark"] .analytics-section,
    body[data-theme="dark"] .history-section {
        background-color: #2d2d2d !important;
        color: white !important;
    }

    [data-theme="dark"] .settings-grid,
    [data-theme="dark"] .setting-group,
    [data-theme="dark"] .option-group,
    [data-theme="dark"] .options-grid,
    [data-theme="dark"] .input-group,
    [data-theme="dark"] .batch-header,
    [data-theme="dark"] .batch-controls,
    [data-theme="dark"] .batch-prompts-container,
    [data-theme="dark"] .prompts-list,
    [data-theme="dark"] .empty-state,
    body[data-theme="dark"] .settings-grid,
    body[data-theme="dark"] .setting-group,
    body[data-theme="dark"] .option-group,
    body[data-theme="dark"] .options-grid,
    body[data-theme="dark"] .input-group,
    body[data-theme="dark"] .batch-header,
    body[data-theme="dark"] .batch-controls,
    body[data-theme="dark"] .batch-prompts-container,
    body[data-theme="dark"] .prompts-list,
    body[data-theme="dark"] .empty-state {
        background-color: #2d2d2d !important;
        color: white !important;
    }

    [data-theme="dark"] .ai-assistant-v27 input,
    [data-theme="dark"] .ai-assistant-v27 select,
    [data-theme="dark"] .ai-assistant-v27 textarea,
    body[data-theme="dark"] .ai-assistant-v27 input,
    body[data-theme="dark"] .ai-assistant-v27 select,
    body[data-theme="dark"] .ai-assistant-v27 textarea {
        background-color: #374151 !important;
        color: white !important;
        border: 1px solid #4b5563 !important;
    }

    [data-theme="dark"] .ai-assistant-v27 label,
    [data-theme="dark"] .ai-assistant-v27 h4,
    [data-theme="dark"] .ai-assistant-v27 h5,
    [data-theme="dark"] .ai-assistant-v27 p,
    [data-theme="dark"] .ai-assistant-v27 span,
    [data-theme="dark"] .ai-assistant-v27 div,
    body[data-theme="dark"] .ai-assistant-v27 label,
    body[data-theme="dark"] .ai-assistant-v27 h4,
    body[data-theme="dark"] .ai-assistant-v27 h5,
    body[data-theme="dark"] .ai-assistant-v27 p,
    body[data-theme="dark"] .ai-assistant-v27 span,
    body[data-theme="dark"] .ai-assistant-v27 div {
        color: white !important;
    }

    [data-theme="dark"] .ai-assistant-v27 .secondary-button,
    [data-theme="dark"] .ai-assistant-v27 .action-button,
    body[data-theme="dark"] .ai-assistant-v27 .secondary-button,
    body[data-theme="dark"] .ai-assistant-v27 .action-button {
        background-color: #374151 !important;
        color: white !important;
        border: 1px solid #4b5563 !important;
    }

    [data-theme="dark"] .ai-assistant-header h3,
    [data-theme="dark"] .status-indicator,
    body[data-theme="dark"] .ai-assistant-header h3,
    body[data-theme="dark"] .status-indicator {
        color: white !important;
    }
    </style>
    
    <!-- 標籤背景色修正 -->
    <style>
    /* 淺色模式標籤背景修正 */
    [data-theme="light"] .tab-button.active,
    body:not([data-theme="dark"]) .tab-button.active {
        background-color: #2563eb !important; /* 藍色背景 */
        color: white !important; /* 白色文字 */
        border: 1px solid #2563eb !important;
    }

    [data-theme="light"] .tab-button:not(.active),
    body:not([data-theme="dark"]) .tab-button:not(.active) {
        background-color: #f3f4f6 !important; /* 淺灰色背景 */
        color: black !important; /* 黑色文字 */
        border: 1px solid #d1d5db !important;
    }

    [data-theme="light"] .tab-button:not(.active):hover,
    body:not([data-theme="dark"]) .tab-button:not(.active):hover {
        background-color: #e5e7eb !important;
        color: black !important;
        border: 1px solid #9ca3af !important;
    }

    /* 特別針對問題標籤 */
    [data-theme="light"] .tab-button[data-tab="batch"],
    [data-theme="light"] .tab-button[data-tab="analytics"], 
    [data-theme="light"] .tab-button[data-tab="history"],
    body:not([data-theme="dark"]) .tab-button[data-tab="batch"],
    body:not([data-theme="dark"]) .tab-button[data-tab="analytics"],
    body:not([data-theme="dark"]) .tab-button[data-tab="history"] {
        background-color: #f3f4f6 !important;
        color: black !important;
        border: 1px solid #d1d5db !important;
    }

    [data-theme="light"] .tab-button[data-tab="batch"].active,
    [data-theme="light"] .tab-button[data-tab="analytics"].active, 
    [data-theme="light"] .tab-button[data-tab="history"].active,
    body:not([data-theme="dark"]) .tab-button[data-tab="batch"].active,
    body:not([data-theme="dark"]) .tab-button[data-tab="analytics"].active,
    body:not([data-theme="dark"]) .tab-button[data-tab="history"].active {
        background-color: #2563eb !important;
        color: white !important;
        border: 1px solid #2563eb !important;
    }

    /* 標籤容器背景 */
    [data-theme="light"] .ai-assistant-tabs,
    [data-theme="light"] .local-ai-tabs,
    body:not([data-theme="dark"]) .ai-assistant-tabs,
    body:not([data-theme="dark"]) .local-ai-tabs {
        background-color: white !important;
    }

    /* 標籤內容區域背景 */
    [data-theme="light"] .tab-content,
    body:not([data-theme="dark"]) .tab-content {
        background-color: white !important;
        color: black !important;
    }

    /* 修正標籤內容中的具體元素 */
    [data-theme="light"] .batch-settings,
    [data-theme="light"] .batch-section,
    [data-theme="light"] .enhance-section,
    [data-theme="light"] .translate-section,
    [data-theme="light"] .style-section,
    [data-theme="light"] .analytics-section,
    [data-theme="light"] .history-section,
    body:not([data-theme="dark"]) .batch-settings,
    body:not([data-theme="dark"]) .batch-section,
    body:not([data-theme="dark"]) .enhance-section,
    body:not([data-theme="dark"]) .translate-section,
    body:not([data-theme="dark"]) .style-section,
    body:not([data-theme="dark"]) .analytics-section,
    body:not([data-theme="dark"]) .history-section {
        background-color: white !important;
        color: black !important;
    }

    /* 修正設置網格和選項組 */
    [data-theme="light"] .settings-grid,
    [data-theme="light"] .setting-group,
    [data-theme="light"] .option-group,
    [data-theme="light"] .options-grid,
    body:not([data-theme="dark"]) .settings-grid,
    body:not([data-theme="dark"]) .setting-group,
    body:not([data-theme="dark"]) .option-group,
    body:not([data-theme="dark"]) .options-grid {
        background-color: white !important;
        color: black !important;
    }

    /* 修正進度和統計區域 */
    [data-theme="light"] .batch-progress,
    [data-theme="light"] .batch-results,
    [data-theme="light"] .batch-stats,
    [data-theme="light"] .progress-header,
    [data-theme="light"] .results-header,
    body:not([data-theme="dark"]) .batch-progress,
    body:not([data-theme="dark"]) .batch-results,
    body:not([data-theme="dark"]) .batch-stats,
    body:not([data-theme="dark"]) .progress-header,
    body:not([data-theme="dark"]) .results-header {
        background-color: white !important;
        color: black !important;
    }

    /* 修正表單元素 */
    [data-theme="light"] .tab-content input,
    [data-theme="light"] .tab-content select,
    [data-theme="light"] .tab-content textarea,
    body:not([data-theme="dark"]) .tab-content input,
    body:not([data-theme="dark"]) .tab-content select,
    body:not([data-theme="dark"]) .tab-content textarea {
        background-color: white !important;
        color: black !important;
        border: 1px solid #d1d5db !important;
    }

    /* 修正標籤文字 */
    [data-theme="light"] .tab-content label,
    [data-theme="light"] .tab-content h4,
    [data-theme="light"] .tab-content h5,
    [data-theme="light"] .tab-content p,
    [data-theme="light"] .tab-content span,
    body:not([data-theme="dark"]) .tab-content label,
    body:not([data-theme="dark"]) .tab-content h4,
    body:not([data-theme="dark"]) .tab-content h5,
    body:not([data-theme="dark"]) .tab-content p,
    body:not([data-theme="dark"]) .tab-content span {
        color: black !important;
    }

    /* 修正按鈕 */
    [data-theme="light"] .tab-content .primary-button,
    [data-theme="light"] .tab-content .secondary-button,
    [data-theme="light"] .tab-content .danger-button,
    [data-theme="light"] .tab-content .action-button,
    body:not([data-theme="dark"]) .tab-content .primary-button,
    body:not([data-theme="dark"]) .tab-content .secondary-button,
    body:not([data-theme="dark"]) .tab-content .danger-button,
    body:not([data-theme="dark"]) .tab-content .action-button {
        background-color: #f3f4f6 !important;
        color: black !important;
        border: 1px solid #d1d5db !important;
    }

    /* 主要按鈕保持藍色 */
    [data-theme="light"] .tab-content .primary-button,
    body:not([data-theme="dark"]) .tab-content .primary-button {
        background-color: #2563eb !important;
        color: white !important;
        border: 1px solid #2563eb !important;
    }

    /* 危險按鈕保持紅色 */
    [data-theme="light"] .tab-content .danger-button,
    body:not([data-theme="dark"]) .tab-content .danger-button {
        background-color: #dc2626 !important;
        color: white !important;
        border: 1px solid #dc2626 !important;
    }

    /* 修正所有 AI Assistant 內容區域 */
    [data-theme="light"] .ai-assistant-v27 *,
    body:not([data-theme="dark"]) .ai-assistant-v27 * {
        background-color: inherit !important;
        color: inherit !important;
    }

    /* 確保主容器是白色背景黑色文字 */
    [data-theme="light"] .ai-assistant-v27,
    body:not([data-theme="dark"]) .ai-assistant-v27 {
        background-color: white !important;
        color: black !important;
    }
    </style>

    <!-- 深色模式顏色優化修正 -->
    <style>
    /* === 深色模式顏色系統優化 === */
    
    /* 定義更好的深色模式顏色變數 */
    [data-theme="dark"],
    body[data-theme="dark"] {
        --dark-bg-primary: #0f172a;      /* 深藍黑主背景 - 更好的對比度 */
        --dark-bg-secondary: #1e293b;    /* 次要背景 - 深藍灰 */
        --dark-bg-tertiary: #334155;     /* 第三級背景 - 中藍灰 */
        --dark-bg-elevated: #475569;     /* 浮起元素 - 淺藍灰 */
        --dark-text-primary: #f8fafc;    /* 主要文字 - 近白色 */
        --dark-text-secondary: #e2e8f0;  /* 次要文字 - 淺灰 */
        --dark-text-muted: #cbd5e1;      /* 輔助文字 - 中灰 */
        --dark-border: #475569;          /* 邊框色 */
        --dark-border-light: transparent; /* 淺邊框 - 設為透明 */
        --dark-accent-blue: #3b82f6;     /* 主要藍色 */
        --dark-accent-blue-hover: #2563eb; /* 藍色懸停 */
    }

    /* 重新定義 AI 智能助手主容器 */
    [data-theme="dark"] .ai-assistant-v27,
    body[data-theme="dark"] .ai-assistant-v27 {
        background-color: var(--dark-bg-primary) !important;
        color: var(--dark-text-primary) !important;
        border: 1px solid var(--dark-border) !important;
        box-shadow: 0 4px 12px rgba(0, 0, 0, 0.3) !important;
    }

    /* 標題區域優化 */
    [data-theme="dark"] .ai-assistant-header,
    body[data-theme="dark"] .ai-assistant-header {
        background: linear-gradient(135deg, var(--dark-bg-secondary) 0%, var(--dark-bg-tertiary) 100%) !important;
        color: var(--dark-text-primary) !important;
        border-bottom: 1px solid var(--dark-border) !important;
    }

    [data-theme="dark"] .ai-assistant-header h3,
    body[data-theme="dark"] .ai-assistant-header h3 {
        color: var(--dark-text-primary) !important;
    }

    /* 狀態指示器優化 */
    [data-theme="dark"] .status-indicator,
    body[data-theme="dark"] .status-indicator {
        background-color: var(--dark-bg-tertiary) !important;
        color: var(--dark-text-secondary) !important;
        border: 1px solid var(--dark-border-light) !important;
    }

    /* 標籤按鈕系統優化 */
    [data-theme="dark"] .tab-button:not(.active),
    body[data-theme="dark"] .tab-button:not(.active) {
        background-color: var(--dark-bg-tertiary) !important;
        color: var(--dark-text-secondary) !important;
        border: 1px solid var(--dark-border-light) !important;
    }

    [data-theme="dark"] .tab-button.active,
    body[data-theme="dark"] .tab-button.active {
        background-color: var(--dark-accent-blue) !important;
        color: white !important;
        border: 1px solid var(--dark-accent-blue) !important;
        box-shadow: 0 2px 4px rgba(59, 130, 246, 0.2) !important;
    }

    [data-theme="dark"] .tab-button:not(.active):hover,
    body[data-theme="dark"] .tab-button:not(.active):hover {
        background-color: var(--dark-bg-elevated) !important;
        color: var(--dark-text-primary) !important;
        border: 1px solid var(--dark-border) !important;
    }

    /* 重新定義內容區域 */
    [data-theme="dark"] .tab-content,
    [data-theme="dark"] .batch-settings,
    [data-theme="dark"] .batch-section,
    [data-theme="dark"] .enhance-section,
    [data-theme="dark"] .translate-section,
    [data-theme="dark"] .style-section,
    [data-theme="dark"] .analytics-section,
    [data-theme="dark"] .history-section,
    body[data-theme="dark"] .tab-content,
    body[data-theme="dark"] .batch-settings,
    body[data-theme="dark"] .batch-section,
    body[data-theme="dark"] .enhance-section,
    body[data-theme="dark"] .translate-section,
    body[data-theme="dark"] .style-section,
    body[data-theme="dark"] .analytics-section,
    body[data-theme="dark"] .history-section {
        background-color: var(--dark-bg-secondary) !important;
        color: var(--dark-text-primary) !important;
    }

    /* 設置區域優化 */
    [data-theme="dark"] .settings-grid,
    [data-theme="dark"] .setting-group,
    [data-theme="dark"] .option-group,
    [data-theme="dark"] .options-grid,
    [data-theme="dark"] .input-group,
    [data-theme="dark"] .batch-header,
    [data-theme="dark"] .batch-controls,
    [data-theme="dark"] .batch-prompts-container,
    [data-theme="dark"] .prompts-list,
    [data-theme="dark"] .empty-state,
    body[data-theme="dark"] .settings-grid,
    body[data-theme="dark"] .setting-group,
    body[data-theme="dark"] .option-group,
    body[data-theme="dark"] .options-grid,
    body[data-theme="dark"] .input-group,
    body[data-theme="dark"] .batch-header,
    body[data-theme="dark"] .batch-controls,
    body[data-theme="dark"] .batch-prompts-container,
    body[data-theme="dark"] .prompts-list,
    body[data-theme="dark"] .empty-state {
        background-color: var(--dark-bg-tertiary) !important;
        color: var(--dark-text-primary) !important;
        border: 1px solid var(--dark-border-light) !important;
    }

    /* 表單元素優化 */
    [data-theme="dark"] .ai-assistant-v27 input,
    [data-theme="dark"] .ai-assistant-v27 select,
    [data-theme="dark"] .ai-assistant-v27 textarea,
    body[data-theme="dark"] .ai-assistant-v27 input,
    body[data-theme="dark"] .ai-assistant-v27 select,
    body[data-theme="dark"] .ai-assistant-v27 textarea {
        background-color: var(--dark-bg-elevated) !important;
        color: var(--dark-text-primary) !important;
        border: 1px solid var(--dark-border) !important;
    }

    /* 表單元素聚焦效果 */
    [data-theme="dark"] .ai-assistant-v27 input:focus,
    [data-theme="dark"] .ai-assistant-v27 select:focus,
    [data-theme="dark"] .ai-assistant-v27 textarea:focus,
    body[data-theme="dark"] .ai-assistant-v27 input:focus,
    body[data-theme="dark"] .ai-assistant-v27 select:focus,
    body[data-theme="dark"] .ai-assistant-v27 textarea:focus {
        border-color: var(--dark-accent-blue) !important;
        box-shadow: 0 0 0 3px rgba(59, 130, 246, 0.1) !important;
        background-color: var(--dark-bg-primary) !important;
    }

    /* 文字元素優化 */
    [data-theme="dark"] .ai-assistant-v27 label,
    [data-theme="dark"] .ai-assistant-v27 h4,
    [data-theme="dark"] .ai-assistant-v27 h5,
    [data-theme="dark"] .ai-assistant-v27 p,
    [data-theme="dark"] .ai-assistant-v27 span,
    [data-theme="dark"] .ai-assistant-v27 div,
    body[data-theme="dark"] .ai-assistant-v27 label,
    body[data-theme="dark"] .ai-assistant-v27 h4,
    body[data-theme="dark"] .ai-assistant-v27 h5,
    body[data-theme="dark"] .ai-assistant-v27 p,
    body[data-theme="dark"] .ai-assistant-v27 span,
    body[data-theme="dark"] .ai-assistant-v27 div {
        color: var(--dark-text-primary) !important;
    }

    /* 次要文字 */
    [data-theme="dark"] .ai-assistant-v27 .text-secondary,
    [data-theme="dark"] .ai-assistant-v27 .help-text,
    [data-theme="dark"] .ai-assistant-v27 .meta-info,
    body[data-theme="dark"] .ai-assistant-v27 .text-secondary,
    body[data-theme="dark"] .ai-assistant-v27 .help-text,
    body[data-theme="dark"] .ai-assistant-v27 .meta-info {
        color: var(--dark-text-secondary) !important;
    }

    /* 按鈕系統重新定義 */
    [data-theme="dark"] .ai-assistant-v27 .primary-button,
    body[data-theme="dark"] .ai-assistant-v27 .primary-button {
        background-color: var(--dark-accent-blue) !important;
        color: white !important;
        border: 1px solid var(--dark-accent-blue) !important;
    }

    [data-theme="dark"] .ai-assistant-v27 .primary-button:hover,
    body[data-theme="dark"] .ai-assistant-v27 .primary-button:hover {
        background-color: var(--dark-accent-blue-hover) !important;
        border-color: var(--dark-accent-blue-hover) !important;
    }

    [data-theme="dark"] .ai-assistant-v27 .secondary-button,
    [data-theme="dark"] .ai-assistant-v27 .action-button,
    body[data-theme="dark"] .ai-assistant-v27 .secondary-button,
    body[data-theme="dark"] .ai-assistant-v27 .action-button {
        background-color: var(--dark-bg-elevated) !important;
        color: var(--dark-text-primary) !important;
        border: 1px solid var(--dark-border) !important;
    }

    [data-theme="dark"] .ai-assistant-v27 .secondary-button:hover,
    [data-theme="dark"] .ai-assistant-v27 .action-button:hover,
    body[data-theme="dark"] .ai-assistant-v27 .secondary-button:hover,
    body[data-theme="dark"] .ai-assistant-v27 .action-button:hover {
        background-color: var(--dark-bg-tertiary) !important;
    }

    /* 進度條優化 */
    [data-theme="dark"] .progress-bar,
    body[data-theme="dark"] .progress-bar {
        background-color: var(--dark-bg-elevated) !important;
        border: 1px solid var(--dark-border-light) !important;
    }

    [data-theme="dark"] .progress-fill,
    body[data-theme="dark"] .progress-fill {
        background: linear-gradient(90deg, var(--dark-accent-blue), var(--dark-accent-blue-hover)) !important;
    }

    /* 滾動條美化 */
    [data-theme="dark"] .ai-assistant-v27 ::-webkit-scrollbar,
    body[data-theme="dark"] .ai-assistant-v27 ::-webkit-scrollbar {
        width: 8px;
        height: 8px;
    }

    [data-theme="dark"] .ai-assistant-v27 ::-webkit-scrollbar-track,
    body[data-theme="dark"] .ai-assistant-v27 ::-webkit-scrollbar-track {
        background: var(--dark-bg-secondary);
        border-radius: 4px;
    }

    [data-theme="dark"] .ai-assistant-v27 ::-webkit-scrollbar-thumb,
    body[data-theme="dark"] .ai-assistant-v27 ::-webkit-scrollbar-thumb {
        background: var(--dark-border);
        border-radius: 4px;
    }

    [data-theme="dark"] .ai-assistant-v27 ::-webkit-scrollbar-thumb:hover,
    body[data-theme="dark"] .ai-assistant-v27 ::-webkit-scrollbar-thumb:hover {
        background: var(--dark-bg-elevated);
    }

    /* 修正任何殘餘的顏色問題 */
    [data-theme="dark"] .ai-assistant-v27 .tab-content *:not(.primary-button):not(.danger-button):not(.success-button),
    body[data-theme="dark"] .ai-assistant-v27 .tab-content *:not(.primary-button):not(.danger-button):not(.success-button) {
        color: inherit !important;
    }

    /* 確保圖標和符號正確顯示 */
    [data-theme="dark"] .ai-assistant-v27 .icon,
    [data-theme="dark"] .ai-assistant-v27 i,
    body[data-theme="dark"] .ai-assistant-v27 .icon,
    body[data-theme="dark"] .ai-assistant-v27 i {
        color: var(--dark-text-secondary) !important;
    }

    [data-theme="dark"] .ai-assistant-v27 .icon.active,
    [data-theme="dark"] .ai-assistant-v27 i.active,
    body[data-theme="dark"] .ai-assistant-v27 .icon.active,
    body[data-theme="dark"] .ai-assistant-v27 i.active {
        color: var(--dark-accent-blue) !important;
    }
    </style>

    <!-- 深色模式顏色系統優化 -->
    <style>
    /* 深色模式改進的顏色變數 */
    [data-theme="dark"] {
        --improved-bg-primary: #0f172a;
        --improved-bg-secondary: #1e293b;
        --improved-bg-tertiary: #334155;
        --improved-text-primary: #f8fafc;
        --improved-text-secondary: #e2e8f0;
        --improved-border: #475569;
        --improved-accent: #3b82f6;
    }

    /* 改進的 AI 智能助手背景 */
    [data-theme="dark"] .ai-assistant-v27,
    body[data-theme="dark"] .ai-assistant-v27 {
        background-color: var(--improved-bg-primary) !important;
        color: var(--improved-text-primary) !important;
        border: 1px solid var(--improved-border) !important;
    }

    /* 改進的標籤內容背景 */
    [data-theme="dark"] .tab-content,
    body[data-theme="dark"] .tab-content {
        background-color: var(--improved-bg-secondary) !important;
        color: var(--improved-text-primary) !important;
    }

    /* 改進的設置區域背景 */
    [data-theme="dark"] .settings-grid,
    [data-theme="dark"] .option-group,
    body[data-theme="dark"] .settings-grid,
    body[data-theme="dark"] .option-group {
        background-color: var(--improved-bg-tertiary) !important;
        color: var(--improved-text-primary) !important;
        border: 1px solid var(--improved-border) !important;
    }

    /* 改進的表單元素 */
    [data-theme="dark"] .ai-assistant-v27 input,
    [data-theme="dark"] .ai-assistant-v27 select,
    body[data-theme="dark"] .ai-assistant-v27 input,
    body[data-theme="dark"] .ai-assistant-v27 select {
        background-color: var(--improved-bg-tertiary) !important;
        color: var(--improved-text-primary) !important;
        border: 1px solid var(--improved-border) !important;
    }

    /* 改進的按鈕 */
    [data-theme="dark"] .ai-assistant-v27 .secondary-button,
    body[data-theme="dark"] .ai-assistant-v27 .secondary-button {
        background-color: var(--improved-bg-tertiary) !important;
        color: var(--improved-text-primary) !important;
        border: 1px solid var(--improved-border) !important;
    }
    </style>

    <!-- 針對具體元素的深色模式修正 -->
    <style>
    /* === 您要求的具體修正 === */
    
    /* generatorTab 區域 - 黑色背景白色文字 */
    [data-theme="dark"] #generatorTab.tab-content,
    body[data-theme="dark"] #generatorTab.tab-content {
        background-color: #000000 !important;
        color: #ffffff !important;
    }

    /* AI 智能助手 v2.7 標題 - 白色文字 */
    [data-theme="dark"] #generatorTab h3,
    body[data-theme="dark"] #generatorTab h3 {
        color: #ffffff !important;
        background-color: transparent !important;
    }

    /* status-indicators 區域 - 黑色背景白色文字 */
    [data-theme="dark"] .status-indicators,
    body[data-theme="dark"] .status-indicators {
        background-color: #000000 !important;
        color: #ffffff !important;
    }

    /* generatorTab 內的所有直接子元素 */
    [data-theme="dark"] #generatorTab > *,
    body[data-theme="dark"] #generatorTab > * {
        background-color: #000000 !important;
        color: #ffffff !important;
    }

    /* generatorTab 內的 main-content 區域 */
    [data-theme="dark"] #generatorTab .main-content,
    body[data-theme="dark"] #generatorTab .main-content {
        background-color: #000000 !important;
        color: #ffffff !important;
    }

    /* generatorTab 內的 input-section */
    [data-theme="dark"] #generatorTab .input-section,
    body[data-theme="dark"] #generatorTab .input-section {
        background-color: #000000 !important;
        color: #ffffff !important;
    }

    /* generatorTab 內的所有標題 */
    [data-theme="dark"] #generatorTab h1,
    [data-theme="dark"] #generatorTab h2,
    [data-theme="dark"] #generatorTab h3,
    [data-theme="dark"] #generatorTab h4,
    [data-theme="dark"] #generatorTab h5,
    body[data-theme="dark"] #generatorTab h1,
    body[data-theme="dark"] #generatorTab h2,
    body[data-theme="dark"] #generatorTab h3,
    body[data-theme="dark"] #generatorTab h4,
    body[data-theme="dark"] #generatorTab h5 {
        color: #ffffff !important;
        background-color: transparent !important;
    }

    /* generatorTab 內的所有段落和文字 */
    [data-theme="dark"] #generatorTab p,
    [data-theme="dark"] #generatorTab span,
    [data-theme="dark"] #generatorTab div,
    [data-theme="dark"] #generatorTab label,
    body[data-theme="dark"] #generatorTab p,
    body[data-theme="dark"] #generatorTab span,
    body[data-theme="dark"] #generatorTab div,
    body[data-theme="dark"] #generatorTab label {
        color: #ffffff !important;
    }

    /* 確保 generatorTab 內的容器都是黑色背景 */
    [data-theme="dark"] #generatorTab .container,
    [data-theme="dark"] #generatorTab .prompts-container,
    body[data-theme="dark"] #generatorTab .container,
    body[data-theme="dark"] #generatorTab .prompts-container {
        background-color: #000000 !important;
        color: #ffffff !important;
    }

    /* generatorTab 內的 header 區域 */
    [data-theme="dark"] #generatorTab header,
    body[data-theme="dark"] #generatorTab header {
        background-color: #000000 !important;
        color: #ffffff !important;
    }

    /* 應用到整個 generatorTab 及其所有子元素 */
    [data-theme="dark"] #generatorTab,
    [data-theme="dark"] #generatorTab *,
    body[data-theme="dark"] #generatorTab,
    body[data-theme="dark"] #generatorTab * {
        background-color: #000000 !important;
        color: #ffffff !important;
    }

    /* 確保按鈕保持正確的顏色 */
    [data-theme="dark"] #generatorTab .primary-button,
    body[data-theme="dark"] #generatorTab .primary-button {
        background-color: #2563eb !important;
        color: #ffffff !important;
    }

    [data-theme="dark"] #generatorTab .secondary-button,
    body[data-theme="dark"] #generatorTab .secondary-button {
        background-color: #333333 !important;
        color: #ffffff !important;
        border: 1px solid #555555 !important;
    }

    /* === 您要求的具體修正：generatorTab 黑色背景白色文字 === */
    [data-theme="dark"] #generatorTab {
        background-color: #000000 !important;
        color: #ffffff !important;
    }

    [data-theme="dark"] #generatorTab h3 {
        color: #ffffff !important;
    }

    [data-theme="dark"] .status-indicators {
        background-color: #000000 !important;
        color: #ffffff !important;
    }

    [data-theme="dark"] #generatorTab * {
        background-color: #000000 !important;
        color: #ffffff !important;
    }
    </style>

    <!-- 按鈕間距修正 -->
    <style>
    /* === 按鈕間距優化 === */
    
    /* 通用按鈕間距 - 所有按鈕之間加上間距 */
    .ai-assistant-v27 button {
        margin: 8px 4px !important;  /* 上下8px，左右4px */
    }
    
    /* 動作按鈕組間距 */
    .action-buttons {
        display: flex !important;
        gap: 12px !important;  /* 按鈕之間12px間距 */
        flex-wrap: wrap !important;  /* 允許換行 */
        margin: 16px 0 !important;  /* 上下16px外邊距 */
    }
    
    /* 風格推薦按鈕特別間距 */
    .ai-assistant-v27 .primary-button,
    .ai-assistant-v27 .secondary-button {
        margin: 8px 8px !important;  /* 增加左右間距 */
        min-width: 120px !important;  /* 設定最小寬度 */
    }
    
    /* 清除緩存和導出數據按鈕間距 */
    .history-controls button,
    .batch-actions button,
    .analytics-actions button {
        margin: 6px 8px !important;
        padding: 8px 16px !important;  /* 內部填充 */
    }
    
    /* 按鈕組容器間距 */
    .button-group {
        display: flex !important;
        gap: 10px !important;
        margin: 12px 0 !important;
        flex-wrap: wrap !important;
    }
    
    /* 表單按鈕間距 */
    .form-actions {
        display: flex !important;
        gap: 15px !important;
        margin-top: 20px !important;
        justify-content: flex-start !important;
    }
    
    /* 工具列按鈕間距 */
    .toolbar-buttons {
        display: flex !important;
        gap: 8px !important;
        flex-wrap: wrap !important;
    }
    
    /* 確保按鈕不會擠在一起 */
    .ai-assistant-v27 .tab-content button {
        margin: 6px 6px !important;
        min-height: 36px !important;  /* 最小高度 */
    }
    
    /* 特定按鈕組的間距修正 */
    .enhancement-controls,
    .translation-controls,
    .style-controls {
        display: flex !important;
        gap: 12px !important;
        margin: 16px 0 !important;
        flex-wrap: wrap !important;
    }
    
    /* 響應式設計 - 手機版更大間距 */
    @media (max-width: 768px) {
        .ai-assistant-v27 button {
            margin: 10px 6px !important;
            min-width: 100px !important;
        }
        
        .action-buttons {
            gap: 15px !important;
            justify-content: center !important;
        }
        
        .button-group {
            gap: 12px !important;
            justify-content: center !important;
        }
    }

    /* === 按鈕間距修正 === */
    .ai-assistant-v27 button {
        margin: 8px 6px !important;
        min-width: 100px !important;
    }
    
    .action-buttons {
        display: flex !important;
        gap: 12px !important;
        flex-wrap: wrap !important;
        margin: 16px 0 !important;
    }
    
    .button-group {
        display: flex !important;
        gap: 10px !important;
        margin: 12px 0 !important;
    }
    </style>

    <!-- Local AI 管理中心 CSS 增強 - 減少緊湊感 -->
    <style>
    /* === 🤖 Local AI 管理中心 增強樣式 === */
    
    .local-ai-manager {
        margin: 3rem 0 !important;
        padding: 0 !important;
        border-radius: 20px !important;
        box-shadow: 0 10px 40px rgba(0, 0, 0, 0.12) !important;
        background: var(--bg-color, #ffffff) !important;
        overflow: hidden !important;
        transition: all 0.4s cubic-bezier(0.4, 0, 0.2, 1) !important;
        border: 1px solid rgba(99, 102, 241, 0.1) !important;
    }
    
    .local-ai-manager:hover {
        box-shadow: 0 20px 60px rgba(0, 0, 0, 0.15) !important;
        transform: translateY(-4px) !important;
        border-color: rgba(99, 102, 241, 0.2) !important;
    }
    
    /* 標題區域大幅增強 */
    .local-ai-header {
        padding: 3rem 3rem !important;
        background: linear-gradient(135deg, #667eea 0%, #764ba2 50%, #f093fb 100%) !important;
        border-bottom: none !important;
        position: relative !important;
        overflow: hidden !important;
        min-height: 120px !important;
    }
    
    /* 添加動態背景效果 */
    .local-ai-header::before {
        content: '';
        position: absolute;
        top: 0;
        left: 0;
        right: 0;
        bottom: 0;
        background: 
            radial-gradient(circle at 20% 80%, rgba(120, 119, 198, 0.3) 0%, transparent 50%),
            radial-gradient(circle at 80% 20%, rgba(255, 119, 198, 0.3) 0%, transparent 50%);
        pointer-events: none;
        animation: shimmer 8s ease-in-out infinite alternate;
    }
    
    @keyframes shimmer {
        0% { opacity: 0.5; }
        100% { opacity: 1; }
    }
    
    /* 標題樣式大幅增強 */
    .local-ai-header h3 {
        margin: 0 !important;
        font-size: 2.2rem !important;
        font-weight: 800 !important;
        color: white !important;
        display: flex !important;
        align-items: center !important;
        gap: 1rem !important;
        text-shadow: 0 4px 8px rgba(0, 0, 0, 0.3) !important;
        position: relative !important;
        z-index: 2 !important;
        letter-spacing: -0.5px !important;
    }
    
    /* 添加閃爍動畫給機器人emoji */
    .local-ai-header h3::first-letter {
        display: inline-block;
        animation: robotPulse 2s ease-in-out infinite;
    }
    
    @keyframes robotPulse {
        0%, 100% { transform: scale(1); }
        50% { transform: scale(1.1); }
    }
    
    /* 左側裝飾條 */
    .local-ai-header h3::before {
        content: '';
        position: absolute;
        left: -1rem;
        top: 50%;
        transform: translateY(-50%);
        width: 6px;
        height: 120%;
        background: linear-gradient(to bottom, #fbbf24, #f59e0b, #d97706);
        border-radius: 3px;
        box-shadow: 0 0 20px rgba(251, 191, 36, 0.5);
    }
    
    /* 狀態指示器增強 */
    .status-indicators {
        display: flex !important;
        gap: 1.5rem !important;
        align-items: center !important;
        position: relative !important;
        z-index: 2 !important;
        flex-wrap: wrap !important;
    }
    
    .status-indicator {
        display: flex !important;
        align-items: center !important;
        gap: 0.75rem !important;
        font-size: 1rem !important;
        font-weight: 600 !important;
        padding: 1rem 1.5rem !important;
        background: rgba(255, 255, 255, 0.2) !important;
        border-radius: 30px !important;
        border: 1px solid rgba(255, 255, 255, 0.3) !important;
        backdrop-filter: blur(20px) !important;
        transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1) !important;
        min-height: 50px !important;
        box-shadow: 0 4px 15px rgba(0, 0, 0, 0.1) !important;
    }
    
    .status-indicator:hover {
        background: rgba(255, 255, 255, 0.25) !important;
        transform: translateY(-2px) scale(1.02) !important;
        box-shadow: 0 8px 25px rgba(0, 0, 0, 0.15) !important;
    }
    
    #initializeLocalAI {
        background: rgba(34, 197, 94, 0.9) !important;
        color: white !important;
        border: 1px solid rgba(34, 197, 94, 0.3) !important;
        padding: 1rem 2rem !important;
        font-weight: 700 !important;
        font-size: 1rem !important;
        transition: all 0.3s ease !important;
    }
    
    #initializeLocalAI:hover {
        background: rgba(34, 197, 94, 1) !important;
        transform: translateY(-2px) scale(1.05) !important;
        box-shadow: 0 10px 30px rgba(34, 197, 94, 0.4) !important;
    }
    
    /* 標籤頁區域增強 */
    .local-ai-tabs {
        background: linear-gradient(to right, #f8fafc, #f1f5f9, #e2e8f0) !important;
        border-bottom: 2px solid rgba(99, 102, 241, 0.1) !important;
        padding: 1rem 2rem !important;
        overflow-x: auto !important;
        display: flex !important;
        gap: 0.75rem !important;
        min-height: 80px !important;
        align-items: center !important;
    }
    
    .local-ai-tabs .tab-button {
        flex: none !important;
        min-width: 160px !important;
        padding: 1.25rem 2rem !important;
        border: none !important;
        background: rgba(255, 255, 255, 0.7) !important;
        color: #64748b !important;
        font-size: 1rem !important;
        font-weight: 600 !important;
        cursor: pointer !important;
        transition: all 0.4s cubic-bezier(0.4, 0, 0.2, 1) !important;
        border-radius: 16px !important;
        white-space: nowrap !important;
        position: relative !important;
        overflow: hidden !important;
        box-shadow: 0 2px 8px rgba(0, 0, 0, 0.05) !important;
        border: 1px solid rgba(0, 0, 0, 0.05) !important;
    }
    
    /* 標籤按鈕懸停動畫 */
    .local-ai-tabs .tab-button::before {
        content: '';
        position: absolute;
        top: 0;
        left: -100%;
        width: 100%;
        height: 100%;
        background: linear-gradient(90deg, transparent, rgba(99, 102, 241, 0.1), transparent);
        transition: left 0.6s ease;
    }
    
    .local-ai-tabs .tab-button:hover::before {
        left: 100%;
    }
    
    .local-ai-tabs .tab-button:hover {
        background: rgba(99, 102, 241, 0.08) !important;
        color: #6366f1 !important;
        transform: translateY(-3px) scale(1.02) !important;
        box-shadow: 0 8px 25px rgba(99, 102, 241, 0.2) !important;
        border-color: rgba(99, 102, 241, 0.2) !important;
    }
    
    .local-ai-tabs .tab-button.active {
        background: linear-gradient(135deg, #6366f1, #8b5cf6) !important;
        color: white !important;
        box-shadow: 0 8px 30px rgba(99, 102, 241, 0.3) !important;
        transform: translateY(-2px) !important;
        border: 1px solid rgba(99, 102, 241, 0.3) !important;
        font-weight: 700 !important;
    }
    
    .local-ai-tabs .tab-button.active::after {
        content: '';
        position: absolute;
        bottom: -2px;
        left: 50%;
        transform: translateX(-50%);
        width: 60%;
        height: 4px;
        background: linear-gradient(to right, #fbbf24, #f59e0b);
        border-radius: 2px;
        box-shadow: 0 2px 8px rgba(251, 191, 36, 0.4);
    }
    
    /* 內容區域增強 */
    .local-ai-content {
        min-height: 600px !important;
        background: var(--bg-color, #ffffff) !important;
        position: relative !important;
    }
    
    .tab-content {
        display: none !important;
        padding: 3rem !important;
        animation: fadeInUp 0.5s ease-out !important;
        min-height: 500px !important;
    }
    
    .tab-content.active {
        display: block !important;
    }
    
    @keyframes fadeInUp {
        from {
            opacity: 0;
            transform: translateY(20px);
        }
        to {
            opacity: 1;
            transform: translateY(0);
        }
    }
    
    /* 深色模式增強 */
    [data-theme="dark"] .local-ai-manager {
        background: #0f172a !important;
        border: 1px solid rgba(99, 102, 241, 0.3) !important;
        box-shadow: 0 10px 40px rgba(0, 0, 0, 0.5) !important;
    }
    
    [data-theme="dark"] .local-ai-manager:hover {
        border-color: rgba(99, 102, 241, 0.5) !important;
        box-shadow: 0 20px 60px rgba(0, 0, 0, 0.7) !important;
    }
    
    [data-theme="dark"] .local-ai-header {
        background: linear-gradient(135deg, #1e293b 0%, #0f172a 50%, #1e1b4b 100%) !important;
    }
    
    [data-theme="dark"] .local-ai-header h3 {
        color: #f8fafc !important;
        text-shadow: 0 4px 8px rgba(0, 0, 0, 0.5) !important;
    }
    
    [data-theme="dark"] .local-ai-tabs {
        background: linear-gradient(to right, #1e293b, #334155, #475569) !important;
        border-bottom-color: rgba(99, 102, 241, 0.3) !important;
    }
    
    [data-theme="dark"] .local-ai-tabs .tab-button {
        background: rgba(51, 65, 85, 0.8) !important;
        color: #cbd5e1 !important;
        border-color: rgba(71, 85, 105, 0.5) !important;
    }
    
    [data-theme="dark"] .local-ai-tabs .tab-button:hover {
        background: rgba(99, 102, 241, 0.2) !important;
        color: #a5b4fc !important;
        border-color: rgba(99, 102, 241, 0.4) !important;
    }
    
    [data-theme="dark"] .local-ai-tabs .tab-button.active {
        background: linear-gradient(135deg, #4f46e5, #7c3aed) !important;
        color: #f8fafc !important;
        border-color: rgba(99, 102, 241, 0.5) !important;
    }
    
    [data-theme="dark"] .local-ai-content {
        background: #0f172a !important;
    }
    
    /* 響應式設計大幅增強 */
    @media (max-width: 768px) {
        .local-ai-manager {
            margin: 2rem 0 !important;
        }
        
        .local-ai-header {
            padding: 2rem 1.5rem !important;
            flex-direction: column !important;
            gap: 1.5rem !important;
            text-align: center !important;
            min-height: 140px !important;
        }
        
        .local-ai-header h3 {
            font-size: 1.8rem !important;
            justify-content: center !important;
        }
        
        .status-indicators {
            flex-wrap: wrap !important;
            justify-content: center !important;
            gap: 1rem !important;
        }
        
        .status-indicator {
            min-width: 140px !important;
            justify-content: center !important;
        }
        
        .local-ai-tabs {
            padding: 0.75rem 1rem !important;
            gap: 0.5rem !important;
            min-height: 70px !important;
        }
        
        .local-ai-tabs .tab-button {
            min-width: 120px !important;
            padding: 1rem 1.25rem !important;
            font-size: 0.9rem !important;
        }
        
        .tab-content {
            padding: 2rem 1.25rem !important;
        }
    }
    
    @media (max-width: 480px) {
        .local-ai-manager {
            margin: 1.5rem 0 !important;
            border-radius: 16px !important;
        }
        
        .local-ai-header {
            padding: 1.5rem 1rem !important;
            min-height: 120px !important;
        }
        
        .local-ai-header h3 {
            font-size: 1.5rem !important;
            gap: 0.75rem !important;
        }
        
        .status-indicator {
            padding: 0.75rem 1rem !important;
            font-size: 0.9rem !important;
            min-width: 120px !important;
        }
        
        .local-ai-tabs .tab-button {
            min-width: 100px !important;
            padding: 0.75rem 1rem !important;
            font-size: 0.85rem !important;
        }
        
        .tab-content {
            padding: 1.5rem 1rem !important;
        }
    }
    
    /* 添加一些精美的細節動畫 */
    .local-ai-manager * {
        transition: all 0.3s ease !important;
    }
    
    /* 載入時的進入動畫 */
    .local-ai-manager {
        animation: slideInFromBottom 0.6s ease-out;
    }
    
    @keyframes slideInFromBottom {
        from {
            opacity: 0;
            transform: translateY(30px);
        }
        to {
            opacity: 1;
            transform: translateY(0);
        }
    }
    </style>
    <!-- 提示詞增強功能 CSS 增強 -->
    <style>
    /* === 🎨 提示詞增強功能增強樣式 === */
    
    #enhance-tab {
        background: linear-gradient(135deg, #f8fafc 0%, #f1f5f9 100%) !important;
        min-height: 700px !important;
        padding: 2rem !important;
    }
    
    /* 原始提示詞輸入區域增強 */
    .enhance-input {
        background: white !important;
        border-radius: 16px !important;
        padding: 2rem !important;
        margin-bottom: 2rem !important;
        box-shadow: 0 4px 20px rgba(0, 0, 0, 0.08) !important;
        border: 1px solid rgba(99, 102, 241, 0.1) !important;
        transition: all 0.3s ease !important;
    }
    
    .enhance-input:hover {
        box-shadow: 0 8px 30px rgba(0, 0, 0, 0.12) !important;
        border-color: rgba(99, 102, 241, 0.2) !important;
        transform: translateY(-2px) !important;
    }
    
    .enhance-input label {
        font-size: 1.1rem !important;
        font-weight: 700 !important;
        color: #1e293b !important;
        margin-bottom: 1rem !important;
        display: flex !important;
        align-items: center !important;
        gap: 0.5rem !important;
    }
    
    #originalPrompt {
        width: 100% !important;
        min-height: 150px !important;
        padding: 1.5rem !important;
        border: 2px solid #e2e8f0 !important;
        border-radius: 12px !important;
        font-size: 1rem !important;
        line-height: 1.6 !important;
        resize: vertical !important;
        font-family: 'Arial', 'Microsoft YaHei', sans-serif !important;
        transition: all 0.3s ease !important;
        background: #fafbfc !important;
    }
    
    #originalPrompt:focus {
        outline: none !important;
        border-color: #6366f1 !important;
        box-shadow: 0 0 0 3px rgba(99, 102, 241, 0.1) !important;
        background: white !important;
    }
    
    #originalPrompt::placeholder {
        color: #94a3b8 !important;
        font-style: italic !important;
    }
    
    /* 增強選項區域 */
    .enhance-options {
        background: white !important;
        border-radius: 16px !important;
        padding: 2rem !important;
        margin-bottom: 2rem !important;
        box-shadow: 0 4px 20px rgba(0, 0, 0, 0.08) !important;
        border: 1px solid rgba(99, 102, 241, 0.1) !important;
    }
    
    .option-group label {
        font-size: 1rem !important;
        font-weight: 600 !important;
        color: #334155 !important;
        margin-bottom: 0.75rem !important;
        display: flex !important;
        align-items: center !important;
        gap: 0.5rem !important;
    }
    
    #enhanceStyle {
        width: 100% !important;
        padding: 1rem 1.25rem !important;
        border: 2px solid #e2e8f0 !important;
        border-radius: 10px !important;
        font-size: 1rem !important;
        background: #fafbfc !important;
        transition: all 0.3s ease !important;
        cursor: pointer !important;
    }
    
    #enhanceStyle:focus {
        outline: none !important;
        border-color: #8b5cf6 !important;
        box-shadow: 0 0 0 3px rgba(139, 92, 246, 0.1) !important;
        background: white !important;
    }
    
    /* 控制按鈕區域大幅增強 */
    .enhance-controls {
        display: flex !important;
        gap: 1.5rem !important;
        justify-content: center !important;
        margin: 3rem 0 !important;
        flex-wrap: wrap !important;
    }
    
    #enhancePromptLocal {
        background: linear-gradient(135deg, #6366f1, #8b5cf6) !important;
        color: white !important;
        border: none !important;
        padding: 1.25rem 2.5rem !important;
        border-radius: 16px !important;
        font-size: 1.1rem !important;
        font-weight: 700 !important;
        cursor: pointer !important;
        transition: all 0.4s cubic-bezier(0.4, 0, 0.2, 1) !important;
        box-shadow: 0 6px 20px rgba(99, 102, 241, 0.3) !important;
        min-width: 180px !important;
        position: relative !important;
        overflow: hidden !important;
    }
    
    #enhancePromptLocal:hover {
        transform: translateY(-3px) scale(1.05) !important;
        box-shadow: 0 10px 40px rgba(99, 102, 241, 0.4) !important;
    }
    
    #enhancePromptLocal:active {
        transform: translateY(-1px) scale(1.02) !important;
    }
    
    #enhancePromptLocal i {
        margin-right: 0.75rem !important;
        font-size: 1.2rem !important;
        animation: sparkle 2s ease-in-out infinite;
    }
    
    @keyframes sparkle {
        0%, 100% { transform: scale(1) rotate(0deg); }
        50% { transform: scale(1.1) rotate(5deg); }
    }
    
    /* 結果展示區域增強 */
    .enhance-results {
        background: white !important;
        border-radius: 20px !important;
        padding: 2.5rem !important;
        margin-top: 2rem !important;
        box-shadow: 0 8px 40px rgba(0, 0, 0, 0.1) !important;
        border: 1px solid rgba(34, 197, 94, 0.2) !important;
        animation: slideInUp 0.5s ease-out !important;
    }
    
    @keyframes slideInUp {
        from {
            opacity: 0;
            transform: translateY(30px);
        }
        to {
            opacity: 1;
            transform: translateY(0);
        }
    }
    
    .result-header {
        display: flex !important;
        justify-content: space-between !important;
        align-items: center !important;
        margin-bottom: 2rem !important;
        padding-bottom: 1rem !important;
        border-bottom: 2px solid #f1f5f9 !important;
    }
    
    .result-header h4 {
        margin: 0 !important;
        font-size: 1.5rem !important;
        font-weight: 700 !important;
        color: #1e293b !important;
        display: flex !important;
        align-items: center !important;
        gap: 0.75rem !important;
    }
    
    /* 增強後提示詞展示 */
    #enhancedPrompt {
        background: linear-gradient(135deg, #f0fdf4, #dcfce7) !important;
        border: 2px solid #22c55e !important;
        border-radius: 12px !important;
        padding: 2rem !important;
        font-size: 1.1rem !important;
        line-height: 1.7 !important;
        color: #15803d !important;
        font-weight: 500 !important;
        word-wrap: break-word !important;
        white-space: pre-wrap !important;
        margin-bottom: 1.5rem !important;
        position: relative !important;
    }
    
    #enhancedPrompt::before {
        content: '✨';
        position: absolute;
        top: -10px;
        right: 15px;
        background: white;
        padding: 5px 10px;
        border-radius: 20px;
        box-shadow: 0 2px 8px rgba(0,0,0,0.1);
        font-size: 1.2rem;
    }
    
    /* 改進建議區域 */
    #enhancementSuggestions {
        background: #fef7ff !important;
        border: 1px solid #e879f9 !important;
        border-radius: 12px !important;
        padding: 1.5rem !important;
        margin-top: 1.5rem !important;
    }
    
    #enhancementSuggestions h5 {
        color: #a855f7 !important;
        font-size: 1.1rem !important;
        font-weight: 600 !important;
        margin-bottom: 1rem !important;
    }
    
    #enhancementSuggestions ul {
        list-style: none !important;
        padding: 0 !important;
        margin: 0 !important;
    }
    
    #enhancementSuggestions li {
        background: white !important;
        border-radius: 8px !important;
        padding: 1rem !important;
        margin-bottom: 0.75rem !important;
        border-left: 4px solid #a855f7 !important;
        box-shadow: 0 2px 8px rgba(168, 85, 247, 0.1) !important;
        transition: all 0.2s ease !important;
    }
    
    #enhancementSuggestions li:hover {
        transform: translateX(5px) !important;
        box-shadow: 0 4px 12px rgba(168, 85, 247, 0.2) !important;
    }
    
    #enhancementSuggestions li::before {
        content: '💡';
        margin-right: 0.5rem;
        font-size: 1.1rem;
    }
    
    /* 深色模式支援 */
    [data-theme="dark"] #enhance-tab {
        background: linear-gradient(135deg, #0f172a 0%, #1e293b 100%) !important;
    }
    
    [data-theme="dark"] .enhance-input,
    [data-theme="dark"] .enhance-options,
    [data-theme="dark"] .enhance-results {
        background: #1e293b !important;
        border-color: rgba(99, 102, 241, 0.3) !important;
    }
    
    [data-theme="dark"] .enhance-input label,
    [data-theme="dark"] .option-group label,
    [data-theme="dark"] .result-header h4 {
        color: #f8fafc !important;
    }
    
    [data-theme="dark"] #originalPrompt,
    [data-theme="dark"] #enhanceStyle {
        background: #334155 !important;
        border-color: #475569 !important;
        color: #f8fafc !important;
    }
    
    [data-theme="dark"] #enhancedPrompt {
        background: linear-gradient(135deg, #064e3b, #065f46) !important;
        border-color: #10b981 !important;
        color: #6ee7b7 !important;
    }
    
    /* 響應式設計 */
    @media (max-width: 768px) {
        #enhance-tab {
            padding: 1rem !important;
        }
        
        .enhance-input,
        .enhance-options,
        .enhance-results {
            padding: 1.5rem !important;
            margin-bottom: 1.5rem !important;
        }
        
        #originalPrompt {
            min-height: 120px !important;
            padding: 1rem !important;
        }
        
        .enhance-controls {
            flex-direction: column !important;
            align-items: center !important;
            gap: 1rem !important;
        }
        
        #enhancePromptLocal {
            width: 100% !important;
            max-width: 300px !important;
            padding: 1rem 2rem !important;
        }
    }
    
    /* 載入狀態動畫 */
    #enhancePromptLocal:disabled i {
        animation: spin 1s linear infinite !important;
    }
    
    @keyframes spin {
        from { transform: rotate(0deg); }
        to { transform: rotate(360deg); }
    }
    
    /* === 額外的提示詞增強功能改進 === */
    
    /* 增加文字輸入框的視覺改進 */
    #enhance-tab .enhance-input {
        position: relative !important;
    }
    
    #enhance-tab .enhance-input::before {
        content: '';
        position: absolute;
        top: 0;
        left: 0;
        right: 0;
        height: 4px;
        background: linear-gradient(90deg, #6366f1, #8b5cf6, #ec4899);
        border-radius: 16px 16px 0 0;
    }
    
    /* 增強選項的圖標美化 */
    #enhanceStyle option {
        padding: 8px 12px !important;
        font-weight: 500 !important;
    }
    
    /* 按鈕群組的進一步美化 */
    .enhance-controls button:nth-child(1) {
        background: linear-gradient(135deg, #6366f1, #8b5cf6) !important;
    }
    
    .enhance-controls button:nth-child(2) {
        background: linear-gradient(135deg, #059669, #10b981) !important;
        color: white !important;
    }
    
    .enhance-controls button:nth-child(3) {
        background: linear-gradient(135deg, #dc2626, #f59e0b) !important;
        color: white !important;
    }
    
    /* 結果區域的成功提示 */
    .enhance-results.show {
        animation: successShow 0.8s cubic-bezier(0.34, 1.56, 0.64, 1) !important;
    }
    
    @keyframes successShow {
        0% {
            opacity: 0;
            transform: scale(0.8) translateY(40px);
        }
        60% {
            transform: scale(1.05) translateY(-5px);
        }
        100% {
            opacity: 1;
            transform: scale(1) translateY(0);
        }
    }
    
    /* 文字計數器樣式 */
    .char-count {
        font-size: 0.85rem !important;
        color: #6b7280 !important;
        font-weight: 500 !important;
    }
    
    /* 提示詞模板按鈕 */
    .template-btn {
        background: white !important;
        border: 2px solid #e2e8f0 !important;
        border-radius: 12px !important;
        padding: 1rem !important;
        cursor: pointer !important;
        transition: all 0.3s ease !important;
        display: flex !important;
        flex-direction: column !important;
        align-items: center !important;
        gap: 0.5rem !important;
        min-width: 80px !important;
    }
    
    .template-btn:hover {
        border-color: #6366f1 !important;
        background: #f8fafc !important;
        transform: translateY(-2px) !important;
        box-shadow: 0 4px 12px rgba(99, 102, 241, 0.15) !important;
    }
    
    .template-btn i {
        font-size: 1.5rem !important;
        color: #6366f1 !important;
    }
    
    .template-btn span {
        font-size: 0.85rem !important;
        font-weight: 600 !important;
        color: #374151 !important;
    }
    
    /* 複製按鈕功能 */
    .copy-button {
        position: absolute !important;
        top: 10px !important;
        right: 50px !important;
        background: rgba(99, 102, 241, 0.1) !important;
        border: 1px solid rgba(99, 102, 241, 0.3) !important;
        border-radius: 6px !important;
        padding: 6px 12px !important;
        font-size: 0.8rem !important;
        cursor: pointer !important;
        transition: all 0.2s ease !important;
    }
    
    .copy-button:hover {
        background: rgba(99, 102, 241, 0.2) !important;
        transform: scale(1.05) !important;
    }
    
    /* 新增：快速動作工具列 */
    .quick-actions {
        display: flex !important;
        gap: 0.5rem !important;
        margin-bottom: 1rem !important;
        justify-content: flex-end !important;
    }
    
    .action-btn {
        background: #f3f4f6 !important;
        border: 1px solid #d1d5db !important;
        border-radius: 6px !important;
        padding: 6px 10px !important;
        cursor: pointer !important;
        transition: all 0.2s ease !important;
        font-size: 0.8rem !important;
    }
    
    .action-btn:hover {
        background: #e5e7eb !important;
        transform: translateY(-1px) !important;
    }
    
    /* 增強樣式選擇的視覺改進 */
    #enhanceStyle {
        background-image: url("data:image/svg+xml;charset=UTF-8,<svg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 24 24' fill='none' stroke='%236366f1' stroke-width='2'><polyline points='6,9 12,15 18,9'></polyline></svg>") !important;
        background-repeat: no-repeat !important;
        background-position: right 12px center !important;
        background-size: 16px !important;
        appearance: none !important;
        -webkit-appearance: none !important;
        -moz-appearance: none !important;
    }
    
    /* 深色模式的模板按鈕 */
    [data-theme="dark"] .template-btn {
        background: #334155 !important;
        border-color: #475569 !important;
        color: #e2e8f0 !important;
    }
    
    [data-theme="dark"] .template-btn:hover {
        background: #475569 !important;
        border-color: #6366f1 !important;
    }
    
    [data-theme="dark"] .template-btn span {
        color: #e2e8f0 !important;
    }
    </style>

    <!-- 提示詞增強功能 JavaScript 增強 -->
    <script>
    // === 🎨 提示詞增強功能 JavaScript 增強 ===
    
    document.addEventListener('DOMContentLoaded', function() {
        // 字符計數功能
        const originalPrompt = document.getElementById('originalPrompt');
        const charCount = document.getElementById('charCount');
        
        if (originalPrompt && charCount) {
            originalPrompt.addEventListener('input', function() {
                const count = this.value.length;
                charCount.textContent = `${count}/2000`;
                
                // 字符數顏色變化
                if (count > 1800) {
                    charCount.style.color = '#dc2626';
                } else if (count > 1500) {
                    charCount.style.color = '#f59e0b';
                } else {
                    charCount.style.color = '#6b7280';
                }
            });
        }
        
        // 快速模板功能
        const templateButtons = document.querySelectorAll('.template-btn');
        templateButtons.forEach(btn => {
            btn.addEventListener('click', function() {
                const template = this.dataset.template;
                const templates = {
                    photo: "專業攝影作品，高解析度，細節豐富，完美光影，攝影師級別構圖",
                    art: "精美藝術作品，細膩筆觸，豐富色彩，藝術大師風格，美術館級別",
                    anime: "精美動漫風格，細膩線條，鮮豔色彩，日系動畫風格，高品質渲染",
                    realistic: "超逼真寫實風格，真實質感，自然光線，真人攝影品質，細節完美",
                    fantasy: "奇幻風格，魔法氛圍，神秘色彩，幻想世界，史詩級場景",
                    portrait: "專業人像攝影，完美光影，自然表情，高品質肖像，攝影棚級別"
                };
                
                if (originalPrompt && templates[template]) {
                    const currentText = originalPrompt.value.trim();
                    const templateText = templates[template];
                    
                    if (currentText) {
                        originalPrompt.value = `${currentText}, ${templateText}`;
                    } else {
                        originalPrompt.value = templateText;
                    }
                    
                    // 觸發字符計數更新
                    originalPrompt.dispatchEvent(new Event('input'));
                    
                    // 視覺反饋
                    this.style.transform = 'scale(0.95)';
                    setTimeout(() => {
                        this.style.transform = 'scale(1)';
                    }, 150);
                }
            });
        });
        
        // 清空按鈕功能
        const clearPrompt = document.getElementById('clearPrompt');
        if (clearPrompt && originalPrompt) {
            clearPrompt.addEventListener('click', function() {
                if (confirm('確定要清空提示詞內容嗎？')) {
                    originalPrompt.value = '';
                    originalPrompt.dispatchEvent(new Event('input'));
                    originalPrompt.focus();
                }
            });
        }
        
        // 貼上按鈕功能
        const pastePrompt = document.getElementById('pastePrompt');
        if (pastePrompt && originalPrompt) {
            pastePrompt.addEventListener('click', async function() {
                try {
                    const text = await navigator.clipboard.readText();
                    if (text) {
                        originalPrompt.value = text;
                        originalPrompt.dispatchEvent(new Event('input'));
                        
                        // 成功提示
                        this.innerHTML = '<i class="fas fa-check"></i>';
                        setTimeout(() => {
                            this.innerHTML = '<i class="fas fa-paste"></i>';
                        }, 1000);
                    }
                } catch (err) {
                    console.log('無法讀取剪貼簿內容:', err);
                    alert('無法讀取剪貼簿內容，請手動貼上。');
                }
            });
        }
        
        // 複製結果功能
        const copyResult = document.getElementById('copyResult');
        const enhancedPrompt = document.getElementById('enhancedPrompt');
        
        if (copyResult && enhancedPrompt) {
            copyResult.addEventListener('click', async function() {
                try {
                    const text = enhancedPrompt.textContent;
                    await navigator.clipboard.writeText(text);
                    
                    // 成功提示
                    const originalIcon = this.innerHTML;
                    this.innerHTML = '<i class="fas fa-check"></i>';
                    this.style.color = '#22c55e';
                    
                    setTimeout(() => {
                        this.innerHTML = originalIcon;
                        this.style.color = '';
                    }, 2000);
                    
                    // 顯示通知
                    showNotification('增強結果已複製到剪貼簿！', 'success');
                    
                } catch (err) {
                    console.error('複製失敗:', err);
                    showNotification('複製失敗，請手動選擇複製。', 'error');
                }
            });
        }
        
        // 增強結果顯示動畫
        const enhanceResults = document.getElementById('enhanceResults');
        if (enhanceResults) {
            // 監聽結果顯示
            const observer = new MutationObserver(function(mutations) {
                mutations.forEach(function(mutation) {
                    if (mutation.type === 'attributes' && mutation.attributeName === 'style') {
                        const target = mutation.target;
                        if (target.style.display !== 'none') {
                            target.classList.add('success-animation');
                            setTimeout(() => {
                                target.classList.remove('success-animation');
                            }, 600);
                        }
                    }
                });
            });
            
            observer.observe(enhanceResults, {
                attributes: true,
                attributeFilter: ['style']
            });
        }
        
        // 快速增強按鈕功能
        const quickEnhance = document.getElementById('quickEnhance');
        if (quickEnhance && originalPrompt) {
            quickEnhance.addEventListener('click', function() {
                const currentText = originalPrompt.value.trim();
                if (!currentText) {
                    alert('請先輸入提示詞！');
                    originalPrompt.focus();
                    return;
                }
                
                // 快速增強邏輯：添加品質修飾詞
                const qualityTerms = [
                    "高品質", "超清晰", "細節豐富", "專業級別", 
                    "完美構圖", "絕佳光影", "頂級品質", "精美細節"
                ];
                
                const randomQuality = qualityTerms[Math.floor(Math.random() * qualityTerms.length)];
                originalPrompt.value = `${currentText}, ${randomQuality}`;
                originalPrompt.dispatchEvent(new Event('input'));
                
                // 視覺反饋
                this.style.background = 'linear-gradient(135deg, #22c55e, #16a34a)';
                setTimeout(() => {
                    this.style.background = '';
                }, 1000);
            });
        }
        
        // 隨機靈感按鈕功能
        const randomEnhance = document.getElementById('randomEnhance');
        if (randomEnhance && originalPrompt) {
            randomEnhance.addEventListener('click', function() {
                const inspirations = [
                    "夢幻色彩，柔和光線",
                    "史詩級場景，宏偉氣勢",
                    "極簡風格，純淨美感",
                    "復古懷舊，溫暖色調",
                    "未來科幻，霓虹光效",
                    "自然野趣，生機盎然",
                    "浪漫唯美，溫馨氛圍",
                    "神秘魔幻，奇幻色彩"
                ];
                
                const randomInspiration = inspirations[Math.floor(Math.random() * inspirations.length)];
                const currentText = originalPrompt.value.trim();
                
                if (currentText) {
                    originalPrompt.value = `${currentText}, ${randomInspiration}`;
                } else {
                    originalPrompt.value = randomInspiration;
                }
                
                originalPrompt.dispatchEvent(new Event('input'));
                
                // 視覺反饋
                this.style.transform = 'rotate(180deg)';
                setTimeout(() => {
                    this.style.transform = 'rotate(0deg)';
                }, 500);
            });
        }
        
        // 保存結果功能
        const saveResult = document.getElementById('saveResult');
        if (saveResult && enhancedPrompt) {
            saveResult.addEventListener('click', function() {
                const text = enhancedPrompt.textContent;
                const blob = new Blob([text], { type: 'text/plain' });
                const url = URL.createObjectURL(blob);
                const a = document.createElement('a');
                a.href = url;
                a.download = `enhanced-prompt-${new Date().getTime()}.txt`;
                document.body.appendChild(a);
                a.click();
                document.body.removeChild(a);
                URL.revokeObjectURL(url);
                
                showNotification('增強結果已保存為文件！', 'success');
            });
        }
        
        // 通知函數
        function showNotification(message, type = 'info') {
            const notification = document.createElement('div');
            notification.className = `notification notification-${type}`;
            notification.textContent = message;
            notification.style.cssText = `
                position: fixed;
                top: 20px;
                right: 20px;
                background: ${type === 'success' ? '#22c55e' : type === 'error' ? '#dc2626' : '#3b82f6'};
                color: white;
                padding: 12px 20px;
                border-radius: 8px;
                z-index: 10000;
                font-weight: 500;
                box-shadow: 0 4px 12px rgba(0,0,0,0.15);
                animation: slideInRight 0.3s ease-out;
            `;
            
            document.body.appendChild(notification);
            
            setTimeout(() => {
                notification.style.animation = 'slideOutRight 0.3s ease-in';
                setTimeout(() => {
                    document.body.removeChild(notification);
                }, 300);
            }, 3000);
        }
    });
    
    // 添加動畫樣式
    const style = document.createElement('style');
    style.textContent = `
        @keyframes slideInRight {
            from { transform: translateX(100%); opacity: 0; }
            to { transform: translateX(0); opacity: 1; }
        }
        @keyframes slideOutRight {
            from { transform: translateX(0); opacity: 1; }
            to { transform: translateX(100%); opacity: 0; }
        }
    `;
    document.head.appendChild(style);
    </script>
    <!-- 重置邊框樣式變數 -->
    <style>
    /* 將 --dark-border-light 變數重置為透明 */
    [data-theme="dark"],
    body[data-theme="dark"] {
        --dark-border-light: transparent !important;
    }
    </style>
</body>
</html> < s t y l e > / *   ��˄@b	gO(u  - - d a r k - b o r d e r - l i g h t   �v��Fh  * / [ d a t a - t h e m e = " d a r k " ]   * ,   b o d y [ d a t a - t h e m e = " d a r k " ]   *   {   b o r d e r - c o l o r :   t r a n s p a r e n t   ! i m p o r t a n t ;   } < / s t y l e > 
 
 